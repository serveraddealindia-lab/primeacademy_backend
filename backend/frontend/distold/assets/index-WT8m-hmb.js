var or=Object.defineProperty;var ir=(t,s,a)=>s in t?or(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a;var la=(t,s,a)=>ir(t,typeof s!="symbol"?s+"":s,a);import{j as e,u as vt,a as _e,b as st,Q as dr,c as cr}from"./query-vendor-pbB2OxY9.js";import{a as mr,r as g,u as Et,b as ur,L as xr,c as xs,R as At,B as gr,d as hr,e as ht,N as pr}from"./react-vendor-Bc501dib.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const h of i.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&r(h)}).observe(document,{childList:!0,subtree:!0});function a(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=a(n);fetch(n.href,i)}})();var Vs={},oa=mr;Vs.createRoot=oa.createRoot,Vs.hydrateRoot=oa.hydrateRoot;function Ea(t,s){return function(){return t.apply(s,arguments)}}const{toString:fr}=Object.prototype,{getPrototypeOf:ta}=Object,{iterator:As,toStringTag:Fa}=Symbol,Ds=(t=>s=>{const a=fr.call(s);return t[a]||(t[a]=a.slice(8,-1).toLowerCase())})(Object.create(null)),Wt=t=>(t=t.toLowerCase(),s=>Ds(s)===t),Is=t=>s=>typeof s===t,{isArray:ls}=Array,ns=Is("undefined");function gs(t){return t!==null&&!ns(t)&&t.constructor!==null&&!ns(t.constructor)&&Rt(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const Ra=Wt("ArrayBuffer");function yr(t){let s;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?s=ArrayBuffer.isView(t):s=t&&t.buffer&&Ra(t.buffer),s}const br=Is("string"),Rt=Is("function"),Oa=Is("number"),hs=t=>t!==null&&typeof t=="object",jr=t=>t===!0||t===!1,Ns=t=>{if(Ds(t)!=="object")return!1;const s=ta(t);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(Fa in t)&&!(As in t)},Nr=t=>{if(!hs(t)||gs(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch{return!1}},vr=Wt("Date"),wr=Wt("File"),Sr=Wt("Blob"),kr=Wt("FileList"),Cr=t=>hs(t)&&Rt(t.pipe),Pr=t=>{let s;return t&&(typeof FormData=="function"&&t instanceof FormData||Rt(t.append)&&((s=Ds(t))==="formdata"||s==="object"&&Rt(t.toString)&&t.toString()==="[object FormData]"))},Ar=Wt("URLSearchParams"),[Dr,Ir,Er,Fr]=["ReadableStream","Request","Response","Headers"].map(Wt),Rr=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ps(t,s,{allOwnKeys:a=!1}={}){if(t===null||typeof t>"u")return;let r,n;if(typeof t!="object"&&(t=[t]),ls(t))for(r=0,n=t.length;r<n;r++)s.call(null,t[r],r,t);else{if(gs(t))return;const i=a?Object.getOwnPropertyNames(t):Object.keys(t),h=i.length;let m;for(r=0;r<h;r++)m=i[r],s.call(null,t[m],m,t)}}function Ta(t,s){if(gs(t))return null;s=s.toLowerCase();const a=Object.keys(t);let r=a.length,n;for(;r-- >0;)if(n=a[r],s===n.toLowerCase())return n;return null}const Yt=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,La=t=>!ns(t)&&t!==Yt;function zs(){const{caseless:t,skipUndefined:s}=La(this)&&this||{},a={},r=(n,i)=>{const h=t&&Ta(a,i)||i;Ns(a[h])&&Ns(n)?a[h]=zs(a[h],n):Ns(n)?a[h]=zs({},n):ls(n)?a[h]=n.slice():(!s||!ns(n))&&(a[h]=n)};for(let n=0,i=arguments.length;n<i;n++)arguments[n]&&ps(arguments[n],r);return a}const Or=(t,s,a,{allOwnKeys:r}={})=>(ps(s,(n,i)=>{a&&Rt(n)?t[i]=Ea(n,a):t[i]=n},{allOwnKeys:r}),t),Tr=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),Lr=(t,s,a,r)=>{t.prototype=Object.create(s.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:s.prototype}),a&&Object.assign(t.prototype,a)},Mr=(t,s,a,r)=>{let n,i,h;const m={};if(s=s||{},t==null)return s;do{for(n=Object.getOwnPropertyNames(t),i=n.length;i-- >0;)h=n[i],(!r||r(h,t,s))&&!m[h]&&(s[h]=t[h],m[h]=!0);t=a!==!1&&ta(t)}while(t&&(!a||a(t,s))&&t!==Object.prototype);return s},qr=(t,s,a)=>{t=String(t),(a===void 0||a>t.length)&&(a=t.length),a-=s.length;const r=t.indexOf(s,a);return r!==-1&&r===a},Br=t=>{if(!t)return null;if(ls(t))return t;let s=t.length;if(!Oa(s))return null;const a=new Array(s);for(;s-- >0;)a[s]=t[s];return a},$r=(t=>s=>t&&s instanceof t)(typeof Uint8Array<"u"&&ta(Uint8Array)),Ur=(t,s)=>{const r=(t&&t[As]).call(t);let n;for(;(n=r.next())&&!n.done;){const i=n.value;s.call(t,i[0],i[1])}},Wr=(t,s)=>{let a;const r=[];for(;(a=t.exec(s))!==null;)r.push(a);return r},Vr=Wt("HTMLFormElement"),zr=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(a,r,n){return r.toUpperCase()+n}),ia=(({hasOwnProperty:t})=>(s,a)=>t.call(s,a))(Object.prototype),Zr=Wt("RegExp"),Ma=(t,s)=>{const a=Object.getOwnPropertyDescriptors(t),r={};ps(a,(n,i)=>{let h;(h=s(n,i,t))!==!1&&(r[i]=h||n)}),Object.defineProperties(t,r)},Kr=t=>{Ma(t,(s,a)=>{if(Rt(t)&&["arguments","caller","callee"].indexOf(a)!==-1)return!1;const r=t[a];if(Rt(r)){if(s.enumerable=!1,"writable"in s){s.writable=!1;return}s.set||(s.set=()=>{throw Error("Can not rewrite read-only method '"+a+"'")})}})},Gr=(t,s)=>{const a={},r=n=>{n.forEach(i=>{a[i]=!0})};return ls(t)?r(t):r(String(t).split(s)),a},_r=()=>{},Jr=(t,s)=>t!=null&&Number.isFinite(t=+t)?t:s;function Qr(t){return!!(t&&Rt(t.append)&&t[Fa]==="FormData"&&t[As])}const Hr=t=>{const s=new Array(10),a=(r,n)=>{if(hs(r)){if(s.indexOf(r)>=0)return;if(gs(r))return r;if(!("toJSON"in r)){s[n]=r;const i=ls(r)?[]:{};return ps(r,(h,m)=>{const j=a(h,n+1);!ns(j)&&(i[m]=j)}),s[n]=void 0,i}}return r};return a(t,0)},Yr=Wt("AsyncFunction"),Xr=t=>t&&(hs(t)||Rt(t))&&Rt(t.then)&&Rt(t.catch),qa=((t,s)=>t?setImmediate:s?((a,r)=>(Yt.addEventListener("message",({source:n,data:i})=>{n===Yt&&i===a&&r.length&&r.shift()()},!1),n=>{r.push(n),Yt.postMessage(a,"*")}))(`axios@${Math.random()}`,[]):a=>setTimeout(a))(typeof setImmediate=="function",Rt(Yt.postMessage)),en=typeof queueMicrotask<"u"?queueMicrotask.bind(Yt):typeof process<"u"&&process.nextTick||qa,tn=t=>t!=null&&Rt(t[As]),Te={isArray:ls,isArrayBuffer:Ra,isBuffer:gs,isFormData:Pr,isArrayBufferView:yr,isString:br,isNumber:Oa,isBoolean:jr,isObject:hs,isPlainObject:Ns,isEmptyObject:Nr,isReadableStream:Dr,isRequest:Ir,isResponse:Er,isHeaders:Fr,isUndefined:ns,isDate:vr,isFile:wr,isBlob:Sr,isRegExp:Zr,isFunction:Rt,isStream:Cr,isURLSearchParams:Ar,isTypedArray:$r,isFileList:kr,forEach:ps,merge:zs,extend:Or,trim:Rr,stripBOM:Tr,inherits:Lr,toFlatObject:Mr,kindOf:Ds,kindOfTest:Wt,endsWith:qr,toArray:Br,forEachEntry:Ur,matchAll:Wr,isHTMLForm:Vr,hasOwnProperty:ia,hasOwnProp:ia,reduceDescriptors:Ma,freezeMethods:Kr,toObjectSet:Gr,toCamelCase:zr,noop:_r,toFiniteNumber:Jr,findKey:Ta,global:Yt,isContextDefined:La,isSpecCompliantForm:Qr,toJSONObject:Hr,isAsyncFn:Yr,isThenable:Xr,setImmediate:qa,asap:en,isIterable:tn};function ut(t,s,a,r,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",s&&(this.code=s),a&&(this.config=a),r&&(this.request=r),n&&(this.response=n,this.status=n.status?n.status:null)}Te.inherits(ut,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Te.toJSONObject(this.config),code:this.code,status:this.status}}});const Ba=ut.prototype,$a={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{$a[t]={value:t}});Object.defineProperties(ut,$a);Object.defineProperty(Ba,"isAxiosError",{value:!0});ut.from=(t,s,a,r,n,i)=>{const h=Object.create(Ba);Te.toFlatObject(t,h,function(q){return q!==Error.prototype},C=>C!=="isAxiosError");const m=t&&t.message?t.message:"Error",j=s==null&&t?t.code:s;return ut.call(h,m,j,a,r,n),t&&h.cause==null&&Object.defineProperty(h,"cause",{value:t,configurable:!0}),h.name=t&&t.name||"Error",i&&Object.assign(h,i),h};const sn=null;function Zs(t){return Te.isPlainObject(t)||Te.isArray(t)}function Ua(t){return Te.endsWith(t,"[]")?t.slice(0,-2):t}function da(t,s,a){return t?t.concat(s).map(function(n,i){return n=Ua(n),!a&&i?"["+n+"]":n}).join(a?".":""):s}function an(t){return Te.isArray(t)&&!t.some(Zs)}const rn=Te.toFlatObject(Te,{},null,function(s){return/^is[A-Z]/.test(s)});function Es(t,s,a){if(!Te.isObject(t))throw new TypeError("target must be an object");s=s||new FormData,a=Te.toFlatObject(a,{metaTokens:!0,dots:!1,indexes:!1},!1,function(w,$){return!Te.isUndefined($[w])});const r=a.metaTokens,n=a.visitor||q,i=a.dots,h=a.indexes,j=(a.Blob||typeof Blob<"u"&&Blob)&&Te.isSpecCompliantForm(s);if(!Te.isFunction(n))throw new TypeError("visitor must be a function");function C(b){if(b===null)return"";if(Te.isDate(b))return b.toISOString();if(Te.isBoolean(b))return b.toString();if(!j&&Te.isBlob(b))throw new ut("Blob is not supported. Use a Buffer instead.");return Te.isArrayBuffer(b)||Te.isTypedArray(b)?j&&typeof Blob=="function"?new Blob([b]):Buffer.from(b):b}function q(b,w,$){let pe=b;if(b&&!$&&typeof b=="object"){if(Te.endsWith(w,"{}"))w=r?w:w.slice(0,-2),b=JSON.stringify(b);else if(Te.isArray(b)&&an(b)||(Te.isFileList(b)||Te.endsWith(w,"[]"))&&(pe=Te.toArray(b)))return w=Ua(w),pe.forEach(function(te,Y){!(Te.isUndefined(te)||te===null)&&s.append(h===!0?da([w],Y,i):h===null?w:w+"[]",C(te))}),!1}return Zs(b)?!0:(s.append(da($,w,i),C(b)),!1)}const K=[],re=Object.assign(rn,{defaultVisitor:q,convertValue:C,isVisitable:Zs});function T(b,w){if(!Te.isUndefined(b)){if(K.indexOf(b)!==-1)throw Error("Circular reference detected in "+w.join("."));K.push(b),Te.forEach(b,function(pe,Pe){(!(Te.isUndefined(pe)||pe===null)&&n.call(s,pe,Te.isString(Pe)?Pe.trim():Pe,w,re))===!0&&T(pe,w?w.concat(Pe):[Pe])}),K.pop()}}if(!Te.isObject(t))throw new TypeError("data must be an object");return T(t),s}function ca(t){const s={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return s[r]})}function sa(t,s){this._pairs=[],t&&Es(t,this,s)}const Wa=sa.prototype;Wa.append=function(s,a){this._pairs.push([s,a])};Wa.toString=function(s){const a=s?function(r){return s.call(this,r,ca)}:ca;return this._pairs.map(function(n){return a(n[0])+"="+a(n[1])},"").join("&")};function nn(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Va(t,s,a){if(!s)return t;const r=a&&a.encode||nn;Te.isFunction(a)&&(a={serialize:a});const n=a&&a.serialize;let i;if(n?i=n(s,a):i=Te.isURLSearchParams(s)?s.toString():new sa(s,a).toString(r),i){const h=t.indexOf("#");h!==-1&&(t=t.slice(0,h)),t+=(t.indexOf("?")===-1?"?":"&")+i}return t}class ma{constructor(){this.handlers=[]}use(s,a,r){return this.handlers.push({fulfilled:s,rejected:a,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(s){this.handlers[s]&&(this.handlers[s]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(s){Te.forEach(this.handlers,function(r){r!==null&&s(r)})}}const za={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ln=typeof URLSearchParams<"u"?URLSearchParams:sa,on=typeof FormData<"u"?FormData:null,dn=typeof Blob<"u"?Blob:null,cn={isBrowser:!0,classes:{URLSearchParams:ln,FormData:on,Blob:dn},protocols:["http","https","file","blob","url","data"]},aa=typeof window<"u"&&typeof document<"u",Ks=typeof navigator=="object"&&navigator||void 0,mn=aa&&(!Ks||["ReactNative","NativeScript","NS"].indexOf(Ks.product)<0),un=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",xn=aa&&window.location.href||"http://localhost",gn=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:aa,hasStandardBrowserEnv:mn,hasStandardBrowserWebWorkerEnv:un,navigator:Ks,origin:xn},Symbol.toStringTag,{value:"Module"})),It={...gn,...cn};function hn(t,s){return Es(t,new It.classes.URLSearchParams,{visitor:function(a,r,n,i){return It.isNode&&Te.isBuffer(a)?(this.append(r,a.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)},...s})}function pn(t){return Te.matchAll(/\w+|\[(\w*)]/g,t).map(s=>s[0]==="[]"?"":s[1]||s[0])}function fn(t){const s={},a=Object.keys(t);let r;const n=a.length;let i;for(r=0;r<n;r++)i=a[r],s[i]=t[i];return s}function Za(t){function s(a,r,n,i){let h=a[i++];if(h==="__proto__")return!0;const m=Number.isFinite(+h),j=i>=a.length;return h=!h&&Te.isArray(n)?n.length:h,j?(Te.hasOwnProp(n,h)?n[h]=[n[h],r]:n[h]=r,!m):((!n[h]||!Te.isObject(n[h]))&&(n[h]=[]),s(a,r,n[h],i)&&Te.isArray(n[h])&&(n[h]=fn(n[h])),!m)}if(Te.isFormData(t)&&Te.isFunction(t.entries)){const a={};return Te.forEachEntry(t,(r,n)=>{s(pn(r),n,a,0)}),a}return null}function yn(t,s,a){if(Te.isString(t))try{return(s||JSON.parse)(t),Te.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(a||JSON.stringify)(t)}const fs={transitional:za,adapter:["xhr","http","fetch"],transformRequest:[function(s,a){const r=a.getContentType()||"",n=r.indexOf("application/json")>-1,i=Te.isObject(s);if(i&&Te.isHTMLForm(s)&&(s=new FormData(s)),Te.isFormData(s))return n?JSON.stringify(Za(s)):s;if(Te.isArrayBuffer(s)||Te.isBuffer(s)||Te.isStream(s)||Te.isFile(s)||Te.isBlob(s)||Te.isReadableStream(s))return s;if(Te.isArrayBufferView(s))return s.buffer;if(Te.isURLSearchParams(s))return a.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),s.toString();let m;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return hn(s,this.formSerializer).toString();if((m=Te.isFileList(s))||r.indexOf("multipart/form-data")>-1){const j=this.env&&this.env.FormData;return Es(m?{"files[]":s}:s,j&&new j,this.formSerializer)}}return i||n?(a.setContentType("application/json",!1),yn(s)):s}],transformResponse:[function(s){const a=this.transitional||fs.transitional,r=a&&a.forcedJSONParsing,n=this.responseType==="json";if(Te.isResponse(s)||Te.isReadableStream(s))return s;if(s&&Te.isString(s)&&(r&&!this.responseType||n)){const h=!(a&&a.silentJSONParsing)&&n;try{return JSON.parse(s,this.parseReviver)}catch(m){if(h)throw m.name==="SyntaxError"?ut.from(m,ut.ERR_BAD_RESPONSE,this,null,this.response):m}}return s}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:It.classes.FormData,Blob:It.classes.Blob},validateStatus:function(s){return s>=200&&s<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Te.forEach(["delete","get","head","post","put","patch"],t=>{fs.headers[t]={}});const bn=Te.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),jn=t=>{const s={};let a,r,n;return t&&t.split(`
`).forEach(function(h){n=h.indexOf(":"),a=h.substring(0,n).trim().toLowerCase(),r=h.substring(n+1).trim(),!(!a||s[a]&&bn[a])&&(a==="set-cookie"?s[a]?s[a].push(r):s[a]=[r]:s[a]=s[a]?s[a]+", "+r:r)}),s},ua=Symbol("internals");function us(t){return t&&String(t).trim().toLowerCase()}function vs(t){return t===!1||t==null?t:Te.isArray(t)?t.map(vs):String(t)}function Nn(t){const s=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=a.exec(t);)s[r[1]]=r[2];return s}const vn=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function Rs(t,s,a,r,n){if(Te.isFunction(r))return r.call(this,s,a);if(n&&(s=a),!!Te.isString(s)){if(Te.isString(r))return s.indexOf(r)!==-1;if(Te.isRegExp(r))return r.test(s)}}function wn(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(s,a,r)=>a.toUpperCase()+r)}function Sn(t,s){const a=Te.toCamelCase(" "+s);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+a,{value:function(n,i,h){return this[r].call(this,s,n,i,h)},configurable:!0})})}let Ot=class{constructor(s){s&&this.set(s)}set(s,a,r){const n=this;function i(m,j,C){const q=us(j);if(!q)throw new Error("header name must be a non-empty string");const K=Te.findKey(n,q);(!K||n[K]===void 0||C===!0||C===void 0&&n[K]!==!1)&&(n[K||j]=vs(m))}const h=(m,j)=>Te.forEach(m,(C,q)=>i(C,q,j));if(Te.isPlainObject(s)||s instanceof this.constructor)h(s,a);else if(Te.isString(s)&&(s=s.trim())&&!vn(s))h(jn(s),a);else if(Te.isObject(s)&&Te.isIterable(s)){let m={},j,C;for(const q of s){if(!Te.isArray(q))throw TypeError("Object iterator must return a key-value pair");m[C=q[0]]=(j=m[C])?Te.isArray(j)?[...j,q[1]]:[j,q[1]]:q[1]}h(m,a)}else s!=null&&i(a,s,r);return this}get(s,a){if(s=us(s),s){const r=Te.findKey(this,s);if(r){const n=this[r];if(!a)return n;if(a===!0)return Nn(n);if(Te.isFunction(a))return a.call(this,n,r);if(Te.isRegExp(a))return a.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(s,a){if(s=us(s),s){const r=Te.findKey(this,s);return!!(r&&this[r]!==void 0&&(!a||Rs(this,this[r],r,a)))}return!1}delete(s,a){const r=this;let n=!1;function i(h){if(h=us(h),h){const m=Te.findKey(r,h);m&&(!a||Rs(r,r[m],m,a))&&(delete r[m],n=!0)}}return Te.isArray(s)?s.forEach(i):i(s),n}clear(s){const a=Object.keys(this);let r=a.length,n=!1;for(;r--;){const i=a[r];(!s||Rs(this,this[i],i,s,!0))&&(delete this[i],n=!0)}return n}normalize(s){const a=this,r={};return Te.forEach(this,(n,i)=>{const h=Te.findKey(r,i);if(h){a[h]=vs(n),delete a[i];return}const m=s?wn(i):String(i).trim();m!==i&&delete a[i],a[m]=vs(n),r[m]=!0}),this}concat(...s){return this.constructor.concat(this,...s)}toJSON(s){const a=Object.create(null);return Te.forEach(this,(r,n)=>{r!=null&&r!==!1&&(a[n]=s&&Te.isArray(r)?r.join(", "):r)}),a}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([s,a])=>s+": "+a).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(s){return s instanceof this?s:new this(s)}static concat(s,...a){const r=new this(s);return a.forEach(n=>r.set(n)),r}static accessor(s){const r=(this[ua]=this[ua]={accessors:{}}).accessors,n=this.prototype;function i(h){const m=us(h);r[m]||(Sn(n,h),r[m]=!0)}return Te.isArray(s)?s.forEach(i):i(s),this}};Ot.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Te.reduceDescriptors(Ot.prototype,({value:t},s)=>{let a=s[0].toUpperCase()+s.slice(1);return{get:()=>t,set(r){this[a]=r}}});Te.freezeMethods(Ot);function Os(t,s){const a=this||fs,r=s||a,n=Ot.from(r.headers);let i=r.data;return Te.forEach(t,function(m){i=m.call(a,i,n.normalize(),s?s.status:void 0)}),n.normalize(),i}function Ka(t){return!!(t&&t.__CANCEL__)}function os(t,s,a){ut.call(this,t??"canceled",ut.ERR_CANCELED,s,a),this.name="CanceledError"}Te.inherits(os,ut,{__CANCEL__:!0});function Ga(t,s,a){const r=a.config.validateStatus;!a.status||!r||r(a.status)?t(a):s(new ut("Request failed with status code "+a.status,[ut.ERR_BAD_REQUEST,ut.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a))}function kn(t){const s=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return s&&s[1]||""}function Cn(t,s){t=t||10;const a=new Array(t),r=new Array(t);let n=0,i=0,h;return s=s!==void 0?s:1e3,function(j){const C=Date.now(),q=r[i];h||(h=C),a[n]=j,r[n]=C;let K=i,re=0;for(;K!==n;)re+=a[K++],K=K%t;if(n=(n+1)%t,n===i&&(i=(i+1)%t),C-h<s)return;const T=q&&C-q;return T?Math.round(re*1e3/T):void 0}}function Pn(t,s){let a=0,r=1e3/s,n,i;const h=(C,q=Date.now())=>{a=q,n=null,i&&(clearTimeout(i),i=null),t(...C)};return[(...C)=>{const q=Date.now(),K=q-a;K>=r?h(C,q):(n=C,i||(i=setTimeout(()=>{i=null,h(n)},r-K)))},()=>n&&h(n)]}const Ps=(t,s,a=3)=>{let r=0;const n=Cn(50,250);return Pn(i=>{const h=i.loaded,m=i.lengthComputable?i.total:void 0,j=h-r,C=n(j),q=h<=m;r=h;const K={loaded:h,total:m,progress:m?h/m:void 0,bytes:j,rate:C||void 0,estimated:C&&m&&q?(m-h)/C:void 0,event:i,lengthComputable:m!=null,[s?"download":"upload"]:!0};t(K)},a)},xa=(t,s)=>{const a=t!=null;return[r=>s[0]({lengthComputable:a,total:t,loaded:r}),s[1]]},ga=t=>(...s)=>Te.asap(()=>t(...s)),An=It.hasStandardBrowserEnv?((t,s)=>a=>(a=new URL(a,It.origin),t.protocol===a.protocol&&t.host===a.host&&(s||t.port===a.port)))(new URL(It.origin),It.navigator&&/(msie|trident)/i.test(It.navigator.userAgent)):()=>!0,Dn=It.hasStandardBrowserEnv?{write(t,s,a,r,n,i,h){if(typeof document>"u")return;const m=[`${t}=${encodeURIComponent(s)}`];Te.isNumber(a)&&m.push(`expires=${new Date(a).toUTCString()}`),Te.isString(r)&&m.push(`path=${r}`),Te.isString(n)&&m.push(`domain=${n}`),i===!0&&m.push("secure"),Te.isString(h)&&m.push(`SameSite=${h}`),document.cookie=m.join("; ")},read(t){if(typeof document>"u")return null;const s=document.cookie.match(new RegExp("(?:^|; )"+t+"=([^;]*)"));return s?decodeURIComponent(s[1]):null},remove(t){this.write(t,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function In(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function En(t,s){return s?t.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):t}function _a(t,s,a){let r=!In(s);return t&&(r||a==!1)?En(t,s):s}const ha=t=>t instanceof Ot?{...t}:t;function es(t,s){s=s||{};const a={};function r(C,q,K,re){return Te.isPlainObject(C)&&Te.isPlainObject(q)?Te.merge.call({caseless:re},C,q):Te.isPlainObject(q)?Te.merge({},q):Te.isArray(q)?q.slice():q}function n(C,q,K,re){if(Te.isUndefined(q)){if(!Te.isUndefined(C))return r(void 0,C,K,re)}else return r(C,q,K,re)}function i(C,q){if(!Te.isUndefined(q))return r(void 0,q)}function h(C,q){if(Te.isUndefined(q)){if(!Te.isUndefined(C))return r(void 0,C)}else return r(void 0,q)}function m(C,q,K){if(K in s)return r(C,q);if(K in t)return r(void 0,C)}const j={url:i,method:i,data:i,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:m,headers:(C,q,K)=>n(ha(C),ha(q),K,!0)};return Te.forEach(Object.keys({...t,...s}),function(q){const K=j[q]||n,re=K(t[q],s[q],q);Te.isUndefined(re)&&K!==m||(a[q]=re)}),a}const Ja=t=>{const s=es({},t);let{data:a,withXSRFToken:r,xsrfHeaderName:n,xsrfCookieName:i,headers:h,auth:m}=s;if(s.headers=h=Ot.from(h),s.url=Va(_a(s.baseURL,s.url,s.allowAbsoluteUrls),t.params,t.paramsSerializer),m&&h.set("Authorization","Basic "+btoa((m.username||"")+":"+(m.password?unescape(encodeURIComponent(m.password)):""))),Te.isFormData(a)){if(It.hasStandardBrowserEnv||It.hasStandardBrowserWebWorkerEnv)h.setContentType(void 0);else if(Te.isFunction(a.getHeaders)){const j=a.getHeaders(),C=["content-type","content-length"];Object.entries(j).forEach(([q,K])=>{C.includes(q.toLowerCase())&&h.set(q,K)})}}if(It.hasStandardBrowserEnv&&(r&&Te.isFunction(r)&&(r=r(s)),r||r!==!1&&An(s.url))){const j=n&&i&&Dn.read(i);j&&h.set(n,j)}return s},Fn=typeof XMLHttpRequest<"u",Rn=Fn&&function(t){return new Promise(function(a,r){const n=Ja(t);let i=n.data;const h=Ot.from(n.headers).normalize();let{responseType:m,onUploadProgress:j,onDownloadProgress:C}=n,q,K,re,T,b;function w(){T&&T(),b&&b(),n.cancelToken&&n.cancelToken.unsubscribe(q),n.signal&&n.signal.removeEventListener("abort",q)}let $=new XMLHttpRequest;$.open(n.method.toUpperCase(),n.url,!0),$.timeout=n.timeout;function pe(){if(!$)return;const te=Ot.from("getAllResponseHeaders"in $&&$.getAllResponseHeaders()),o={data:!m||m==="text"||m==="json"?$.responseText:$.response,status:$.status,statusText:$.statusText,headers:te,config:t,request:$};Ga(function(N){a(N),w()},function(N){r(N),w()},o),$=null}"onloadend"in $?$.onloadend=pe:$.onreadystatechange=function(){!$||$.readyState!==4||$.status===0&&!($.responseURL&&$.responseURL.indexOf("file:")===0)||setTimeout(pe)},$.onabort=function(){$&&(r(new ut("Request aborted",ut.ECONNABORTED,t,$)),$=null)},$.onerror=function(Y){const o=Y&&Y.message?Y.message:"Network Error",de=new ut(o,ut.ERR_NETWORK,t,$);de.event=Y||null,r(de),$=null},$.ontimeout=function(){let Y=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const o=n.transitional||za;n.timeoutErrorMessage&&(Y=n.timeoutErrorMessage),r(new ut(Y,o.clarifyTimeoutError?ut.ETIMEDOUT:ut.ECONNABORTED,t,$)),$=null},i===void 0&&h.setContentType(null),"setRequestHeader"in $&&Te.forEach(h.toJSON(),function(Y,o){$.setRequestHeader(o,Y)}),Te.isUndefined(n.withCredentials)||($.withCredentials=!!n.withCredentials),m&&m!=="json"&&($.responseType=n.responseType),C&&([re,b]=Ps(C,!0),$.addEventListener("progress",re)),j&&$.upload&&([K,T]=Ps(j),$.upload.addEventListener("progress",K),$.upload.addEventListener("loadend",T)),(n.cancelToken||n.signal)&&(q=te=>{$&&(r(!te||te.type?new os(null,t,$):te),$.abort(),$=null)},n.cancelToken&&n.cancelToken.subscribe(q),n.signal&&(n.signal.aborted?q():n.signal.addEventListener("abort",q)));const Pe=kn(n.url);if(Pe&&It.protocols.indexOf(Pe)===-1){r(new ut("Unsupported protocol "+Pe+":",ut.ERR_BAD_REQUEST,t));return}$.send(i||null)})},On=(t,s)=>{const{length:a}=t=t?t.filter(Boolean):[];if(s||a){let r=new AbortController,n;const i=function(C){if(!n){n=!0,m();const q=C instanceof Error?C:this.reason;r.abort(q instanceof ut?q:new os(q instanceof Error?q.message:q))}};let h=s&&setTimeout(()=>{h=null,i(new ut(`timeout ${s} of ms exceeded`,ut.ETIMEDOUT))},s);const m=()=>{t&&(h&&clearTimeout(h),h=null,t.forEach(C=>{C.unsubscribe?C.unsubscribe(i):C.removeEventListener("abort",i)}),t=null)};t.forEach(C=>C.addEventListener("abort",i));const{signal:j}=r;return j.unsubscribe=()=>Te.asap(m),j}},Tn=function*(t,s){let a=t.byteLength;if(a<s){yield t;return}let r=0,n;for(;r<a;)n=r+s,yield t.slice(r,n),r=n},Ln=async function*(t,s){for await(const a of Mn(t))yield*Tn(a,s)},Mn=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const s=t.getReader();try{for(;;){const{done:a,value:r}=await s.read();if(a)break;yield r}}finally{await s.cancel()}},pa=(t,s,a,r)=>{const n=Ln(t,s);let i=0,h,m=j=>{h||(h=!0,r&&r(j))};return new ReadableStream({async pull(j){try{const{done:C,value:q}=await n.next();if(C){m(),j.close();return}let K=q.byteLength;if(a){let re=i+=K;a(re)}j.enqueue(new Uint8Array(q))}catch(C){throw m(C),C}},cancel(j){return m(j),n.return()}},{highWaterMark:2})},fa=64*1024,{isFunction:ys}=Te,qn=(({Request:t,Response:s})=>({Request:t,Response:s}))(Te.global),{ReadableStream:ya,TextEncoder:ba}=Te.global,ja=(t,...s)=>{try{return!!t(...s)}catch{return!1}},Bn=t=>{t=Te.merge.call({skipUndefined:!0},qn,t);const{fetch:s,Request:a,Response:r}=t,n=s?ys(s):typeof fetch=="function",i=ys(a),h=ys(r);if(!n)return!1;const m=n&&ys(ya),j=n&&(typeof ba=="function"?(b=>w=>b.encode(w))(new ba):async b=>new Uint8Array(await new a(b).arrayBuffer())),C=i&&m&&ja(()=>{let b=!1;const w=new a(It.origin,{body:new ya,method:"POST",get duplex(){return b=!0,"half"}}).headers.has("Content-Type");return b&&!w}),q=h&&m&&ja(()=>Te.isReadableStream(new r("").body)),K={stream:q&&(b=>b.body)};n&&["text","arrayBuffer","blob","formData","stream"].forEach(b=>{!K[b]&&(K[b]=(w,$)=>{let pe=w&&w[b];if(pe)return pe.call(w);throw new ut(`Response type '${b}' is not supported`,ut.ERR_NOT_SUPPORT,$)})});const re=async b=>{if(b==null)return 0;if(Te.isBlob(b))return b.size;if(Te.isSpecCompliantForm(b))return(await new a(It.origin,{method:"POST",body:b}).arrayBuffer()).byteLength;if(Te.isArrayBufferView(b)||Te.isArrayBuffer(b))return b.byteLength;if(Te.isURLSearchParams(b)&&(b=b+""),Te.isString(b))return(await j(b)).byteLength},T=async(b,w)=>{const $=Te.toFiniteNumber(b.getContentLength());return $??re(w)};return async b=>{let{url:w,method:$,data:pe,signal:Pe,cancelToken:te,timeout:Y,onDownloadProgress:o,onUploadProgress:de,responseType:N,headers:S,withCredentials:x="same-origin",fetchOptions:Z}=Ja(b),J=s||fetch;N=N?(N+"").toLowerCase():"text";let Ie=On([Pe,te&&te.toAbortSignal()],Y),Ae=null;const Me=Ie&&Ie.unsubscribe&&(()=>{Ie.unsubscribe()});let W;try{if(de&&C&&$!=="get"&&$!=="head"&&(W=await T(S,pe))!==0){let M=new a(w,{method:"POST",body:pe,duplex:"half"}),P;if(Te.isFormData(pe)&&(P=M.headers.get("content-type"))&&S.setContentType(P),M.body){const[H,U]=xa(W,Ps(ga(de)));pe=pa(M.body,fa,H,U)}}Te.isString(x)||(x=x?"include":"omit");const Ne=i&&"credentials"in a.prototype,V={...Z,signal:Ie,method:$.toUpperCase(),headers:S.normalize().toJSON(),body:pe,duplex:"half",credentials:Ne?x:void 0};Ae=i&&new a(w,V);let Qe=await(i?J(Ae,Z):J(w,V));const ve=q&&(N==="stream"||N==="response");if(q&&(o||ve&&Me)){const M={};["status","statusText","headers"].forEach(ce=>{M[ce]=Qe[ce]});const P=Te.toFiniteNumber(Qe.headers.get("content-length")),[H,U]=o&&xa(P,Ps(ga(o),!0))||[];Qe=new r(pa(Qe.body,fa,H,()=>{U&&U(),Me&&Me()}),M)}N=N||"text";let p=await K[Te.findKey(K,N)||"text"](Qe,b);return!ve&&Me&&Me(),await new Promise((M,P)=>{Ga(M,P,{data:p,headers:Ot.from(Qe.headers),status:Qe.status,statusText:Qe.statusText,config:b,request:Ae})})}catch(Ne){throw Me&&Me(),Ne&&Ne.name==="TypeError"&&/Load failed|fetch/i.test(Ne.message)?Object.assign(new ut("Network Error",ut.ERR_NETWORK,b,Ae),{cause:Ne.cause||Ne}):ut.from(Ne,Ne&&Ne.code,b,Ae)}}},$n=new Map,Qa=t=>{let s=t&&t.env||{};const{fetch:a,Request:r,Response:n}=s,i=[r,n,a];let h=i.length,m=h,j,C,q=$n;for(;m--;)j=i[m],C=q.get(j),C===void 0&&q.set(j,C=m?new Map:Bn(s)),q=C;return C};Qa();const ra={http:sn,xhr:Rn,fetch:{get:Qa}};Te.forEach(ra,(t,s)=>{if(t){try{Object.defineProperty(t,"name",{value:s})}catch{}Object.defineProperty(t,"adapterName",{value:s})}});const Na=t=>`- ${t}`,Un=t=>Te.isFunction(t)||t===null||t===!1;function Wn(t,s){t=Te.isArray(t)?t:[t];const{length:a}=t;let r,n;const i={};for(let h=0;h<a;h++){r=t[h];let m;if(n=r,!Un(r)&&(n=ra[(m=String(r)).toLowerCase()],n===void 0))throw new ut(`Unknown adapter '${m}'`);if(n&&(Te.isFunction(n)||(n=n.get(s))))break;i[m||"#"+h]=n}if(!n){const h=Object.entries(i).map(([j,C])=>`adapter ${j} `+(C===!1?"is not supported by the environment":"is not available in the build"));let m=a?h.length>1?`since :
`+h.map(Na).join(`
`):" "+Na(h[0]):"as no adapter specified";throw new ut("There is no suitable adapter to dispatch the request "+m,"ERR_NOT_SUPPORT")}return n}const Ha={getAdapter:Wn,adapters:ra};function Ts(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new os(null,t)}function va(t){return Ts(t),t.headers=Ot.from(t.headers),t.data=Os.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Ha.getAdapter(t.adapter||fs.adapter,t)(t).then(function(r){return Ts(t),r.data=Os.call(t,t.transformResponse,r),r.headers=Ot.from(r.headers),r},function(r){return Ka(r)||(Ts(t),r&&r.response&&(r.response.data=Os.call(t,t.transformResponse,r.response),r.response.headers=Ot.from(r.response.headers))),Promise.reject(r)})}const Ya="1.13.1",Fs={};["object","boolean","number","function","string","symbol"].forEach((t,s)=>{Fs[t]=function(r){return typeof r===t||"a"+(s<1?"n ":" ")+t}});const wa={};Fs.transitional=function(s,a,r){function n(i,h){return"[Axios v"+Ya+"] Transitional option '"+i+"'"+h+(r?". "+r:"")}return(i,h,m)=>{if(s===!1)throw new ut(n(h," has been removed"+(a?" in "+a:"")),ut.ERR_DEPRECATED);return a&&!wa[h]&&(wa[h]=!0,console.warn(n(h," has been deprecated since v"+a+" and will be removed in the near future"))),s?s(i,h,m):!0}};Fs.spelling=function(s){return(a,r)=>(console.warn(`${r} is likely a misspelling of ${s}`),!0)};function Vn(t,s,a){if(typeof t!="object")throw new ut("options must be an object",ut.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let n=r.length;for(;n-- >0;){const i=r[n],h=s[i];if(h){const m=t[i],j=m===void 0||h(m,i,t);if(j!==!0)throw new ut("option "+i+" must be "+j,ut.ERR_BAD_OPTION_VALUE);continue}if(a!==!0)throw new ut("Unknown option "+i,ut.ERR_BAD_OPTION)}}const ws={assertOptions:Vn,validators:Fs},Vt=ws.validators;let Xt=class{constructor(s){this.defaults=s||{},this.interceptors={request:new ma,response:new ma}}async request(s,a){try{return await this._request(s,a)}catch(r){if(r instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const i=n.stack?n.stack.replace(/^.+\n/,""):"";try{r.stack?i&&!String(r.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+i):r.stack=i}catch{}}throw r}}_request(s,a){typeof s=="string"?(a=a||{},a.url=s):a=s||{},a=es(this.defaults,a);const{transitional:r,paramsSerializer:n,headers:i}=a;r!==void 0&&ws.assertOptions(r,{silentJSONParsing:Vt.transitional(Vt.boolean),forcedJSONParsing:Vt.transitional(Vt.boolean),clarifyTimeoutError:Vt.transitional(Vt.boolean)},!1),n!=null&&(Te.isFunction(n)?a.paramsSerializer={serialize:n}:ws.assertOptions(n,{encode:Vt.function,serialize:Vt.function},!0)),a.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?a.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:a.allowAbsoluteUrls=!0),ws.assertOptions(a,{baseUrl:Vt.spelling("baseURL"),withXsrfToken:Vt.spelling("withXSRFToken")},!0),a.method=(a.method||this.defaults.method||"get").toLowerCase();let h=i&&Te.merge(i.common,i[a.method]);i&&Te.forEach(["delete","get","head","post","put","patch","common"],b=>{delete i[b]}),a.headers=Ot.concat(h,i);const m=[];let j=!0;this.interceptors.request.forEach(function(w){typeof w.runWhen=="function"&&w.runWhen(a)===!1||(j=j&&w.synchronous,m.unshift(w.fulfilled,w.rejected))});const C=[];this.interceptors.response.forEach(function(w){C.push(w.fulfilled,w.rejected)});let q,K=0,re;if(!j){const b=[va.bind(this),void 0];for(b.unshift(...m),b.push(...C),re=b.length,q=Promise.resolve(a);K<re;)q=q.then(b[K++],b[K++]);return q}re=m.length;let T=a;for(;K<re;){const b=m[K++],w=m[K++];try{T=b(T)}catch($){w.call(this,$);break}}try{q=va.call(this,T)}catch(b){return Promise.reject(b)}for(K=0,re=C.length;K<re;)q=q.then(C[K++],C[K++]);return q}getUri(s){s=es(this.defaults,s);const a=_a(s.baseURL,s.url,s.allowAbsoluteUrls);return Va(a,s.params,s.paramsSerializer)}};Te.forEach(["delete","get","head","options"],function(s){Xt.prototype[s]=function(a,r){return this.request(es(r||{},{method:s,url:a,data:(r||{}).data}))}});Te.forEach(["post","put","patch"],function(s){function a(r){return function(i,h,m){return this.request(es(m||{},{method:s,headers:r?{"Content-Type":"multipart/form-data"}:{},url:i,data:h}))}}Xt.prototype[s]=a(),Xt.prototype[s+"Form"]=a(!0)});let zn=class Xa{constructor(s){if(typeof s!="function")throw new TypeError("executor must be a function.");let a;this.promise=new Promise(function(i){a=i});const r=this;this.promise.then(n=>{if(!r._listeners)return;let i=r._listeners.length;for(;i-- >0;)r._listeners[i](n);r._listeners=null}),this.promise.then=n=>{let i;const h=new Promise(m=>{r.subscribe(m),i=m}).then(n);return h.cancel=function(){r.unsubscribe(i)},h},s(function(i,h,m){r.reason||(r.reason=new os(i,h,m),a(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(s){if(this.reason){s(this.reason);return}this._listeners?this._listeners.push(s):this._listeners=[s]}unsubscribe(s){if(!this._listeners)return;const a=this._listeners.indexOf(s);a!==-1&&this._listeners.splice(a,1)}toAbortSignal(){const s=new AbortController,a=r=>{s.abort(r)};return this.subscribe(a),s.signal.unsubscribe=()=>this.unsubscribe(a),s.signal}static source(){let s;return{token:new Xa(function(n){s=n}),cancel:s}}};function Zn(t){return function(a){return t.apply(null,a)}}function Kn(t){return Te.isObject(t)&&t.isAxiosError===!0}const Gs={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Gs).forEach(([t,s])=>{Gs[s]=t});function er(t){const s=new Xt(t),a=Ea(Xt.prototype.request,s);return Te.extend(a,Xt.prototype,s,{allOwnKeys:!0}),Te.extend(a,s,null,{allOwnKeys:!0}),a.create=function(n){return er(es(t,n))},a}const Ct=er(fs);Ct.Axios=Xt;Ct.CanceledError=os;Ct.CancelToken=zn;Ct.isCancel=Ka;Ct.VERSION=Ya;Ct.toFormData=Es;Ct.AxiosError=ut;Ct.Cancel=Ct.CanceledError;Ct.all=function(s){return Promise.all(s)};Ct.spread=Zn;Ct.isAxiosError=Kn;Ct.mergeConfig=es;Ct.AxiosHeaders=Ot;Ct.formToJSON=t=>Za(Te.isHTMLForm(t)?new FormData(t):t);Ct.getAdapter=Ha.getAdapter;Ct.HttpStatusCode=Gs;Ct.default=Ct;const{Axios:eo,AxiosError:to,CanceledError:so,isCancel:ao,CancelToken:ro,VERSION:no,all:lo,Cancel:oo,isAxiosError:io,spread:co,toFormData:mo,AxiosHeaders:uo,HttpStatusCode:xo,formToJSON:go,getAdapter:ho,mergeConfig:po}=Ct,Gn=()=>{const t="https://api.prashantthakar.com/api";return t.endsWith("/api")?t:`${t}/api`},Re=Ct.create({baseURL:Gn(),headers:{"Content-Type":"application/json"},timeout:3e4});Re.interceptors.request.use(t=>{const s=localStorage.getItem("token");return s&&(t.headers.Authorization=`Bearer ${s}`),t.data instanceof FormData&&delete t.headers["Content-Type"],t},t=>Promise.reject(t));Re.interceptors.response.use(t=>t,t=>{var s,a,r,n,i,h,m,j,C,q;if(console.error("API Error:",{url:(s=t.config)==null?void 0:s.url,method:(a=t.config)==null?void 0:a.method,baseURL:(r=t.config)==null?void 0:r.baseURL,status:(n=t.response)==null?void 0:n.status,statusText:(i=t.response)==null?void 0:i.statusText,message:t.message,response:(h=t.response)==null?void 0:h.data,request:t.request}),!t.response&&t.request){const K=((m=t.config)==null?void 0:m.baseURL)||"http://localhost:3001/api";console.error(`Cannot connect to server at ${K}. Make sure the backend is running.`)}return((j=t.response)==null?void 0:j.status)===401&&!((q=(C=t.config)==null?void 0:C.url)!=null&&q.includes("/auth/login"))&&(localStorage.removeItem("token"),window.location.pathname!=="/login"&&(window.location.href="/login")),Promise.reject(t)});const tr=g.createContext(void 0),_n=({children:t})=>{const[s,a]=g.useState(null),[r,n]=g.useState(!0),[,i]=g.useState(null),h=async()=>{var C,q;try{const K=await Re.get("/auth/me");K&&K.data&&K.data.status==="success"&&K.data.data&&K.data.data.user?(a({...K.data.data.user,userId:K.data.data.user.id}),i(null)):(console.warn("Invalid response structure from /auth/me:",K==null?void 0:K.data),localStorage.removeItem("token"),i(null))}catch(K){console.error("Failed to fetch user:",K),i(K),(((C=K.response)==null?void 0:C.status)===401||((q=K.response)==null?void 0:q.status)===403)&&localStorage.removeItem("token")}finally{n(!1)}};g.useEffect(()=>{let C=!0,q=!1;return(async()=>{try{localStorage.getItem("token")&&!q?await h():q||n(!1)}catch(re){console.error("Error initializing auth:",re),C&&!q&&(i(re),n(!1))}})(),()=>{q=!0,C=!1}},[]);const m=async(C,q)=>{var K,re;try{const T=await Re.post("/auth/login",{email:C,password:q});if(T.data.status==="success"){const b=T.data.data.token,w=T.data.data.user;localStorage.setItem("token",b),a({...w,userId:w.id})}else throw new Error(T.data.message||"Login failed")}catch(T){throw(re=(K=T.response)==null?void 0:K.data)!=null&&re.message?new Error(T.response.data.message):T.message?T:new Error("Login failed. Please try again.")}},j=()=>{localStorage.removeItem("token"),a(null),window.location.href="/login"};return e.jsx(tr.Provider,{value:{user:s,loading:r,login:m,logout:j,isAuthenticated:!!s},children:t})},Nt=()=>{const t=g.useContext(tr);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t},Jn=()=>{const[t,s]=g.useState(""),[a,r]=g.useState(""),[n,i]=g.useState(""),[h,m]=g.useState(!1),[j,C]=g.useState(!1),[q,K]=g.useState(!1),[re,T]=g.useState(""),[b,w]=g.useState(!1),[$,pe]=g.useState(""),[Pe,te]=g.useState(!1),{login:Y,isAuthenticated:o,loading:de}=Nt(),N=Et();g.useEffect(()=>{!de&&o&&N("/dashboard",{replace:!0})},[o,de,N]);const S=async Z=>{var J;if(Z.preventDefault(),i(""),!t.trim()){i("Please enter your email address");return}if(!a.trim()){i("Please enter your password");return}m(!0);try{await Y(t.trim(),a),N("/dashboard",{replace:!0})}catch(Ie){let Ae="Login failed. Please check your credentials.";Ie.response?Ae=((J=Ie.response.data)==null?void 0:J.message)||Ie.message||Ae:Ie.request?Ae="Unable to connect to server. Please check your connection.":Ae=Ie.message||Ae,i(Ae)}finally{m(!1)}},x=async Z=>{if(Z.preventDefault(),pe(""),te(!1),!re.trim()){pe("Please enter your email address");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(re.trim())){pe("Please enter a valid email address");return}w(!0);try{const Ie=await fetch("https://api.prashantthakar.com/api/auth/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:re.trim()})}),Ae=await Ie.json();Ie.ok&&Ae.status==="success"?(te(!0),pe("")):pe(Ae.message||"Failed to send reset email. Please try again.")}catch{pe("Unable to connect to server. Please check your connection.")}finally{w(!1)}};return de?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):e.jsxs("div",{className:"min-h-screen flex flex-col lg:flex-row overflow-hidden bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900",children:[e.jsx("div",{className:"w-full lg:w-1/2 flex items-center justify-center min-h-screen px-4 sm:px-6 md:px-8 lg:px-12 py-8 sm:py-12",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"mb-8 sm:mb-10 md:mb-12 text-center lg:text-left",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-orange-500 text-4xl sm:text-5xl md:text-6xl font-bold tracking-tight mb-2",style:{fontFamily:"Arial, sans-serif",lineHeight:"1.1"},children:"PRIME"}),e.jsxs("div",{className:"flex flex-col mb-2",children:[e.jsx("div",{className:"h-1 w-20 sm:w-24 md:w-28 bg-orange-500 mb-1"}),e.jsx("div",{className:"h-0.5 w-20 sm:w-24 md:w-28 bg-orange-500"})]}),e.jsx("div",{className:"text-white text-xl sm:text-2xl font-light tracking-wider mb-1",children:"ACADEMY"}),e.jsx("div",{className:"text-gray-400 text-sm mt-1",children:"SINCE 2013"})]}),e.jsx("p",{className:"text-white text-lg sm:text-xl font-light",children:"Digital Art With Excellence"})]}),n&&e.jsx("div",{className:"mb-4 sm:mb-6 p-3 sm:p-4 bg-red-500 bg-opacity-90 text-white rounded-lg text-sm sm:text-base shadow-lg",children:n}),e.jsxs("form",{onSubmit:S,className:"space-y-5 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-white text-sm font-medium mb-2",children:"Email Address"}),e.jsx("input",{id:"email",type:"email",value:t,onChange:Z=>s(Z.target.value),required:!0,className:"w-full px-4 py-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg text-white placeholder-white placeholder-opacity-60 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent backdrop-blur-sm text-sm sm:text-base transition-all duration-200 hover:bg-opacity-15",placeholder:"Enter your email",style:{color:"white"}})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-white text-sm font-medium mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"password",type:j?"text":"password",value:a,onChange:Z=>r(Z.target.value),required:!0,className:"w-full px-4 py-3 pr-12 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg text-white placeholder-white placeholder-opacity-60 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent backdrop-blur-sm text-sm sm:text-base transition-all duration-200 hover:bg-opacity-15",placeholder:"Enter your password",style:{color:"white"}}),e.jsx("button",{type:"button",onClick:()=>C(!j),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-white text-opacity-70 hover:text-opacity-100 focus:outline-none transition-opacity","aria-label":j?"Hide password":"Show password",children:j?e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.29 3.29m0 0L3 12m3.29-5.71L12 12m-5.71 0L12 12m0 0l3.29 3.29M12 12l3.29-3.29m0 0L21 3m-5.71 5.71L21 12m-5.71 0L12 12"})}):e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"button",onClick:()=>K(!0),className:"text-white text-opacity-80 hover:text-opacity-100 text-sm font-medium transition-opacity focus:outline-none focus:underline",children:"Forgot Password?"})}),e.jsx("button",{type:"submit",disabled:h,className:"w-full py-3 sm:py-3.5 px-4 bg-gradient-to-r from-orange-500 to-orange-600 text-white font-semibold rounded-lg hover:from-orange-600 hover:to-orange-700 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 focus:ring-offset-gray-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 transform hover:scale-[1.02] active:scale-[0.98] shadow-lg text-sm sm:text-base",children:h?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Signing in..."]}):"Sign In"})]}),e.jsx("div",{className:"mt-6 sm:mt-8 text-center",children:e.jsx("p",{className:"text-white text-opacity-70 text-xs sm:text-sm",children:"Enter your registered email and password to continue"})})]})}),e.jsx("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden",children:e.jsxs("div",{className:"w-full h-full relative",children:[e.jsx("div",{className:"absolute inset-0",style:{backgroundImage:"url('/login-page.jpeg')",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-black/40 via-black/20 to-transparent"})}),e.jsx("div",{className:"relative z-10 w-full h-full flex flex-col justify-end p-8 xl:p-12",children:e.jsxs("div",{className:"max-w-lg",children:[e.jsx("h2",{className:"text-4xl xl:text-5xl 2xl:text-6xl font-bold text-white leading-tight mb-3 drop-shadow-lg",children:"A Journey of 12 Years"}),e.jsx("h2",{className:"text-4xl xl:text-5xl 2xl:text-6xl font-bold text-white leading-tight mb-6 drop-shadow-lg",children:"A Legacy of Pride"}),e.jsx("div",{className:"h-1 w-24 bg-orange-500 mb-4"}),e.jsx("p",{className:"text-white text-lg xl:text-xl font-light text-opacity-90 drop-shadow-md",children:"Excellence in Digital Art Education Since 2013"})]})})]})}),e.jsxs("div",{className:"lg:hidden w-full h-64 sm:h-80 md:h-96 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0",style:{backgroundImage:"url('/login-page.jpeg')",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-black/30 to-transparent"})}),e.jsxs("div",{className:"relative z-10 w-full h-full flex flex-col justify-end p-6 sm:p-8",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-white leading-tight mb-2 drop-shadow-lg",children:"A Journey of 12 Years"}),e.jsx("h2",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-white leading-tight drop-shadow-lg",children:"A Legacy of Pride"})]})]}),q&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6 sm:p-8 relative",children:[e.jsx("button",{onClick:()=>{K(!1),T(""),pe(""),te(!1)},className:"absolute top-4 right-4 text-white text-opacity-70 hover:text-opacity-100 focus:outline-none transition-opacity","aria-label":"Close",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),Pe?e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-4 flex justify-center",children:e.jsx("div",{className:"w-16 h-16 bg-green-500 bg-opacity-20 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-3",children:"Check Your Email"}),e.jsxs("p",{className:"text-white text-opacity-80 mb-6",children:["We've sent a password reset link to ",e.jsx("strong",{className:"text-white",children:re}),". Please check your email and follow the instructions to reset your password."]}),e.jsx("button",{onClick:()=>{K(!1),T(""),pe(""),te(!1)},className:"w-full py-3 px-4 bg-gradient-to-r from-orange-500 to-orange-600 text-white font-semibold rounded-lg hover:from-orange-600 hover:to-orange-700 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 focus:ring-offset-gray-800 transition-all duration-200",children:"Close"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Reset Password"}),e.jsx("p",{className:"text-white text-opacity-70 mb-6 text-sm",children:"Enter your registered email address and we'll send you a link to reset your password."}),$&&e.jsx("div",{className:"mb-4 p-3 bg-red-500 bg-opacity-90 text-white rounded-lg text-sm",children:$}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"forgot-email",className:"block text-white text-sm font-medium mb-2",children:"Email Address"}),e.jsx("input",{id:"forgot-email",type:"email",value:re,onChange:Z=>T(Z.target.value),required:!0,className:"w-full px-4 py-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg text-white placeholder-white placeholder-opacity-60 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent backdrop-blur-sm text-sm sm:text-base transition-all duration-200",placeholder:"Enter your email",style:{color:"white"}})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{K(!1),T(""),pe(""),te(!1)},className:"flex-1 py-3 px-4 bg-white bg-opacity-10 text-white font-semibold rounded-lg hover:bg-opacity-20 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-gray-800 transition-all duration-200",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:b,className:"flex-1 py-3 px-4 bg-gradient-to-r from-orange-500 to-orange-600 text-white font-semibold rounded-lg hover:from-orange-600 hover:to-orange-700 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 focus:ring-offset-gray-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",children:b?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Sending..."]}):"Send Reset Link"})]})]})]})]})})]})},sr={superadmin:{batches:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!0},students:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!0},faculty:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!0},employees:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!0},sessions:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!0},attendance:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!0},payments:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!0},portfolios:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!0},reports:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!0},approvals:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!0},users:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!0},software_completions:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!0},student_leaves:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!0},batch_extensions:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!0},employee_leaves:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!0},faculty_leaves:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!0}},admin:{batches:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!0},students:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!1},faculty:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!1},employees:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!1},sessions:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!0},attendance:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!0},payments:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!1},portfolios:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!1},reports:{canView:!0,canAdd:!1,canEdit:!1,canDelete:!1},approvals:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!1},users:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!1},software_completions:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!1},student_leaves:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!1},batch_extensions:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!1},employee_leaves:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!1},faculty_leaves:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!1}},faculty:{batches:{canView:!0,canAdd:!1,canEdit:!1,canDelete:!1},students:{canView:!0,canAdd:!1,canEdit:!1,canDelete:!1},faculty:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1},employees:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1},sessions:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!1},attendance:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!1},payments:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1},portfolios:{canView:!0,canAdd:!1,canEdit:!0,canDelete:!1},reports:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1},approvals:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1},users:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1},software_completions:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!1},student_leaves:{canView:!0,canAdd:!1,canEdit:!1,canDelete:!1},batch_extensions:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1},employee_leaves:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1},faculty_leaves:{canView:!0,canAdd:!0,canEdit:!1,canDelete:!1}},student:{batches:{canView:!0,canAdd:!1,canEdit:!1,canDelete:!1},students:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1},faculty:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1},employees:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1},sessions:{canView:!0,canAdd:!1,canEdit:!1,canDelete:!1},attendance:{canView:!0,canAdd:!1,canEdit:!1,canDelete:!1},payments:{canView:!0,canAdd:!1,canEdit:!1,canDelete:!1},portfolios:{canView:!0,canAdd:!0,canEdit:!0,canDelete:!1},reports:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1},approvals:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1},users:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1},software_completions:{canView:!0,canAdd:!1,canEdit:!1,canDelete:!1},student_leaves:{canView:!0,canAdd:!0,canEdit:!1,canDelete:!1},batch_extensions:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1},employee_leaves:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1},faculty_leaves:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1}},employee:{batches:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1},students:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1},faculty:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1},employees:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1},sessions:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1},attendance:{canView:!0,canAdd:!0,canEdit:!1,canDelete:!1},payments:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1},portfolios:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1},reports:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1},approvals:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1},users:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1},software_completions:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1},student_leaves:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1},batch_extensions:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1},employee_leaves:{canView:!0,canAdd:!0,canEdit:!1,canDelete:!1},faculty_leaves:{canView:!1,canAdd:!1,canEdit:!1,canDelete:!1}}},Dt=(t,s)=>{if(!t)return!1;const a=sr[t];if(!a)return!1;const r=a[s];return r?r.canView:!1},et=({children:t})=>{var j;const{user:s,logout:a}=Nt(),r=ur(),[n,i]=g.useState(()=>{const C=localStorage.getItem("sidebarOpen");return C!==null?JSON.parse(C):window.innerWidth>=1024});g.useEffect(()=>{localStorage.setItem("sidebarOpen",JSON.stringify(n))},[n]);const h=[{name:"Dashboard",href:"/dashboard",icon:"",module:null},{name:"Batches",href:"/batches",icon:"",module:"batches"},{name:"Course Modules",href:"/course-modules",icon:"",module:"batches"},{name:"Students",href:"/students",icon:"",module:"students"},{name:"Faculty",href:"/faculty",icon:"",module:"faculty"},{name:"Employees",href:"/employees",icon:"",module:"employees"},{name:"Attendance Management",href:"/attendance",icon:"",module:"attendance"},{name:"Attendance",href:"/my-attendance",icon:"",module:"attendance"},{name:"My Attendance",href:"/student-attendance",icon:"",module:"attendance"},{name:"Payments",href:"/payments",icon:"",module:"payments"},{name:"Portfolios",href:"/portfolios",icon:"",module:"portfolios"},{name:"Reports",href:"/reports",icon:"",module:"reports"},{name:"Approvals",href:"/approvals",icon:"",module:"approvals"},{name:"Leave Management",href:"/leaves",icon:"",module:null},{name:"Batch Extensions",href:"/batch-extensions",icon:"",module:"batch_extensions"},{name:"Users",href:"/users",icon:"",module:"users"},{name:"Roles",href:"/roles",icon:"",module:null},{name:"Certificates",href:"/certificates",icon:"",module:null},{name:"Biometric Settings",href:"/biometric-settings",icon:"",module:null},{name:"Photo Management",href:"/photos",icon:"",module:null},{name:"Settings",href:"/settings",icon:"",module:null}],m=g.useMemo(()=>h.filter(C=>C.name==="Dashboard"?!0:C.name==="Course Modules"?(s==null?void 0:s.role)==="student"||(s==null?void 0:s.role)==="employee"?!1:C.module?Dt(s==null?void 0:s.role,C.module):!1:C.name==="Roles"?(s==null?void 0:s.role)==="superadmin":C.name==="Certificates"?!1:C.name==="Biometric Settings"||C.name==="Photo Management"?(s==null?void 0:s.role)==="admin"||(s==null?void 0:s.role)==="superadmin":C.href==="/my-attendance"?((s==null?void 0:s.role)==="employee"||(s==null?void 0:s.role)==="faculty")&&Dt(s==null?void 0:s.role,"attendance"):C.href==="/student-attendance"?(s==null?void 0:s.role)==="student"&&Dt(s==null?void 0:s.role,"attendance"):C.href==="/attendance"?((s==null?void 0:s.role)==="admin"||(s==null?void 0:s.role)==="superadmin")&&Dt(s==null?void 0:s.role,"attendance"):C.name==="Leave Management"?s!=null&&s.role?s.role==="student"?Dt(s.role,"student_leaves"):s.role==="employee"?Dt(s.role,"employee_leaves"):s.role==="faculty"?Dt(s.role,"faculty_leaves"):s.role==="admin"||s.role==="superadmin":!1:C.module?Dt(s==null?void 0:s.role,C.module):!1),[s==null?void 0:s.role]);return e.jsxs("div",{className:"min-h-screen bg-gray-100 flex",children:[n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden",onClick:()=>i(!1)}),e.jsxs("aside",{className:`${n?"translate-x-0":"-translate-x-full lg:translate-x-0"} ${n?"w-64":"w-20"} bg-white shadow-lg transition-all duration-300 ease-in-out fixed h-screen overflow-y-auto z-50 lg:fixed`,children:[e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[n&&e.jsx("h1",{className:"text-xl font-bold text-orange-600",children:"Prime Academy"}),e.jsx("button",{onClick:()=>i(!n),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx("svg",{className:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n?e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"}):e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})]}),e.jsx("nav",{className:"space-y-2 pb-24",children:m.map(C=>{const q=r.pathname===C.href||C.href!=="/dashboard"&&r.pathname.startsWith(C.href);return e.jsxs(xr,{to:C.href,onClick:()=>{window.innerWidth<1024&&i(!1)},className:`flex items-center px-4 py-3 rounded-lg transition-colors ${q?"bg-orange-100 text-orange-700 font-semibold":"text-gray-700 hover:bg-gray-100"}`,title:n?"":C.name,children:[e.jsx("span",{className:"text-xl mr-3 flex-shrink-0",children:C.icon}),n&&e.jsx("span",{className:"text-sm whitespace-nowrap",children:C.name})]},C.name)})})]}),n&&s&&e.jsxs("div",{className:"sticky bottom-0 left-0 right-0 p-4 border-t border-gray-200 bg-white mt-auto",children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("div",{className:"font-semibold text-gray-900 truncate",children:s.name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.role})]}),e.jsx("button",{onClick:a,className:"w-full px-4 py-2 text-sm font-medium text-white bg-orange-600 rounded-lg hover:bg-orange-700 transition-colors",children:"Logout"})]})]}),e.jsxs("div",{className:`flex-1 transition-all duration-300 min-h-screen w-full ${n?"lg:ml-64":"lg:ml-20"}`,children:[e.jsx("header",{className:"bg-white shadow-sm sticky top-0 z-30",children:e.jsxs("div",{className:"px-4 sm:px-6 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>i(!n),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors mr-2 lg:hidden","aria-label":"Toggle sidebar",children:e.jsx("svg",{className:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),!n&&e.jsx("button",{onClick:()=>i(!0),className:"hidden lg:block p-2 rounded-lg hover:bg-gray-100 transition-colors mr-4",children:e.jsx("svg",{className:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-800 truncate",children:((j=m.find(C=>r.pathname===C.href||C.href!=="/dashboard"&&r.pathname.startsWith(C.href)))==null?void 0:j.name)||"Dashboard"})]}),e.jsx("div",{className:"flex items-center space-x-2 sm:space-x-4",children:s&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"hidden sm:inline text-sm text-gray-700 truncate max-w-[150px]",children:[s.name," (",s.role,")"]}),e.jsx("button",{onClick:a,className:"px-3 sm:px-4 py-2 text-sm font-medium text-white bg-orange-600 rounded-lg hover:bg-orange-700 transition-colors whitespace-nowrap",children:"Logout"})]})})]})}),e.jsx("main",{className:"p-3 sm:p-4 md:p-6 bg-gray-50 min-h-[calc(100vh-4rem)] overflow-y-auto",children:t})]})]})},Sa=()=>{const{user:t}=Nt(),s=Et(),a=[{name:"Batches",path:"/batches",icon:"",description:"Manage training batches",module:"batches"},{name:"Course Modules",path:"/course-modules",icon:"",description:"Manage multiple courses with tabs",module:"batches"},{name:"Students",path:"/students",icon:"",description:"Manage students",module:"students"},{name:"Faculty",path:"/faculty",icon:"",description:"Manage faculty members",module:"faculty"},{name:"Employees",path:"/employees",icon:"",description:"Manage employees",module:"employees"},{name:"Attendance",path:"/attendance",icon:"",description:"Track attendance",module:"attendance"},{name:"Attendance",path:"/my-attendance",icon:"",description:"Punch in/out and manage attendance",module:"attendance"},{name:"My Attendance",path:"/student-attendance",icon:"",description:"View your attendance by batch and day",module:"attendance"},{name:"Payments",path:"/payments",icon:"",description:"Manage payments",module:"payments"},{name:"Portfolios",path:"/portfolios",icon:"",description:"Student portfolios",module:"portfolios"},{name:"Reports",path:"/reports",icon:"",description:"View reports",module:"reports"},{name:"Approvals",path:"/approvals",icon:"",description:"Manage approvals",module:"approvals"},{name:"Leave Management",path:"/leaves",icon:"",description:"Manage leave requests",module:null},{name:"Batch Extensions",path:"/batch-extensions",icon:"",description:"Manage batch extensions",module:"batch_extensions"},{name:"Users",path:"/users",icon:"",description:"Manage users",module:"users"},{name:"Roles",path:"/roles",icon:"",description:"Manage roles and permissions",module:null}],r=g.useMemo(()=>a.filter(n=>n.name==="Course Modules"?(t==null?void 0:t.role)==="student"||(t==null?void 0:t.role)==="employee"?!1:n.module?Dt(t==null?void 0:t.role,n.module):!1:n.name==="Roles"?(t==null?void 0:t.role)==="superadmin":n.path==="/my-attendance"?((t==null?void 0:t.role)==="employee"||(t==null?void 0:t.role)==="faculty")&&Dt(t==null?void 0:t.role,"attendance"):n.path==="/student-attendance"?(t==null?void 0:t.role)==="student"&&Dt(t==null?void 0:t.role,"attendance"):n.path==="/attendance"?((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")&&Dt(t==null?void 0:t.role,"attendance"):n.name==="Leave Management"?t!=null&&t.role?t.role==="student"?Dt(t.role,"student_leaves"):t.role==="employee"?Dt(t.role,"employee_leaves"):t.role==="faculty"?Dt(t.role,"faculty_leaves"):t.role==="admin"||t.role==="superadmin":!1:n.module?Dt(t==null?void 0:t.role,n.module):!1),[t==null?void 0:t.role]);return e.jsx(et,{children:e.jsxs("div",{className:"max-w-7xl mx-auto p-4 md:p-6",children:[e.jsxs("div",{className:"mb-6 md:mb-8",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:"Dashboard"}),e.jsxs("p",{className:"mt-2 text-sm md:text-base text-gray-600",children:["Welcome back, ",t==null?void 0:t.name,"!"]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6",children:r.map(n=>e.jsxs("div",{onClick:()=>s(n.path),className:"bg-white rounded-lg shadow-md p-4 md:p-6 cursor-pointer hover:shadow-lg transition-shadow border border-gray-200 hover:border-orange-500",children:[e.jsx("div",{className:"text-3xl md:text-4xl mb-3 md:mb-4",children:n.icon}),e.jsx("h3",{className:"text-lg md:text-xl font-semibold text-gray-900 mb-2",children:n.name}),e.jsx("p",{className:"text-xs md:text-sm text-gray-600",children:n.description})]},n.path))})]})})};var _s=(t=>(t.IN_PROGRESS="in_progress",t.COMPLETED="completed",t))(_s||{});const Ss={createCompletion:async t=>(await Re.post("/software-completions",t)).data,getCompletions:async t=>(await Re.get("/software-completions",{params:t})).data,updateCompletion:async(t,s)=>(await Re.patch(`/software-completions/${t}`,s)).data},St={getAllBatches:async()=>(await Re.get("/batches")).data,getBatchById:async t=>(await Re.get(`/batches/${t}`)).data,createBatch:async t=>(await Re.post("/batches",t)).data,updateBatch:async(t,s)=>(await Re.put(`/batches/${t}`,s)).data,deleteBatch:async t=>(await Re.delete(`/batches/${t}`)).data,suggestCandidates:async(t,s)=>{const a=s&&s.length>0?{includeStatuses:s.join(",")}:{};return(await Re.get(`/batches/${t}/candidates/suggest`,{params:a})).data},assignFaculty:async(t,s)=>(await Re.put(`/batches/${t}/faculty`,{facultyIds:s})).data},kt={getAllStudents:async()=>(await Re.get("/attendance-reports/all-students")).data,getStudentDetails:async t=>(await Re.get(`/attendance-reports/students/${t}/details`)).data,createEnrollment:async t=>(await Re.post("/enrollments",t)).data,completeEnrollment:async t=>(await Re.post("/students/enroll",t)).data,unifiedStudentImport:async t=>{const s=new FormData;return s.append("file",t),(await Re.post("/students/unified-import",s,{headers:{"Content-Type":"multipart/form-data"}})).data},bulkEnrollStudents:async t=>{const s=new FormData;return s.append("file",t),(await Re.post("/students/bulk-enroll",s,{headers:{"Content-Type":"multipart/form-data"}})).data},downloadUnifiedTemplate:async()=>(await Re.get("/students/template",{responseType:"blob"})).data,downloadEnrollmentTemplate:async()=>(await Re.get("/students/template",{responseType:"blob"})).data,createThreeDummyStudents:async()=>(await Re.post("/students/create-three-dummy")).data,getAllSoftware:async()=>(await Re.get("/students/all-software")).data,getCourseNames:async()=>(await Re.get("/students/course-names")).data,checkDuplicate:async(t,s,a)=>{const r={};return t&&(r.email=t),s&&(r.phone=s),a&&(r.excludeId=a),(await Re.get("/students/check-duplicate",{params:r})).data}},lt=t=>{if(!t)return"-";try{const s=typeof t=="string"?new Date(t):t;if(isNaN(s.getTime()))return"-";const a=String(s.getDate()).padStart(2,"0"),r=String(s.getMonth()+1).padStart(2,"0"),n=s.getFullYear();return`${a}/${r}/${n}`}catch{return"-"}},Pt=t=>{if(!t)return"";try{const[s,a,r]=t.split("-");return s&&a&&r?`${r}/${a}/${s}`:""}catch{return""}},ar=t=>{if(!t)return"";try{const s=t.trim().split("/");if(s.length===3){const[a,r,n]=s,i=parseInt(a,10),h=parseInt(r,10),m=parseInt(n,10);if(i>=1&&i<=31&&h>=1&&h<=12&&m>=1900&&m<=2100)return`${m}-${String(h).padStart(2,"0")}-${String(i).padStart(2,"0")}`}return""}catch{return""}},rr=t=>{if(!t)return!1;try{const s=t.trim().split("/");if(s.length!==3)return!1;const a=parseInt(s[0],10),r=parseInt(s[1],10),n=parseInt(s[2],10);if(isNaN(a)||isNaN(r)||isNaN(n)||a<1||a>31||r<1||r>12||n<1900||n>2100)return!1;const i=new Date(n,r-1,a);return!(i.getDate()!==a||i.getMonth()!==r-1||i.getFullYear()!==n)}catch{return!1}},ts=t=>t?t.replace(/\D/g,"").length===10:!1,ka=t=>t?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.trim()):!1,Qn=()=>{var N;const{user:t}=Nt(),s=vt(),[a,r]=g.useState(!1),[n,i]=g.useState(null),[h,m]=g.useState(!1),[j,C]=g.useState(""),{data:q,isLoading:K}=_e({queryKey:["software-completions",t==null?void 0:t.role,t==null?void 0:t.userId],queryFn:()=>Ss.getCompletions()}),{data:re}=_e({queryKey:["batches"],queryFn:()=>St.getAllBatches()}),{data:T}=_e({queryKey:["students"],queryFn:()=>kt.getAllStudents()}),b=st({mutationFn:S=>Ss.createCompletion(S),onSuccess:()=>{s.invalidateQueries({queryKey:["software-completions"]}),r(!1),alert("Software completion record created successfully!")}}),w=st({mutationFn:({id:S,status:x,endDate:Z})=>Ss.updateCompletion(S,{status:x,endDate:Z}),onSuccess:()=>{s.invalidateQueries({queryKey:["software-completions"]}),m(!1),i(null),alert("Software completion record updated successfully!")}}),$=(q==null?void 0:q.data.completions)||[],pe=(re==null?void 0:re.data)||[],Pe=((N=T==null?void 0:T.data)==null?void 0:N.students)||[],te=$.filter(S=>{var Z,J,Ie,Ae,Me,W,Ne,V,Qe,ve;if(!j.trim())return!0;const x=j.toLowerCase();return((J=(Z=S.student)==null?void 0:Z.name)==null?void 0:J.toLowerCase().includes(x))||((Ae=(Ie=S.student)==null?void 0:Ie.email)==null?void 0:Ae.toLowerCase().includes(x))||((Me=S.softwareName)==null?void 0:Me.toLowerCase().includes(x))||((Ne=(W=S.batch)==null?void 0:W.title)==null?void 0:Ne.toLowerCase().includes(x))||((V=S.status)==null?void 0:V.toLowerCase().includes(x))||((ve=(Qe=S.faculty)==null?void 0:Qe.name)==null?void 0:ve.toLowerCase().includes(x))}),Y=S=>{const x={[_s.IN_PROGRESS]:"bg-blue-100 text-blue-800",[_s.COMPLETED]:"bg-green-100 text-green-800"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${x[S]}`,children:S.replace("_"," ").toUpperCase()})},o=S=>{i(S),m(!0)},de=(S,x)=>{n&&w.mutate({id:n.id,status:S,endDate:x})};return e.jsxs(et,{children:[e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-orange-500 px-8 py-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Software Completion Management"}),e.jsx("p",{className:"mt-2 text-orange-100",children:"Track software completion for students"})]}),((t==null?void 0:t.role)==="faculty"||(t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")&&e.jsx("button",{onClick:()=>r(!0),className:"px-4 py-2 bg-white text-orange-600 rounded-lg font-semibold hover:bg-orange-50 transition-colors",children:"+ Add Completion"})]})}),e.jsx("div",{className:"p-6",children:K?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"relative max-w-md",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Search completions by student, software, batch, faculty, or status...",value:j,onChange:S=>C(S.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"}),j&&e.jsx("button",{onClick:()=>C(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400 hover:text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),j&&e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Showing ",te.length," of ",$.length," completions"]})]}),te.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500 text-lg",children:j?"No completions found matching your search":"No software completion records found"}),j&&e.jsx("button",{onClick:()=>C(""),className:"mt-2 text-orange-600 hover:text-orange-700 text-sm",children:"Clear search"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Student"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Batch"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Software"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Faculty"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Start Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"End Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),((t==null?void 0:t.role)==="faculty"||(t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")&&e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:te.map(S=>{var x,Z,J,Ie;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:(x=S.student)==null?void 0:x.name}),e.jsx("div",{className:"text-sm text-gray-500",children:(Z=S.student)==null?void 0:Z.email})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(J=S.batch)==null?void 0:J.title}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:S.softwareName}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(Ie=S.faculty)==null?void 0:Ie.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:lt(S.startDate)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:lt(S.endDate)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:Y(S.status)}),((t==null?void 0:t.role)==="faculty"||(t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")&&e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx("button",{onClick:()=>o(S),className:"text-orange-600 hover:text-orange-900",children:"Update"})})]},S.id)})})]})})]})})]})}),a&&e.jsx(Hn,{onClose:()=>r(!1),onSubmit:S=>b.mutate(S),batches:pe,students:Pe,currentUser:t}),h&&n&&e.jsx(Yn,{completion:n,onClose:()=>{m(!1),i(null)},onSubmit:de})]})},Hn=({onClose:t,onSubmit:s,batches:a,students:r,currentUser:n})=>{const[i,h]=g.useState({studentId:0,batchId:0,softwareName:"",startDate:"",endDate:"",facultyId:(n==null?void 0:n.role)==="faculty"?n.userId:0}),m=j=>{j.preventDefault(),i.studentId&&i.batchId&&i.softwareName&&i.startDate&&i.endDate&&i.facultyId?s(i):alert("Please fill in all required fields")};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Add Software Completion"}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Student"}),e.jsxs("select",{value:i.studentId,onChange:j=>h({...i,studentId:parseInt(j.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0,children:[e.jsx("option",{value:"",children:"Select Student"}),r.map(j=>e.jsx("option",{value:j.id,children:j.name},j.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Batch"}),e.jsxs("select",{value:i.batchId,onChange:j=>h({...i,batchId:parseInt(j.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0,children:[e.jsx("option",{value:"",children:"Select Batch"}),a.map(j=>e.jsx("option",{value:j.id,children:j.title},j.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Software Name"}),e.jsx("input",{type:"text",value:i.softwareName,onChange:j=>h({...i,softwareName:j.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0})]}),(n==null?void 0:n.role)!=="faculty"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Faculty"}),e.jsx("input",{type:"number",value:i.facultyId,onChange:j=>h({...i,facultyId:parseInt(j.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",value:i.startDate,onChange:j=>h({...i,startDate:j.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date"}),e.jsx("input",{type:"date",value:i.endDate,onChange:j=>h({...i,endDate:j.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Submit"})]})]})]})})},Yn=({completion:t,onClose:s,onSubmit:a})=>{var j;const[r,n]=g.useState(t.status),[i,h]=g.useState(t.endDate),m=C=>{C.preventDefault(),a(r,i)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Update Software Completion"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Student:"})," ",(j=t.student)==null?void 0:j.name]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Software:"})," ",t.softwareName]})]}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:r,onChange:C=>n(C.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date"}),e.jsx("input",{type:"date",value:i,onChange:C=>h(C.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Update"})]})]})]})})};var as=(t=>(t.PENDING="pending",t.APPROVED="approved",t.REJECTED="rejected",t))(as||{});const Ls={createExtension:async t=>(await Re.post("/batch-extensions",t)).data,getExtensions:async t=>(await Re.get("/batch-extensions",{params:t})).data,approveExtension:async(t,s)=>(await Re.post(`/batch-extensions/${t}/approve`,s)).data},Xn=()=>{const{user:t}=Nt(),s=vt(),[a,r]=g.useState(!1),[n,i]=g.useState(null),[h,m]=g.useState(!1),{data:j,isLoading:C}=_e({queryKey:["batch-extensions"],queryFn:()=>Ls.getExtensions()}),{data:q}=_e({queryKey:["batches"],queryFn:()=>St.getAllBatches()}),K=st({mutationFn:te=>Ls.createExtension(te),onSuccess:()=>{s.invalidateQueries({queryKey:["batch-extensions"]}),r(!1),alert("Extension request created successfully!")}}),re=st({mutationFn:({id:te,approve:Y,rejectionReason:o})=>Ls.approveExtension(te,{approve:Y,rejectionReason:o}),onSuccess:()=>{s.invalidateQueries({queryKey:["batch-extensions"]}),s.invalidateQueries({queryKey:["batches"]}),m(!1),i(null),alert("Extension request processed successfully!")}}),T=(j==null?void 0:j.data.extensions)||[],b=(q==null?void 0:q.data)||[],w=te=>{const Y={[as.PENDING]:"bg-yellow-100 text-yellow-800",[as.APPROVED]:"bg-green-100 text-green-800",[as.REJECTED]:"bg-red-100 text-red-800"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${Y[te]}`,children:te.toUpperCase()})},$=(te,Y)=>{i(te),m(!0)},pe=(te,Y)=>{n&&re.mutate({id:n.id,approve:te,rejectionReason:Y})},Pe=te=>(t==null?void 0:t.role)==="superadmin"||(t==null?void 0:t.role)==="admin"&&te.numberOfSessions<=3;return e.jsxs(et,{children:[e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-orange-500 px-8 py-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Batch Extension Management"}),e.jsx("p",{className:"mt-2 text-orange-100",children:"Request and manage batch time extensions"})]}),((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")&&e.jsx("button",{onClick:()=>r(!0),className:"px-4 py-2 bg-white text-orange-600 rounded-lg font-semibold hover:bg-orange-50 transition-colors",children:"+ Request Extension"})]})}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Note:"})," Extensions up to 3 sessions can be approved by Admin. Extensions for more than 3 sessions require SuperAdmin approval."]})}),C?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Batch"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sessions"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Requested By"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reason"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:T.map(te=>{var Y,o,de;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:(Y=te.batch)==null?void 0:Y.title}),e.jsx("div",{className:"text-sm text-gray-500",children:(o=te.batch)==null?void 0:o.software})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:`text-sm font-semibold ${te.numberOfSessions>3?"text-red-600":"text-gray-900"}`,children:[te.numberOfSessions," ",te.numberOfSessions>3&&"(Requires SuperAdmin)"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(de=te.requester)==null?void 0:de.name}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:te.reason||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:w(te.status)}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2",children:[te.status===as.PENDING&&Pe(te)&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>$(te),className:"text-green-600 hover:text-green-900",children:"Approve"}),e.jsx("button",{onClick:()=>$(te),className:"text-red-600 hover:text-red-900",children:"Reject"})]}),te.status===as.PENDING&&!Pe(te)&&e.jsx("span",{className:"text-gray-400",children:"Requires SuperAdmin"})]})]},te.id)})})]}),T.length===0&&e.jsx("div",{className:"text-center py-12 text-gray-500",children:"No extension requests found"})]})]})]})}),a&&e.jsx(el,{onClose:()=>r(!1),onSubmit:te=>K.mutate(te),batches:b}),h&&n&&e.jsx(tl,{extension:n,onClose:()=>{m(!1),i(null)},onSubmit:pe})]})},el=({onClose:t,onSubmit:s,batches:a})=>{const[r,n]=g.useState({batchId:0,numberOfSessions:1,reason:""}),i=h=>{h.preventDefault(),r.batchId&&r.numberOfSessions>0?s(r):alert("Please fill in all required fields")};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Request Batch Extension"}),e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Batch"}),e.jsxs("select",{value:r.batchId,onChange:h=>n({...r,batchId:parseInt(h.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0,children:[e.jsx("option",{value:"",children:"Select Batch"}),a.map(h=>e.jsx("option",{value:h.id,children:h.title},h.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Number of Sessions"}),e.jsx("input",{type:"number",min:"1",value:r.numberOfSessions,onChange:h=>n({...r,numberOfSessions:parseInt(h.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0}),r.numberOfSessions>3&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:"This will require SuperAdmin approval"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason"}),e.jsx("textarea",{value:r.reason,onChange:h=>n({...r,reason:h.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",rows:3})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Submit"})]})]})]})})},tl=({extension:t,onClose:s,onSubmit:a})=>{var j;const[r,n]=g.useState(!0),[i,h]=g.useState(""),m=C=>{C.preventDefault(),a(r,r?void 0:i)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4",children:[r?"Approve":"Reject"," Extension Request"]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Batch:"})," ",(j=t.batch)==null?void 0:j.title]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Sessions:"})," ",t.numberOfSessions]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Reason:"})," ",t.reason||"-"]})]}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",checked:r,onChange:()=>n(!0)}),e.jsx("span",{children:"Approve"})]}),e.jsxs("label",{className:"flex items-center space-x-2 mt-2",children:[e.jsx("input",{type:"radio",checked:!r,onChange:()=>n(!1)}),e.jsx("span",{children:"Reject"})]})]}),!r&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rejection Reason"}),e.jsx("textarea",{value:i,onChange:C=>h(C.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",rows:3,required:!r})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",className:`px-4 py-2 rounded-lg text-white ${r?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"}`,children:r?"Approve":"Reject"})]})]})]})})};var Tt=(t=>(t.PENDING="pending",t.APPROVED="approved",t.REJECTED="rejected",t))(Tt||{});const Ms={createLeave:async t=>(await Re.post("/student-leaves",t)).data,getLeaves:async t=>(await Re.get("/student-leaves",{params:t})).data,approveLeave:async(t,s)=>(await Re.post(`/student-leaves/${t}/approve`,s)).data},qs={createLeave:async t=>(await Re.post("/employee-leaves",t)).data,getLeaves:async t=>(await Re.get("/employee-leaves",{params:t})).data,approveLeave:async(t,s)=>(await Re.post(`/employee-leaves/${t}/approve`,s)).data},Bs={createLeave:async t=>(await Re.post("/faculty-leaves",t)).data,getLeaves:async t=>(await Re.get("/faculty-leaves",{params:t})).data,approveLeave:async(t,s)=>(await Re.post(`/faculty-leaves/${t}/approve`,s)).data},yt={getAllUsers:async t=>(await Re.get("/users",{params:t})).data,getUser:async t=>(await Re.get(`/users/${t}`)).data,createUser:async t=>(await Re.post("/auth/register",t)).data,updateUser:async(t,s)=>(await Re.put(`/users/${t}`,s)).data,deleteUser:async t=>{await Re.delete(`/users/${t}`)},loginAsUser:async t=>(await Re.post(`/users/${t}/login-as`)).data,updateStudentProfile:async(t,s)=>(await Re.put(`/users/${t}/student-profile`,s)).data,resetPassword:async(t,s)=>(await Re.post(`/users/${t}/reset-password`,{newPassword:s})).data},Ca=()=>{var H,U,ce,ae,u,k,c,D,se,ge,G,Ce,Ze,Xe,Be,Q;const{user:t}=Nt(),s=vt(),[a,r]=g.useState(()=>(t==null?void 0:t.role)==="student"?"student":(t==null?void 0:t.role)==="employee"?"employee":(t==null?void 0:t.role)==="faculty"?"faculty":"student"),[n,i]=g.useState(!1),[h,m]=g.useState(!1),[j,C]=g.useState(null),[q,K]=g.useState("all"),[re,T]=g.useState(""),{data:b,isLoading:w}=_e({queryKey:["student-leaves",q],queryFn:()=>Ms.getLeaves(q!=="all"?{status:q}:{}),enabled:a==="student"||(t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin"}),{data:$,isLoading:pe}=_e({queryKey:["employee-leaves",q],queryFn:()=>qs.getLeaves(q!=="all"?{status:q}:{}),enabled:a==="employee"||(t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin"}),{data:Pe,isLoading:te}=_e({queryKey:["faculty-leaves",q],queryFn:()=>Bs.getLeaves(q!=="all"?{status:q}:{}),enabled:a==="faculty"||(t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin"}),{data:Y}=_e({queryKey:["batches"],queryFn:()=>St.getAllBatches(),enabled:n&&a==="student"&&((t==null?void 0:t.role)==="student"||(t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")}),{data:o}=_e({queryKey:["students","active"],queryFn:()=>yt.getAllUsers({role:"student",isActive:!0}),enabled:n&&a==="student"&&((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")}),{data:de}=_e({queryKey:["employees","active"],queryFn:()=>yt.getAllUsers({role:"employee",isActive:!0}),enabled:n&&a==="employee"&&((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")}),{data:N}=_e({queryKey:["faculty","active"],queryFn:()=>yt.getAllUsers({role:"faculty",isActive:!0}),enabled:n&&a==="faculty"&&((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")}),S=st({mutationFn:l=>Ms.createLeave(l),onSuccess:()=>{s.invalidateQueries({queryKey:["student-leaves"]}),i(!1),alert("Leave request created successfully!")},onError:l=>{var O,X;alert(((X=(O=l.response)==null?void 0:O.data)==null?void 0:X.message)||"Failed to create leave request")}}),x=st({mutationFn:l=>qs.createLeave(l),onSuccess:()=>{s.invalidateQueries({queryKey:["employee-leaves"]}),i(!1),alert("Leave request created successfully!")},onError:l=>{var O,X;alert(((X=(O=l.response)==null?void 0:O.data)==null?void 0:X.message)||"Failed to create leave request")}}),Z=st({mutationFn:l=>Bs.createLeave(l),onSuccess:()=>{s.invalidateQueries({queryKey:["faculty-leaves"]}),i(!1),alert("Leave request created successfully!")},onError:l=>{var O,X;alert(((X=(O=l.response)==null?void 0:O.data)==null?void 0:X.message)||"Failed to create leave request")}}),J=st({mutationFn:({id:l,approve:O,rejectionReason:X})=>Ms.approveLeave(l,{approve:O,rejectionReason:X}),onSuccess:()=>{s.invalidateQueries({queryKey:["student-leaves"]}),m(!1),C(null),alert("Leave request updated successfully!")},onError:l=>{var O,X;alert(((X=(O=l.response)==null?void 0:O.data)==null?void 0:X.message)||"Failed to update leave request")}}),Ie=st({mutationFn:({id:l,approve:O,rejectionReason:X})=>qs.approveLeave(l,{approve:O,rejectionReason:X}),onSuccess:()=>{s.invalidateQueries({queryKey:["employee-leaves"]}),m(!1),C(null),alert("Leave request updated successfully!")},onError:l=>{var O,X;alert(((X=(O=l.response)==null?void 0:O.data)==null?void 0:X.message)||"Failed to update leave request")}}),Ae=st({mutationFn:({id:l,approve:O,rejectionReason:X})=>Bs.approveLeave(l,{approve:O,rejectionReason:X}),onSuccess:()=>{s.invalidateQueries({queryKey:["faculty-leaves"]}),m(!1),C(null),alert("Leave request updated successfully!")},onError:l=>{var O,X;alert(((X=(O=l.response)==null?void 0:O.data)==null?void 0:X.message)||"Failed to update leave request")}}),Me=l=>{l.preventDefault();const O=new FormData(l.currentTarget);if(a==="student"){const X={studentId:(t==null?void 0:t.role)==="student"?(t==null?void 0:t.id)||0:parseInt(O.get("studentId")),batchId:parseInt(O.get("batchId")),startDate:O.get("startDate"),endDate:O.get("endDate"),reason:O.get("reason")||void 0};S.mutate(X)}else if(a==="employee"){const X={employeeId:(t==null?void 0:t.role)==="employee"?(t==null?void 0:t.id)||0:parseInt(O.get("employeeId")),startDate:O.get("startDate"),endDate:O.get("endDate"),reason:O.get("reason")||void 0};x.mutate(X)}else if(a==="faculty"){const X={facultyId:(t==null?void 0:t.role)==="faculty"?(t==null?void 0:t.id)||0:parseInt(O.get("facultyId")),startDate:O.get("startDate"),endDate:O.get("endDate"),reason:O.get("reason")||void 0};Z.mutate(X)}},W=l=>{C(l),m(!0)},Ne=l=>{if(l.preventDefault(),!j)return;const O=new FormData(l.currentTarget),X=O.get("approve")==="true",fe=O.get("rejectionReason")||void 0;a==="student"?J.mutate({id:j.id,approve:X,rejectionReason:fe}):a==="employee"?Ie.mutate({id:j.id,approve:X,rejectionReason:fe}):a==="faculty"&&Ae.mutate({id:j.id,approve:X,rejectionReason:fe})},V=()=>a==="student"?(b==null?void 0:b.data.leaves)||[]:a==="employee"?($==null?void 0:$.data.leaves)||[]:a==="faculty"?(Pe==null?void 0:Pe.data.leaves)||[]:[],Qe=()=>a==="student"?w:a==="employee"?pe:a==="faculty"?te:!1,ve=()=>(t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin"||a==="student"&&(t==null?void 0:t.role)==="student"||a==="employee"&&(t==null?void 0:t.role)==="employee"||a==="faculty"&&(t==null?void 0:t.role)==="faculty",p=()=>(t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin",M=V(),P=q==="all"?M:M.filter(l=>l.status===q);return e.jsxs(et,{children:[e.jsx("div",{className:"max-w-7xl mx-auto p-4 md:p-6",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-orange-500 px-4 md:px-8 py-4 md:py-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-white",children:"Leave Management"}),e.jsx("p",{className:"mt-2 text-orange-100",children:"Manage leave requests for all users"})]}),ve()&&e.jsx("button",{onClick:()=>i(!0),className:"px-4 py-2 bg-white text-orange-600 rounded-lg font-semibold hover:bg-orange-50 transition-colors",children:"+ Request Leave"})]})}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex -mb-px",children:[((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin"||(t==null?void 0:t.role)==="student")&&e.jsx("button",{onClick:()=>r("student"),className:`px-6 py-3 text-sm font-medium ${a==="student"?"border-b-2 border-orange-500 text-orange-600":"text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Student Leaves"}),((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin"||(t==null?void 0:t.role)==="employee")&&e.jsx("button",{onClick:()=>r("employee"),className:`px-6 py-3 text-sm font-medium ${a==="employee"?"border-b-2 border-orange-500 text-orange-600":"text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Employee Leaves"}),((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin"||(t==null?void 0:t.role)==="faculty")&&e.jsx("button",{onClick:()=>r("faculty"),className:`px-6 py-3 text-sm font-medium ${a==="faculty"?"border-b-2 border-orange-500 text-orange-600":"text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Faculty Leaves"})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-4 flex gap-2",children:[e.jsx("button",{onClick:()=>K("all"),className:`px-4 py-2 rounded-lg text-sm font-medium ${q==="all"?"bg-orange-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"All"}),e.jsx("button",{onClick:()=>K(Tt.PENDING),className:`px-4 py-2 rounded-lg text-sm font-medium ${q===Tt.PENDING?"bg-yellow-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"Pending"}),e.jsx("button",{onClick:()=>K(Tt.APPROVED),className:`px-4 py-2 rounded-lg text-sm font-medium ${q===Tt.APPROVED?"bg-green-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"Approved"}),e.jsx("button",{onClick:()=>K(Tt.REJECTED),className:`px-4 py-2 rounded-lg text-sm font-medium ${q===Tt.REJECTED?"bg-red-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"Rejected"})]}),Qe()?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):P.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"No leave requests found"})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[a==="student"&&e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Student"}),a==="employee"&&e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee"}),a==="faculty"&&e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Faculty"}),a==="student"&&e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Batch"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Start Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"End Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reason"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),p()&&e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:P.map(l=>{var O,X,fe,Fe,je,v,_,ue;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[a==="student"&&e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:((O=l.student)==null?void 0:O.name)||"N/A"}),e.jsx("div",{className:"text-sm text-gray-500",children:(X=l.student)==null?void 0:X.email})]}),a==="employee"&&e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:((fe=l.employee)==null?void 0:fe.name)||"N/A"}),e.jsx("div",{className:"text-sm text-gray-500",children:(Fe=l.employee)==null?void 0:Fe.email})]}),a==="faculty"&&e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:((je=l.faculty)==null?void 0:je.name)||"N/A"}),e.jsx("div",{className:"text-sm text-gray-500",children:(v=l.faculty)==null?void 0:v.email})]}),a==="student"&&e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:((_=l.batch)==null?void 0:_.title)||"N/A"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:lt(l.startDate)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:lt(l.endDate)}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:l.reason||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${l.status===Tt.APPROVED?"bg-green-100 text-green-800":l.status===Tt.REJECTED?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:l.status})}),p()&&l.status===Tt.PENDING&&e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx("button",{onClick:()=>W(l),className:"text-green-600 hover:text-green-900 mr-3",children:"Approve"}),e.jsx("button",{onClick:()=>W(l),className:"text-red-600 hover:text-red-900",children:"Reject"})]}),p()&&l.status!==Tt.PENDING&&e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[((ue=l.approver)==null?void 0:ue.name)&&`By ${l.approver.name}`,l.approvedAt&&` on ${lt(l.approvedAt)}`]})]},l.id)})})]})})]})]})}),n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Request Leave"}),e.jsx("button",{onClick:()=>i(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:Me,children:[a==="student"&&e.jsxs(e.Fragment,{children:[((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Student *"}),e.jsxs("div",{className:"relative mb-2",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Search students by name or email...",value:re,onChange:l=>T(l.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("select",{name:"studentId",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",disabled:!((H=o==null?void 0:o.data)!=null&&H.users),children:[e.jsx("option",{value:"",children:(U=o==null?void 0:o.data)!=null&&U.users?"Select Student":"Loading..."}),(u=(ae=(ce=o==null?void 0:o.data)==null?void 0:ce.users)==null?void 0:ae.filter(l=>{var X,fe;if(!re.trim())return!0;const O=re.toLowerCase();return((X=l.name)==null?void 0:X.toLowerCase().includes(O))||((fe=l.email)==null?void 0:fe.toLowerCase().includes(O))}))==null?void 0:u.map(l=>e.jsxs("option",{value:l.id,children:[l.name," (",l.email,")"]},l.id))]}),((c=(k=o==null?void 0:o.data)==null?void 0:k.users)==null?void 0:c.filter(l=>{var X,fe;if(!re.trim())return!1;const O=re.toLowerCase();return((X=l.name)==null?void 0:X.toLowerCase().includes(O))||((fe=l.email)==null?void 0:fe.toLowerCase().includes(O))}).length)===0&&re.trim()&&e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"No students found matching your search"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Batch *"}),e.jsxs("select",{name:"batchId",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select Batch"}),(D=Y==null?void 0:Y.data)==null?void 0:D.map(l=>e.jsx("option",{value:l.id,children:l.title},l.id))]})]})]}),a==="employee"&&((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Employee *"}),e.jsxs("select",{name:"employeeId",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",disabled:!((se=de==null?void 0:de.data)!=null&&se.users),children:[e.jsx("option",{value:"",children:(ge=de==null?void 0:de.data)!=null&&ge.users?"Select Employee":"Loading..."}),(Ce=(G=de==null?void 0:de.data)==null?void 0:G.users)==null?void 0:Ce.map(l=>e.jsxs("option",{value:l.id,children:[l.name," (",l.email,")"]},l.id))]})]}),a==="faculty"&&((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Faculty *"}),e.jsxs("select",{name:"facultyId",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",disabled:!((Ze=N==null?void 0:N.data)!=null&&Ze.users),children:[e.jsx("option",{value:"",children:(Xe=N==null?void 0:N.data)!=null&&Xe.users?"Select Faculty":"Loading..."}),(Q=(Be=N==null?void 0:N.data)==null?void 0:Be.users)==null?void 0:Q.map(l=>e.jsxs("option",{value:l.id,children:[l.name," (",l.email,")"]},l.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date *"}),e.jsx("input",{type:"date",name:"startDate",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date *"}),e.jsx("input",{type:"date",name:"endDate",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason"}),e.jsx("textarea",{name:"reason",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:a==="student"&&S.isPending||a==="employee"&&x.isPending||a==="faculty"&&Z.isPending,className:"flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:S.isPending||x.isPending||Z.isPending?"Submitting...":"Submit Request"}),e.jsx("button",{type:"button",onClick:()=>i(!1),className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})}),h&&j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:j.status===Tt.PENDING?"Approve/Reject Leave":"Leave Details"}),e.jsx("button",{onClick:()=>{m(!1),C(null)},className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),j.status===Tt.PENDING?e.jsxs("form",{onSubmit:Ne,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Action *"}),e.jsxs("select",{name:"approve",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"true",children:"Approve"}),e.jsx("option",{value:"false",children:"Reject"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rejection Reason (if rejecting)"}),e.jsx("textarea",{name:"rejectionReason",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:a==="student"&&J.isPending||a==="employee"&&Ie.isPending||a==="faculty"&&Ae.isPending,className:"flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:J.isPending||Ie.isPending||Ae.isPending?"Processing...":"Submit"}),e.jsx("button",{type:"button",onClick:()=>{m(!1),C(null)},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Status"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:j.status})]}),j.rejectionReason&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Rejection Reason"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:j.rejectionReason})]}),j.approver&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Approved By"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:j.approver.name})]}),e.jsx("button",{onClick:()=>{m(!1),C(null)},className:"w-full px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Close"})]})]})})]})},_t={getStudentsWithoutBatch:async()=>(await Re.get("/attendance-reports/students-without-batch")).data,getBatchAttendance:async(t,s)=>(await Re.get("/reports/batch-attendance",{params:{batchId:t,...s}})).data,getPendingPayments:async()=>(await Re.get("/reports/pending-payments")).data,getPortfolioStatus:async()=>(await Re.get("/reports/portfolio-status")).data,getAllAnalysisReports:async()=>(await Re.get("/reports/all-analysis")).data,getStudentsEnrolledBatchNotStarted:async()=>(await Re.get("/attendance-reports/students-enrolled-batch-not-started")).data,getStudentsMultipleCoursesConflict:async()=>(await Re.get("/attendance-reports/students-multiple-courses-conflict")).data,getStudentsOnLeavePendingBatches:async()=>(await Re.get("/attendance-reports/students-on-leave-pending-batches")).data,getStudentsWise:async t=>(await Re.get("/attendance-reports/students-wise",{params:t})).data},sl=()=>{var W,Ne,V,Qe,ve,p,M,P,H,U,ce,ae;const{user:t}=Nt(),s=Et(),a=vt(),[r,n]=g.useState(null),[i,h]=g.useState(!1),[m,j]=g.useState("batches"),[C,q]=g.useState("all"),{data:K,isLoading:re}=_e({queryKey:["batches"],queryFn:()=>St.getAllBatches()}),{data:T,isLoading:b}=_e({queryKey:["students-without-batch"],queryFn:()=>_t.getStudentsWithoutBatch()}),{data:w,isLoading:$}=_e({queryKey:["students-enrolled-batch-not-started"],queryFn:()=>_t.getStudentsEnrolledBatchNotStarted()}),{data:pe,isLoading:Pe}=_e({queryKey:["students-multiple-courses-conflict"],queryFn:()=>_t.getStudentsMultipleCoursesConflict()}),{data:te,isLoading:Y}=_e({queryKey:["students-on-leave-pending-batches"],queryFn:()=>_t.getStudentsOnLeavePendingBatches()}),o=st({mutationFn:u=>St.deleteBatch(u),onSuccess:()=>{a.invalidateQueries({queryKey:["batches"]}),h(!1),n(null),alert("Batch deleted successfully!")},onError:u=>{var k,c;alert(((c=(k=u.response)==null?void 0:k.data)==null?void 0:c.message)||"Failed to delete batch")}}),de=(K==null?void 0:K.data)||[],[N,S]=g.useState(""),x=de.filter(u=>{var c,D,se,ge;if(C!=="all"){const G=new Date(u.startDate),Ce=new Date(u.endDate),Ze=new Date;Ze.setHours(0,0,0,0),G.setHours(0,0,0,0),Ce.setHours(0,0,0,0);const Xe=Ce<Ze,Be=G<=Ze&&Ce>=Ze;if(C==="past"){if(!Xe)return!1}else if(C==="current"){if(!Be)return!1}else if(C==="complete"&&!Xe)return!1}if(!N.trim())return!0;const k=N.toLowerCase();return((c=u.title)==null?void 0:c.toLowerCase().includes(k))||((D=u.software)==null?void 0:D.toLowerCase().includes(k))||((se=u.mode)==null?void 0:se.toLowerCase().includes(k))||((ge=u.status)==null?void 0:ge.toLowerCase().includes(k))}),Z=()=>{if(x.length===0){alert("No batches to export");return}const u=["Batch ID","Title","Course","Software","Mode","Schedule","Start Date","End Date","Duration (Days)","Status","Capacity","Enrolled Students","Student Names","Student Emails","Faculty Count","Faculty Names","Created Date"],k=x.map(G=>{var v,_,ue;const Ce=new Date(G.startDate),Ze=new Date(G.endDate),Xe=Math.ceil((Ze.getTime()-Ce.getTime())/(1e3*60*60*24)),Be=new Date;Be.setHours(0,0,0,0),Ce.setHours(0,0,0,0),Ze.setHours(0,0,0,0);const Q=Ze<Be,l=Ce<=Be&&Ze>=Be,O=Q?"Completed":l?"Ongoing":"Upcoming",X=G.assignedFaculty&&G.assignedFaculty.length>0?G.assignedFaculty.map(A=>A.name).join("; "):"-",fe=G.enrollments&&G.enrollments.length>0?G.enrollments.map(A=>{var L;return((L=A.student)==null?void 0:L.name)||A.name||"Unknown"}).join("; "):"-",Fe=G.enrollments&&G.enrollments.length>0?G.enrollments.map(A=>{var L;return((L=A.student)==null?void 0:L.email)||A.email||""}).filter(A=>A).join("; "):"-",je=G.schedule&&Object.keys(G.schedule).length>0?Object.entries(G.schedule).map(([A,L])=>`${A}: ${L.startTime}-${L.endTime}`).join("; "):"-";return[G.id,G.title||"",((v=G.course)==null?void 0:v.name)||"",G.software||"",G.mode||"",je,lt(Ce),lt(Ze),Xe,O,G.maxCapacity||"",((_=G.enrollments)==null?void 0:_.length)||0,fe,Fe,((ue=G.assignedFaculty)==null?void 0:ue.length)||0,X,G.createdAt?lt(G.createdAt):""]}),c=[u.map(G=>`"${G.replace(/"/g,'""')}"`).join(","),...k.map(G=>G.map(Ce=>`"${String(Ce).replace(/"/g,'""')}"`).join(","))].join(`
`),D=new Blob([c],{type:"text/csv;charset=utf-8;"}),se=URL.createObjectURL(D),ge=document.createElement("a");ge.href=se,ge.download=`batches_export_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(ge),ge.click(),document.body.removeChild(ge),URL.revokeObjectURL(se)},J=u=>{s(`/batches/${u.id}`)},Ie=u=>{s(`/batches/${u.id}/edit`)},Ae=u=>{n(u),h(!0)},Me=()=>{r&&o.mutate(r.id)};return re?e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto p-4 md:p-6",children:e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})})})}):e.jsxs(et,{children:[e.jsx("div",{className:"max-w-7xl mx-auto p-4 md:p-6",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-orange-500 px-4 md:px-8 py-4 md:py-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-white",children:"Batch Management"}),e.jsx("p",{className:"mt-2 text-sm md:text-base text-orange-100",children:"Manage training batches"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 md:gap-3 w-full lg:w-auto",children:[x.length>0&&e.jsxs("button",{onClick:Z,className:"px-4 py-2 bg-white text-orange-600 rounded-lg font-semibold hover:bg-orange-50 transition-colors flex items-center gap-2",title:"Download all batches as CSV",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download CSV"]}),((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")&&e.jsx("button",{onClick:()=>s("/batches/create"),className:"px-4 py-2 bg-white text-orange-600 rounded-lg font-semibold hover:bg-orange-50 transition-colors",children:"+ Create Batch"})]})]})}),e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsx("div",{className:"mb-4 md:mb-6 border-b border-gray-200",children:e.jsxs("nav",{className:"-mb-px flex space-x-2 md:space-x-4 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>j("batches"),className:`py-4 px-3 border-b-2 font-medium text-sm whitespace-nowrap ${m==="batches"?"border-orange-500 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:["All Batches (",x.length,")"]}),e.jsxs("button",{onClick:()=>j("available-students"),className:`py-4 px-3 border-b-2 font-medium text-sm whitespace-nowrap ${m==="available-students"?"border-orange-500 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:["Available Students (",(T==null?void 0:T.data.totalCount)||0,")"]}),e.jsxs("button",{onClick:()=>j("enrolled-not-started"),className:`py-4 px-3 border-b-2 font-medium text-sm whitespace-nowrap ${m==="enrolled-not-started"?"border-orange-500 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:["Enrolled - Batch Not Started (",(w==null?void 0:w.data.totalCount)||0,")"]}),e.jsxs("button",{onClick:()=>j("multiple-courses"),className:`py-4 px-3 border-b-2 font-medium text-sm whitespace-nowrap ${m==="multiple-courses"?"border-orange-500 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:["Multiple Courses Conflict (",(pe==null?void 0:pe.data.totalCount)||0,")"]}),e.jsxs("button",{onClick:()=>j("on-leave"),className:`py-4 px-3 border-b-2 font-medium text-sm whitespace-nowrap ${m==="on-leave"?"border-orange-500 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:["On Leave - Pending Batches (",(te==null?void 0:te.data.totalCount)||0,")"]})]})}),m==="batches"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4 border-b border-gray-200",children:e.jsxs("nav",{className:"-mb-px flex space-x-2 md:space-x-4 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>q("all"),className:`py-2 px-3 border-b-2 font-medium text-sm whitespace-nowrap ${C==="all"?"border-orange-500 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:["All Batches (",de.length,")"]}),e.jsxs("button",{onClick:()=>q("past"),className:`py-2 px-3 border-b-2 font-medium text-sm whitespace-nowrap ${C==="past"?"border-orange-500 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:["Past (",de.filter(u=>{const k=new Date(u.endDate),c=new Date;return c.setHours(0,0,0,0),k.setHours(0,0,0,0),k<c}).length,")"]}),e.jsxs("button",{onClick:()=>q("current"),className:`py-2 px-3 border-b-2 font-medium text-sm whitespace-nowrap ${C==="current"?"border-orange-500 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:["Current/Ongoing (",de.filter(u=>{const k=new Date(u.startDate),c=new Date(u.endDate),D=new Date;return D.setHours(0,0,0,0),k.setHours(0,0,0,0),c.setHours(0,0,0,0),k<=D&&c>=D}).length,")"]}),e.jsxs("button",{onClick:()=>q("complete"),className:`py-2 px-3 border-b-2 font-medium text-sm whitespace-nowrap ${C==="complete"?"border-orange-500 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:["Complete (",de.filter(u=>{const k=new Date(u.endDate),c=new Date;return c.setHours(0,0,0,0),k.setHours(0,0,0,0),k<c}).length,")"]})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"relative max-w-md",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Search batches by title, software, mode, or status...",value:N,onChange:u=>S(u.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"}),N&&e.jsx("button",{onClick:()=>S(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400 hover:text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(N||C!=="all")&&e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Showing ",x.length," of ",de.length," batches",C!=="all"&&e.jsxs("span",{className:"ml-2 text-orange-600",children:["(Filtered: ",C==="past"?"Past":C==="current"?"Current/Ongoing":"Complete",")"]})]})]}),x.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500 text-lg",children:N?"No batches found matching your search":"No batches found"}),N&&e.jsx("button",{onClick:()=>S(""),className:"mt-2 text-orange-600 hover:text-orange-700 text-sm",children:"Clear search"})]}):e.jsx("div",{className:"overflow-x-auto -mx-4 sm:mx-0",children:e.jsx("div",{className:"inline-block min-w-full align-middle sm:px-0",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"S.No"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Batch Title"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden md:table-cell",children:"Course"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden md:table-cell",children:"Software"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden lg:table-cell",children:"Mode"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden xl:table-cell",children:"Schedule/Time"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Start Date"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden lg:table-cell",children:"End Date"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Duration"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden xl:table-cell",children:"Capacity"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden xl:table-cell",children:"Students"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x.map((u,k)=>{var Xe,Be,Q;const c=new Date(u.startDate),D=new Date(u.endDate),se=new Date;se.setHours(0,0,0,0),c.setHours(0,0,0,0),D.setHours(0,0,0,0);const ge=Math.ceil((D.getTime()-se.getTime())/(1e3*60*60*24)),G=D<se,Ce=c<=se&&D>=se,Ze=Math.ceil((D.getTime()-c.getTime())/(1e3*60*60*24));return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-xs sm:text-sm font-medium text-gray-900",children:k+1})}),e.jsxs("td",{className:"px-3 sm:px-6 py-4",children:[e.jsx("div",{className:"text-xs sm:text-sm font-medium text-gray-900",children:u.title}),e.jsxs("div",{className:"text-xs text-gray-500 md:hidden mt-1",children:[((Xe=u.course)==null?void 0:Xe.name)||"-","  ",u.software||"-","  ",u.mode||"-"]})]}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap hidden md:table-cell",children:e.jsx("div",{className:"text-xs sm:text-sm font-medium text-gray-900",children:((Be=u.course)==null?void 0:Be.name)||"-"})}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap hidden md:table-cell",children:e.jsx("div",{className:"text-xs sm:text-sm text-gray-500",children:u.software||"-"})}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap hidden lg:table-cell",children:e.jsx("div",{className:"text-xs sm:text-sm text-gray-500 capitalize",children:u.mode||"-"})}),e.jsx("td",{className:"px-3 sm:px-6 py-4 hidden xl:table-cell",children:u.schedule&&(Array.isArray(u.schedule)?u.schedule.length>0:Object.keys(u.schedule).length>0)?e.jsxs("div",{className:"text-xs text-gray-600 space-y-1 max-w-xs",children:[(()=>{const l=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];if(Array.isArray(u.schedule))return u.schedule.map((je,v)=>je&&typeof je=="object"&&je.startTime?{day:je.day||l[v]||`Day ${v+1}`,times:je}:null).filter(je=>je!==null&&je.times&&je.times.startTime).slice(0,3).map(({day:je,times:v})=>e.jsxs("div",{className:"truncate",children:[je.substring(0,3),": ",v.startTime," - ",v.endTime]},je));const O=u.schedule,X=l.filter(Fe=>O[Fe]&&O[Fe].startTime).map(Fe=>({day:Fe,times:O[Fe]}));return(X.length>0?X:Object.entries(O).filter(([Fe,je])=>je&&je.startTime).map(([Fe,je])=>{const v=parseInt(Fe);return!isNaN(v)&&v>=0&&v<l.length?{day:l[v],times:je}:{day:Fe,times:je}})).slice(0,3).map(({day:Fe,times:je})=>e.jsxs("div",{className:"truncate",children:[Fe.substring(0,3),": ",je.startTime," - ",je.endTime]},Fe))})(),(Array.isArray(u.schedule)?u.schedule.length:Object.keys(u.schedule).length)>3&&e.jsxs("div",{className:"text-gray-500 italic",children:["+ ",(Array.isArray(u.schedule)?u.schedule.length:Object.keys(u.schedule).length)-3," more days"]})]}):e.jsx("div",{className:"text-xs sm:text-sm text-gray-400",children:"No schedule"})}),e.jsxs("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-xs sm:text-sm font-medium text-gray-900",children:lt(c)}),e.jsxs("div",{className:"text-xs text-gray-500 lg:hidden mt-1",children:["End: ",lt(D)]})]}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap hidden lg:table-cell",children:e.jsx("div",{className:"text-xs sm:text-sm font-medium text-gray-900",children:lt(D)})}),e.jsxs("td",{className:"px-3 sm:px-6 py-4",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-gray-500",children:[Ze," ",Ze===1?"day":"days"]}),Ce&&e.jsx("div",{className:"text-xs text-blue-600 font-medium",children:ge>0?`${ge} days left`:"Ends today"}),G&&e.jsx("div",{className:"text-xs text-gray-500",children:"Completed"}),!Ce&&!G&&e.jsxs("div",{className:"text-xs text-orange-600 font-medium",children:["Starts in ",Math.ceil((c.getTime()-se.getTime())/(1e3*60*60*24))," days"]})]}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${G?"bg-gray-100 text-gray-800":Ce?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:G?"Completed":Ce?"Ongoing":"Upcoming"})}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap hidden xl:table-cell",children:e.jsxs("div",{className:"text-xs sm:text-sm text-gray-500",children:[((Q=u.enrollments)==null?void 0:Q.length)||0," / ",u.maxCapacity||"-"]})}),e.jsx("td",{className:"px-3 sm:px-6 py-4 hidden xl:table-cell",children:u.enrollments&&u.enrollments.length>0?e.jsxs("div",{className:"max-w-xs",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-gray-900 font-medium mb-1",children:[u.enrollments.length," student",u.enrollments.length!==1?"s":""]}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[u.enrollments.slice(0,3).map((l,O)=>{var Fe,je,v;const X=((Fe=l.student)==null?void 0:Fe.name)||l.name||`Student ${O+1}`,fe=((je=l.student)==null?void 0:je.email)||l.email||"";return e.jsxs("div",{className:"truncate",title:`${X}${fe?` (${fe})`:""}`,children:[" ",X]},l.id||((v=l.student)==null?void 0:v.id)||O)}),u.enrollments.length>3&&e.jsxs("div",{className:"text-gray-500 italic",children:["+ ",u.enrollments.length-3," more"]})]})]}):e.jsx("div",{className:"text-xs sm:text-sm text-gray-400",children:"No students enrolled"})}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap text-xs sm:text-sm font-medium",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-1 sm:gap-2",children:[e.jsx("button",{onClick:()=>J(u),className:"px-2 sm:px-3 py-1 bg-blue-500 text-white rounded text-xs transition-colors hover:bg-blue-600",title:"View Batch",children:"View"}),((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Ie(u),className:"px-2 sm:px-3 py-1 bg-orange-500 text-white rounded text-xs transition-colors hover:bg-orange-600",title:"Edit Batch",children:"Edit"}),e.jsx("button",{onClick:()=>Ae(u),className:"px-2 sm:px-3 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600 transition-colors",title:"Delete Batch",children:"Delete"})]})]})})]},u.id)})})]})})})]}),m==="available-students"&&e.jsx(e.Fragment,{children:b?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-500",children:"Loading available students..."})]}):!((W=T==null?void 0:T.data)!=null&&W.students)||T.data.students.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"All students are enrolled in batches"})}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Previous Enrollments"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Registered Date"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:(V=(Ne=T==null?void 0:T.data)==null?void 0:Ne.students)==null?void 0:V.map(u=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:u.name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:u.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:u.phone||"-"})}),e.jsx("td",{className:"px-6 py-4",children:u.enrollments&&u.enrollments.length>0?e.jsx("div",{className:"text-xs text-gray-600",children:u.enrollments.map((k,c)=>{const D=k.batch;return D?e.jsxs("div",{className:"mb-1",children:[D.title," (",D.status||"ended",")"]},c):null})}):e.jsx("div",{className:"text-sm text-gray-400",children:"No previous enrollments"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:lt(u.createdAt)})})]},u.id))})]}),e.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:["Total: ",(T==null?void 0:T.data.totalCount)||0," students available for enrollment"]})]})}),m==="enrolled-not-started"&&e.jsx(e.Fragment,{children:$?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-500",children:"Loading students..."})]}):!((Qe=w==null?void 0:w.data)!=null&&Qe.students)||w.data.students.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"No students found enrolled in batches that haven't started yet"})}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsx("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Note:"})," These students are enrolled but their batch start date is in the future. They are waiting for their batch to begin."]})}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Student"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Batch"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Batch Start Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Enrollment Date"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:(p=(ve=w==null?void 0:w.data)==null?void 0:ve.students)==null?void 0:p.map(u=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:u.name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:u.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:u.phone||"-"})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:u.batch.title}),e.jsxs("div",{className:"text-xs text-gray-500",children:[u.batch.software||"N/A","  ",u.batch.mode]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:lt(u.batch.startDate)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:lt(u.enrollmentDate)})})]},u.id))})]}),e.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:["Total: ",(w==null?void 0:w.data.totalCount)||0," students waiting for batch to start"]})]})}),m==="multiple-courses"&&e.jsx(e.Fragment,{children:Pe?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-500",children:"Loading students..."})]}):!((M=pe==null?void 0:pe.data)!=null&&M.students)||pe.data.students.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"No students found with multiple course enrollments"})}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsx("div",{className:"mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Note:"})," These students are enrolled in 2 or more courses. Some may have time conflicts or overlapping schedules."]})}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Student"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Enrollments"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Running Batches"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Future Batches"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Time Conflict"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Batches"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:(H=(P=pe==null?void 0:pe.data)==null?void 0:P.students)==null?void 0:H.map(u=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:u.name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:u.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:u.totalEnrollments})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full",children:u.runningBatches})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full",children:u.futureBatches})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:u.hasTimeConflict?e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-red-100 text-red-800 rounded-full",children:"Yes"}):e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-gray-100 text-gray-800 rounded-full",children:"No"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-xs space-y-1 max-w-md",children:u.batches.map((k,c)=>e.jsxs("div",{className:"p-2 bg-gray-50 rounded border border-gray-200",children:[e.jsx("div",{className:"font-medium text-gray-900",children:k.title}),e.jsxs("div",{className:"text-gray-600",children:[k.software||"N/A","  ",k.mode]}),e.jsxs("div",{className:"text-gray-500 text-xs mt-1",children:[lt(k.startDate)," - ",lt(k.endDate)]})]},k.id||c))})})]},u.id))})]}),e.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:["Total: ",(pe==null?void 0:pe.data.totalCount)||0," students with multiple course enrollments"]})]})}),m==="on-leave"&&e.jsx(e.Fragment,{children:Y?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-500",children:"Loading students..."})]}):!((U=te==null?void 0:te.data)!=null&&U.students)||te.data.students.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"No students found on leave with pending batches"})}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsx("div",{className:"mb-4 p-4 bg-orange-50 border border-orange-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-orange-800",children:[e.jsx("strong",{children:"Note:"})," These students are on approved leave but have other batches that need to be allocated or are currently running."]})}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Student"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Leaves"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pending Batches"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:(ae=(ce=te==null?void 0:te.data)==null?void 0:ce.students)==null?void 0:ae.map(u=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:u.name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:u.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:u.phone||"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-xs space-y-1 max-w-xs",children:u.leaves.map(k=>e.jsxs("div",{className:"p-2 bg-blue-50 rounded border border-blue-200",children:[e.jsx("div",{className:"font-medium text-gray-900",children:k.batchTitle}),e.jsxs("div",{className:"text-gray-600 text-xs",children:[lt(k.startDate)," - ",lt(k.endDate)]}),k.reason&&e.jsxs("div",{className:"text-gray-500 text-xs mt-1",children:["Reason: ",k.reason]})]},k.id))})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-xs space-y-1 max-w-md",children:u.pendingBatches.map(k=>e.jsxs("div",{className:`p-2 rounded border ${k.isRunning?"bg-red-50 border-red-200":"bg-yellow-50 border-yellow-200"}`,children:[e.jsx("div",{className:"font-medium text-gray-900",children:k.title}),e.jsxs("div",{className:"text-gray-600",children:[k.software||"N/A","  ",k.mode]}),e.jsxs("div",{className:"text-gray-500 text-xs mt-1",children:[lt(k.startDate)," - ",lt(k.endDate)]}),k.isRunning&&e.jsx("span",{className:"inline-block mt-1 px-2 py-0.5 text-xs font-medium bg-red-100 text-red-800 rounded",children:"Currently Running"})]},k.id))})})]},u.id))})]}),e.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:["Total: ",(te==null?void 0:te.data.totalCount)||0," students on leave with pending batches"]})]})})]})]})}),i&&r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-red-600",children:"Delete Batch"}),e.jsxs("p",{className:"mb-4 text-gray-700",children:["Are you sure you want to delete ",e.jsx("strong",{children:r.title}),"? This action cannot be undone."]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("button",{onClick:Me,disabled:o.isPending,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition-colors disabled:opacity-50 text-sm sm:text-base",children:o.isPending?"Deleting...":"Delete"}),e.jsx("button",{onClick:()=>{h(!1),n(null)},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors text-sm sm:text-base",children:"Cancel"})]})]})})]})},Kt={getAllFaculty:async(t=1e3)=>(await Re.get("/users",{params:{role:"faculty",limit:t,isActive:"true"}})).data,createFacultyProfile:async t=>(await Re.post("/faculty",t)).data,updateFacultyProfile:async(t,s)=>(await Re.put(`/users/${t}/faculty-profile`,s)).data},Jt={getAllCourses:async()=>(await Re.get("/courses")).data,getCourseById:async t=>(await Re.get(`/courses/${t}`)).data,createCourse:async t=>(await Re.post("/courses",t)).data,updateCourse:async(t,s)=>(await Re.put(`/courses/${t}`,s)).data,deleteCourse:async t=>(await Re.delete(`/courses/${t}`)).data},al=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],rl=()=>{var G,Ce,Ze,Xe,Be,Q;const{user:t}=Nt(),s=Et(),a=vt(),[r,n]=g.useState({}),[i,h]=g.useState(!1),[m,j]=g.useState([]),[C,q]=g.useState([]),[K,re]=g.useState([]),[T,b]=g.useState(!1),[w,$]=g.useState([]),[pe,Pe]=g.useState(!1),[te,Y]=g.useState(""),[o,de]=g.useState([]),[N,S]=g.useState(""),[x,Z]=g.useState(""),[J,Ie]=g.useState(""),[Ae,Me]=g.useState(null),[W,Ne]=g.useState("active"),{data:V}=_e({queryKey:["students"],queryFn:()=>kt.getAllStudents()}),{data:Qe,isLoading:ve}=_e({queryKey:["faculty"],queryFn:()=>Kt.getAllFaculty(1e3)}),{data:p,isLoading:M}=_e({queryKey:["courses"],queryFn:()=>Jt.getAllCourses()}),P=st({mutationFn:async l=>St.createBatch(l),onSuccess:()=>{a.invalidateQueries({queryKey:["batches"]}),a.invalidateQueries({queryKey:["students"]}),alert("Batch created successfully!"),s("/batches")},onError:l=>{var O,X;alert(((X=(O=l.response)==null?void 0:O.data)==null?void 0:X.message)||"Failed to create batch")}}),H=l=>{n(O=>{if(O[l]){const X={...O};return delete X[l],X}else return{...O,[l]:{startTime:"",endTime:""}}})},U=(l,O,X)=>{n(fe=>{const Fe={...fe};return i?Object.keys(fe).forEach(je=>{Fe[je]={...fe[je],[O]:X}}):Fe[l]={...fe[l],[O]:X},Fe})},ce=l=>{var v;l.preventDefault();const O=new FormData(l.currentTarget),X=o.length>0?o.join(", "):"";if(!X||X.trim()===""){alert("Please select at least one software for this batch.");return}if(K.length===0){alert("Please select at least one faculty member to assign to this batch.");return}const fe=O.get("status")||W,Fe=fe&&fe.trim()?fe.trim():"active",je={title:((v=O.get("title"))==null?void 0:v.trim())||"",software:X.trim(),mode:O.get("mode")||"",startDate:O.get("startDate")||"",endDate:O.get("endDate")||"",maxCapacity:O.get("maxCapacity")?parseInt(O.get("maxCapacity")):void 0,status:Fe,schedule:Object.keys(r).length>0?Object.fromEntries(Object.entries(r).filter(([_,ue])=>ue.startTime&&ue.endTime)):void 0,facultyIds:K,studentIds:m.length>0?m:void 0,exceptionStudentIds:C.length>0?C:void 0,courseId:Ae||null};console.log("Creating batch with status:",Fe,"Full data:",je),P.mutate(je)},ae=async()=>{var je,v,_;const l=document.querySelector("form");if(!l)return;const O=new FormData(l),X=o.length>0?o.join(", "):void 0,fe=O.get("startDate");if(!X||!fe){alert("Please select software and enter start date first to get suggestions");return}let Fe=[];if(K.length>0)Fe=K;else if((je=Qe==null?void 0:Qe.data)!=null&&je.users&&Qe.data.users.length>0)Fe=[Qe.data.users[0].id];else{alert("Please select at least one faculty member first, or ensure faculty data is loaded");return}try{const ue=O.get("status")||W||"active",A={title:"TEMP_FOR_SUGGESTIONS",software:X,mode:O.get("mode")||"online",startDate:fe,endDate:O.get("endDate")||fe,maxCapacity:100,status:ue,facultyIds:Fe},L=await St.createBatch(A);if(L.data.batch){const z=await St.suggestCandidates(L.data.batch.id);console.log("Suggestions received:",z),z.data&&z.data.candidates?($(z.data.candidates),b(!0)):(console.error("No suggestions data received:",z),$([]),b(!0));try{await St.deleteBatch(L.data.batch.id)}catch(oe){console.error("Failed to delete temp batch:",oe)}}else alert("Failed to create temporary batch for suggestions")}catch(ue){console.error("Error getting suggestions:",ue),alert(((_=(v=ue.response)==null?void 0:v.data)==null?void 0:_.message)||"Failed to get suggestions. Please check console for details.")}},u=l=>{j(O=>O.includes(l)?O.filter(X=>X!==l):[...O,l])},k=l=>{re(O=>O.includes(l)?O.filter(X=>X!==l):[...O,l])},c=l=>{(l.status==="available"||l.status==="fees_overdue"||l.status==="pending_fees"||l.status==="no_orientation"||l.status==="time_conflict"||l.status==="day_mismatch")&&u(l.studentId)},D=(l,O)=>{O?(q(X=>[...X,l]),m.includes(l)||j(X=>[...X,l])):q(X=>X.filter(fe=>fe!==l))},se=(V==null?void 0:V.data.students)||[],ge=((G=Qe==null?void 0:Qe.data)==null?void 0:G.users)||[];return(t==null?void 0:t.role)!=="admin"&&(t==null?void 0:t.role)!=="superadmin"?e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6",children:[e.jsx("p",{className:"text-red-600",children:"You don't have permission to create batches."}),e.jsx("button",{onClick:()=>s("/batches"),className:"mt-4 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Back to Batches"})]})})}):e.jsx(et,{children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-orange-500 px-8 py-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Create New Batch"}),e.jsx("p",{className:"mt-2 text-orange-100",children:"Fill in the details to create a new training batch"})]}),e.jsx("button",{onClick:()=>s("/batches"),className:"px-4 py-2 bg-white text-orange-600 rounded-lg font-semibold hover:bg-orange-50 transition-colors",children:" Back"})]})}),e.jsx("div",{className:"p-8 max-h-[calc(100vh-12rem)] overflow-y-auto",children:e.jsxs("form",{onSubmit:ce,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Batch Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"title",required:!0,placeholder:"e.g., Digital Art Fundamentals - Batch 1",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Course (Optional)"}),e.jsxs("select",{value:Ae||"",onChange:l=>Me(l.target.value?parseInt(l.target.value):null),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select a course (optional)"}),M?e.jsx("option",{disabled:!0,children:"Loading courses..."}):(Ce=p==null?void 0:p.data)==null?void 0:Ce.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]}),Ae&&((Ze=p==null?void 0:p.data)==null?void 0:Ze.find(l=>l.id===Ae))&&e.jsxs("p",{className:"mt-1 text-xs text-gray-600",children:["Software: ",Array.isArray((Xe=p.data.find(l=>l.id===Ae))==null?void 0:Xe.software)?(Be=p.data.find(l=>l.id===Ae))==null?void 0:Be.software.join(", "):"N/A"]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Software"}),e.jsx("div",{className:"border border-gray-300 rounded-lg p-4 max-h-48 overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:["Photoshop","Illustrator","InDesign","After Effects","Premiere Pro","Figma","Sketch","Blender","Maya","3ds Max","Cinema 4D","Lightroom","CorelDRAW","AutoCAD","SolidWorks","Revit","SketchUp","Unity","Unreal Engine","DaVinci Resolve","Final Cut Pro","Procreate","Affinity Designer","Affinity Photo","Canva Pro","Other"].map(l=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:l==="Other"?pe:o.includes(l),onChange:O=>{l==="Other"?Pe(O.target.checked):O.target.checked?de(X=>[...X,l]):de(X=>X.filter(fe=>fe!==l))},className:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:l})]},l))})}),pe&&e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Specify Other Software"}),e.jsx("input",{type:"text",value:te,onChange:l=>{const O=l.target.value;if(Y(O),O.trim()){const X=O.split(",").map(fe=>fe.trim()).filter(fe=>fe);de(fe=>[...fe.filter(je=>["Photoshop","Illustrator","InDesign","After Effects","Premiere Pro","Figma","Sketch","Blender","Maya","3ds Max","Cinema 4D","Lightroom","CorelDRAW","AutoCAD","SolidWorks","Revit","SketchUp","Unity","Unreal Engine","DaVinci Resolve","Final Cut Pro","Procreate","Affinity Designer","Affinity Photo","Canva Pro"].includes(je)),...X])}else de(X=>X.filter(fe=>["Photoshop","Illustrator","InDesign","After Effects","Premiere Pro","Figma","Sketch","Blender","Maya","3ds Max","Cinema 4D","Lightroom","CorelDRAW","AutoCAD","SolidWorks","Revit","SketchUp","Unity","Unreal Engine","DaVinci Resolve","Final Cut Pro","Procreate","Affinity Designer","Affinity Photo","Canva Pro"].includes(fe)))},placeholder:"Enter software names (comma separated)",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),o.length>0&&e.jsxs("p",{className:"mt-2 text-xs text-gray-600",children:["Selected: ",o.join(", ")]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Mode ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"mode",required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select mode"}),e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"offline",children:"Offline"}),e.jsx("option",{value:"hybrid",children:"Hybrid"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Start Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",name:"startDate",required:!0,onChange:l=>{Z(Pt(l.target.value))},className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"}),x&&e.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:["Selected: ",x]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["End Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",name:"endDate",required:!0,onChange:l=>{Ie(Pt(l.target.value))},className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"}),J&&e.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:["Selected: ",J]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max Capacity"}),e.jsx("input",{type:"number",name:"maxCapacity",min:"1",placeholder:"e.g., 30",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Maximum number of students allowed in this batch"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Status ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"status",required:!0,value:W,onChange:l=>Ne(l.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})]}),e.jsxs("div",{className:"pt-6 border-t border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:["Assign Faculty ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Select at least one faculty member to assign to this batch"}),(Q=Qe==null?void 0:Qe.data)!=null&&Q.users&&Qe.data.users.length===0?e.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"No faculty members found. Please create faculty users first."})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"max-h-60 overflow-y-auto border border-gray-300 rounded-lg p-3 space-y-2",children:ve?e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-orange-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:"Loading faculty..."})]}):ge.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No active faculty members found"}):ge.filter(l=>l.isActive!==!1).map(l=>e.jsxs("label",{className:"flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:K.includes(l.id),onChange:()=>k(l.id),className:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500 mr-3"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:l.name}),e.jsxs("span",{className:"text-sm text-gray-600 ml-2",children:["(",l.email,")"]}),l.phone&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:[" ",l.phone]})]})]},l.id))}),K.length>0?e.jsxs("p",{className:"mt-2 text-sm text-green-600 font-medium",children:[" ",K.length," faculty member(s) selected"]}):e.jsx("p",{className:"mt-2 text-sm text-red-600",children:" Please select at least one faculty member"})]})]}),e.jsxs("div",{className:"pt-6 border-t border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Schedule (Optional)"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Select days and set start/end times for each day"}),e.jsxs("div",{className:"mb-4 flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{const l=["Monday","Wednesday","Friday"],O={...r};l.forEach(X=>{O[X]||(O[X]={startTime:"",endTime:""})}),Object.keys(O).forEach(X=>{l.includes(X)||delete O[X]}),n(O)},className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${Object.keys(r).length===3&&["Monday","Wednesday","Friday"].every(l=>r[l])?"bg-blue-600 text-white":"bg-blue-100 text-blue-800 hover:bg-blue-200"}`,children:"MWF (Mon, Wed, Fri)"}),e.jsx("button",{type:"button",onClick:()=>{const l=["Tuesday","Thursday","Saturday"],O={...r};l.forEach(X=>{O[X]||(O[X]={startTime:"",endTime:""})}),Object.keys(O).forEach(X=>{l.includes(X)||delete O[X]}),n(O)},className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${Object.keys(r).length===3&&["Tuesday","Thursday","Saturday"].every(l=>r[l])?"bg-purple-600 text-white":"bg-purple-100 text-purple-800 hover:bg-purple-200"}`,children:"TTS (Tue, Thu, Sat)"}),e.jsx("button",{type:"button",onClick:()=>{n({})},className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${Object.keys(r).length>0&&!(["Monday","Wednesday","Friday"].every(l=>r[l])&&Object.keys(r).length===3)&&!(["Tuesday","Thursday","Saturday"].every(l=>r[l])&&Object.keys(r).length===3)?"bg-green-600 text-white":"bg-green-100 text-green-800 hover:bg-green-200"}`,children:"Custom"})]}),e.jsxs("div",{className:"mb-4 p-3 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i,onChange:l=>h(l.target.checked),className:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-700",children:"Apply same time to all selected days"})]}),e.jsx("p",{className:"ml-6 mt-1 text-xs text-gray-600",children:"When enabled, changing time on any day will update all selected days"})]}),e.jsx("div",{className:"space-y-4",children:al.map(l=>{const O=!!r[l],X=r[l]||{startTime:"",endTime:""};return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:O,onChange:()=>H(l),className:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-700",children:l})]})}),O&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-3 pl-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Start Time"}),e.jsx("input",{type:"time",value:X.startTime,onChange:fe=>U(l,"startTime",fe.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"End Time"}),e.jsx("input",{type:"time",value:X.endTime,onChange:fe=>U(l,"endTime",fe.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 text-sm"})]})]})]},l)})})]}),e.jsxs("div",{className:"pt-6 border-t border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Add Students (Optional)"}),e.jsx("button",{type:"button",onClick:ae,className:"px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-semibold hover:bg-blue-700 transition-colors",children:"Get Suggested Students"})]}),T&&e.jsxs("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"Suggested Students (based on software)"}),w.length>0?e.jsx("div",{className:"max-h-40 overflow-y-auto space-y-2",children:w.map(l=>e.jsx("div",{className:`p-2 rounded border cursor-pointer ${l.status==="available"?"bg-green-50 border-green-300 hover:bg-green-100":l.status==="fees_overdue"?"bg-yellow-50 border-yellow-300 hover:bg-yellow-100":l.status==="pending_fees"?"bg-amber-50 border-amber-300 hover:bg-amber-100":l.status==="no_orientation"?"bg-orange-50 border-orange-300 hover:bg-orange-100":l.status==="time_conflict"?"bg-red-50 border-red-300 hover:bg-red-100":l.status==="day_mismatch"?"bg-red-100 border-red-400 hover:bg-red-200":"bg-gray-50 border-gray-300 opacity-50"}`,onClick:()=>c(l),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-medium",children:l.name||`Student #${l.studentId}`}),l.email&&e.jsxs("span",{className:"text-xs text-gray-600 ml-2",children:["(",l.email,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded ${l.status==="available"?"bg-green-200 text-green-800":l.status==="fees_overdue"?"bg-yellow-200 text-yellow-800":l.status==="pending_fees"?"bg-amber-200 text-amber-800":l.status==="no_orientation"?"bg-orange-200 text-orange-800":l.status==="time_conflict"?"bg-red-200 text-red-800":l.status==="day_mismatch"?"bg-red-300 text-red-900 font-semibold":"bg-gray-200 text-gray-800"}`,children:l.statusMessage||l.status}),(l.status==="pending_fees"||l.status==="fees_overdue")&&e.jsxs("label",{className:"flex items-center gap-1 text-xs cursor-pointer",onClick:O=>O.stopPropagation(),children:[e.jsx("input",{type:"checkbox",checked:C.includes(l.studentId),onChange:O=>{D(l.studentId,O.target.checked),O.target.checked&&!m.includes(l.studentId)&&u(l.studentId)},className:"w-3 h-3 text-orange-600 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("span",{className:"text-amber-700 font-medium",children:"Add as Exception"})]}),e.jsx("input",{type:"checkbox",checked:m.includes(l.studentId),onChange:()=>u(l.studentId),disabled:l.status==="busy"||l.status==="day_mismatch",className:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500",onClick:O=>O.stopPropagation()})]})]})},l.studentId))}):e.jsxs("div",{className:"p-3 bg-white border border-blue-200 rounded",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:['No students found with matching software "',o.join(", "),'".']}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Students need to have the software selected in their profile to appear here."})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Students to Enroll"}),e.jsxs("div",{className:"mb-3 relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Search students by name or email...",value:N,onChange:l=>S(l.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"max-h-60 overflow-y-auto border border-gray-300 rounded-lg p-3 space-y-2",children:[se.filter(l=>{if(!N.trim())return!0;const O=N.toLowerCase();return l.name.toLowerCase().includes(O)||l.email.toLowerCase().includes(O)}).map(l=>e.jsxs("label",{className:"flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m.includes(l.id),onChange:()=>u(l.id),className:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500 mr-3"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:l.name}),e.jsxs("span",{className:"text-sm text-gray-600 ml-2",children:["(",l.email,")"]})]})]},l.id)),se.filter(l=>{if(!N.trim())return!1;const O=N.toLowerCase();return l.name.toLowerCase().includes(O)||l.email.toLowerCase().includes(O)}).length===0&&N.trim()&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No students found matching your search"})]}),m.length>0&&e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:[m.length," student(s) selected"]})]})]}),e.jsxs("div",{className:"flex gap-4 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"submit",disabled:P.isPending,className:"flex-1 px-6 py-3 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:P.isPending?"Creating...":"Create Batch"}),e.jsx("button",{type:"button",onClick:()=>s("/batches"),className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})})]})})})},nr=({onSettingsChange:t})=>{const[s,a]=g.useState(!0),[r,n]=g.useState(!1),[i,h]=g.useState(!1),[m,j]=g.useState(!1);g.useEffect(()=>{const q=localStorage.getItem("studentStatusSettings");if(q)try{const K=JSON.parse(q);a(K.includeActive??!0),n(K.includeActivePlus??!1),h(K.includeDropped??!1),j(K.includeDeactive??!1)}catch(K){console.error("Error loading student status settings:",K)}},[]),g.useEffect(()=>{t({includeActive:s,includeActivePlus:r,includeDropped:i,includeDeactive:m});const q={includeActive:s,includeActivePlus:r,includeDropped:i,includeDeactive:m};localStorage.setItem("studentStatusSettings",JSON.stringify(q))},[s,r,i,m,t]);const C=q=>{switch(q){case"includeActive":a(!s);break;case"includeActivePlus":n(!r);break;case"includeDropped":h(!i);break;case"includeDeactive":j(!m);break}};return e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Student Status Settings"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Select which student statuses to include in batch suggestions:"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s,onChange:()=>C("includeActive"),className:"h-5 w-5 text-orange-600 rounded focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:"Active (default)"})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:()=>C("includeActivePlus"),className:"h-5 w-5 text-orange-600 rounded focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:"Active Plus"})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i,onChange:()=>C("includeDropped"),className:"h-5 w-5 text-orange-600 rounded focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:"Dropped"})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:()=>C("includeDeactive"),className:"h-5 w-5 text-orange-600 rounded focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:"Deactive"})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg border border-blue-100",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Note:"})," Only 'Active' students are shown by default. Changes will affect student suggestions in batch creation and editing."]})})]})},bs=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],nl=()=>{var A,L,z,oe,le,xe,he;const{id:t}=xs(),s=t?parseInt(t,10):null,{user:a}=Nt(),r=Et(),n=vt(),[i,h]=g.useState({}),[m,j]=g.useState(!1),[C,q]=g.useState([]),[K,re]=g.useState([]),[T,b]=g.useState([]),[w,$]=g.useState(!1),[pe,Pe]=g.useState([]),[te,Y]=g.useState(!1),[o,de]=g.useState(""),[N,S]=g.useState([]),[x,Z]=g.useState(""),[J,Ie]=g.useState(""),[Ae,Me]=g.useState(""),[W,Ne]=g.useState(null),[V,Qe]=g.useState("active"),[ve,p]=g.useState(!0),[M,P]=g.useState(""),[H,U]=g.useState(""),[ce,ae]=g.useState({includeActive:!0,includeActivePlus:!1,includeDropped:!1,includeDeactive:!1}),u={Photoshop:23,Illustrator:16,InDesign:16,"After Effects":16,"Premiere Pro":14,Figma:12,XD:6,"Animate CC":32,"Premiere Audition":14,"HTML Java DW CSS":24,"Ar. MAX + Vray":48,MAX:89,Fusion:10,"Real Flow":10,"Fume FX":8,Nuke:24,"Thinking Particle":10,"Ray Fire":6,Mocha:6,Silhouette:6,"PF Track":6,Vue:13,Houdni:12,FCP:11,Maya:92,"CAD UNITY":12,Mudbox:7,"Unity Game Design":24,"Z-Brush":12,Lumion:6,SketchUp:12,Unreal:33,"Blender Pro":72,"Cinema 4D":72,"Substance Painter":6,"3D Equalizer":6,Photography:10,"Auto-Cad":15,Davinci:10,Corel:14,CorelDRAW:14},k=(B,ye,De)=>{if(!B||ye.length===0)return"";let Se=0;if(ye.forEach(ot=>{const I=ot.trim();if(u[I])Se+=u[I];else{const E=Object.keys(u).find(f=>f.toLowerCase().includes(I.toLowerCase())||I.toLowerCase().includes(f.toLowerCase()));E&&(Se+=u[E])}}),Se===0)return B;if(De&&Object.keys(De).length>0&&Object.keys(De).length>0){const I=new Date(B);I.setHours(0,0,0,0);let E=new Date(I),f=0,Ee=bs[E.getDay()],R=!1;if(R=[Ee,Ee.substring(0,3),Ee.toLowerCase(),Ee.substring(0,3).toLowerCase(),E.getDay().toString(),(E.getDay()===0?7:E.getDay()).toString()].some(Oe=>Oe in De),!R)for(;!R;)E=new Date(E.getTime()+24*60*60*1e3),Ee=bs[E.getDay()],R=[Ee,Ee.substring(0,3),Ee.toLowerCase(),Ee.substring(0,3).toLowerCase(),E.getDay().toString(),(E.getDay()===0?7:E.getDay()).toString()].some(Ue=>Ue in De);for(f=1;f<Se;){E=new Date(E.getTime()+24*60*60*1e3);const Oe=bs[E.getDay()];[Oe,Oe.substring(0,3),Oe.toLowerCase(),Oe.substring(0,3).toLowerCase(),E.getDay().toString(),(E.getDay()===0?7:E.getDay()).toString()].some(Ve=>Ve in De)&&f++}return E.toISOString().split("T")[0]}const at=new Date(B),it=new Date(at);return it.setDate(at.getDate()+Se),it.toISOString().split("T")[0]},{data:c,isLoading:D}=_e({queryKey:["batch",s],queryFn:()=>St.getBatchById(s),enabled:!!s}),{data:se}=_e({queryKey:["students"],queryFn:()=>kt.getAllStudents()}),{data:ge,isLoading:G}=_e({queryKey:["faculty"],queryFn:()=>Kt.getAllFaculty(1e3)}),{data:Ce,isLoading:Ze}=_e({queryKey:["courses"],queryFn:()=>Jt.getAllCourses()});g.useEffect(()=>{var B;if((B=c==null?void 0:c.data)!=null&&B.batch){const ye=c.data.batch;Qe(ye.status||"active"),Ne(ye.courseId||null);const De=ye.startDate.split("T")[0],Se=ye.endDate.split("T")[0];if(P(De),U(Se),Ie(Pt(De)),Me(Pt(Se)),ye.schedule&&h(ye.schedule),ye.assignedFaculty&&ye.assignedFaculty.length>0&&b(ye.assignedFaculty.map(at=>at.id)),ye.enrollments&&ye.enrollments.length>0){const at=[],it=[];ye.enrollments.forEach(ot=>{var E;const I=((E=ot.student)==null?void 0:E.id)??ot.id;I&&(at.push(I),(ot.status==="exception"||ot.enrollmentStatus==="exception")&&it.push(I))}),q(at),re(it)}if(ye.software){const at=ye.software.split(",").map(E=>E.trim()).filter(E=>E),it=["Photoshop","Illustrator","InDesign","After Effects","Premiere Pro","Figma","Sketch","Blender","Maya","3ds Max","Cinema 4D","Lightroom","CorelDRAW","AutoCAD","SolidWorks","Revit","SketchUp","Unity","Unreal Engine","DaVinci Resolve","Final Cut Pro","Procreate","Affinity Designer","Affinity Photo","Canva Pro"],ot=at.filter(E=>it.includes(E)),I=at.filter(E=>!it.includes(E));S(ot),I.length>0&&(de(I.join(", ")),Y(!0))}p(!1)}},[c]),g.useEffect(()=>{if(M&&N.length>0){const B=k(M,N,i);B&&(U(B),Me(Pt(B)))}},[M,N,i]);const Xe=st({mutationFn:async B=>St.updateBatch(s,B),onSuccess:()=>{n.invalidateQueries({queryKey:["batches"]}),n.invalidateQueries({queryKey:["batch",s]}),n.invalidateQueries({queryKey:["students"]}),alert("Batch updated successfully!"),r("/batches")},onError:B=>{var ye,De;alert(((De=(ye=B.response)==null?void 0:ye.data)==null?void 0:De.message)||"Failed to update batch")}}),Be=B=>{h(ye=>{if(ye[B]){const De={...ye};return delete De[B],De}else return{...ye,[B]:{startTime:"",endTime:""}}})},Q=(B,ye,De)=>{h(Se=>{const at={...Se};return m?Object.keys(Se).forEach(it=>{at[it]={...Se[it],[ye]:De}}):at[B]={...Se[B],[ye]:De},at})},l=B=>{var ot;B.preventDefault();const ye=new FormData(B.currentTarget),De=N.length>0?N.join(", "):"";if(!De||De.trim()===""){alert("Please select at least one software for this batch.");return}if(T.length===0){alert("Please select at least one faculty member to assign to this batch.");return}const Se=ye.get("status")||V,at=Se&&Se.trim()?Se.trim():"active",it={title:((ot=ye.get("title"))==null?void 0:ot.trim())||void 0,software:De.trim(),mode:ye.get("mode")||void 0,startDate:M||ye.get("startDate")||void 0,endDate:H||ye.get("endDate")||void 0,maxCapacity:ye.get("maxCapacity")?parseInt(ye.get("maxCapacity")):void 0,status:at,schedule:Object.keys(i).length>0?Object.fromEntries(Object.entries(i).filter(([I,E])=>E.startTime&&E.endTime)):void 0,facultyIds:T,studentIds:C,exceptionStudentIds:K.length>0?K:void 0,courseId:W||null};Xe.mutate(it)},O=async()=>{var it,ot,I;const B=document.querySelector("form");if(!B)return;const ye=new FormData(B),De=N.length>0?N.join(", "):void 0,Se=ye.get("startDate");if(!De||!Se){alert("Please select software and enter start date first to get suggestions");return}let at=[];if(T.length>0)at=T;else if((it=ge==null?void 0:ge.data)!=null&&it.users&&ge.data.users.length>0)at=[ge.data.users[0].id];else{alert("Please select at least one faculty member first, or ensure faculty data is loaded");return}try{const E=ye.get("status")||V||"active",f={title:"TEMP_FOR_SUGGESTIONS",software:De,mode:ye.get("mode")||"online",startDate:Se,endDate:ye.get("endDate")||Se,maxCapacity:100,status:E,facultyIds:at,schedule:Object.keys(i).length>0?Object.fromEntries(Object.entries(i).filter(([R,me])=>me.startTime&&me.endTime)):void 0},Ee=await St.createBatch(f);if(Ee.data.batch){const R=[];ce.includeActive&&R.push("active"),ce.includeActivePlus&&R.push("active plus"),ce.includeDropped&&R.push("dropped"),ce.includeDeactive&&R.push("deactive");const me=await St.suggestCandidates(Ee.data.batch.id,R);me.data&&me.data.candidates?(Pe(me.data.candidates),$(!0)):(Pe([]),$(!0));try{await St.deleteBatch(Ee.data.batch.id)}catch(Oe){console.error("Failed to delete temp batch:",Oe)}}else alert("Failed to create temporary batch for suggestions")}catch(E){console.error("Error getting suggestions:",E),alert(((I=(ot=E.response)==null?void 0:ot.data)==null?void 0:I.message)||"Failed to get suggestions. Please check console for details.")}},X=B=>{q(ye=>ye.includes(B)?ye.filter(De=>De!==B):[...ye,B])},fe=B=>{b(ye=>ye.includes(B)?ye.filter(De=>De!==B):[...ye,B])},Fe=B=>{(B.status==="available"||B.status==="fees_overdue"||B.status==="pending_fees"||B.status==="no_orientation"||B.status==="time_conflict"||B.status==="day_mismatch")&&X(B.studentId)},je=(B,ye)=>{ye?(re(De=>[...De,B]),C.includes(B)||q(De=>[...De,B])):re(De=>De.filter(Se=>Se!==B))},v=(se==null?void 0:se.data.students)||[],_=((A=ge==null?void 0:ge.data)==null?void 0:A.users)||[],ue=(L=c==null?void 0:c.data)==null?void 0:L.batch;return(a==null?void 0:a.role)!=="admin"&&(a==null?void 0:a.role)!=="superadmin"?e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6",children:[e.jsx("p",{className:"text-red-600",children:"You don't have permission to edit batches."}),e.jsx("button",{onClick:()=>r("/batches"),className:"mt-4 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Back to Batches"})]})})}):D||ve||!ue?e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"bg-white shadow-xl rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading batch details..."})]})})})}):e.jsx(et,{children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-orange-500 px-8 py-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Edit Batch"}),e.jsx("p",{className:"mt-2 text-orange-100",children:"Update batch details and settings"})]}),e.jsx("button",{onClick:()=>r("/batches"),className:"px-4 py-2 bg-white text-orange-600 rounded-lg font-semibold hover:bg-orange-50 transition-colors",children:" Back"})]})}),e.jsx("div",{className:"p-8 max-h-[calc(100vh-12rem)] overflow-y-auto",children:e.jsxs("form",{onSubmit:l,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Batch Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"title",required:!0,defaultValue:ue.title,placeholder:"e.g., Digital Art Fundamentals - Batch 1",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(nr,{onSettingsChange:B=>ae(B)})}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Course (Optional)"}),e.jsxs("select",{value:W||"",onChange:B=>Ne(B.target.value?parseInt(B.target.value):null),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select a course (optional)"}),Ze?e.jsx("option",{disabled:!0,children:"Loading courses..."}):(z=Ce==null?void 0:Ce.data)==null?void 0:z.map(B=>e.jsx("option",{value:B.id,children:B.name},B.id))]}),W&&((oe=Ce==null?void 0:Ce.data)==null?void 0:oe.find(B=>B.id===W))&&e.jsxs("p",{className:"mt-1 text-xs text-gray-600",children:["Software: ",Array.isArray((le=Ce.data.find(B=>B.id===W))==null?void 0:le.software)?(xe=Ce.data.find(B=>B.id===W))==null?void 0:xe.software.join(", "):"N/A"]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Software"}),e.jsx("div",{className:"border border-gray-300 rounded-lg p-4 max-h-48 overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:["Photoshop","Illustrator","InDesign","After Effects","Premiere Pro","Figma","Sketch","Blender","Maya","3ds Max","Cinema 4D","Lightroom","CorelDRAW","AutoCAD","SolidWorks","Revit","SketchUp","Unity","Unreal Engine","DaVinci Resolve","Final Cut Pro","Procreate","Affinity Designer","Affinity Photo","Canva Pro","Other"].map(B=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:B==="Other"?te:N.includes(B),onChange:ye=>{B==="Other"?Y(ye.target.checked):ye.target.checked?S(De=>[...De,B]):S(De=>De.filter(Se=>Se!==B))},className:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:B})]},B))})}),te&&e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Specify Other Software"}),e.jsx("input",{type:"text",value:o,onChange:B=>{const ye=B.target.value;if(de(ye),ye.trim()){const De=ye.split(",").map(Se=>Se.trim()).filter(Se=>Se);S(Se=>[...Se.filter(it=>["Photoshop","Illustrator","InDesign","After Effects","Premiere Pro","Figma","Sketch","Blender","Maya","3ds Max","Cinema 4D","Lightroom","CorelDRAW","AutoCAD","SolidWorks","Revit","SketchUp","Unity","Unreal Engine","DaVinci Resolve","Final Cut Pro","Procreate","Affinity Designer","Affinity Photo","Canva Pro"].includes(it)),...De])}else S(De=>De.filter(Se=>["Photoshop","Illustrator","InDesign","After Effects","Premiere Pro","Figma","Sketch","Blender","Maya","3ds Max","Cinema 4D","Lightroom","CorelDRAW","AutoCAD","SolidWorks","Revit","SketchUp","Unity","Unreal Engine","DaVinci Resolve","Final Cut Pro","Procreate","Affinity Designer","Affinity Photo","Canva Pro"].includes(Se)))},placeholder:"Enter software names (comma separated)",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),N.length>0&&e.jsxs("p",{className:"mt-2 text-xs text-gray-600",children:["Selected: ",N.join(", ")]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Mode ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"mode",required:!0,defaultValue:ue.mode,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select mode"}),e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"offline",children:"Offline"}),e.jsx("option",{value:"hybrid",children:"Hybrid"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Start Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",name:"startDate",required:!0,value:M,onChange:B=>{const ye=B.target.value;if(P(ye),Ie(Pt(ye)),N.length>0){const De=k(ye,N,i);De&&(U(De),Me(Pt(De)))}},className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"}),J&&e.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:["Selected: ",J]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["End Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",name:"endDate",required:!0,value:H,onChange:B=>{const ye=B.target.value;U(ye),Me(Pt(ye))},className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"}),Ae&&e.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:["Selected: ",Ae]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Auto-calculated based on software sessions. You can manually override this date."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max Capacity"}),e.jsx("input",{type:"number",name:"maxCapacity",min:"1",defaultValue:ue.maxCapacity||"",placeholder:"e.g., 30",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Maximum number of students allowed in this batch"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Status ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"status",required:!0,value:V,onChange:B=>Qe(B.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})]})," ",e.jsxs("div",{className:"pt-6 border-t border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Schedule (Optional)"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Select days and set start/end times for each day"}),e.jsxs("div",{className:"mb-4 flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{const B=["Monday","Wednesday","Friday"],ye={...i};B.forEach(De=>{ye[De]||(ye[De]={startTime:"",endTime:""})}),Object.keys(ye).forEach(De=>{B.includes(De)||delete ye[De]}),h(ye)},className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${Object.keys(i).length===3&&["Monday","Wednesday","Friday"].every(B=>i[B])?"bg-blue-600 text-white":"bg-blue-100 text-blue-800 hover:bg-blue-200"}`,children:"MWF (Mon, Wed, Fri)"}),e.jsx("button",{type:"button",onClick:()=>{const B=["Tuesday","Thursday","Saturday"],ye={...i};B.forEach(De=>{ye[De]||(ye[De]={startTime:"",endTime:""})}),Object.keys(ye).forEach(De=>{B.includes(De)||delete ye[De]}),h(ye)},className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${Object.keys(i).length===3&&["Tuesday","Thursday","Saturday"].every(B=>i[B])?"bg-purple-600 text-white":"bg-purple-100 text-purple-800 hover:bg-purple-200"}`,children:"TTS (Tue, Thu, Sat)"}),e.jsx("button",{type:"button",onClick:()=>{h({})},className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${Object.keys(i).length>0&&!(["Monday","Wednesday","Friday"].every(B=>i[B])&&Object.keys(i).length===3)&&!(["Tuesday","Thursday","Saturday"].every(B=>i[B])&&Object.keys(i).length===3)?"bg-green-600 text-white":"bg-green-100 text-green-800 hover:bg-green-200"}`,children:"Custom"})]}),e.jsxs("div",{className:"mb-4 p-3 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:B=>j(B.target.checked),className:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-700",children:"Apply same time to all selected days"})]}),e.jsx("p",{className:"ml-6 mt-1 text-xs text-gray-600",children:"When enabled, changing time on any day will update all selected days"})]}),e.jsx("div",{className:"space-y-4",children:bs.map(B=>{const ye=!!i[B],De=i[B]||{startTime:"",endTime:""};return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:ye,onChange:()=>Be(B),className:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-700",children:B})]})}),ye&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-3 pl-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Start Time"}),e.jsx("input",{type:"time",value:De.startTime,onChange:Se=>Q(B,"startTime",Se.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"End Time"}),e.jsx("input",{type:"time",value:De.endTime,onChange:Se=>Q(B,"endTime",Se.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 text-sm"})]})]})]},B)})})]}),e.jsxs("div",{className:"pt-6 border-t border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:["Assign Faculty ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Select at least one faculty member to assign to this batch"}),(he=ge==null?void 0:ge.data)!=null&&he.users&&ge.data.users.length===0?e.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"No faculty members found. Please create faculty users first."})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"max-h-60 overflow-y-auto border border-gray-300 rounded-lg p-3 space-y-2",children:G?e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-orange-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:"Loading faculty..."})]}):_.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No active faculty members found"}):_.filter(B=>B.isActive!==!1).map(B=>e.jsxs("label",{className:"flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:T.includes(B.id),onChange:()=>fe(B.id),className:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500 mr-3"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:B.name}),e.jsxs("span",{className:"text-sm text-gray-600 ml-2",children:["(",B.email,")"]}),B.phone&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:[" ",B.phone]})]})]},B.id))}),T.length>0?e.jsxs("p",{className:"mt-2 text-sm text-green-600 font-medium",children:[" ",T.length," faculty member(s) selected"]}):e.jsx("p",{className:"mt-2 text-sm text-red-600",children:" Please select at least one faculty member"})]})]}),e.jsxs("div",{className:"pt-6 border-t border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Add Students (Optional)"}),e.jsx("button",{type:"button",onClick:O,className:"px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-semibold hover:bg-blue-700 transition-colors",children:"Get Suggested Students"})]}),w&&e.jsxs("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"Suggested Students (based on software)"}),pe.length>0?e.jsx("div",{className:"max-h-40 overflow-y-auto space-y-2",children:pe.map(B=>e.jsx("div",{className:`p-2 rounded border cursor-pointer ${B.status==="available"?"bg-green-50 border-green-300 hover:bg-green-100":B.status==="fees_overdue"?"bg-yellow-50 border-yellow-300 hover:bg-yellow-100":B.status==="pending_fees"?"bg-amber-50 border-amber-300 hover:bg-amber-100":B.status==="no_orientation"?"bg-orange-50 border-orange-300 hover:bg-orange-100":B.status==="time_conflict"||B.status==="day_mismatch"?"bg-red-50 border-red-300 hover:bg-red-100":"bg-gray-50 border-gray-300 opacity-50"}`,onClick:()=>Fe(B),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-medium",children:B.name||`Student #${B.studentId}`}),B.email&&e.jsxs("span",{className:"text-xs text-gray-600 ml-2",children:["(",B.email,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded ${B.status==="available"?"bg-green-200 text-green-800":B.status==="fees_overdue"?"bg-yellow-200 text-yellow-800":B.status==="pending_fees"?"bg-amber-200 text-amber-800":B.status==="no_orientation"?"bg-orange-200 text-orange-800":B.status==="time_conflict"?"bg-red-200 text-red-800":"bg-gray-200 text-gray-800"}`,children:B.statusMessage||B.status}),(B.status==="pending_fees"||B.status==="fees_overdue")&&e.jsxs("label",{className:"flex items-center gap-1 text-xs cursor-pointer",onClick:ye=>ye.stopPropagation(),children:[e.jsx("input",{type:"checkbox",checked:K.includes(B.studentId),onChange:ye=>{je(B.studentId,ye.target.checked),ye.target.checked&&!C.includes(B.studentId)&&X(B.studentId)},className:"w-3 h-3 text-orange-600 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("span",{className:"text-amber-700 font-medium",children:"Add as Exception"})]}),e.jsx("input",{type:"checkbox",checked:C.includes(B.studentId),onChange:()=>X(B.studentId),disabled:B.status==="busy"||B.status==="time_conflict"||B.status==="day_mismatch",className:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500",onClick:ye=>ye.stopPropagation()})]})]})},B.studentId))}):e.jsxs("div",{className:"p-3 bg-white border border-blue-200 rounded",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:['No students found with matching software "',N.join(", "),'".']}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Students need to have the software selected in their profile to appear here."})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Students to Enroll"}),e.jsxs("div",{className:"mb-3 relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Search students by name or email...",value:x,onChange:B=>Z(B.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"max-h-60 overflow-y-auto border border-gray-300 rounded-lg p-3 space-y-2",children:[v.filter(B=>{if(!x.trim())return!0;const ye=x.toLowerCase();return B.name.toLowerCase().includes(ye)||B.email.toLowerCase().includes(ye)}).map(B=>e.jsxs("label",{className:"flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:C.includes(B.id),onChange:()=>X(B.id),className:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500 mr-3"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:B.name}),e.jsxs("span",{className:"text-sm text-gray-600 ml-2",children:["(",B.email,")"]}),K.includes(B.id)&&e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 bg-amber-200 text-amber-800 rounded",children:"Exception"})]})]},B.id)),v.filter(B=>{if(!x.trim())return!1;const ye=x.toLowerCase();return B.name.toLowerCase().includes(ye)||B.email.toLowerCase().includes(ye)}).length===0&&x.trim()&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No students found matching your search"})]}),C.length>0&&e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:[C.length," student(s) selected",K.length>0&&e.jsxs("span",{className:"ml-2 text-amber-600",children:["(",K.length," as exception",K.length>1?"s":"",")"]})]})]})]}),e.jsxs("div",{className:"flex gap-4 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"submit",disabled:Xe.isPending,className:"flex-1 px-6 py-3 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:Xe.isPending?"Updating...":"Update Batch"}),e.jsx("button",{type:"button",onClick:()=>r("/batches"),className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})})]})})})},Ht=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],ll=()=>{var K,re;const{id:t}=xs(),s=Et(),[a,r]=g.useState(null),{data:n,isLoading:i,error:h}=_e({queryKey:["batch",t],queryFn:()=>St.getBatchById(Number(t)),enabled:!!t}),m={Photoshop:23,Illustrator:16,InDesign:16,"After Effects":16,"Premiere Pro":14,Figma:12,XD:6,"Animate CC":32,"Premiere Audition":14,"HTML Java DW CSS":24,"Ar. MAX + Vray":48,MAX:89,Fusion:10,"Real Flow":10,"Fume FX":8,Nuke:24,"Thinking Particle":10,"Ray Fire":6,Mocha:6,Silhouette:6,"PF Track":6,Vue:13,Houdni:12,FCP:11,Maya:92,"CAD UNITY":12,Mudbox:7,"Unity Game Design":24,"Z-Brush":12,Lumion:6,SketchUp:12,Unreal:33,"Blender Pro":72,"Cinema 4D":72,"Substance Painter":6,"3D Equalizer":6,Photography:10,"Auto-Cad":15,Davinci:10,Corel:14,CorelDRAW:14},j=T=>{if(!T)return 0;const b=T.split(",").map($=>$.trim()).filter($=>$);let w=0;return b.forEach($=>{const pe=$.trim();if(m[pe])w+=m[pe];else{const Pe=Object.keys(m).find(te=>te.toLowerCase().includes(pe.toLowerCase())||pe.toLowerCase().includes(te.toLowerCase()));Pe&&(w+=m[Pe])}}),w},C=(T,b,w)=>{if(!T||!b)return"";const $=j(b);if($===0)return T;if(w&&Object.keys(w).length>0&&Object.keys(w).length>0){const Y=new Date(T);Y.setHours(0,0,0,0);let o=new Date(Y),de=0,N=Ht[o.getDay()],S=!1;if(S=[N,N.substring(0,3),N.toLowerCase(),N.substring(0,3).toLowerCase(),o.getDay().toString(),(o.getDay()===0?7:o.getDay()).toString()].some(Z=>Z in w),!S)for(;!S;)o=new Date(o.getTime()+24*60*60*1e3),N=Ht[o.getDay()],S=[N,N.substring(0,3),N.toLowerCase(),N.substring(0,3).toLowerCase(),o.getDay().toString(),(o.getDay()===0?7:o.getDay()).toString()].some(J=>J in w);for(de=1;de<$;){o=new Date(o.getTime()+24*60*60*1e3);const Z=Ht[o.getDay()];[Z,Z.substring(0,3),Z.toLowerCase(),Z.substring(0,3).toLowerCase(),o.getDay().toString(),(o.getDay()===0?7:o.getDay()).toString()].some(Ae=>Ae in w)&&de++}return o.toISOString().split("T")[0]}const pe=new Date(T),Pe=new Date(pe);return Pe.setDate(pe.getDate()+$),Pe.toISOString().split("T")[0]};g.useEffect(()=>{n!=null&&n.data.batch&&r(n.data.batch)},[n]);const q=T=>{var N;const b=[["Section","Field","Value"],["Batch","Title",T.title],["Batch","Software",T.software||"-"],["Batch","Mode",T.mode],["Batch","Status",T.status||"-"],["Batch","Start Date",lt(T.startDate)],["Batch","End Date",lt(T.endDate)],["Batch","Max Capacity",((N=T.maxCapacity)==null?void 0:N.toString())||"-"]],w=T.schedule&&Object.keys(T.schedule).length>0?Object.entries(T.schedule).map(([S,x])=>["Schedule",S,`${x.startTime} - ${x.endTime}`]):[],$=T.assignedFaculty&&T.assignedFaculty.length>0?T.assignedFaculty.map(S=>["Faculty",S.name,`${S.email}${S.phone?` / ${S.phone}`:""}`]):[],pe=T.enrollments&&T.enrollments.length>0?T.enrollments.map((S,x)=>{var Ae,Me,W;const Z=((Ae=S.student)==null?void 0:Ae.name)??S.name??`Student ${x+1}`,J=((Me=S.student)==null?void 0:Me.email)??S.email??"-",Ie=((W=S.student)==null?void 0:W.phone)??S.phone;return["Student",Z,`${J}${Ie?` / ${Ie}`:""}`]}):[],te=[...b,...w,...$,...pe].map(S=>S.map(x=>`"${x.replace(/"/g,'""')}"`).join(",")).join(`
`),Y=new Blob([te],{type:"text/csv"}),o=URL.createObjectURL(Y),de=document.createElement("a");de.href=o,de.download=`${T.title.replace(/\s+/g,"_")}-details.csv`,document.body.appendChild(de),de.click(),document.body.removeChild(de),URL.revokeObjectURL(o)};return i?e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})})})}):h||!a?e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"bg-white shadow-xl rounded-lg p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-600 mb-4",children:"Failed to load batch details"}),e.jsx("button",{onClick:()=>s("/batches"),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Back to Batches"})]})})})}):e.jsx(et,{children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:()=>s("/batches"),className:"flex items-center text-gray-600 hover:text-gray-900 mb-4",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to Batches"]})}),e.jsx("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"rounded-2xl bg-gradient-to-r from-orange-600 to-pink-500 p-5 text-white flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm uppercase tracking-wide text-orange-100",children:"Batch Overview"}),e.jsx("h1",{className:"text-3xl font-bold",children:a.title}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-sm",children:[e.jsx("span",{className:"px-3 py-1 rounded-full bg-white/20",children:a.mode}),e.jsx("span",{className:`px-3 py-1 rounded-full ${a.status==="active"?"bg-emerald-200/80 text-emerald-800":"bg-gray-200 text-gray-800"}`,children:a.status||"inactive"}),a.maxCapacity&&e.jsxs("span",{className:"px-3 py-1 rounded-full bg-white/20",children:[a.maxCapacity," seats"]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:e.jsx("button",{onClick:()=>q(a),className:"px-4 py-2 rounded-lg bg-white text-orange-600 font-semibold shadow hover:bg-gray-100 transition-colors",children:"Download CSV"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{className:"rounded-xl border border-gray-200 p-5 space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Key Details"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm text-gray-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Start Date"}),e.jsx("p",{className:"font-medium",children:lt(a.startDate)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"End Date"}),e.jsx("p",{className:"font-medium",children:lt(a.endDate)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Software"}),e.jsx("p",{className:"font-medium",children:a.software||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Total Lectures"}),e.jsxs("p",{className:"font-medium",children:[j(a.software||"")," lectures"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Expected End Date"}),e.jsx("p",{className:"font-medium",children:a.startDate&&a.software?lt(C(a.startDate,a.software||"",a.schedule)||""):"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Created At"}),e.jsx("p",{className:"font-medium",children:a.createdAt?new Date(a.createdAt).toLocaleString():"-"})]})]})]}),e.jsxs("div",{className:"rounded-xl border border-gray-200 p-5 space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Schedule"}),(()=>{if(!a.schedule)return e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("p",{children:"No schedule defined."}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Edit this batch to add a schedule."})]});if(Array.isArray(a.schedule)?a.schedule.length===0:Object.keys(a.schedule).length===0)return e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("p",{children:"No schedule defined."}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Edit this batch to add a schedule."})]});let b=[];if(Array.isArray(a.schedule))b=a.schedule.map((w,$)=>w&&typeof w=="object"&&(w.day||w.startTime)?{day:w.day||Ht[$]||`Day ${$+1}`,times:w.startTime?{startTime:w.startTime,endTime:w.endTime}:w}:w&&w.startTime?{day:Ht[$]||`Day ${$+1}`,times:w}:null).filter(w=>w!==null&&w.times&&w.times.startTime);else{const w=a.schedule,$=Ht.filter(pe=>w[pe]&&w[pe].startTime).map(pe=>({day:pe,times:w[pe]}));$.length>0?b=$:b=Object.entries(w).filter(([Pe,te])=>te?!!(typeof te=="object"&&te.startTime):!1).map(([Pe,te])=>{const Y=parseInt(Pe);return!isNaN(Y)&&Y>=0&&Y<Ht.length?{day:Ht[Y],times:typeof te=="object"&&te.startTime?te:{startTime:"",endTime:""}}:{day:Pe,times:typeof te=="object"&&te.startTime?te:{startTime:"",endTime:""}}}).filter(Pe=>Pe.times.startTime)}return b.length===0?e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("p",{children:"No valid schedule entries found."}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Edit this batch to add or update the schedule."})]}):e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto pr-1",children:b.map(({day:w,times:$})=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 rounded-lg px-3 py-2 text-sm hover:bg-gray-100 transition-colors",children:[e.jsx("span",{className:"font-medium text-gray-700 capitalize",children:w}),e.jsxs("span",{className:"text-gray-600 font-mono",children:[($==null?void 0:$.startTime)||"-"," - ",($==null?void 0:$.endTime)||"-"]})]},w))})})()]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{className:"rounded-xl border border-gray-200 p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Assigned Faculty"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[((K=a.assignedFaculty)==null?void 0:K.length)||0," member(s)"]})]}),a.assignedFaculty&&a.assignedFaculty.length>0?e.jsx("div",{className:"space-y-3",children:a.assignedFaculty.map(T=>e.jsxs("div",{className:"flex flex-col rounded-lg border border-gray-100 bg-gray-50 px-3 py-2 text-sm",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:T.name}),e.jsx("span",{className:"text-gray-600",children:T.email}),T.phone&&e.jsx("span",{className:"text-gray-500",children:T.phone})]},T.id))}):e.jsx("p",{className:"text-sm text-gray-500",children:"No faculty assigned."})]}),e.jsxs("div",{className:"rounded-xl border border-gray-200 p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Enrolled Students"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[((re=a.enrollments)==null?void 0:re.length)||0," student(s)"]})]}),a.enrollments&&a.enrollments.length>0?e.jsx("div",{className:"space-y-3 max-h-56 overflow-y-auto pr-1",children:a.enrollments.map((T,b)=>{var Y,o,de,N;const w=((Y=T.student)==null?void 0:Y.id)??T.id??b,$=((o=T.student)==null?void 0:o.name)??T.name??"Unknown Student",pe=((de=T.student)==null?void 0:de.email)??T.email??"-",Pe=((N=T.student)==null?void 0:N.phone)??T.phone,te=T.enrollmentStatus==="exception";return e.jsx("div",{className:`flex flex-col rounded-lg border px-3 py-2 text-sm ${te?"border-amber-300 bg-amber-50":"border-gray-100"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:$}),e.jsxs("span",{className:"text-gray-600 ml-2",children:["(",pe,")"]}),Pe&&e.jsx("span",{className:"text-gray-500 block text-xs",children:Pe})]}),te&&e.jsx("span",{className:"ml-2 px-2 py-1 text-xs font-semibold bg-amber-200 text-amber-800 rounded",children:"Exception"})]})},w)})}):e.jsx("p",{className:"text-sm text-gray-500",children:"No students enrolled yet."})]})]})]})})]})})},wt={uploadFile:async t=>{const s=new FormData;return s.append("files",t),(await Re.post("/upload",s)).data},uploadMultipleFiles:async t=>{const s=new FormData;return t.forEach(r=>{s.append("files",r)}),(await Re.post("/upload",s)).data}},Pa=()=>{let t="https://api.prashantthakar.com/api";if(t)return t=t.trim(),!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${window.location.protocol}//${t}`),t.endsWith("/api")?t:`${t}/api`;if(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")return"http://localhost:3001/api";{const s=window.location.hostname,a=window.location.protocol,r=s.split(".");if(r.length>=3){const i=`api.${r.slice(-2).join(".")}`;return`${a}//${i}/api`}else return`${window.location.origin}/api`}},He=t=>{if(!t)return null;if(t.includes("://"))try{const h=new URL(t),m=h.hostname;let j=h.pathname;const C=m.split("."),q=C.length>=2?C.slice(-2).join("."):m,K=/\/\.?([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}(\/|$)/;j=j.replace(K,b=>{const w=b.replace(/^\/\.?/,"").replace(/\/$/,""),$=w.split("."),pe=$.length>=2?$.slice(-2).join("."):w;return pe===q||w===m||w.includes(m)||m.includes(w)||m.includes(pe)||pe.includes(q)?"/":b}),j="/"+j.split("/").filter(b=>b).filter(b=>{const w=b.startsWith(".")?b.substring(1):b;if(/^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/.test(w)){const pe=w.split("."),Pe=pe.length>=2?pe.slice(-2).join("."):w;return!(Pe===q||w===m||w.includes(m)||m.includes(w)||m.includes(Pe)||Pe.includes(q))}return!0}).join("/").replace(/\/+/g,"/"),h.pathname=j,h.pathname=h.pathname.replace(/\/api\/uploads(\/|$)/g,"/uploads$1"),t=h.toString()}catch{t=t.replace(/\/\.?([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}(\/|$)/g,"/"),t=t.replace(/\/api\/uploads(\/|$)/g,"/uploads$1")}if(t.startsWith("http://")||t.startsWith("https://"))try{const h=new URL(t),m=h.hostname,j=m.split("."),C=j.length>=2?j.slice(-2).join("."):m,q=/^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/;let K=h.pathname;const re=/\/\.?([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}(\/|$)/;return K=K.replace(re,w=>{const $=w.replace(/^\/\.?/,"").replace(/\/$/,""),pe=$.split("."),Pe=pe.length>=2?pe.slice(-2).join("."):$;return Pe===C||$===m||$.includes(m)||m.includes($)||m.includes(Pe)||Pe.includes(C)?"/":w}),K="/"+K.split("/").filter(w=>w).filter(w=>{const $=w.startsWith(".")?w.substring(1):w;if(q.test($)){const pe=$.split("."),Pe=pe.length>=2?pe.slice(-2).join("."):$;return!(Pe===C||$===m||$.includes(m)||m.includes($)||m.includes(Pe)||Pe.includes(C))}return!0}).join("/").replace(/\/+/g,"/"),h.pathname=K,h.pathname=h.pathname.replace(/\/api\/uploads(\/|$)/g,"/uploads$1"),h.toString()}catch{let m=t;return m=m.replace(/\/\.?([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}(\/|$)/g,"/"),m=m.replace(/\/api\/uploads(\/|$)/g,"/uploads$1"),m=m.replace(/\/+/g,"/"),m}if(t.startsWith("data:"))return t;let s=t.trim();if(s.startsWith(".")&&(/^\.([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}/.test(s)?s=(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?"http://":window.location.protocol+"//")+s.substring(1):s=s.substring(1)),s.startsWith("/")){const h=/^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/;s=s.replace(/^\/\.([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}(\/|$)/,"/");const m=s.split("/").filter(j=>j);if(m.length>0){const j=m[0].startsWith(".")?m[0].substring(1):m[0];h.test(j)&&(m.shift(),s="/"+m.join("/"))}}const a=/^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/;if(a.test(s)){const m=window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1"?"https://":"http://";!s.startsWith("http://")&&!s.startsWith("https://")&&(s=m+s),s=s.replace(/\/api\/uploads(\/|$)/g,"/uploads$1");try{const j=new URL(s);let C=j.pathname;C=C.replace(/^\/\.([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}(\/|$)/,"/");const q=C.split("/").filter(re=>re),K=q.filter(re=>{const T=re.startsWith(".")?re.substring(1):re;return!a.test(T)});K.length!==q.length&&(j.pathname="/"+K.join("/"),s=j.toString())}catch(j){console.warn("Failed to parse URL:",s,j)}return s}const r=Pa();let n=r.replace("/api","").replace(/\/$/,""),i=s.startsWith("/")?s:`/${s}`;if(console.log("imageUtils - Initial relativePath:",i),i=i.replace(/^\/api\/uploads\//,"/uploads/"),i=i.replace(/\/api\/uploads(\/|$)/g,"/uploads$1"),console.log("imageUtils - After /api removal:",i),window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")if(i.startsWith("/uploads/"))console.log("imageUtils - Local dev, path starts with /uploads/, preserving:",i),i=i.replace(/\/{2,}/g,"/"),console.log("imageUtils - After cleanup:",i);else{const h=i.split("/").filter(m=>m);if(h.length>0){const m=/^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/;i="/"+h.filter((C,q)=>{if(q===h.length-1)return!0;const K=C.startsWith(".")?C.substring(1):C;return!m.test(K)}).join("/")}i=i.replace(/\/{2,}/g,"/")}else{const h=i.split("/").filter(m=>m);if(h.length>0){const m=/^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/;i="/"+h.filter((C,q)=>{if(q===h.length-1)return!0;const K=C.startsWith(".")?C.substring(1):C;return!m.test(K)}).join("/")}i=i.replace(/\/{2,}/g,"/")}if(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"){if(n="http://localhost:3001",i.startsWith("/uploads")||(i.startsWith("/")?i="/uploads"+i:i="/uploads/"+i),i=i.replace(/\/{2,}/g,"/"),!i.match(/\/[^/]+\.[a-zA-Z0-9]+$/)){const m=s.match(/\/([^/]+\.(jpg|jpeg|png|gif|webp|pdf))$/i);m&&m[1]?(console.warn("Filename missing, recovering:",{original:t,cleaned:s,relativePath:i,recoveredFilename:m[1]}),i=i.replace(/\/$/,"")+"/"+m[1]):console.error("CRITICAL: Cannot recover filename!",{original:t,cleaned:s,relativePath:i})}const h=`${n}${i}`;return console.log("Local image URL constructed:",{original:t,cleaned:s,relativePath:i,baseUrl:n,fullUrl:h}),h}try{if(n=Pa().replace("/api","").replace(/\/$/,""),!n.startsWith("http://")&&!n.startsWith("https://")){const C=window.location.protocol;n.startsWith("//")?n=`${C}${n}`:n=`${C}//${n}`}const m=new URL(n);if(n=`${m.protocol}//${m.hostname}${m.port?":"+m.port:""}`,!n||n==="//"||!n.includes("."))throw new Error(`Invalid base URL: ${n}`);if(i.startsWith("/uploads")||(i.startsWith("/")?i="/uploads"+i:i="/uploads/"+i),i=i.replace(/\/{2,}/g,"/"),!i.match(/\/[^/]+\.[a-zA-Z0-9]+$/)){const C=s.match(/\/([^/]+\.(jpg|jpeg|png|gif|webp|pdf))$/i);C&&C[1]&&(console.warn("Production - Filename missing, recovering:",{original:t,cleaned:s,relativePath:i,recoveredFilename:C[1]}),i=i.replace(/\/$/,"")+"/"+C[1])}const j=`${n}${i}`;try{const C=new URL(j);let q=C.pathname;const K=q.split("/").filter(re=>re);if(K.length>0){const re=/^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/;q="/"+K.filter((b,w)=>{if(w===K.length-1)return!0;const $=b.startsWith(".")?b.substring(1):b;return!re.test($)}).join("/")}return q=q.replace(/\/+/g,"/"),C.pathname=q,C.toString()}catch{return j}}catch(h){console.error("Error constructing production URL:",h,{apiBase:r,baseUrl:n,relativePath:i,imageUrl:t});try{const m=window.location.hostname,j=window.location.protocol,C=m.split(".");if(C.length>=3){const re=`api.${C.slice(-2).join(".")}`;n=`${j}//${re}`}else n=window.location.origin;i.startsWith("/uploads")||(i.startsWith("/")?i="/uploads"+i:i="/uploads/"+i);const q=`${n}${i}`;return console.warn("Using fallback URL:",q),q}catch(m){return console.error("Fallback URL construction also failed:",m),t}}},ol=()=>{var W,Ne,V,Qe,ve,p,M,P,H;const{user:t}=Nt(),s=Et(),a=vt(),[r,n]=g.useState(null),[i,h]=g.useState(!1),[m,j]=g.useState(!1),[C,q]=g.useState(!1),[K,re]=g.useState(null),[T,b]=g.useState(!1),[w,$]=g.useState(""),{data:pe,isLoading:Pe,error:te}=_e({queryKey:["faculty"],queryFn:()=>Kt.getAllFaculty(),retry:1}),{data:Y,isLoading:o,error:de,refetch:N}=_e({queryKey:["faculty-profile",r==null?void 0:r.id],queryFn:async()=>{var U,ce,ae,u,k,c;if(!(r!=null&&r.id))return console.warn("No faculty ID provided for profile fetch"),null;try{const D=await yt.getUser(r.id);console.log("Faculty profile API response:",D);let se=null;const ge=(D==null?void 0:D.data)||D;if((U=ge==null?void 0:ge.data)!=null&&U.user?se=ge.data.user:ge!=null&&ge.data&&!ge.data.user&&ge.data.id?se=ge.data:ge!=null&&ge.user?se=ge.user:ge!=null&&ge.id&&(se=ge),!se||!se.id)return console.warn("Invalid user response structure, using fallback:",ge),{user:r,profile:r.facultyProfile||null};let G=se.facultyProfile||null;if(!G)try{const Ce=await Re.get(`/faculty/${r.id}`);console.log("Profile response:",Ce),(ae=(ce=Ce==null?void 0:Ce.data)==null?void 0:ce.data)!=null&&ae.facultyProfile?G=Ce.data.data.facultyProfile:(u=Ce==null?void 0:Ce.data)!=null&&u.facultyProfile?G=Ce.data.facultyProfile:(k=Ce==null?void 0:Ce.data)!=null&&k.data&&Ce.data.data.id?G=Ce.data.data:(c=Ce==null?void 0:Ce.data)!=null&&c.id&&(G=Ce.data),console.log("Extracted profile:",G)}catch(Ce){console.warn("Could not fetch faculty profile separately:",Ce==null?void 0:Ce.message),r.facultyProfile&&(G=r.facultyProfile)}return console.log("Faculty user data:",se),console.log("Faculty profile data:",G),console.log("Profile documents:",G==null?void 0:G.documents),{user:se,profile:G}}catch(D){return console.error("Error fetching faculty profile:",D),console.warn("Using fallback faculty data due to error:",D==null?void 0:D.message),{user:r,profile:r.facultyProfile||null}}},enabled:!!(r!=null&&r.id)&&C,retry:2,staleTime:0,gcTime:0,refetchOnMount:!0,refetchOnWindowFocus:!1});At.useEffect(()=>{C&&r&&(a.invalidateQueries({queryKey:["faculty-profile",r.id]}),a.invalidateQueries({queryKey:["faculty",r.id]}),a.invalidateQueries({queryKey:["faculty"]}),a.invalidateQueries({queryKey:["users",r.id]}),setTimeout(()=>{N()},100))},[C,r,a,N]),At.useEffect(()=>{a.invalidateQueries({queryKey:["faculty"]})},[a]);const S=st({mutationFn:U=>yt.deleteUser(U),onSuccess:()=>{a.invalidateQueries({queryKey:["faculty"]}),h(!1),n(null),alert("Faculty deleted successfully!")},onError:U=>{var ce,ae;alert(((ae=(ce=U.response)==null?void 0:ce.data)==null?void 0:ae.message)||"Failed to delete faculty")}}),x=st({mutationFn:({userId:U,avatarUrl:ce})=>yt.updateUser(U,{avatarUrl:ce}),onSuccess:(U,ce)=>{if(a.invalidateQueries({queryKey:["faculty"]}),a.invalidateQueries({queryKey:["users"]}),a.invalidateQueries({queryKey:["faculty-profile",r==null?void 0:r.id]}),r){const ae={...r,avatarUrl:ce.avatarUrl};if(n(ae),!K||!K.startsWith("data:")){const u=He(ce.avatarUrl)||ce.avatarUrl,k=u+(u.includes("?")?"&":"?")+`t=${Date.now()}`;console.log("Faculty Management - Mutation success, updating preview:",{avatarUrl:ce.avatarUrl,fullImageUrl:u,cacheBustedUrl:k}),re(k)}}b(!1),alert("Image updated successfully!"),setTimeout(()=>{j(!1),n(null),re(null)},2e3)},onError:U=>{var ce,ae;alert(((ae=(ce=U.response)==null?void 0:ce.data)==null?void 0:ae.message)||"Failed to update image"),b(!1)}}),Z=async U=>{var u,k,c;const ce=(u=U.target.files)==null?void 0:u[0];if(!ce||!r)return;if(!ce.type.startsWith("image/")){alert("Please select an image file");return}if(ce.size>5*1024*1024){alert("Image size must be less than 5MB");return}const ae=new FileReader;ae.onloadend=()=>{re(ae.result)},ae.readAsDataURL(ce),b(!0);try{const D=await wt.uploadFile(ce);if(console.log("Upload response:",D),D.data&&D.data.files&&D.data.files.length>0){const se=D.data.files[0].url;console.log("Faculty Management - Upload response:",{uploadResponse:D,imageUrl:se,file:D.data.files[0]});const ge=He(se)||se,G=ge+(ge.includes("?")?"&":"?")+`t=${Date.now()}`;console.log("Faculty Management - URL processing:",{original:se,fullImageUrl:ge,cacheBustedUrl:G});const Ce=G;re(Ce),console.log("Faculty Management - Set imagePreview to:",Ce),x.mutate({userId:r.id,avatarUrl:se})}else throw new Error("No files returned from upload")}catch(D){console.error("Upload error:",D),alert(((c=(k=D.response)==null?void 0:k.data)==null?void 0:c.message)||D.message||"Failed to upload image"),b(!1),re(null)}},J=(pe==null?void 0:pe.data.users)||[],Ie=J.filter(U=>{var ae,u,k;if(!w.trim())return!0;const ce=w.toLowerCase();return((ae=U.name)==null?void 0:ae.toLowerCase().includes(ce))||((u=U.email)==null?void 0:u.toLowerCase().includes(ce))||((k=U.phone)==null?void 0:k.toLowerCase().includes(ce))}),Ae=U=>{n(U),h(!0)},Me=()=>{r&&S.mutate(r.id)};return Pe?e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})})})}):te?e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"bg-white shadow-xl rounded-lg p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-red-600 text-lg mb-4",children:"Error loading faculty data"}),e.jsx("p",{className:"text-gray-500 text-sm",children:((Ne=(W=te==null?void 0:te.response)==null?void 0:W.data)==null?void 0:Ne.message)||(te==null?void 0:te.message)||"Unknown error"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Retry"})]})})})}):e.jsxs(et,{children:[e.jsx("div",{className:"max-w-7xl mx-auto p-4 md:p-6",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-orange-500 px-4 md:px-8 py-4 md:py-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-white",children:"Faculty Management"}),e.jsx("p",{className:"mt-2 text-sm md:text-base text-orange-100",children:"Manage faculty members"})]}),((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")&&e.jsx("button",{onClick:()=>window.location.href="/faculty/register",className:"px-4 py-2 bg-white text-orange-600 rounded-lg font-semibold hover:bg-orange-50 transition-colors text-sm md:text-base whitespace-nowrap",children:"+ New Faculty Registration"})]})}),e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"relative max-w-md",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Search faculty by name, email, or phone...",value:w,onChange:U=>$(U.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"}),w&&e.jsx("button",{onClick:()=>$(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400 hover:text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),w&&e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Showing ",Ie.length," of ",J.length," faculty members"]})]}),Ie.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500 text-lg",children:w?"No faculty members found matching your search":"No faculty members found"}),w&&e.jsx("button",{onClick:()=>$(""),className:"mt-2 text-orange-600 hover:text-orange-700 text-sm",children:"Clear search"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"S.No"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Photo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Expertise"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Availability"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")&&e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Ie.map((U,ce)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:ce+1})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"flex items-center",children:U.avatarUrl?e.jsx("img",{src:(He(U.avatarUrl)||U.avatarUrl)+(U.avatarUrl.includes("?")?"&":"?")+`t=${Date.now()}`,alt:U.name,className:"h-12 w-12 rounded-full object-cover border-2 border-gray-200",crossOrigin:"anonymous",onError:ae=>{console.error("Faculty photo failed to load:",U.avatarUrl),ae.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2ZmOTUwMCIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMjAiIGZpbGw9IiNmZmYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj57e2ZhY3VsdHlNZW1iZXIubmFtZS5jaGFyQXQoMCl9fTwvdGV4dD48L3N2Zz4="}},`faculty-${U.id}-${U.avatarUrl}`):e.jsx("div",{className:"h-12 w-12 rounded-full bg-orange-500 flex items-center justify-center text-white font-semibold text-lg",children:U.name.charAt(0).toUpperCase()})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:U.name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:U.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:U.phone||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:(()=>{var u;const ae=(u=U.facultyProfile)==null?void 0:u.expertise;if(!ae)return"-";if(typeof ae=="string")return ae;if(typeof ae=="object"&&ae!==null){const k=ae,c=k.description||k.expertise||k.text;return typeof c=="string"?c:JSON.stringify(c||ae)}return String(ae)})()})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:(()=>{var u;const ae=(u=U.facultyProfile)==null?void 0:u.availability;if(!ae)return"-";if(typeof ae=="string")return ae;if(typeof ae=="object"&&ae!==null){const k=ae,c=k.schedule||k.availability||k.text;return typeof c=="string"?c:JSON.stringify(c||ae)}return String(ae)})()})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${U.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:U.isActive?"Active":"Inactive"})}),((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")&&e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{onClick:()=>{n(U),q(!0)},className:"text-blue-600 hover:text-blue-900 text-xs",title:"View Faculty",children:" View"}),e.jsx("button",{onClick:()=>{n(U),re(U.avatarUrl||null),j(!0)},className:"text-orange-600 hover:text-orange-900 text-xs",title:"Update Photo",children:" Update Photo"}),e.jsx("button",{onClick:()=>s(`/faculty/${U.id}/edit`),className:"text-orange-600 hover:text-orange-900 text-xs",title:"Edit Faculty",children:" Edit"}),(t==null?void 0:t.role)==="superadmin"&&e.jsx("button",{onClick:()=>Ae(U),className:"text-red-600 hover:text-red-900 text-xs",title:"Delete Faculty",children:" Delete"})]})})]},U.id))})]})})]})]})}),i&&r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-red-600",children:"Delete Faculty"}),e.jsxs("p",{className:"mb-4 text-gray-700",children:["Are you sure you want to delete ",e.jsx("strong",{children:r.name}),"? This action cannot be undone."]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("button",{onClick:Me,disabled:S.isPending,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition-colors disabled:opacity-50 text-sm sm:text-base",children:S.isPending?"Deleting...":"Delete"}),e.jsx("button",{onClick:()=>{h(!1),n(null)},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors text-sm sm:text-base",children:"Cancel"})]})]})}),m&&r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Update Faculty Photo"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("strong",{children:"Faculty:"})," ",r.name]}),e.jsx("div",{className:"flex justify-center mb-4",children:K?(()=>{let U=K;if(!U.startsWith("data:")){const ce=He(U)||U;U=ce+(ce.includes("?")?"&":"?")+`t=${Date.now()}`,console.log("Faculty Management - Image preview URL:",{original:K,processed:ce,final:U})}return e.jsx("img",{src:U,alt:"Preview",className:"h-32 w-32 rounded-full object-cover border-4 border-orange-500",crossOrigin:"anonymous",onError:ce=>{console.error("Image preview failed to load:",{previewSrc:U,imagePreview:K}),ce.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZmY5NTAwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSI0OCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPnt7c2VsZWN0ZWRGYWN1bHR5Lm5hbWUuY2hhckF0KDApfX08L3RleHQ+PC9zdmc+"}},`preview-${K}-${Date.now()}`)})():r!=null&&r.avatarUrl?(()=>{const U=He(r.avatarUrl)||r.avatarUrl,ce=U+(U.includes("?")?"&":"?")+`t=${Date.now()}`;return console.log("Faculty Management - Current photo URL:",{original:r.avatarUrl,final:ce}),e.jsx("img",{src:ce,alt:"Current",className:"h-32 w-32 rounded-full object-cover border-4 border-orange-500",crossOrigin:"anonymous",onError:ae=>{console.error("Current faculty photo failed to load:",{original:r.avatarUrl,final:ce}),ae.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZmY5NTAwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSI0OCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPnt7c2VsZWN0ZWRGYWN1bHR5Lm5hbWUuY2hhckF0KDApfX08L3RleHQ+PC9zdmc+"}},`current-${r.avatarUrl}-${Date.now()}`)})():e.jsx("div",{className:"h-32 w-32 rounded-full bg-gray-200 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-400",children:"No image"})})}),e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Image (JPG, PNG - Max 5MB)"}),e.jsx("input",{type:"file",accept:"image/jpeg,image/jpg,image/png",onChange:Z,disabled:T,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 disabled:opacity-50"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{type:"button",onClick:()=>{j(!1),n(null),re(null)},disabled:T,className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors disabled:opacity-50",children:T?"Uploading...":"Close"})})]})}),C&&r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center z-10",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Faculty Details"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:async()=>{a.invalidateQueries({queryKey:["faculty-profile",r==null?void 0:r.id]}),a.invalidateQueries({queryKey:["faculty",r==null?void 0:r.id]}),a.invalidateQueries({queryKey:["faculty"]}),a.invalidateQueries({queryKey:["users",r==null?void 0:r.id]}),await N()},className:"px-3 py-1 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700",title:"Refresh Faculty Data",children:" Refresh"}),e.jsx("button",{onClick:()=>{q(!1),n(null)},className:"text-gray-400 hover:text-gray-600 text-2xl font-bold",children:""})]})]}),e.jsx("div",{className:"p-6",children:o?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"Loading faculty details..."})}):de?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-red-600 font-semibold mb-2",children:"Failed to load faculty details"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:((Qe=(V=de==null?void 0:de.response)==null?void 0:V.data)==null?void 0:Qe.message)||(de==null?void 0:de.message)||"An error occurred while fetching faculty details"}),e.jsx("button",{onClick:()=>{a.invalidateQueries({queryKey:["faculty-profile",r==null?void 0:r.id]}),N()},className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Retry"})]}):Y&&Y.user||r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 border-b pb-2",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Photo"}),e.jsx("div",{className:"mt-2",children:(()=>{const U=(Y==null?void 0:Y.user)||r,ce=U==null?void 0:U.avatarUrl,ae=(U==null?void 0:U.name)||"";return ce?e.jsx("img",{src:He(ce)||"",alt:ae,className:"h-24 w-24 rounded-full object-cover border-2 border-gray-200",crossOrigin:"anonymous",onError:u=>{u.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iOTYiIGhlaWdodD0iOTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2ZmOTUwMCIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMzYiIGZpbGw9IiNmZmYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj57e25hbWUuY2hhckF0KDApfX08L3RleHQ+PC9zdmc+"}}):e.jsx("div",{className:"h-24 w-24 rounded-full bg-orange-500 flex items-center justify-center text-white font-semibold text-2xl",children:ae.charAt(0).toUpperCase()})})()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Name"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:((ve=(Y==null?void 0:Y.user)||r)==null?void 0:ve.name)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:((p=(Y==null?void 0:Y.user)||r)==null?void 0:p.email)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Phone"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:((M=(Y==null?void 0:Y.user)||r)==null?void 0:M.phone)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Status"}),e.jsx("p",{className:"mt-1",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${(P=(Y==null?void 0:Y.user)||r)!=null&&P.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:(H=(Y==null?void 0:Y.user)||r)!=null&&H.isActive?"Active":"Inactive"})})]})]})]}),Y!=null&&Y.profile||r!=null&&r.facultyProfile?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 border-b pb-2",children:"Faculty Profile"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(()=>{const U=(Y==null?void 0:Y.profile)||(r==null?void 0:r.facultyProfile);let ce=U==null?void 0:U.expertise,ae=U==null?void 0:U.availability;if(ce&&typeof ce=="string")try{const u=JSON.parse(ce);typeof u=="object"&&u!==null?ce=u.description||u.expertise||u.text||JSON.stringify(u):ce=u}catch{}else ce&&typeof ce=="object"&&(ce=ce.description||ce.expertise||ce.text||JSON.stringify(ce));if(ae&&typeof ae=="string")try{const u=JSON.parse(ae);if(typeof u=="object"&&u!==null){const k=u.schedule||u.availability||u.text;ae=typeof k=="string"?k:JSON.stringify(k||u)}else ae=String(u)}catch{}else if(ae&&typeof ae=="object"){const u=ae.schedule||ae.availability||ae.text;ae=typeof u=="string"?u:JSON.stringify(u||ae)}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Expertise"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:ce||e.jsx("span",{className:"text-gray-400 italic",children:"Not provided"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Availability"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:ae||e.jsx("span",{className:"text-gray-400 italic",children:"Not provided"})})]})]})})()})]}),(()=>{const U=(Y==null?void 0:Y.profile)||(r==null?void 0:r.facultyProfile),ce=U==null?void 0:U.documents;let ae=null;if(ce)if(typeof ce=="string")try{ae=JSON.parse(ce)}catch(ge){console.error("Error parsing documents:",ge)}else typeof ce=="object"&&ce!==null&&(ae=ce);const u=(ae==null?void 0:ae.personalInfo)||{},k=(ae==null?void 0:ae.employmentInfo)||{},c=(ae==null?void 0:ae.bankInfo)||{},D=(ae==null?void 0:ae.emergencyInfo)||{},se=(ae==null?void 0:ae.softwareProficiency)||"";return!u.dateOfBirth&&(U!=null&&U.dateOfBirth)&&(u.dateOfBirth=U.dateOfBirth),e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 border-b pb-2",children:"Personal Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Gender"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:u.gender||e.jsx("span",{className:"text-gray-400 italic",children:"Not provided"})})]}),(()=>{const ge=(Y==null?void 0:Y.profile)||(r==null?void 0:r.facultyProfile),G=u.dateOfBirth||(ge==null?void 0:ge.dateOfBirth);return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Date of Birth"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:G?lt(G):e.jsx("span",{className:"text-gray-400 italic",children:"Not provided"})})]})})(),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Nationality"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:u.nationality||e.jsx("span",{className:"text-gray-400 italic",children:"Not provided"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Marital Status"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:u.maritalStatus||e.jsx("span",{className:"text-gray-400 italic",children:"Not provided"})})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Address"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:u.address||e.jsx("span",{className:"text-gray-400 italic",children:"Not provided"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"City"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:u.city||e.jsx("span",{className:"text-gray-400 italic",children:"Not provided"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"State"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:u.state||e.jsx("span",{className:"text-gray-400 italic",children:"Not provided"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Postal Code"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:u.postalCode||e.jsx("span",{className:"text-gray-400 italic",children:"Not provided"})})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 border-b pb-2",children:"Employment Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Department"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:k.department||e.jsx("span",{className:"text-gray-400 italic",children:"Not provided"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Designation"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:k.designation||e.jsx("span",{className:"text-gray-400 italic",children:"Not provided"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Date of Joining"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:k.dateOfJoining?lt(k.dateOfJoining):e.jsx("span",{className:"text-gray-400 italic",children:"Not provided"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Employment Type"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:k.employmentType||e.jsx("span",{className:"text-gray-400 italic",children:"Not provided"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Reporting Manager"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:k.reportingManager||e.jsx("span",{className:"text-gray-400 italic",children:"Not provided"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Work Location"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:k.workLocation||e.jsx("span",{className:"text-gray-400 italic",children:"Not provided"})})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 border-b pb-2",children:"Bank Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Bank Name"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:c.bankName||e.jsx("span",{className:"text-gray-400 italic",children:"Not provided"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Account Number"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:c.accountNumber||e.jsx("span",{className:"text-gray-400 italic",children:"Not provided"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"IFSC Code"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:c.ifscCode||e.jsx("span",{className:"text-gray-400 italic",children:"Not provided"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Branch"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:c.branch||e.jsx("span",{className:"text-gray-400 italic",children:"Not provided"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"PAN Number"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:c.panNumber||e.jsx("span",{className:"text-gray-400 italic",children:"Not provided"})})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 border-b pb-2",children:"Emergency Contact"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Emergency Contact Name"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:D.emergencyContactName||D.name||e.jsx("span",{className:"text-gray-400 italic",children:"Not provided"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Emergency Contact Number"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:D.emergencyPhoneNumber||D.number||e.jsx("span",{className:"text-gray-400 italic",children:"Not provided"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Relationship"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:D.emergencyRelationship||D.relation||e.jsx("span",{className:"text-gray-400 italic",children:"Not provided"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Alternate Phone Number"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:D.emergencyAlternatePhone||e.jsx("span",{className:"text-gray-400 italic",children:"Not provided"})})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 border-b pb-2",children:"Software Proficiency"}),se&&se.trim()!==""?e.jsx("div",{className:"flex flex-wrap gap-2",children:se.split(",").map((ge,G)=>e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded text-sm font-medium",children:ge.trim()},G))}):e.jsx("p",{className:"text-sm text-gray-400 italic",children:"Not provided"})]})]})})()]}):e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 border-b pb-2",children:"Profile Details"}),e.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-gray-500",children:"No faculty profile information available."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Please edit the faculty to add profile information."})]})]}),(()=>{var u,k;const U=(Y==null?void 0:Y.profile)||(r==null?void 0:r.facultyProfile);if(!U)return null;const ce=U==null?void 0:U.documents;let ae=null;if(ce)if(typeof ce=="string")try{ae=JSON.parse(ce)}catch(c){console.error("Error parsing documents:",c)}else typeof ce=="object"&&(ae=ce);return ae&&(ae.photo||ae.panCard||ae.aadharCard||ae.otherDocuments&&Array.isArray(ae.otherDocuments)&&ae.otherDocuments.length>0)?e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 border-b pb-2",children:"Documents"}),e.jsxs("div",{className:"space-y-4",children:[ae.photo&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Photo"}),e.jsxs("div",{className:"flex items-center space-x-4 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("div",{className:"flex-shrink-0",children:ae.photo.url&&e.jsx("img",{src:He(ae.photo.url)||"",alt:"Photo",className:"h-16 w-16 object-cover rounded border border-gray-300",crossOrigin:"anonymous"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:ae.photo.name||"Photo"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Image File"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:ae.photo.url&&e.jsxs(e.Fragment,{children:[e.jsx("a",{href:He(ae.photo.url)||"",target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1.5 text-sm text-blue-600 hover:text-blue-800 border border-blue-300 rounded hover:bg-blue-50",children:" View"}),e.jsx("a",{href:He(ae.photo.url)||"",download:!0,className:"px-3 py-1.5 text-sm text-green-600 hover:text-green-800 border border-green-300 rounded hover:bg-green-50",children:" Download"})]})})]})]}),ae.panCard&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"PAN Card"}),e.jsxs("div",{className:"flex items-center space-x-4 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex-shrink-0",children:[ae.panCard.url&&e.jsx("img",{src:He(ae.panCard.url)||"",alt:"PAN Card",className:"h-16 w-16 object-cover rounded border border-gray-300",crossOrigin:"anonymous",onError:c=>{var D;c.target.style.display="none",(D=c.target.nextElementSibling)==null||D.classList.remove("hidden")}}),e.jsx("div",{className:"h-16 w-16 bg-gray-200 rounded border border-gray-300 flex items-center justify-center hidden",children:e.jsx("span",{className:"text-2xl",children:""})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:ae.panCard.name||"PAN Card"}),e.jsx("p",{className:"text-xs text-gray-500",children:(u=ae.panCard.url)!=null&&u.endsWith(".pdf")?"PDF Document":"Image File"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:ae.panCard.url&&e.jsxs(e.Fragment,{children:[e.jsx("a",{href:He(ae.panCard.url)||"",target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1.5 text-sm text-blue-600 hover:text-blue-800 border border-blue-300 rounded hover:bg-blue-50",children:" View"}),e.jsx("a",{href:He(ae.panCard.url)||"",download:!0,className:"px-3 py-1.5 text-sm text-green-600 hover:text-green-800 border border-green-300 rounded hover:bg-green-50",children:" Download"})]})})]})]}),ae.aadharCard&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Aadhar Card"}),e.jsxs("div",{className:"flex items-center space-x-4 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex-shrink-0",children:[ae.aadharCard.url&&e.jsx("img",{src:He(ae.aadharCard.url)||"",alt:"Aadhar Card",className:"h-16 w-16 object-cover rounded border border-gray-300",crossOrigin:"anonymous",onError:c=>{var D;c.target.style.display="none",(D=c.target.nextElementSibling)==null||D.classList.remove("hidden")}}),e.jsx("div",{className:"h-16 w-16 bg-gray-200 rounded border border-gray-300 flex items-center justify-center hidden",children:e.jsx("span",{className:"text-2xl",children:""})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:ae.aadharCard.name||"Aadhar Card"}),e.jsx("p",{className:"text-xs text-gray-500",children:(k=ae.aadharCard.url)!=null&&k.endsWith(".pdf")?"PDF Document":"Image File"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:ae.aadharCard.url&&e.jsxs(e.Fragment,{children:[e.jsx("a",{href:He(ae.aadharCard.url)||"",target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1.5 text-sm text-blue-600 hover:text-blue-800 border border-blue-300 rounded hover:bg-blue-50",children:" View"}),e.jsx("a",{href:He(ae.aadharCard.url)||"",download:!0,className:"px-3 py-1.5 text-sm text-green-600 hover:text-green-800 border border-green-300 rounded hover:bg-green-50",children:" Download"})]})})]})]}),ae.otherDocuments&&Array.isArray(ae.otherDocuments)&&ae.otherDocuments.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Other Documents"}),e.jsx("div",{className:"space-y-2",children:ae.otherDocuments.map((c,D)=>{const se=typeof c=="string"?c:c.url,ge=typeof c=="string"?`Document ${D+1}`:c.name||`Document ${D+1}`,G=He(se)||"",Ce=(se==null?void 0:se.endsWith(".pdf"))||(se==null?void 0:se.includes("application/pdf")),Ze=se==null?void 0:se.match(/\.(jpg|jpeg|png|gif|webp)$/i);return e.jsxs("div",{className:"flex items-center space-x-4 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex-shrink-0",children:[Ze&&se?e.jsx("img",{src:G,alt:ge,className:"h-16 w-16 object-cover rounded border border-gray-300",crossOrigin:"anonymous",onError:Xe=>{var Be;Xe.target.style.display="none",(Be=Xe.target.nextElementSibling)==null||Be.classList.remove("hidden")}}):e.jsx("div",{className:"h-16 w-16 bg-gray-200 rounded border border-gray-300 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:Ce?"":""})}),e.jsx("div",{className:"h-16 w-16 bg-gray-200 rounded border border-gray-300 flex items-center justify-center hidden",children:e.jsx("span",{className:"text-2xl",children:""})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",title:ge,children:ge}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:Ce?"PDF Document":Ze?"Image File":"Document"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("a",{href:G,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1.5 text-sm text-blue-600 hover:text-blue-800 border border-blue-300 rounded hover:bg-blue-50",title:"View Document",children:" View"}),e.jsx("a",{href:G,download:!0,className:"px-3 py-1.5 text-sm text-green-600 hover:text-green-800 border border-green-300 rounded hover:bg-green-50",title:"Download Document",children:" Download"})]})]},D)})})]})]})]}):e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 border-b pb-2",children:"Documents"}),e.jsx("div",{className:"text-center py-8 bg-gray-50 rounded-lg border border-gray-200",children:e.jsx("p",{className:"text-gray-500 mb-2",children:"No documents uploaded for this faculty."})})]})})()]}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"Failed to load faculty details."})})}),e.jsx("div",{className:"sticky bottom-0 bg-gray-50 border-t px-6 py-4 flex justify-end",children:e.jsx("button",{onClick:()=>{q(!1),n(null)},className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300",children:"Close"})})]})})]})},na=()=>{const[t,s]=g.useState(!1),[a,r]=g.useState(null);return{uploadPhoto:async h=>{var C,q,K,re,T,b;if(!h)return r("No file selected"),null;if(!["image/jpeg","image/jpg","image/png","image/webp","image/gif"].includes(h.type))return r(`Please select a valid image file (JPG, PNG, WEBP, or GIF). Selected: ${h.type}`),null;const j=10*1024*1024;if(h.size>j)return r("Image size must be less than 10MB"),null;s(!0),r(null);try{console.log("Starting photo upload:",{name:h.name,type:h.type,size:h.size});const w=await wt.uploadFile(h);if(console.log("Upload response received:",w),!w)throw new Error("No response from server");if(w.status!=="success")throw new Error((w==null?void 0:w.message)||"Upload failed");if(!((C=w.data)!=null&&C.files)||w.data.files.length===0)throw new Error("No file returned from upload");const $=w.data.files[0];console.log("Uploaded file data:",$);const pe={name:$.originalName,url:$.url,size:$.size};return console.log("Photo upload successful:",pe),s(!1),pe}catch(w){console.error("Photo upload error:",w),console.error("Error details:",{message:w.message,response:(q=w.response)==null?void 0:q.data,status:(K=w.response)==null?void 0:K.status,statusText:(re=w.response)==null?void 0:re.statusText});const $=((b=(T=w.response)==null?void 0:T.data)==null?void 0:b.message)||w.message||"Failed to upload photo";return r($),s(!1),null}},uploading:t,error:a,getPhotoUrl:h=>h?He(h):null}},il=()=>{var fe,Fe,je,v,_,ue;const{id:t}=xs(),{user:s}=Nt(),a=Et(),r=vt(),[n,i]=g.useState(1),h=7,{uploadPhoto:m,uploading:j,error:C,getPhotoUrl:q}=na(),[K,re]=g.useState(null),[T,b]=g.useState(null),[w,$]=g.useState(null),[pe,Pe]=g.useState([]),[te,Y]=g.useState(!1),[o,de]=g.useState(!1),[N,S]=g.useState(!1),[x,Z]=g.useState([]),[J,Ie]=g.useState(""),[Ae,Me]=g.useState(!1),{data:W,isLoading:Ne,error:V}=_e({queryKey:["faculty",t],queryFn:async()=>{var A,L,z;try{if(!t)throw new Error("Faculty ID is required");const oe=await Re.get(`/users/${t}`);if(!(oe!=null&&oe.data))throw new Error("No data in user response");let le=null;const xe=oe.data;if((A=xe==null?void 0:xe.data)!=null&&A.user?le=xe.data.user:xe!=null&&xe.data&&!xe.data.user&&xe.data.id?le=xe.data:xe!=null&&xe.user?le=xe.user:xe!=null&&xe.id&&(le=xe),!le||!le.id)throw new Error("Invalid user response structure - user not found");const he=le.facultyProfile||null;return he||(console.warn("Faculty profile not found in user response. Profile might not exist yet."),console.log("User data:",le)),console.log("Faculty data fetched successfully:",{userId:le==null?void 0:le.id,userName:le==null?void 0:le.name,hasProfile:!!he,profileId:he==null?void 0:he.id,hasDocuments:!!(he!=null&&he.documents),documentsType:he!=null&&he.documents?typeof(he==null?void 0:he.documents):"null",hasExpertise:!!(he!=null&&he.expertise),expertiseType:he!=null&&he.expertise?typeof(he==null?void 0:he.expertise):"null",hasAvailability:!!(he!=null&&he.availability),availabilityType:he!=null&&he.availability?typeof(he==null?void 0:he.availability):"null"}),{user:le,profile:he}}catch(oe){throw console.error("Error fetching faculty data:",oe),console.error("Error details:",{message:oe==null?void 0:oe.message,response:(L=oe==null?void 0:oe.response)==null?void 0:L.data,status:(z=oe==null?void 0:oe.response)==null?void 0:z.status}),oe}},enabled:!!t,retry:1,staleTime:5*60*1e3,gcTime:10*60*1e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1}),Qe=st({mutationFn:A=>yt.updateUser(Number(t),A),onSuccess:()=>{r.invalidateQueries({queryKey:["faculty",t]}),r.invalidateQueries({queryKey:["faculty"]}),r.invalidateQueries({queryKey:["faculty-profile",t]})}}),ve=st({mutationFn:async A=>{const{isFinalStep:L,...z}=A;if(z.documents){const le=xe=>{if(xe==null)return null;if(typeof xe!="object")return xe;if(Array.isArray(xe))return xe.map(le).filter(B=>B!==void 0);const he={};for(const B in xe)if(Object.prototype.hasOwnProperty.call(xe,B)){const ye=xe[B];ye!==void 0&&(he[B]=le(ye))}return he};z.documents=le(z.documents)}return console.log("Sending faculty profile update:",{userId:Number(t),hasDocuments:!!z.documents,documentsKeys:z.documents?Object.keys(z.documents):[],hasExpertise:!!z.expertise,hasAvailability:!!z.availability,hasDateOfBirth:!!z.dateOfBirth}),{result:await Kt.updateFacultyProfile(Number(t),z),isFinalStep:L}},onSuccess:async({result:A,isFinalStep:L})=>{var oe,le,xe;console.log("Faculty profile update success:",A);const z=((oe=A==null?void 0:A.data)==null?void 0:oe.user)||((xe=(le=A==null?void 0:A.data)==null?void 0:le.facultyProfile)==null?void 0:xe.user);z&&r.setQueryData(["faculty",t],he=>{var B,ye;return he?{user:z,profile:z.facultyProfile||((ye=A==null?void 0:A.data)==null?void 0:ye.facultyProfile)||he.profile}:{user:z,profile:z.facultyProfile||((B=A==null?void 0:A.data)==null?void 0:B.facultyProfile)||null}}),r.invalidateQueries({queryKey:["faculty",t]}),r.invalidateQueries({queryKey:["faculty"]}),r.invalidateQueries({queryKey:["faculty-profile",t]}),r.invalidateQueries({queryKey:["users"]}),L?(await r.refetchQueries({queryKey:["faculty",t]}),alert("Faculty updated successfully!"),a("/faculty")):console.log("Step data saved successfully")},onError:A=>{var z,oe,le;console.error("Update profile error:",A),console.error("Error response:",(z=A==null?void 0:A.response)==null?void 0:z.data),console.error("Error message:",A==null?void 0:A.message);const L=((le=(oe=A==null?void 0:A.response)==null?void 0:oe.data)==null?void 0:le.message)||(A==null?void 0:A.message)||"Failed to update faculty profile";alert(L)}}),p=g.useCallback(()=>{var z,oe,le;if(!((z=W==null?void 0:W.profile)!=null&&z.documents))return console.log("No documents in profile:",{hasProfile:!!(W!=null&&W.profile),hasDocuments:!!((oe=W==null?void 0:W.profile)!=null&&oe.documents),documentsType:(le=W==null?void 0:W.profile)!=null&&le.documents?typeof W.profile.documents:"null"}),null;let A=null;const L=W.profile.documents;if(console.log("Parsing documents:",{type:typeof L,isString:typeof L=="string",isObject:typeof L=="object",value:typeof L=="string"?L.substring(0,100):L}),typeof L=="string")try{A=JSON.parse(L),console.log("Successfully parsed documents string:",{hasPersonalInfo:!!(A!=null&&A.personalInfo),hasEmploymentInfo:!!(A!=null&&A.employmentInfo),hasBankInfo:!!(A!=null&&A.bankInfo),hasEmergencyInfo:!!(A!=null&&A.emergencyInfo)})}catch(xe){return console.error("Error parsing documents string:",xe),console.error("Documents string value:",L),null}else typeof L=="object"&&L!==null&&(A=L,console.log("Documents is already an object:",{hasPersonalInfo:!!(A!=null&&A.personalInfo),hasEmploymentInfo:!!(A!=null&&A.employmentInfo),hasBankInfo:!!(A!=null&&A.bankInfo),hasEmergencyInfo:!!(A!=null&&A.emergencyInfo)}));return A},[W]);At.useEffect(()=>{if(W!=null&&W.profile){const A=p();if(A){if(A.photo&&A.photo.url&&re(A.photo),A.panCard&&A.panCard.url&&b(A.panCard),A.aadharCard&&A.aadharCard.url&&$(A.aadharCard),A.otherDocuments&&Array.isArray(A.otherDocuments)){const L=A.otherDocuments.filter(z=>z&&z.url);L.length>0&&Pe(L)}if(A.softwareProficiency)if(typeof A.softwareProficiency=="string"){const L=A.softwareProficiency.split(",").map(z=>z.trim()).filter(Boolean);Z(L)}else Array.isArray(A.softwareProficiency)&&Z(A.softwareProficiency)}}},[W]);const M=g.useMemo(()=>p(),[p]),P=g.useMemo(()=>{var L,z;const A=(M==null?void 0:M.personalInfo)||{};return!A.dateOfBirth&&((L=W==null?void 0:W.profile)!=null&&L.dateOfBirth)&&(A.dateOfBirth=W.profile.dateOfBirth),console.log("Personal Info extracted:",{hasParsedDocuments:!!M,hasPersonalInfo:!!(M!=null&&M.personalInfo),personalInfoKeys:Object.keys(A),gender:A.gender,address:A.address,city:A.city,dateOfBirth:A.dateOfBirth,dateOfBirthType:typeof A.dateOfBirth,profileDateOfBirth:(z=W==null?void 0:W.profile)==null?void 0:z.dateOfBirth}),A},[M,(fe=W==null?void 0:W.profile)==null?void 0:fe.dateOfBirth]),H=g.useMemo(()=>(M==null?void 0:M.employmentInfo)||{},[M]),U=g.useMemo(()=>(M==null?void 0:M.bankInfo)||{},[M]),ce=g.useMemo(()=>(M==null?void 0:M.emergencyInfo)||{},[M]),ae=g.useMemo(()=>{const A=W==null?void 0:W.profile;if(!(A!=null&&A.expertise))return"";const L=A.expertise;if(typeof L=="string")try{const z=JSON.parse(L);return typeof z=="object"&&z!==null?z.description||z.expertise||z.text||L:z}catch{return L}else if(typeof L=="object")return L.description||L.expertise||L.text||JSON.stringify(L);return""},[(Fe=W==null?void 0:W.profile)==null?void 0:Fe.expertise]),u=g.useMemo(()=>{const A=W==null?void 0:W.profile;if(!(A!=null&&A.availability))return"";const L=A.availability;if(typeof L=="string")try{const z=JSON.parse(L);if(typeof z=="object"&&z!==null){const oe=z.schedule||z.availability||z.text;return typeof oe=="string"?oe:oe?JSON.stringify(oe):L}return String(z)}catch{return L}else if(typeof L=="object"){const z=L.schedule||L.availability||L.text;return typeof z=="string"?z:JSON.stringify(z||L)}return""},[(je=W==null?void 0:W.profile)==null?void 0:je.availability]);At.useEffect(()=>{if(W){const{user:A,profile:L}=W||{user:null,profile:null};console.log("Faculty data loaded in component:",{userId:A==null?void 0:A.id,userName:A==null?void 0:A.name,hasProfile:!!L,profileId:L==null?void 0:L.id,hasDocuments:!!(L!=null&&L.documents),documentsType:L!=null&&L.documents?typeof(L==null?void 0:L.documents):"null",documentsKeys:M?Object.keys(M):[],hasPersonalInfo:Object.keys(P).length>0,personalInfoKeys:Object.keys(P),hasEmploymentInfo:Object.keys(H).length>0,hasBankInfo:Object.keys(U).length>0,hasEmergencyInfo:Object.keys(ce).length>0,expertise:ae,availability:u})}},[W,M,P,H,U,ce,ae,u]);const k=async A=>{var oe;const L=(oe=A.target.files)==null?void 0:oe[0];if(!L){console.log("No file selected"),A.target.value="";return}console.log("Photo upload initiated:",{fileName:L.name,fileType:L.type,fileSize:L.size});const z=await m(L);if(!z){const le=C||"Failed to upload photo. Please try again.";console.error("Photo upload failed:",le),alert(le),A.target.value="";return}if(console.log("Photo uploaded successfully, updating state:",z),re(z),t)try{console.log("Updating avatarUrl in database:",z.url),await yt.updateUser(Number(t),{avatarUrl:z.url}),r.invalidateQueries({queryKey:["faculty",t]}),r.invalidateQueries({queryKey:["faculty"]}),console.log("AvatarUrl updated successfully")}catch(le){console.error("Error updating avatarUrl:",le),alert("Photo uploaded but failed to update profile. Please refresh the page.")}alert("Photo uploaded successfully!"),A.target.value=""},c=async A=>{var oe,le,xe;const L=(oe=A.target.files)==null?void 0:oe[0];if(!L)return;if(!["image/jpeg","image/jpg","image/png","application/pdf"].includes(L.type)){alert("Please select a valid file (JPG, PNG, or PDF)"),A.target.value="";return}Y(!0);try{const he=await wt.uploadFile(L);if(he.data&&he.data.files&&he.data.files.length>0){const B=he.data.files[0],ye=He(B.url)||B.url;b({name:B.originalName,url:ye,size:B.size}),alert("PAN Card uploaded successfully!")}}catch(he){console.error("PAN Card upload error:",he),alert(((xe=(le=he.response)==null?void 0:le.data)==null?void 0:xe.message)||he.message||"Failed to upload PAN Card")}finally{Y(!1),A.target.value=""}},D=async A=>{var oe,le,xe;const L=(oe=A.target.files)==null?void 0:oe[0];if(!L)return;if(!["image/jpeg","image/jpg","image/png","application/pdf"].includes(L.type)){alert("Please select a valid file (JPG, PNG, or PDF)"),A.target.value="";return}de(!0);try{const he=await wt.uploadFile(L);if(he.data&&he.data.files&&he.data.files.length>0){const B=he.data.files[0],ye=He(B.url)||B.url;$({name:B.originalName,url:ye,size:B.size}),alert("Aadhar Card uploaded successfully!")}}catch(he){console.error("Aadhar Card upload error:",he),alert(((xe=(le=he.response)==null?void 0:le.data)==null?void 0:xe.message)||he.message||"Failed to upload Aadhar Card")}finally{de(!1),A.target.value=""}},se=async A=>{var le,xe;const L=A.target.files;if(!L||L.length===0)return;const z=["image/jpeg","image/jpg","image/png","application/pdf"],oe=[];for(let he=0;he<L.length;he++)z.includes(L[he].type)&&oe.push(L[he]);if(oe.length===0){alert("Please select valid files (JPG, PNG, or PDF)"),A.target.value="";return}S(!0);try{const he=oe.map(De=>wt.uploadFile(De)),ye=(await Promise.all(he)).filter(De=>De.data&&De.data.files&&De.data.files.length>0).map(De=>{const Se=He(De.data.files[0].url)||De.data.files[0].url;return{name:De.data.files[0].originalName,url:Se,size:De.data.files[0].size}});Pe(De=>[...De,...ye]),alert(`${ye.length} document(s) uploaded successfully!`)}catch(he){console.error("Other documents upload error:",he),alert(((xe=(le=he.response)==null?void 0:le.data)==null?void 0:xe.message)||he.message||"Failed to upload documents")}finally{S(!1),A.target.value=""}},ge=A=>{Pe(L=>L.filter((z,oe)=>oe!==A))};if(!s)return e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6",children:[e.jsx("p",{className:"text-red-600",children:"Please log in to continue."}),e.jsx("button",{onClick:()=>a("/login"),className:"mt-4 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Go to Login"})]})})});if((s==null?void 0:s.role)!=="admin"&&(s==null?void 0:s.role)!=="superadmin")return e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6",children:[e.jsx("p",{className:"text-red-600",children:"You don't have permission to edit faculty."}),e.jsx("button",{onClick:()=>a("/faculty"),className:"mt-4 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Back to Faculty"})]})})});if(Ne)return e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})})})});if(V)return e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6",children:[e.jsx("p",{className:"text-red-600 font-semibold mb-2",children:"Error loading faculty data"}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:((_=(v=V==null?void 0:V.response)==null?void 0:v.data)==null?void 0:_.message)||(V==null?void 0:V.message)||"An error occurred while loading faculty data"}),e.jsx("button",{onClick:()=>a("/faculty"),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Back to Faculty"})]})})});if(!W)return e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6",children:[e.jsx("p",{className:"text-red-600",children:"Faculty not found."}),e.jsx("button",{onClick:()=>a("/faculty"),className:"mt-4 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Back to Faculty"})]})})});if(!t)return e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6",children:[e.jsx("p",{className:"text-red-600 font-semibold mb-2",children:"Invalid Faculty ID"}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"No faculty ID provided in the URL."}),e.jsx("button",{onClick:()=>a("/faculty"),className:"mt-4 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Back to Faculty"})]})})});const{user:G,profile:Ce}=W||{user:null,profile:null};if(!G||!G.id)return e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6",children:[e.jsx("p",{className:"text-red-600 font-semibold mb-2",children:"Faculty user data not available."}),e.jsx("button",{onClick:()=>a("/faculty"),className:"mt-4 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Back to Faculty"})]})})});const Ze=async A=>{var he,B;A.preventDefault();const L=new FormData(A.currentTarget),z=L.get("name"),oe=L.get("email"),le=L.get("phone");if(!z||!z.trim()){alert("Name is required");return}if(!oe||!oe.trim()){alert("Email is required");return}else if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(oe.trim())){alert("Please enter a valid email address");return}if(!le||!le.trim()){alert("Phone number is required");return}else if(le.replace(/\D/g,"").length!==10){alert("Please enter a valid 10-digit phone number");return}const xe={name:z,email:oe,phone:le,isActive:L.get("isActive")==="true"};try{const ye=await Re.get(`/users?email=${encodeURIComponent(oe)}`);if(ye.data&&ye.data.length>0&&ye.data[0].id!==Number(t)){alert("A user with this email already exists. Please use a different email address.");return}const De=await Re.get(`/users?phone=${encodeURIComponent(le)}`);if(De.data&&De.data.length>0&&De.data[0].id!==Number(t)){alert("A user with this phone number already exists. Please use a different phone number.");return}await Qe.mutateAsync(xe),i(2)}catch(ye){console.error("Error updating user:",ye);const De=((B=(he=ye.response)==null?void 0:he.data)==null?void 0:B.message)||"Failed to update user information";alert(De)}},Xe=async A=>{var ze,Ve,nt,dt;A.preventDefault();const L=new FormData(A.currentTarget),z=L.get("gender");let oe=L.get("dateOfBirth");const le=L.get("nationality"),xe=L.get("maritalStatus"),he=L.get("address"),B=L.get("city"),ye=L.get("state"),De=L.get("postalCode");if(!oe||!oe.trim()){const tt=((ze=M==null?void 0:M.personalInfo)==null?void 0:ze.dateOfBirth)||((Ve=W==null?void 0:W.profile)==null?void 0:Ve.dateOfBirth);if(tt)try{oe=lt(tt),oe&&oe!=="-"?console.log("Using existing dateOfBirth from data:",oe):oe=""}catch(ne){console.error("Error formatting existing dateOfBirth:",ne),oe=""}}if(!z||!z.trim()){alert("Gender is required");return}if(!oe||!oe.trim()||oe==="-"){alert("Date of Birth is required. Please enter your date of birth in DD/MM/YYYY format.");return}if(!rr(oe)){alert("Please enter a valid date in DD/MM/YYYY format (e.g., 01/01/1990)");return}const Se=ar(oe);if(!Se){alert("Invalid date format. Please use DD/MM/YYYY format");return}const at=new Date(Se);if(isNaN(at.getTime())){alert("Invalid date. Please check the date you entered");return}if(at>new Date){alert("Date of birth cannot be in the future");return}const it=new Date;let ot=it.getFullYear()-at.getFullYear();const I=it.getMonth()-at.getMonth(),E=it.getDate()-at.getDate();if((I<0||I===0&&E<0)&&ot--,ot<18){alert("Faculty must be at least 18 years old");return}if(!le||!le.trim()){alert("Nationality is required");return}if(!xe||!xe.trim()){alert("Marital Status is required");return}if(!he||!he.trim()){alert("Address is required");return}if(!B||!B.trim()){alert("City is required");return}if(!ye||!ye.trim()){alert("State is required");return}if(!De||!De.trim()){alert("Postal Code is required");return}const f={};f.gender=z,f.dateOfBirth=Se,f.nationality=le,f.maritalStatus=xe,f.address=he,f.city=B,f.state=ye,f.postalCode=De;const Ee=(W==null?void 0:W.profile)||Ce,R=(Ee==null?void 0:Ee.documents)||{};let me={};try{me=typeof R=="string"?JSON.parse(R):R||{},(typeof me!="object"||Array.isArray(me))&&(me={})}catch(tt){console.error("Error parsing existing documents:",tt),me={}}const Ue={documents:{...me,personalInfo:Object.keys(f).length>0?f:me.personalInfo||{}}};f.dateOfBirth&&(Ue.dateOfBirth=f.dateOfBirth);try{await ve.mutateAsync(Ue),await new Promise(tt=>setTimeout(tt,500)),i(3)}catch(tt){console.error("Error updating profile:",tt);const ne=((dt=(nt=tt.response)==null?void 0:nt.data)==null?void 0:dt.message)||"Failed to update profile";alert(ne)}},Be=async A=>{var f,Ee;A.preventDefault();const L=new FormData(A.currentTarget),z=L.get("department"),oe=L.get("designation"),le=L.get("dateOfJoining"),xe=L.get("employmentType"),he=L.get("workLocation"),B=L.get("expertise"),ye=L.get("availability");if(!z||!z.trim()){alert("Department is required");return}if(!oe||!oe.trim()){alert("Designation is required");return}if(!le||!le.trim()){alert("Date of Joining is required");return}if(!xe||!xe.trim()){alert("Employment Type is required");return}if(!he||!he.trim()){alert("Work Location is required");return}if(!B||!B.trim()){alert("Expertise is required");return}if(!ye||!ye.trim()){alert("Availability is required");return}const De={};De.department=z,De.designation=oe,De.dateOfJoining=le,De.employmentType=xe;const Se=L.get("reportingManager");Se&&(De.reportingManager=Se),De.workLocation=he;const at=(W==null?void 0:W.profile)||Ce,it=(at==null?void 0:at.documents)||{};let ot={};try{ot=typeof it=="string"?JSON.parse(it):it||{},(typeof ot!="object"||Array.isArray(ot))&&(ot={})}catch(R){console.error("Error parsing existing documents:",R),ot={}}const I={...ot,employmentInfo:Object.keys(De).length>0?De:ot.employmentInfo||{}},E={expertise:B,availability:ye,documents:I};try{await ve.mutateAsync(E),await new Promise(R=>setTimeout(R,500)),i(4)}catch(R){console.error("Error updating profile:",R);const me=((Ee=(f=R.response)==null?void 0:f.data)==null?void 0:Ee.message)||"Failed to update profile";alert(me)}},Q=async A=>{var ye,De;A.preventDefault();const L=[...x];Ae&&J.trim()&&L.push(J.trim());const z=L.join(", "),oe=(W==null?void 0:W.profile)||Ce,le=(oe==null?void 0:oe.documents)||{};let xe={};try{xe=typeof le=="string"?JSON.parse(le):le||{}}catch(Se){console.error("Error parsing existing documents:",Se),xe={}}const B={documents:{...xe,softwareProficiency:z}};try{await ve.mutateAsync(B),await new Promise(Se=>setTimeout(Se,500)),i(5)}catch(Se){console.error("Error updating software:",Se);const at=((De=(ye=Se.response)==null?void 0:ye.data)==null?void 0:De.message)||"Failed to update software";alert(at)}},l=async A=>{var ot,I;A.preventDefault();const L=new FormData(A.currentTarget),z=L.get("bankName"),oe=L.get("accountNumber"),le=L.get("ifscCode"),xe=L.get("branch"),he=L.get("panNumber");if(!z||!z.trim()){alert("Bank Name is required");return}if(!oe||!oe.trim()){alert("Account Number is required");return}if(!le||!le.trim()){alert("IFSC Code is required");return}else{const E=le.toUpperCase();if(!/^[A-Z]{4}0[A-Z0-9]{6}$/.test(E)){alert("Invalid IFSC Code format. IFSC should be 11 characters (e.g., ABCD0123456)");return}}if(!xe||!xe.trim()){alert("Branch is required");return}if(!he||!he.trim()){alert("PAN Number is required");return}else{const E=he.toUpperCase();if(!/^[A-Z]{5}[0-9]{4}[A-Z]{1}$/.test(E)){alert("Invalid PAN Number format. PAN should be 10 characters (e.g., ABCDE1234F)");return}}const B={};B.bankName=z,B.accountNumber=oe,B.ifscCode=le.toUpperCase(),B.branch=xe,B.panNumber=he.toUpperCase();const ye=(W==null?void 0:W.profile)||Ce,De=(ye==null?void 0:ye.documents)||{};let Se={};try{Se=typeof De=="string"?JSON.parse(De):De||{},(typeof Se!="object"||Array.isArray(Se))&&(Se={})}catch(E){console.error("Error parsing existing documents:",E),Se={}}const it={documents:{...Se,bankInfo:Object.keys(B).length>0?B:Se.bankInfo||{}}};try{await ve.mutateAsync(it),await new Promise(E=>setTimeout(E,500)),i(6)}catch(E){console.error("Error updating bank details:",E);const f=((I=(ot=E.response)==null?void 0:ot.data)==null?void 0:I.message)||"Failed to update bank details";alert(f)}},O=async A=>{var it,ot;A.preventDefault();const L=new FormData(A.currentTarget),z=L.get("emergencyContactName"),oe=L.get("emergencyRelationship"),le=L.get("emergencyPhoneNumber"),xe=L.get("emergencyAlternatePhone");if(!z||!z.trim()){alert("Emergency Contact Name is required");return}if(!oe||!oe.trim()){alert("Emergency Relationship is required");return}if(!le||!le.trim()){alert("Emergency Phone Number is required");return}else if(le.replace(/\D/g,"").length!==10){alert("Please enter a valid 10-digit emergency phone number");return}const he={};he.emergencyContactName=z,he.emergencyRelationship=oe,he.emergencyPhoneNumber=le,xe&&(he.emergencyAlternatePhone=xe);const B=(W==null?void 0:W.profile)||Ce,ye=(B==null?void 0:B.documents)||{};let De={};try{De=typeof ye=="string"?JSON.parse(ye):ye||{},(typeof De!="object"||Array.isArray(De))&&(De={})}catch(I){console.error("Error parsing existing documents:",I),De={}}const at={documents:{...De,emergencyInfo:Object.keys(he).length>0?he:De.emergencyInfo||{}}};try{await ve.mutateAsync(at),await new Promise(I=>setTimeout(I,500)),i(7)}catch(I){console.error("Error updating emergency contact:",I);const E=((ot=(it=I.response)==null?void 0:it.data)==null?void 0:ot.message)||"Failed to update emergency contact";alert(E)}},X=async A=>{var B,ye;A.preventDefault();const L={};K&&(L.photo=K),T&&(L.panCard=T),w&&(L.aadharCard=w),pe.length>0&&(L.otherDocuments=pe);const z=(W==null?void 0:W.profile)||Ce,oe=(z==null?void 0:z.documents)||{};let le={};try{le=typeof oe=="string"?JSON.parse(oe):oe||{}}catch(De){console.error("Error parsing existing documents:",De),le={}}const he={documents:{...le,...L},isFinalStep:!0};try{await ve.mutateAsync(he)}catch(De){console.error("Error updating documents:",De),alert(((ye=(B=De.response)==null?void 0:B.data)==null?void 0:ye.message)||"Failed to update documents")}};return e.jsx(et,{children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-orange-500 px-8 py-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Edit Faculty"}),e.jsx("p",{className:"mt-2 text-orange-100",children:"Update faculty information"})]}),e.jsx("button",{onClick:()=>a("/faculty"),className:"px-4 py-2 bg-white text-orange-600 rounded-lg font-semibold hover:bg-orange-50 transition-colors",children:" Back"})]})}),e.jsx("div",{className:"px-8 py-4 bg-gray-50 border-b",children:e.jsx("div",{className:"flex items-center justify-between",children:[1,2,3,4,5,6,7].map(A=>e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsxs("div",{className:"flex flex-col items-center flex-1",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center font-semibold ${n>=A?"bg-orange-600 text-white":"bg-gray-300 text-gray-600"}`,children:A}),e.jsxs("span",{className:"mt-2 text-xs text-gray-600 text-center",children:[A===1&&"Account",A===2&&"Personal",A===3&&"Employment",A===4&&"Software",A===5&&"Bank",A===6&&"Emergency",A===7&&"Documents"]})]}),A<h&&e.jsx("div",{className:`flex-1 h-1 mx-2 ${n>A?"bg-orange-600":"bg-gray-300"}`})]},A))})}),e.jsxs("div",{className:"p-8 max-h-[calc(100vh-12rem)] overflow-y-auto",children:[Ne&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"Loading faculty data..."})}),V&&!Ne&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-red-600 font-semibold mb-2",children:"Error loading faculty data"}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:(V==null?void 0:V.message)||"Failed to load faculty data"}),e.jsx("button",{onClick:()=>a("/faculty"),className:"mt-4 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Back to Faculty"})]}),!Ne&&!V&&(!G||!G.id)&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-red-600 font-semibold mb-2",children:"Cannot render faculty edit form"}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Required faculty data is missing."}),e.jsx("button",{onClick:()=>a("/faculty"),className:"mt-4 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Back to Faculty"})]}),!Ne&&!V&&G&&G.id&&e.jsxs(e.Fragment,{children:[n===1&&e.jsxs("form",{onSubmit:Ze,className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Account Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Name *"}),e.jsx("input",{type:"text",name:"name",defaultValue:(G==null?void 0:G.name)||"",required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),e.jsx("input",{type:"email",name:"email",defaultValue:(G==null?void 0:G.email)||"",required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone *"}),e.jsx("input",{type:"tel",name:"phone",defaultValue:(G==null?void 0:G.phone)||"",required:!0,pattern:"[0-9]{10}",title:"Phone number should be 10 digits",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status *"}),e.jsxs("select",{name:"isActive",defaultValue:(G==null?void 0:G.isActive)!==void 0?G.isActive?"true":"false":"true",required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]})]})]}),e.jsx("div",{className:"flex gap-4 pt-6",children:e.jsx("button",{type:"submit",disabled:Qe.isPending,className:"flex-1 px-6 py-3 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:Qe.isPending?"Saving...":"Save & Continue"})})]},`step1-${G.id}-${G.name||""}-${G.email||""}`),n===2&&e.jsxs("form",{onSubmit:Xe,className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Personal Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Gender *"}),e.jsxs("select",{name:"gender",defaultValue:(P==null?void 0:P.gender)||"",required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date of Birth *"}),e.jsx("input",{type:"text",name:"dateOfBirth",placeholder:"DD/MM/YYYY",defaultValue:(()=>{var L;const A=(P==null?void 0:P.dateOfBirth)||((L=W==null?void 0:W.profile)==null?void 0:L.dateOfBirth);if(!A)return"";try{const z=lt(A);return z==="-"?"":z}catch(z){return console.error("Error formatting date of birth:",z,"Date value:",A),""}})(),required:!0,pattern:"\\d{2}/\\d{2}/\\d{4}",title:"Please enter date in DD/MM/YYYY format (e.g., 01/01/1990)",maxLength:10,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",onInput:A=>{const L=A.currentTarget;let z=L.value.replace(/\D/g,"");z.length>=2&&(z=z.substring(0,2)+"/"+z.substring(2)),z.length>=5&&(z=z.substring(0,5)+"/"+z.substring(5,9)),L.value=z}},`dateOfBirth-${(P==null?void 0:P.dateOfBirth)||((ue=W==null?void 0:W.profile)==null?void 0:ue.dateOfBirth)||"empty"}-${(G==null?void 0:G.id)||""}`),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Format: DD/MM/YYYY (e.g., 01/01/1990)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nationality *"}),e.jsx("input",{type:"text",name:"nationality",defaultValue:(P==null?void 0:P.nationality)||"",required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Marital Status *"}),e.jsxs("select",{name:"maritalStatus",defaultValue:(P==null?void 0:P.maritalStatus)||"",required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"single",children:"Single"}),e.jsx("option",{value:"married",children:"Married"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address *"}),e.jsx("textarea",{name:"address",rows:3,defaultValue:(P==null?void 0:P.address)||"",required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City *"}),e.jsx("input",{type:"text",name:"city",defaultValue:(P==null?void 0:P.city)||"",required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"State *"}),e.jsx("input",{type:"text",name:"state",defaultValue:(P==null?void 0:P.state)||"",required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Postal Code *"}),e.jsx("input",{type:"text",name:"postalCode",defaultValue:(P==null?void 0:P.postalCode)||"",required:!0,pattern:"[0-9]{5,6}",title:"Postal code should be 5-6 digits",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"})]})]}),e.jsxs("div",{className:"flex gap-4 pt-6",children:[e.jsx("button",{type:"button",onClick:()=>i(1),className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Previous"}),e.jsx("button",{type:"submit",disabled:ve.isPending,className:"flex-1 px-6 py-3 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:ve.isPending?"Saving...":"Save & Continue"})]})]},`step2-${G==null?void 0:G.id}-${JSON.stringify(P)}-${M?"hasDocs":"noDocs"}`),n===3&&e.jsxs("form",{onSubmit:Be,className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Employment Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department *"}),e.jsx("input",{type:"text",name:"department",defaultValue:(H==null?void 0:H.department)||"",required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Designation *"}),e.jsx("input",{type:"text",name:"designation",defaultValue:(H==null?void 0:H.designation)||"",required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date of Joining *"}),e.jsx("input",{type:"date",name:"dateOfJoining",defaultValue:H!=null&&H.dateOfJoining?H.dateOfJoining.split("T")[0]:"",required:!0,max:new Date().toISOString().split("T")[0],className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Employment Type *"}),e.jsxs("select",{name:"employmentType",defaultValue:(H==null?void 0:H.employmentType)||"",required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"full-time",children:"Full-time"}),e.jsx("option",{value:"part-time",children:"Part-time"}),e.jsx("option",{value:"contract",children:"Contract"}),e.jsx("option",{value:"intern",children:"Intern"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reporting Manager"}),e.jsx("input",{type:"text",name:"reportingManager",defaultValue:(H==null?void 0:H.reportingManager)||"",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Work Location *"}),e.jsx("input",{type:"text",name:"workLocation",defaultValue:(H==null?void 0:H.workLocation)||"",required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Expertise / Specialization *"}),e.jsx("textarea",{name:"expertise",rows:3,required:!0,defaultValue:ae,placeholder:"Describe your areas of expertise and specialization",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"},`expertise-${ae||"empty"}`)]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Availability *"}),e.jsx("textarea",{name:"availability",rows:2,required:!0,defaultValue:u,placeholder:"e.g., Monday-Friday 9 AM - 5 PM",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"},`availability-${u||"empty"}`)]})]}),e.jsxs("div",{className:"flex gap-4 pt-6",children:[e.jsx("button",{type:"button",onClick:()=>i(2),className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Previous"}),e.jsx("button",{type:"submit",disabled:ve.isPending,className:"flex-1 px-6 py-3 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:ve.isPending?"Saving...":"Save & Continue"})]})]},`step3-${G==null?void 0:G.id}-${(H==null?void 0:H.department)||""}-${ae||""}`),n===4&&e.jsxs("form",{onSubmit:Q,className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Software Proficiency"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Software Proficiency ",e.jsx("span",{className:"text-gray-500",children:"(Select all applicable)"})]}),e.jsx("div",{className:"border border-gray-300 rounded-lg p-4 max-h-64 overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:["Photoshop","Illustrator","InDesign","After Effects","Premiere Pro","Figma","Sketch","Blender","Maya","3ds Max","Cinema 4D","Lightroom","CorelDRAW","AutoCAD","SolidWorks","Revit","SketchUp","Unity","Unreal Engine","DaVinci Resolve","Final Cut Pro","Procreate","Affinity Designer","Affinity Photo","Canva Pro","Other"].map(A=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:x.includes(A),onChange:L=>{A==="Other"&&(Me(L.target.checked),L.target.checked||Ie("")),L.target.checked?Z([...x,A]):Z(x.filter(z=>z!==A))},className:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:A})]},A))})}),Ae&&e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Specify Other Software"}),e.jsx("input",{type:"text",value:J,onChange:A=>Ie(A.target.value),placeholder:"Enter software names (comma separated)",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"})]})]}),e.jsxs("div",{className:"flex gap-4 pt-6",children:[e.jsx("button",{type:"button",onClick:()=>i(3),className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Previous"}),e.jsx("button",{type:"submit",disabled:ve.isPending,className:"flex-1 px-6 py-3 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:ve.isPending?"Saving...":"Save & Continue"})]})]},`step4-${G==null?void 0:G.id}-${x.join(",")||""}`),n===5&&e.jsxs("form",{onSubmit:l,className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Bank Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bank Name *"}),e.jsx("input",{type:"text",name:"bankName",defaultValue:(U==null?void 0:U.bankName)||"",required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Account Number *"}),e.jsx("input",{type:"text",name:"accountNumber",defaultValue:(U==null?void 0:U.accountNumber)||"",required:!0,pattern:"[0-9]{9,18}",title:"Account number should be 9-18 digits",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"IFSC Code *"}),e.jsx("input",{type:"text",name:"ifscCode",defaultValue:(U==null?void 0:U.ifscCode)||"",required:!0,pattern:"[A-Z]{4}0[A-Z0-9]{6}",title:"IFSC code should be 11 characters (e.g., ABCD0123456)",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 uppercase",style:{textTransform:"uppercase"}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Branch *"}),e.jsx("input",{type:"text",name:"branch",defaultValue:(U==null?void 0:U.branch)||"",required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"PAN Number *"}),e.jsx("input",{type:"text",name:"panNumber",maxLength:10,defaultValue:(U==null?void 0:U.panNumber)||"",required:!0,pattern:"[A-Za-z]{5}[0-9]{4}[A-Za-z]{1}",title:"PAN should be 10 characters (e.g., ABCDE1234F)",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 uppercase",style:{textTransform:"uppercase"},onChange:A=>{A.target.value=A.target.value.toUpperCase()}})]})]}),e.jsxs("div",{className:"flex gap-4 pt-6",children:[e.jsx("button",{type:"button",onClick:()=>i(4),className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Previous"}),e.jsx("button",{type:"submit",disabled:ve.isPending,className:"flex-1 px-6 py-3 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:ve.isPending?"Saving...":"Save & Continue"})]})]},`step5-${G==null?void 0:G.id}-${(U==null?void 0:U.accountNumber)||""}-${(U==null?void 0:U.panNumber)||""}`),n===6&&e.jsxs("form",{onSubmit:O,className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Emergency Contact Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Name *"}),e.jsx("input",{type:"text",name:"emergencyContactName",defaultValue:(ce==null?void 0:ce.emergencyContactName)||"",required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Relationship *"}),e.jsx("input",{type:"text",name:"emergencyRelationship",placeholder:"e.g., Father, Mother, Spouse, Guardian",defaultValue:(ce==null?void 0:ce.emergencyRelationship)||"",required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number *"}),e.jsx("input",{type:"tel",name:"emergencyPhoneNumber",defaultValue:(ce==null?void 0:ce.emergencyPhoneNumber)||"",required:!0,pattern:"[0-9]{10}",minLength:10,maxLength:10,placeholder:"10 digit phone number",title:"Phone number should be 10 digits",onChange:A=>{const L=A.target.value.replace(/\D/g,"").slice(0,10);A.target.value=L},className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Enter 10 digit phone number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Alternate Phone Number"}),e.jsx("input",{type:"tel",name:"emergencyAlternatePhone",defaultValue:(ce==null?void 0:ce.emergencyAlternatePhone)||"",pattern:"[0-9]{10}",minLength:10,maxLength:10,placeholder:"10 digit phone number (optional)",title:"Phone number should be 10 digits",onChange:A=>{const L=A.target.value.replace(/\D/g,"").slice(0,10);A.target.value=L},className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Enter 10 digit phone number (optional)"})]})]}),e.jsxs("div",{className:"flex gap-4 pt-6",children:[e.jsx("button",{type:"button",onClick:()=>i(5),className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Previous"}),e.jsx("button",{type:"submit",disabled:ve.isPending,className:"flex-1 px-6 py-3 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:ve.isPending?"Saving...":"Save & Continue"})]})]},`step6-${G==null?void 0:G.id}-${ae||""}-${u||""}`),n===7&&e.jsxs("form",{onSubmit:X,className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Documents"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Photo"}),e.jsx("input",{type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp,image/gif",onChange:k,disabled:j,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 disabled:opacity-50"}),j&&e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Uploading..."}),K&&K.url&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg border border-gray-200 flex items-center space-x-4",children:[e.jsx("img",{src:(q(K.url)||K.url)+(K.url.includes("?")?"&":"?")+`t=${Date.now()}`,alt:"Photo",className:"h-16 w-16 object-cover rounded border border-gray-300",crossOrigin:"anonymous",onError:A=>{console.error("Photo failed to load:",K.url),A.target.style.display="none"}},`photo-${K.url}-${Date.now()}`),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:K.name||"Photo"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Image File"})]}),e.jsx("button",{type:"button",onClick:()=>re(null),className:"px-3 py-1.5 text-sm text-red-600 hover:text-red-800 border border-red-300 rounded hover:bg-red-50",children:"Remove"})]}),C&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:C})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"PAN Card"}),e.jsx("input",{type:"file",accept:"image/jpeg,image/jpg,image/png,application/pdf",onChange:c,disabled:te,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 disabled:opacity-50"}),te&&e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Uploading..."}),(()=>{const A=T||(M==null?void 0:M.panCard)||null;return A&&A.url?e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg border border-gray-200 flex items-center space-x-4",children:[A.url.endsWith(".pdf")?e.jsx("div",{className:"h-16 w-16 bg-gray-200 rounded border border-gray-300 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:""})}):e.jsx("img",{src:He(A.url)||"",alt:"PAN Card",className:"h-16 w-16 object-cover rounded border border-gray-300",crossOrigin:"anonymous"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:A.name||"PAN Card"}),e.jsx("p",{className:"text-xs text-gray-500",children:A.url.endsWith(".pdf")?"PDF Document":"Image File"})]}),e.jsx("button",{type:"button",onClick:()=>b(null),className:"px-3 py-1.5 text-sm text-red-600 hover:text-red-800 border border-red-300 rounded hover:bg-red-50",children:"Remove"})]}):null})()]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Aadhar Card"}),e.jsx("input",{type:"file",accept:"image/jpeg,image/jpg,image/png,application/pdf",onChange:D,disabled:o,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 disabled:opacity-50"}),o&&e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Uploading..."}),(()=>{const A=w||(M==null?void 0:M.aadharCard)||null;return A&&A.url?e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg border border-gray-200 flex items-center space-x-4",children:[A.url.endsWith(".pdf")?e.jsx("div",{className:"h-16 w-16 bg-gray-200 rounded border border-gray-300 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:""})}):e.jsx("img",{src:He(A.url)||"",alt:"Aadhar Card",className:"h-16 w-16 object-cover rounded border border-gray-300",crossOrigin:"anonymous"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:A.name||"Aadhar Card"}),e.jsx("p",{className:"text-xs text-gray-500",children:A.url.endsWith(".pdf")?"PDF Document":"Image File"})]}),e.jsx("button",{type:"button",onClick:()=>$(null),className:"px-3 py-1.5 text-sm text-red-600 hover:text-red-800 border border-red-300 rounded hover:bg-red-50",children:"Remove"})]}):null})()]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Other Documents (Multiple files allowed)"}),e.jsx("input",{type:"file",accept:"image/jpeg,image/jpg,image/png,application/pdf",multiple:!0,onChange:se,disabled:N,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 disabled:opacity-50"}),N&&e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Uploading..."}),(()=>{const A=pe.length>0?pe:M!=null&&M.otherDocuments&&Array.isArray(M.otherDocuments)?M.otherDocuments.filter(L=>L&&L.url):[];return A.length>0?e.jsx("div",{className:"mt-3 space-y-2",children:A.map((L,z)=>{const oe=L.url.endsWith(".pdf"),le=L.url.match(/\.(jpg|jpeg|png|gif|webp)$/i);return e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg border border-gray-200 flex items-center space-x-4",children:[le?e.jsx("img",{src:He(L.url)||"",alt:L.name,className:"h-16 w-16 object-cover rounded border border-gray-300",crossOrigin:"anonymous"}):e.jsx("div",{className:"h-16 w-16 bg-gray-200 rounded border border-gray-300 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:oe?"":""})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",title:L.name,children:L.name}),e.jsx("p",{className:"text-xs text-gray-500",children:oe?"PDF Document":le?"Image File":"Document"})]}),e.jsx("button",{type:"button",onClick:()=>{if(pe.length===0&&A.length>0){const xe=A.filter((he,B)=>B!==z);Pe(xe)}else ge(z)},className:"px-3 py-1.5 text-sm text-red-600 hover:text-red-800 border border-red-300 rounded hover:bg-red-50",children:"Remove"})]},z)})}):null})()]}),e.jsxs("div",{className:"flex gap-4 pt-6",children:[e.jsx("button",{type:"button",onClick:()=>i(6),className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Previous"}),e.jsx("button",{type:"submit",disabled:ve.isPending,className:"flex-1 px-6 py-3 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:ve.isPending?"Saving...":"Save & Finish"})]})]},`step7-${G==null?void 0:G.id}`)]})]})]})})})},ks={getAll:async t=>{const s=new URLSearchParams;return t!=null&&t.studentId&&s.append("studentId",t.studentId.toString()),t!=null&&t.softwareName&&s.append("softwareName",t.softwareName),t!=null&&t.status&&s.append("status",t.status),t!=null&&t.courseName&&s.append("courseName",t.courseName),t!=null&&t.page&&s.append("page",t.page.toString()),t!=null&&t.limit&&s.append("limit",t.limit.toString()),(await Re.get(`/student-software-progress?${s.toString()}`)).data},getById:async t=>(await Re.get(`/student-software-progress/${t}`)).data,create:async t=>(await Re.post("/student-software-progress",t)).data,update:async(t,s)=>(await Re.put(`/student-software-progress/${t}`,s)).data,delete:async t=>(await Re.delete(`/student-software-progress/${t}`)).data,deleteAll:async()=>(await Re.delete("/student-software-progress")).data,importExcel:async t=>{const s=new FormData;return s.append("file",t),(await Re.post("/student-software-progress/import-excel",s,{headers:{"Content-Type":"multipart/form-data"}})).data},downloadTemplate:async()=>{var t,s,a;try{const r=await Re.get("/student-software-progress/download-template",{responseType:"blob"}),n=r.headers["content-type"]||"";if(n.includes("application/json")){const m=await r.data.text(),j=JSON.parse(m);throw new Error(j.message||"Failed to download template")}if(!n.includes("spreadsheetml")&&!n.includes("excel"))try{const m=await r.data.text(),j=JSON.parse(m);throw new Error(j.message||"Failed to download template")}catch{}const i=window.URL.createObjectURL(r.data),h=document.createElement("a");h.href=i,h.setAttribute("download","studentwise_import_template.xlsx"),document.body.appendChild(h),h.click(),setTimeout(()=>{h.remove(),window.URL.revokeObjectURL(i)},100)}catch(r){if(((t=r.response)==null?void 0:t.data)instanceof Blob)try{const n=await r.response.data.text(),i=JSON.parse(n);throw new Error(i.message||i.error||"Failed to download template")}catch{throw new Error("Failed to download template. Please check backend logs.")}throw(a=(s=r.response)==null?void 0:s.data)!=null&&a.message?new Error(r.response.data.message):r.message?r:new Error("Failed to download template. Please try again.")}},exportExcel:async t=>{var a,r,n;const s=new URLSearchParams;t!=null&&t.studentId&&s.append("studentId",t.studentId.toString()),t!=null&&t.courseName&&s.append("courseName",t.courseName),t!=null&&t.status&&s.append("status",t.status);try{const i=await Re.get(`/student-software-progress/export-excel?${s.toString()}`,{responseType:"blob"}),h=i.headers["content-type"]||"";if(h.includes("application/json")){const C=await i.data.text(),q=JSON.parse(C);throw new Error(q.message||"Failed to export Excel")}if(!h.includes("spreadsheetml")&&!h.includes("excel"))try{const C=await i.data.text(),q=JSON.parse(C);throw new Error(q.message||"Failed to export Excel")}catch{}const m=window.URL.createObjectURL(i.data),j=document.createElement("a");j.href=m,j.setAttribute("download",`student-software-progress-${new Date().toISOString().split("T")[0]}.xlsx`),document.body.appendChild(j),j.click(),setTimeout(()=>{j.remove(),window.URL.revokeObjectURL(m)},100)}catch(i){if(((a=i.response)==null?void 0:a.data)instanceof Blob)try{const h=await i.response.data.text(),m=JSON.parse(h);throw new Error(m.message||m.error||"Failed to export Excel")}catch{throw new Error("Failed to export Excel. Please check backend logs.")}throw(n=(r=i.response)==null?void 0:r.data)!=null&&n.message?new Error(i.response.data.message):i.message?i:new Error("Failed to export Excel. Please try again.")}}};var Js=(t=>(t.ENGLISH="english",t.GUJARATI="gujarati",t))(Js||{});const dl={getStudentOrientation:async t=>(await Re.get(`/orientation/${t}`)).data,acceptOrientation:async(t,s)=>(await Re.post(`/orientation/${t}/accept`,{language:s})).data,getBulkOrientationStatus:async t=>(await Re.get("/orientation/bulk/status",{params:{studentIds:t.join(",")}})).data},qt={getAllPayments:async t=>(await Re.get("/payments",{params:t})).data,getPayment:async t=>(await Re.get(`/payments/${t}`)).data,createPayment:async t=>(await Re.post("/payments",t)).data,updatePayment:async(t,s)=>(await Re.put(`/payments/${t}`,s)).data,downloadReceipt:async t=>(await Re.get(`/payments/${t}/receipt`,{responseType:"blob"})).data,generateReceipt:async t=>(await Re.post(`/payments/${t}/generate-receipt`)).data},cl=()=>{var T;const t=vt(),[s,a]=g.useState(null),{data:r}=_e({queryKey:["students"],queryFn:()=>kt.getAllStudents()}),{data:n}=_e({queryKey:["student-details",s],queryFn:()=>s?kt.getStudentDetails(s):null,enabled:!!s}),{data:i}=_e({queryKey:["student-software-progress",s],queryFn:()=>s?ks.getAll({studentId:s}):{status:"success",data:{records:[]}},enabled:!!s}),h=g.useMemo(()=>{var te,Y,o,de,N;if(!s)return[];const b=new Set;(((Y=(te=n==null?void 0:n.data)==null?void 0:te.student)==null?void 0:Y.enrollments)||[]).forEach(S=>{var x;if(S.batch){if((x=S.batch.course)!=null&&x.software){let Z=[];const J=S.batch.course.software;if(Array.isArray(J))Z=J.filter(Ie=>Ie&&typeof Ie=="string");else if(typeof J=="string")try{const Ie=JSON.parse(J);Array.isArray(Ie)?Z=Ie.filter(Ae=>Ae&&typeof Ae=="string"):typeof Ie=="string"?Z=[Ie]:Z=[J]}catch{Z=J.split(",").map(Ie=>Ie.trim()).filter(Boolean)}Z.forEach(Ie=>{Ie&&typeof Ie=="string"&&Ie.trim()&&b.add(Ie.trim())})}if(S.batch.software){let Z=[];if(Array.isArray(S.batch.software))Z=S.batch.software.filter(J=>J&&typeof J=="string");else if(typeof S.batch.software=="string")try{const J=JSON.parse(S.batch.software);Array.isArray(J)?Z=J.filter(Ie=>Ie&&typeof Ie=="string"):Z=[S.batch.software]}catch{Z=S.batch.software.split(",").map(J=>J.trim()).filter(Boolean)}Z.forEach(J=>{J&&typeof J=="string"&&J.trim()&&b.add(J.trim())})}}});const $=(de=(o=n==null?void 0:n.data)==null?void 0:o.student)==null?void 0:de.studentProfile;if($!=null&&$.softwareList){const S=$.softwareList;if(Array.isArray(S))S.forEach(x=>{x&&typeof x=="string"&&x.trim()&&b.add(x.trim())});else{const x=String(S);try{const Z=JSON.parse(x);Array.isArray(Z)?Z.forEach(J=>{J&&typeof J=="string"&&J.trim()&&b.add(J.trim())}):typeof Z=="string"&&Z.trim()&&b.add(Z.trim())}catch{x.split(",").forEach(Z=>{const J=Z.trim();J&&b.add(J)})}}}if($!=null&&$.documents){let S=$.documents;if(typeof S=="string")try{S=JSON.parse(S)}catch{S={}}const x=(S==null?void 0:S.enrollmentMetadata)||S;x!=null&&x.complimentarySoftware&&(typeof x.complimentarySoftware=="string"?x.complimentarySoftware.split(",").map(J=>J.trim()).filter(Boolean):Array.isArray(x.complimentarySoftware)?x.complimentarySoftware:[]).forEach(J=>{J&&typeof J=="string"&&J.trim()&&b.add(J.trim())})}return(((N=i==null?void 0:i.data)==null?void 0:N.records)||[]).forEach(S=>{S.softwareName&&S.softwareName.trim()&&b.add(S.softwareName.trim())}),Array.from(b).sort()},[s,n,i]),m=g.useMemo(()=>{var te;const b=[],w=[],$=[],pe=((te=i==null?void 0:i.data)==null?void 0:te.records)||[],Pe=new Map;return pe.forEach(Y=>{Pe.set(Y.softwareName,Y)}),h.forEach(Y=>{const o=Pe.get(Y),N={name:Y,status:(S=>S==="XX"||S==="IP"||S==="NO"||S==="Finished"?S:"XX")(o==null?void 0:o.status),startDate:o!=null&&o.batchStartDate?new Date(o.batchStartDate).toISOString().split("T")[0]:void 0,endDate:o!=null&&o.batchEndDate?new Date(o.batchEndDate).toISOString().split("T")[0]:void 0,progressId:o==null?void 0:o.id};N.status==="XX"?b.push(N):N.status==="IP"?w.push(N):N.status==="NO"?b.push(N):N.status==="Finished"&&$.push(N)}),{notStarted:b,running:w,completed:$}},[h,i]),j=st({mutationFn:async({studentId:b,softwareName:w,status:$,startDate:pe,endDate:Pe,progressId:te})=>{const Y={studentId:b,softwareName:w,status:$,batchStartDate:pe?new Date(pe).toISOString():void 0,batchEndDate:Pe?new Date(Pe).toISOString():void 0};return te?ks.update(te,Y):ks.create(Y)},onSuccess:()=>{t.invalidateQueries({queryKey:["student-software-progress",s]}),t.invalidateQueries({queryKey:["student-details",s]})},onError:b=>{var w,$;alert((($=(w=b.response)==null?void 0:w.data)==null?void 0:$.message)||"Failed to save software progress")}}),C=(b,w)=>{if(!s){alert("Please select a student first.");return}j.mutate({studentId:s,softwareName:b.name,status:w,startDate:b.startDate,endDate:b.endDate,progressId:b.progressId})},q=(b,w,$)=>{if(!s){alert("Please select a student first.");return}j.mutate({studentId:s,softwareName:b.name,status:b.status,startDate:w==="start"?$:b.startDate,endDate:w==="end"?$:b.endDate,progressId:b.progressId})},K=b=>{switch(b){case"Finished":return"bg-green-100 text-green-800";case"IP":return"bg-blue-100 text-blue-800";case"NO":return"bg-gray-100 text-gray-800";case"XX":default:return"bg-yellow-100 text-yellow-800"}},re=((T=r==null?void 0:r.data)==null?void 0:T.students)||[];return e.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Student Software Tracking"}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{htmlFor:"student-select",className:"block text-sm font-medium text-gray-700 mb-2",children:["Select Student ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"student-select",value:s||"",onChange:b=>a(b.target.value?parseInt(b.target.value):null),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",required:!0,children:[e.jsx("option",{value:"",children:"-- Select Student --"}),re.map(b=>e.jsxs("option",{value:b.id,children:[b.name," (",b.email,")"]},b.id))]})]}),s&&h.length>0&&e.jsxs("div",{className:"mt-8",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:["Software Progress (",h.length," software)"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-lg font-semibold text-yellow-800 mb-3",children:["Not Started (",m.notStarted.length,")"]}),e.jsxs("div",{className:"space-y-3",children:[m.notStarted.map(b=>e.jsxs("div",{className:"bg-white p-3 rounded-md shadow-sm border border-yellow-100",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:b.name}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-semibold ${K(b.status)}`,children:"Not Started"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600",children:"Start Date (Optional)"}),e.jsx("input",{type:"date",value:b.startDate||"",onChange:w=>q(b,"start",w.target.value),className:"mt-1 block w-full px-2 py-1 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600",children:"End Date (Optional)"}),e.jsx("input",{type:"date",value:b.endDate||"",onChange:w=>q(b,"end",w.target.value),className:"mt-1 block w-full px-2 py-1 border border-gray-300 rounded-md"})]})]}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx("button",{onClick:()=>C(b,"IP"),className:"flex-1 px-3 py-1 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700",children:"Start"}),e.jsx("button",{onClick:()=>C(b,"Finished"),className:"flex-1 px-3 py-1 bg-green-600 text-white rounded-md text-sm hover:bg-green-700",children:"Complete"})]})]},b.name)),m.notStarted.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No software"})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-lg font-semibold text-blue-800 mb-3",children:["Running (",m.running.length,")"]}),e.jsxs("div",{className:"space-y-3",children:[m.running.map(b=>e.jsxs("div",{className:"bg-white p-3 rounded-md shadow-sm border border-blue-100",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:b.name}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-semibold ${K(b.status)}`,children:"In Progress"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600",children:"Start Date (Optional)"}),e.jsx("input",{type:"date",value:b.startDate||"",onChange:w=>q(b,"start",w.target.value),className:"mt-1 block w-full px-2 py-1 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600",children:"End Date (Optional)"}),e.jsx("input",{type:"date",value:b.endDate||"",onChange:w=>q(b,"end",w.target.value),className:"mt-1 block w-full px-2 py-1 border border-gray-300 rounded-md"})]})]}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx("button",{onClick:()=>C(b,"XX"),className:"flex-1 px-3 py-1 bg-yellow-600 text-white rounded-md text-sm hover:bg-yellow-700",children:"Mark Not Started"}),e.jsx("button",{onClick:()=>C(b,"Finished"),className:"flex-1 px-3 py-1 bg-green-600 text-white rounded-md text-sm hover:bg-green-700",children:"Complete"})]})]},b.name)),m.running.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No software"})]})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-lg font-semibold text-green-800 mb-3",children:["Completed (",m.completed.length,")"]}),e.jsxs("div",{className:"space-y-3",children:[m.completed.map(b=>e.jsxs("div",{className:"bg-white p-3 rounded-md shadow-sm border border-green-100",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:b.name}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-semibold ${K(b.status)}`,children:"Completed"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600",children:"Start Date (Optional)"}),e.jsx("input",{type:"date",value:b.startDate||"",onChange:w=>q(b,"start",w.target.value),className:"mt-1 block w-full px-2 py-1 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600",children:"End Date (Optional)"}),e.jsx("input",{type:"date",value:b.endDate||"",onChange:w=>q(b,"end",w.target.value),className:"mt-1 block w-full px-2 py-1 border border-gray-300 rounded-md"})]})]}),e.jsx("div",{className:"mt-3",children:e.jsx("button",{onClick:()=>C(b,"IP"),className:"w-full px-3 py-1 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700",children:"Mark In Progress"})})]},b.name)),m.completed.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No software"})]})]})]})]}),s&&h.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"text-lg",children:"No software found for this student."}),e.jsx("p",{className:"text-sm mt-2",children:"Please ensure the student is enrolled in a course or has software listed in their profile."})]}),!s&&e.jsx("div",{className:"text-center py-12 text-gray-500",children:e.jsx("p",{className:"text-lg",children:"Please select a student to view their software progress."})})]})},ml=({payment:t,amount:s,paidAmount:a,pending:r,refetchPayments:n})=>{const[i,h]=g.useState(!1),[m,j]=g.useState(!1),[C,q]=g.useState(!1),K=b=>{switch(b==null?void 0:b.toLowerCase()){case"paid":return"bg-green-100 text-green-800";case"partial":return"bg-yellow-100 text-yellow-800";case"pending":return"bg-gray-100 text-gray-800";case"overdue":return"bg-red-100 text-red-800";case"cancelled":return"bg-gray-100 text-gray-500";case"active":return"bg-green-100 text-green-800";case"active plus":return"bg-blue-100 text-blue-800";case"dropped":return"bg-red-100 text-red-800";case"finished":return"bg-purple-100 text-purple-800";case"deactive":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},re=async()=>{var b,w;if(t.id){j(!0);try{await qt.generateReceipt(t.id),alert("Receipt generated successfully!"),n()}catch($){alert(((w=(b=$.response)==null?void 0:b.data)==null?void 0:w.message)||"Failed to generate receipt")}finally{j(!1)}}},T=async()=>{var b,w;if(!(!t.id||!t.receiptUrl)){q(!0);try{const $=await qt.downloadReceipt(t.id),pe=window.URL.createObjectURL($),Pe=document.createElement("a");Pe.href=pe,Pe.download=`receipt_${t.id}.pdf`,document.body.appendChild(Pe),Pe.click(),document.body.removeChild(Pe),window.URL.revokeObjectURL(pe)}catch($){alert(((w=(b=$.response)==null?void 0:b.data)==null?void 0:w.message)||"Failed to download receipt")}finally{q(!1)}}};return e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-white hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>h(!i),children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-7 gap-4 p-4 items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Payment ID"}),e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:["#",t.id]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Amount"}),e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:["",s.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Paid Amount"}),e.jsxs("p",{className:"text-sm font-semibold text-green-600",children:["",a.toFixed(2),r>0&&e.jsxs("span",{className:"text-xs text-orange-600 block",children:["Pending: ",r.toFixed(2)]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Due Date"}),e.jsx("p",{className:"text-sm text-gray-900",children:t.dueDate?lt(t.dueDate):"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Paid Date"}),e.jsx("p",{className:"text-sm text-gray-900",children:t.paidDate?lt(t.paidDate):"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Status"}),e.jsx("span",{className:`inline-block px-2 py-1 rounded text-xs font-semibold capitalize ${K(t.status)}`,children:t.status||"pending"})]}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("button",{onClick:b=>{b.stopPropagation(),h(!i)},className:"text-gray-500 hover:text-gray-700",children:i?"":""})})]})}),i&&e.jsx("div",{className:"border-t border-gray-200 bg-gray-50 p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Payment Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Payment Method:"}),e.jsx("span",{className:"text-gray-900 font-medium",children:t.paymentMethod||"Not specified"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Transaction ID:"}),e.jsx("span",{className:"text-gray-900 font-mono text-xs",children:t.transactionId||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Created At:"}),e.jsx("span",{className:"text-gray-900",children:t.createdAt?lt(t.createdAt):"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Updated At:"}),e.jsx("span",{className:"text-gray-900",children:t.updatedAt?lt(t.updatedAt):"N/A"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Enrollment & Batch"}),e.jsx("div",{className:"space-y-2 text-sm",children:t.enrollment?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Enrollment ID:"}),e.jsxs("span",{className:"text-gray-900 font-medium",children:["#",t.enrollment.id]})]}),t.enrollment.batch&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Batch:"}),e.jsx("span",{className:"text-gray-900 font-medium",children:t.enrollment.batch.title})]})]}):e.jsx("p",{className:"text-gray-500 italic",children:"No enrollment linked"})})]}),t.notes&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Notes"}),e.jsx("p",{className:"text-sm text-gray-900 bg-white p-3 rounded border border-gray-200",children:t.notes})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Receipt"}),e.jsx("div",{className:"flex gap-2",children:t.receiptUrl?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:T,disabled:C,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 text-sm font-medium",children:C?"Downloading...":" Download Receipt"}),e.jsx("a",{href:`https://api.prashantthakar.com/api${t.receiptUrl.split("/").map((b,w)=>w===0||b===""?b:encodeURIComponent(b)).join("/")}`,target:"_blank",rel:"noopener noreferrer",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm font-medium",children:" View Receipt"})]}):t.status==="paid"||t.status==="partial"?e.jsx("button",{onClick:re,disabled:m,className:"px-4 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700 disabled:opacity-50 text-sm font-medium",children:m?"Generating...":" Generate Receipt"}):e.jsx("p",{className:"text-sm text-gray-500 italic",children:"Receipt can only be generated for paid or partial payments"})})]})]})})]})},ul=t=>{switch(t==null?void 0:t.toLowerCase()){case"active":return"bg-green-100 text-green-800";case"active plus":return"bg-blue-100 text-blue-800";case"dropped":return"bg-red-100 text-red-800";case"finished":return"bg-purple-100 text-purple-800";case"deactive":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},xl=()=>{var B,ye,De,Se,at,it,ot;const{user:t}=Nt(),s=Et(),a=vt(),[r,n]=g.useState("students"),[i,h]=g.useState(!1),[m,j]=g.useState(!1),[C,q]=g.useState(!1),[K,re]=g.useState(!1),[T,b]=g.useState(!1),[w,$]=g.useState(!1),[pe,Pe]=g.useState(null),[te,Y]=g.useState("english"),[o,de]=g.useState(null),[N,S]=g.useState(null),[x,Z]=g.useState(!1),[J,Ie]=g.useState(!1),[Ae,Me]=g.useState(null),[W,Ne]=g.useState(""),[V,Qe]=g.useState("all"),[ve,p]=g.useState({}),{data:M,isLoading:P}=_e({queryKey:["students"],queryFn:()=>kt.getAllStudents()}),{data:H}=_e({queryKey:["batches"],queryFn:()=>St.getAllBatches()}),{data:U}=_e({queryKey:["courses"],queryFn:()=>Jt.getAllCourses()}),{data:ce,refetch:ae,isLoading:u,error:k}=_e({queryKey:["student-payments",o==null?void 0:o.id],queryFn:async()=>{var E,f,Ee,R,me,Oe,Ue,ze;if(!(o!=null&&o.id))return{status:"success",data:{payments:[]}};const I=o.id;console.log(" Fetching payments for student ID:",I,"Type:",typeof I);try{const Ve=await qt.getAllPayments();console.log(" All payments in system:",((f=(E=Ve==null?void 0:Ve.data)==null?void 0:E.payments)==null?void 0:f.length)||0);const dt=(((Ee=Ve==null?void 0:Ve.data)==null?void 0:Ee.payments)||[]).filter(ne=>{const we=Number(ne.studentId),Ke=Number(I);return we===Ke});console.log(" Payments matching student ID:",dt.length),dt.length>0&&console.log(" Matching payments:",dt.map(ne=>({id:ne.id,studentId:ne.studentId,amount:ne.amount,status:ne.status})));const tt=await qt.getAllPayments({studentId:I});return console.log(" Filtered payments result:",tt),console.log(" Payments data:",tt==null?void 0:tt.data),console.log(" Payments array:",(R=tt==null?void 0:tt.data)==null?void 0:R.payments),console.log(" Payments count:",((Oe=(me=tt==null?void 0:tt.data)==null?void 0:me.payments)==null?void 0:Oe.length)||0),((ze=(Ue=tt==null?void 0:tt.data)==null?void 0:Ue.payments)==null?void 0:ze.length)===0&&dt.length>0?(console.warn(" WARNING: Found matching payments in all payments but filtered query returned empty!"),console.warn("This suggests a query issue. Returning matching payments manually."),{status:"success",data:{payments:dt}}):tt}catch(Ve){throw console.error(" Error fetching payments:",Ve),Ve}},enabled:!!(o!=null&&o.id)&&C,retry:1,staleTime:0,gcTime:0}),{data:c,isLoading:D,error:se,refetch:ge}=_e({queryKey:["student-profile",o==null?void 0:o.id],queryFn:async()=>{var I,E,f,Ee,R,me,Oe,Ue;if(!(o!=null&&o.id))return console.warn("No student ID provided for profile fetch"),null;try{const ze=await kt.getStudentDetails(o.id);if(console.log("Student details API response:",ze),console.log("Student profile documents:",(f=(E=(I=ze==null?void 0:ze.data)==null?void 0:I.student)==null?void 0:E.studentProfile)==null?void 0:f.documents),(Ee=ze==null?void 0:ze.data)!=null&&Ee.student){const Ve=ze.data.student;if((R=Ve.studentProfile)!=null&&R.documents&&typeof Ve.studentProfile.documents=="string")try{Ve.studentProfile.documents=JSON.parse(Ve.studentProfile.documents),console.log("Parsed documents string:",Ve.studentProfile.documents)}catch(nt){console.error("Error parsing documents:",nt)}if(!Ve.studentProfile||!Ve.studentProfile.documents)try{const nt=await yt.getUser(o.id);(Oe=(me=nt==null?void 0:nt.data)==null?void 0:me.user)!=null&&Oe.studentProfile&&(Ve.studentProfile={...Ve.studentProfile,...nt.data.user.studentProfile})}catch(nt){console.warn("Failed to fetch user profile as fallback:",nt==null?void 0:nt.message)}return{data:{user:Ve}}}return console.warn("Student details response missing student object, falling back to selectedStudent"),{data:{user:o}}}catch(ze){console.error("Error fetching student details:",ze);try{const Ve=await yt.getUser(o.id);if((Ue=Ve==null?void 0:Ve.data)!=null&&Ue.user)return{data:{user:Ve.data.user}}}catch(Ve){console.warn("Fallback user fetch also failed:",Ve==null?void 0:Ve.message)}return{data:{user:o}}}},enabled:!!(o!=null&&o.id)&&C,retry:2,staleTime:0,gcTime:0});At.useEffect(()=>{C&&o&&(a.invalidateQueries({queryKey:["student-profile",o.id]}),a.invalidateQueries({queryKey:["student",o.id]}),a.invalidateQueries({queryKey:["students"]}),a.invalidateQueries({queryKey:["student-software-progress",o.id]}),ge())},[C,o,a,ge]),At.useEffect(()=>{a.invalidateQueries({queryKey:["students"]}),a.invalidateQueries({queryKey:["student-profile"]}),a.invalidateQueries({queryKey:["student-software-progress"]}),C&&o&&ge()},[a,C,o,ge]),At.useEffect(()=>{const I=()=>{document.visibilityState==="visible"&&(a.invalidateQueries({queryKey:["students"]}),a.invalidateQueries({queryKey:["student-profile"]}),a.invalidateQueries({queryKey:["student-software-progress"]}),C&&o&&ge())};return document.addEventListener("visibilitychange",I),()=>{document.removeEventListener("visibilitychange",I)}},[a,C,o,ge]),_e({queryKey:["software-completions",o==null?void 0:o.id],queryFn:async()=>{if(!(o!=null&&o.id))return{status:"success",data:{completions:[],count:0}};try{const I=await Ss.getCompletions({studentId:o.id});return console.log("Software completions fetched:",I),I}catch(I){return console.error("Error fetching software completions:",I),{status:"success",data:{completions:[],count:0}}}},enabled:!!(o!=null&&o.id)&&C,retry:1});const{data:G,isLoading:Ce,error:Ze}=_e({queryKey:["student-software-progress",o==null?void 0:o.id],queryFn:async()=>{if(!(o!=null&&o.id))return{status:"success",data:{records:[]}};try{const I=await ks.getAll({studentId:o.id});return console.log("Software progress fetched:",I),I}catch(I){return console.error("Error fetching software progress:",I),{status:"success",data:{records:[]}}}},enabled:!!(o!=null&&o.id)&&C,retry:1}),Xe=g.useMemo(()=>{var Oe,Ue;if(!(o!=null&&o.id)||!((Oe=c==null?void 0:c.data)!=null&&Oe.user))return[];const I=new Set,f=c.data.user.studentProfile;if(f!=null&&f.softwareList){const ze=f.softwareList;if(Array.isArray(ze))ze.forEach(Ve=>{Ve&&typeof Ve=="string"&&Ve.trim()&&I.add(Ve.trim())});else{const Ve=String(ze);try{const nt=JSON.parse(Ve);Array.isArray(nt)?nt.forEach(dt=>{dt&&typeof dt=="string"&&dt.trim()&&I.add(dt.trim())}):typeof nt=="string"&&nt.trim()&&I.add(nt.trim())}catch{Ve.split(",").forEach(nt=>{const dt=nt.trim();dt&&I.add(dt)})}}}if(f!=null&&f.documents){let ze=f.documents;if(typeof ze=="string")try{ze=JSON.parse(ze)}catch{ze={}}const Ve=(ze==null?void 0:ze.enrollmentMetadata)||ze;Ve!=null&&Ve.complimentarySoftware&&(typeof Ve.complimentarySoftware=="string"?Ve.complimentarySoftware.split(",").map(dt=>dt.trim()).filter(Boolean):Array.isArray(Ve.complimentarySoftware)?Ve.complimentarySoftware:[]).forEach(dt=>{dt&&typeof dt=="string"&&dt.trim()&&I.add(dt.trim())})}const Ee=((Ue=G==null?void 0:G.data)==null?void 0:Ue.records)||[],R=new Map,me=Array.from(I).sort();return Ee.forEach(ze=>{ze.softwareName&&I.has(ze.softwareName.trim())&&R.set(ze.softwareName.trim(),ze)}),me.map(ze=>{const Ve=R.get(ze);return Ve||{id:0,studentId:o.id,softwareName:ze,softwareCode:null,status:"XX",enrollmentDate:null,courseName:null,courseType:null,studentStatus:null,batchTiming:null,schedule:null,facultyName:null,batchStartDate:null,batchEndDate:null,batchId:null,notes:null,batch:null}})},[o==null?void 0:o.id,c,G]),Be=st({mutationFn:I=>kt.createEnrollment(I),onSuccess:()=>{a.invalidateQueries({queryKey:["students"]}),a.invalidateQueries({queryKey:["batches"]}),h(!1),alert("Student enrolled successfully!")},onError:I=>{var E,f;alert(((f=(E=I.response)==null?void 0:E.data)==null?void 0:f.message)||"Failed to enroll student. Please check if the enrollment endpoint exists in the backend.")}}),Q=st({mutationFn:({studentId:I,language:E})=>dl.acceptOrientation(I,E),onSuccess:(I,E)=>{p(f=>({...f,[E.studentId]:{isEligible:I.data.isEligible,english:I.data.orientations.english.accepted,gujarati:I.data.orientations.gujarati.accepted}})),a.invalidateQueries({queryKey:["bulk-orientation-status"]}),alert("Orientation accepted successfully!")},onError:I=>{var E,f;alert(((f=(E=I.response)==null?void 0:E.data)==null?void 0:f.message)||"Failed to accept orientation")}}),l=st({mutationFn:({userId:I,avatarUrl:E})=>yt.updateUser(I,{avatarUrl:E}),onSuccess:(I,E)=>{if(a.invalidateQueries({queryKey:["students"]}),a.invalidateQueries({queryKey:["users"]}),a.invalidateQueries({queryKey:["student-details",o==null?void 0:o.id]}),o){const f={...o,avatarUrl:E.avatarUrl};de(f);const Ee=He(E.avatarUrl)||E.avatarUrl,R=Ee+(Ee.includes("?")?"&":"?")+`t=${Date.now()}`;S(R)}Z(!1),alert("Image updated successfully!"),setTimeout(()=>{j(!1),de(null),S(null)},1e3)},onError:I=>{var E,f;alert(((f=(E=I.response)==null?void 0:E.data)==null?void 0:f.message)||"Failed to update image"),Z(!1)}}),O=st({mutationFn:I=>yt.deleteUser(I),onSuccess:()=>{a.invalidateQueries({queryKey:["students"]}),re(!1),de(null),alert("Student deleted successfully!")},onError:I=>{var E,f;alert(((f=(E=I.response)==null?void 0:E.data)==null?void 0:f.message)||"Failed to delete student")}}),X=st({mutationFn:I=>kt.unifiedStudentImport(I),onSuccess:I=>{Me(I.data),a.invalidateQueries({queryKey:["students"]}),a.invalidateQueries({queryKey:["batches"]}),a.invalidateQueries({queryKey:["student-software-progress"]}),Ie(!1),I.data.failed===0&&(alert(`Successfully imported ${I.data.success} student(s)!`),b(!1),Me(null))},onError:I=>{var E,f;Ie(!1),alert(((f=(E=I.response)==null?void 0:E.data)==null?void 0:f.message)||"Failed to import students")}}),fe=async()=>{var I;try{const E=await kt.downloadUnifiedTemplate();if(E.type==="application/json"){const R=await E.text(),me=JSON.parse(R);alert(me.message||"Failed to download template");return}const f=window.URL.createObjectURL(E),Ee=document.createElement("a");Ee.href=f,Ee.download="unified_student_template.xlsx",document.body.appendChild(Ee),Ee.click(),document.body.removeChild(Ee),window.URL.revokeObjectURL(f)}catch(E){console.error("Download template error:",E),(I=E.response)!=null&&I.data?E.response.data instanceof Blob?E.response.data.text().then(f=>{try{const Ee=JSON.parse(f);alert(Ee.message||"Failed to download template")}catch{alert("Failed to download template")}}):alert(E.response.data.message||"Failed to download template"):alert(E.message||"Failed to download template")}},Fe=async I=>{I.preventDefault();const f=new FormData(I.currentTarget).get("file");if(!f){alert("Please select a file");return}if(!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","text/csv"].includes(f.type)){alert("Invalid file type. Only Excel files (.xlsx, .xls) and CSV files are allowed.");return}Ie(!0),Me(null),X.mutate(f)},je=async I=>{var Ee,R,me;const E=(Ee=I.target.files)==null?void 0:Ee[0];if(!E||!o)return;if(!E.type.startsWith("image/")){alert("Please select an image file");return}if(E.size>5*1024*1024){alert("Image size must be less than 5MB");return}const f=new FileReader;f.onloadend=()=>{S(f.result)},f.readAsDataURL(E),Z(!0);try{const Oe=await wt.uploadFile(E);if(console.log("Upload response:",Oe),Oe.data&&Oe.data.files&&Oe.data.files.length>0){const Ue=Oe.data.files[0].url;console.log("Uploaded image URL:",Ue);const ze=He(Ue)||Ue,Ve=ze+(ze.includes("?")?"&":"?")+`t=${Date.now()}`;console.log("Full image URL for preview (with cache-busting):",Ve),S(Ve),l.mutate({userId:o.id,avatarUrl:Ue})}else throw new Error("No files returned from upload")}catch(Oe){console.error("Upload error:",Oe),alert(((me=(R=Oe.response)==null?void 0:R.data)==null?void 0:me.message)||Oe.message||"Failed to upload image"),Z(!1),S(null)}},v=(M==null?void 0:M.data.students)||[],_=(M==null?void 0:M.data.totalCount)||v.length,ue=(H==null?void 0:H.data)||[],A=g.useMemo(()=>{let I=v;if(W.trim()){const E=W.toLowerCase();I=I.filter(f=>{const Ee=(f.name||"").toLowerCase(),R=(f.email||"").toLowerCase(),me=(f.phone||"").toLowerCase();return Ee.includes(E)||R.includes(E)||me.includes(E)})}return V!=="all"&&(I=I.filter(E=>{var Ee,R;return((R=(Ee=E.studentProfile)==null?void 0:Ee.status)==null?void 0:R.toLowerCase())===V.toLowerCase()})),I},[v,W,V]),L=I=>{if(!I)return"-";try{const E=typeof I=="string"?new Date(I):I;if(isNaN(E.getTime()))return"-";const f=String(E.getDate()).padStart(2,"0"),Ee=String(E.getMonth()+1).padStart(2,"0"),R=E.getFullYear();return`${f}/${Ee}/${R}`}catch{return"-"}},z=I=>{I.preventDefault();const E=new FormData(I.currentTarget),f={studentId:parseInt(E.get("studentId")),batchId:parseInt(E.get("batchId")),enrollmentDate:E.get("enrollmentDate")||new Date().toISOString().split("T")[0],status:E.get("status")||"active"};Be.mutate(f)},oe=I=>{console.log("Opening view modal for student:",I.id,I.name),de(I),q(!0),setTimeout(()=>{a.invalidateQueries({queryKey:["student-profile",I.id]}),a.invalidateQueries({queryKey:["student-payments",I.id]})},100)},le=I=>{s(`/students/${I.id}/edit`)},xe=I=>{de(I),re(!0)},he=()=>{o&&O.mutate(o.id)};return P?e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})})})}):e.jsxs(et,{children:[e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-orange-500 px-8 py-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Student Management"}),e.jsx("p",{className:"mt-2 text-orange-100",children:"Manage students and enrollments"}),e.jsxs("p",{className:"mt-1 text-orange-200 text-sm font-semibold",children:["Total Students: ",_]})]}),(((B=t==null?void 0:t.role)==null?void 0:B.toLowerCase())==="admin"||((ye=t==null?void 0:t.role)==null?void 0:ye.toLowerCase())==="superadmin")&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>s("/students/enroll"),className:"px-4 py-2 bg-white text-orange-600 rounded-lg font-semibold hover:bg-orange-50 transition-colors",children:"+ New Enrollment"}),e.jsx("button",{onClick:()=>h(!0),className:"px-4 py-2 bg-orange-700 text-white rounded-lg font-semibold hover:bg-orange-800 transition-colors",children:"Enroll Existing Student"}),e.jsx("button",{onClick:fe,className:"px-4 py-2 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition-colors",children:" Download Template"}),e.jsx("button",{onClick:()=>b(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors",children:" Import Students"})]})]})}),e.jsx("div",{className:"border-b border-gray-200 bg-white",children:e.jsxs("nav",{className:"flex space-x-8 px-6","aria-label":"Tabs",children:[e.jsx("button",{onClick:()=>n("students"),className:`py-4 px-1 border-b-2 font-medium text-sm ${r==="students"?"border-orange-500 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Students List"}),e.jsx("button",{onClick:()=>n("student-software"),className:`py-4 px-1 border-b-2 font-medium text-sm ${r==="student-software"?"border-orange-500 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Student Software"})]})}),e.jsx("div",{className:"p-6",children:r==="student-software"?e.jsx(cl,{}):r==="students"&&A.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"No students found"})}):r==="students"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative max-w-md flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Search students by name, email, or phone...",value:W,onChange:I=>Ne(I.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"}),W&&e.jsx("button",{onClick:()=>Ne(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400 hover:text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"w-full sm:w-48",children:e.jsxs("select",{value:V,onChange:I=>Qe(I.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"active plus",children:"Active Plus"}),e.jsx("option",{value:"dropped",children:"Dropped"}),e.jsx("option",{value:"finished",children:"Finished"}),e.jsx("option",{value:"deactive",children:"Deactive"})]})})]}),W||V!=="all"?e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Showing ",A.length," of ",v.length," students"]}):null,e.jsx("div",{className:"overflow-x-auto -mx-4 sm:mx-0",children:e.jsx("div",{className:"inline-block min-w-full align-middle sm:px-0",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"S.NO"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Photo"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden md:table-cell",children:"Email"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden lg:table-cell",children:"Phone"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden xl:table-cell",children:"DOB"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden xl:table-cell",children:"Status"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden xl:table-cell",children:"Address"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden xl:table-cell",children:"Local Address"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden xl:table-cell",children:"Permanent Address"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden xl:table-cell",children:"Course Name"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden xl:table-cell",children:"Software List"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden xl:table-cell",children:"Emergency Contact"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden lg:table-cell",children:"Joined Date"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden md:table-cell",children:"Orientation"}),(((De=t==null?void 0:t.role)==null?void 0:De.toLowerCase())==="admin"||((Se=t==null?void 0:t.role)==null?void 0:Se.toLowerCase())==="superadmin")&&e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:A.map((I,E)=>{var nt,dt,tt,ne,we,Ke,rt;const f=I.studentProfile,Ee=f==null?void 0:f.documents;let R=null;Ee&&typeof Ee=="object"&&("enrollmentMetadata"in Ee?R=Ee.enrollmentMetadata:Ee&&typeof Ee=="object"&&!Array.isArray(Ee)&&(R=Ee));const me=(R==null?void 0:R.courseName)||"-",Oe=(()=>{if(me!=="-"&&(U!=null&&U.data)){const jt=U.data.find(Ft=>Ft.name===me);if(jt!=null&&jt.software&&Array.isArray(jt.software)&&jt.software.length>0)return jt.software}const ct=f==null?void 0:f.softwareList;return Array.isArray(ct)?ct:[]})(),Ue=R==null?void 0:R.emergencyContact,ze=(Ue==null?void 0:Ue.number)||"-",Ve=(Ue==null?void 0:Ue.name)||"-";return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-xs sm:text-sm font-medium text-gray-900",children:E+1})}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"flex items-center",children:I.avatarUrl?e.jsx("img",{src:(He(I.avatarUrl)||I.avatarUrl)+(I.avatarUrl.includes("?")?"&":"?")+`t=${Date.now()}`,alt:I.name,className:"h-10 w-10 sm:h-12 sm:w-12 rounded-full object-cover border-2 border-gray-200",crossOrigin:"anonymous",onError:ct=>{console.error("Student photo failed to load:",I.avatarUrl),ct.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2ZmOTUwMCIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMjAiIGZpbGw9IiNmZmYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj57e3N0dWRlbnQubmFtZS5jaGFyQXQoMCl9fTwvdGV4dD48L3N2Zz4="}},`student-${I.id}-${I.avatarUrl}`):e.jsx("div",{className:"h-10 w-10 sm:h-12 sm:w-12 rounded-full bg-orange-500 flex items-center justify-center text-white font-semibold text-base sm:text-lg",children:I.name.charAt(0).toUpperCase()})})}),e.jsxs("td",{className:"px-3 sm:px-6 py-4",children:[e.jsx("div",{className:"text-xs sm:text-sm font-medium text-gray-900",children:I.name}),e.jsx("div",{className:"text-xs text-gray-500 md:hidden mt-1",children:I.email}),e.jsxs("div",{className:"text-xs text-gray-500 lg:hidden mt-1",children:[I.phone||"-","  ",I.createdAt?new Date(I.createdAt).toLocaleDateString():"-"]})]}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap hidden md:table-cell",children:e.jsx("div",{className:"text-xs sm:text-sm text-gray-500",children:I.email})}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap hidden lg:table-cell",children:e.jsx("div",{className:"text-xs sm:text-sm text-gray-500",children:I.phone||"-"})}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap hidden xl:table-cell",children:e.jsx("div",{className:"text-xs sm:text-sm text-gray-500",children:f!=null&&f.dob?L(f.dob):"-"})}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap hidden xl:table-cell",children:e.jsx("div",{className:"text-xs sm:text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded font-semibold ${((nt=f==null?void 0:f.status)==null?void 0:nt.toLowerCase())==="active"?"bg-green-100 text-green-800":((dt=f==null?void 0:f.status)==null?void 0:dt.toLowerCase())==="active plus"?"bg-blue-100 text-blue-800":((tt=f==null?void 0:f.status)==null?void 0:tt.toLowerCase())==="dropped"?"bg-red-100 text-red-800":((ne=f==null?void 0:f.status)==null?void 0:ne.toLowerCase())==="finished"?"bg-purple-100 text-purple-800":(((we=f==null?void 0:f.status)==null?void 0:we.toLowerCase())==="deactive","bg-gray-100 text-gray-800")}`,children:(f==null?void 0:f.status)||"-"})})}),e.jsx("td",{className:"px-3 sm:px-6 py-4 hidden xl:table-cell",children:e.jsx("div",{className:"text-xs sm:text-sm text-gray-500 max-w-xs truncate",title:(f==null?void 0:f.address)||"-",children:(f==null?void 0:f.address)||"-"})}),e.jsx("td",{className:"px-3 sm:px-6 py-4 hidden xl:table-cell",children:e.jsx("div",{className:"text-xs sm:text-sm text-gray-500 max-w-xs truncate",title:(R==null?void 0:R.localAddress)||"-",children:(R==null?void 0:R.localAddress)||"-"})}),e.jsx("td",{className:"px-3 sm:px-6 py-4 hidden xl:table-cell",children:e.jsx("div",{className:"text-xs sm:text-sm text-gray-500 max-w-xs truncate",title:(R==null?void 0:R.permanentAddress)||"-",children:(R==null?void 0:R.permanentAddress)||"-"})}),e.jsx("td",{className:"px-3 sm:px-6 py-4 hidden xl:table-cell",children:e.jsx("div",{className:"text-xs sm:text-sm text-gray-500 max-w-xs truncate",title:me,children:me})}),e.jsx("td",{className:"px-3 sm:px-6 py-4 hidden xl:table-cell",children:e.jsx("div",{className:"text-xs sm:text-sm text-gray-500",children:Oe.length>0?e.jsxs("div",{className:"flex flex-wrap gap-1",children:[Oe.slice(0,3).map((ct,jt)=>e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-800 rounded text-xs",children:ct},jt)),Oe.length>3&&e.jsxs("span",{className:"text-gray-500 text-xs",children:["+",Oe.length-3]})]}):"-"})}),e.jsx("td",{className:"px-3 sm:px-6 py-4 hidden xl:table-cell",children:e.jsxs("div",{className:"text-xs sm:text-sm text-gray-500",children:[e.jsx("div",{children:Ve}),e.jsx("div",{className:"text-gray-400",children:ze})]})}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap hidden lg:table-cell",children:e.jsx("div",{className:"text-xs sm:text-sm text-gray-500",children:I.createdAt?L(I.createdAt):"-"})}),e.jsx("td",{className:"px-3 sm:px-6 py-4 hidden md:table-cell",children:(()=>{const ct=ve[I.id],jt=(ct==null?void 0:ct.isEligible)||!1;return e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${jt?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:jt?" Eligible":" Pending"}),e.jsx("button",{onClick:()=>{Pe(I.id),$(!0)},className:"text-blue-600 hover:text-blue-900 text-xs",title:"View Orientation",children:" Orientation"})]})})()}),e.jsx("td",{className:"px-3 sm:px-6 py-4 text-xs sm:text-sm font-medium",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-1 sm:gap-2",children:[e.jsx("button",{onClick:()=>oe(I),className:"text-blue-600 hover:text-blue-900 text-left sm:text-center",title:"View Student",children:" View"}),(((Ke=t==null?void 0:t.role)==null?void 0:Ke.toLowerCase())==="admin"||((rt=t==null?void 0:t.role)==null?void 0:rt.toLowerCase())==="superadmin")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{de(I),S(I.avatarUrl||null),j(!0)},className:"text-blue-600 hover:text-blue-900 text-left sm:text-center",title:"Update Photo",children:" Photo"}),e.jsx("button",{onClick:()=>le(I),className:"text-orange-600 hover:text-orange-900 text-left sm:text-center",title:"Edit Student",children:" Edit"}),e.jsx("button",{onClick:()=>xe(I),className:"text-red-600 hover:text-red-900 text-left sm:text-center",title:"Delete Student",children:" Delete"})]})]})})]},I.id)})})]})})}),W&&A.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-500 text-lg",children:"No students found matching your search"}),e.jsx("button",{onClick:()=>Ne(""),className:"mt-2 text-sm text-orange-600 hover:text-orange-800",children:"Clear search"})]})]}):null})]})}),i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Enroll Student in Batch"}),e.jsxs("form",{onSubmit:z,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Student *"}),e.jsxs("select",{name:"studentId",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select a student"}),A.map(I=>e.jsxs("option",{value:I.id,children:[I.name," (",I.email,")"]},I.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Batch *"}),e.jsxs("select",{name:"batchId",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select a batch"}),ue.map(I=>e.jsxs("option",{value:I.id,children:[I.title," ",I.software?`- ${I.software}`:""," (",I.mode,")"]},I.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Enrollment Date *"}),e.jsx("input",{type:"date",name:"enrollmentDate",required:!0,defaultValue:new Date().toISOString().split("T")[0],className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{name:"status",defaultValue:"active",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:Be.isPending,className:"flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:Be.isPending?"Enrolling...":"Enroll Student"}),e.jsx("button",{type:"button",onClick:()=>h(!1),className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})}),m&&o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Update Student Photo"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("strong",{children:"Student:"})," ",o.name]}),e.jsx("div",{className:"flex justify-center mb-4",children:N?e.jsx("img",{src:N.startsWith("data:")?N:(He(N)||N)+(N.includes("?")?"&":"?")+`t=${Date.now()}`,alt:"Preview",className:"h-32 w-32 rounded-full object-cover border-4 border-orange-500",crossOrigin:"anonymous",onError:I=>{console.error("Image preview failed to load:",N),I.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZmY5NTAwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSI0OCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPnt7c2VsZWN0ZWRTdHVkZW50Lm5hbWUuY2hhckF0KDApfX08L3RleHQ+PC9zdmc+"}},`preview-${N}-${Date.now()}`):o!=null&&o.avatarUrl?e.jsx("img",{src:(He(o.avatarUrl)||o.avatarUrl)+(o.avatarUrl.includes("?")?"&":"?")+`t=${Date.now()}`,alt:"Current",className:"h-32 w-32 rounded-full object-cover border-4 border-orange-500",crossOrigin:"anonymous",onError:I=>{console.error("Current student photo failed to load:",o.avatarUrl),I.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZmY5NTAwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSI0OCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPnt7c2VsZWN0ZWRTdHVkZW50Lm5hbWUuY2hhckF0KDApfX08L3RleHQ+PC9zdmc+"}},`current-${o.avatarUrl}-${Date.now()}`):e.jsx("div",{className:"h-32 w-32 rounded-full bg-gray-200 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-400",children:"No image"})})}),e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Image (JPG, PNG - Max 5MB)"}),e.jsx("input",{type:"file",accept:"image/jpeg,image/jpg,image/png",onChange:je,disabled:x,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 disabled:opacity-50"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{type:"button",onClick:()=>{j(!1),de(null),S(null)},disabled:x,className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors disabled:opacity-50",children:x?"Uploading...":"Close"})})]})}),C&&o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Student Profile"}),e.jsx("button",{onClick:()=>{q(!1),de(null)},className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),D?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):se?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:e.jsx("p",{className:"text-yellow-800 text-sm",children:"Could not load full profile. Showing basic information."})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 border-b pb-2",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Name"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900 font-medium",children:(o==null?void 0:o.name)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(o==null?void 0:o.email)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Phone"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(o==null?void 0:o.phone)||"-"})]})]})]})]}):(!c||!("data"in c)||!((at=c.data)!=null&&at.user))&&!D?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 border-b pb-2",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Name"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900 font-medium",children:(o==null?void 0:o.name)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(o==null?void 0:o.email)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Phone"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(o==null?void 0:o.phone)||"-"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 border-b pb-2",children:"Profile Details"}),e.jsx("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:e.jsx("p",{className:"text-gray-500",children:"No student profile information available."})})]})]}):c&&"data"in c&&((it=c.data)!=null&&it.user)?e.jsxs("div",{className:"space-y-6",children:[(()=>{var R;const I=((R=c==null?void 0:c.data)==null?void 0:R.user)||o||null,E=I==null?void 0:I.studentProfile,f=(E==null?void 0:E.photoUrl)||(I==null?void 0:I.avatarUrl)||(o==null?void 0:o.avatarUrl),Ee=(I==null?void 0:I.name)||(o==null?void 0:o.name)||"Student";return e.jsx("div",{className:"flex justify-center mb-6",children:f?e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:He(f)||f,alt:Ee,className:"w-40 h-40 rounded-full object-cover border-4 border-orange-500 shadow-lg mx-auto",crossOrigin:"anonymous",onError:me=>{me.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYwIiBoZWlnaHQ9IjE2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZmY5NTAwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSI0OCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPnt7c3R1ZGVudE5hbWUuY2hhckF0KDApfX08L3RleHQ+PC9zdmc+"}}),e.jsx("p",{className:"mt-3 text-sm font-medium text-gray-700",children:"Student Photo"})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-40 h-40 rounded-full bg-orange-500 flex items-center justify-center text-white font-bold text-4xl mx-auto shadow-lg",children:Ee.charAt(0).toUpperCase()}),e.jsx("p",{className:"mt-3 text-sm font-medium text-gray-700",children:"No Photo Available"})]})})})(),(()=>{var E,f;const I=((E=c==null?void 0:c.data)==null?void 0:E.user)||o||null;return e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 border-b pb-2",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Name"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900 font-medium",children:(I==null?void 0:I.name)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(I==null?void 0:I.email)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Phone"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(I==null?void 0:I.phone)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Status"}),e.jsx("p",{className:"mt-1",children:e.jsx("span",{className:"px-2 py-1 rounded text-xs font-semibold "+(()=>{var me;const R=(((me=I==null?void 0:I.studentProfile)==null?void 0:me.status)||(I!=null&&I.isActive?"Active":"Inactive")).toLowerCase();return R==="active"?"bg-green-100 text-green-800":R==="active plus"?"bg-blue-100 text-blue-800":R==="dropped"?"bg-red-100 text-red-800":R==="finished"?"bg-purple-100 text-purple-800":R==="deactive"?"bg-gray-100 text-gray-800":"bg-red-100 text-red-800"})(),children:((f=I==null?void 0:I.studentProfile)==null?void 0:f.status)||(I!=null&&I.isActive?"Active":"Inactive")})})]}),(I==null?void 0:I.createdAt)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Joined Date"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:new Date(I.createdAt).toLocaleDateString()})]}),(I==null?void 0:I.updatedAt)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Last Updated"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:new Date(I.updatedAt).toLocaleDateString()})]})]})]})})(),(()=>{var Oe,Ue,ze,Ve,nt,dt;const I=((Oe=c==null?void 0:c.data)==null?void 0:Oe.user)||o||null;let E=(Ue=I==null?void 0:I.studentProfile)==null?void 0:Ue.documents,f=null,Ee=null;if(E){if(typeof E=="string")try{E=JSON.parse(E)}catch(ne){console.error("Error parsing documents:",ne),E=null}E&&typeof E=="object"&&(console.log(" Documents structure:",E),console.log(" Documents keys:",Object.keys(E)),(E.photo||E.panCard||E.aadharCard||E.otherDocuments)&&(Ee=E),"enrollmentMetadata"in E?(f=E.enrollmentMetadata,console.log(" Found enrollmentMetadata in documents.enrollmentMetadata:",f),f!=null&&f.documents&&(Ee=f.documents)):E.totalDeal!==void 0||E.bookingAmount!==void 0?(f=E,console.log(" Found enrollmentMetadata at root level of documents:",f)):console.warn(" No enrollmentMetadata found in documents structure"));const tt=(ze=I==null?void 0:I.enrollments)==null?void 0:ze[0];if(tt!=null&&tt.paymentPlan&&!f){const ne=tt.paymentPlan;console.log(" Found paymentPlan in enrollment:",ne),f={totalDeal:ne.totalDeal,bookingAmount:ne.bookingAmount,balanceAmount:ne.balanceAmount,emiPlan:ne.emiPlan,emiPlanDate:ne.emiPlanDate,emiInstallments:ne.emiInstallments}}console.log(" Final enrollmentMetadata:",f)}const R=I==null?void 0:I.studentProfile,me=f==null?void 0:f.emergencyContact;return e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 border-b pb-2",children:"Profile Details"}),I?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Personal Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Date of Birth"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:R!=null&&R.dob?L(R.dob):"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Enrollment Date"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:R!=null&&R.enrollmentDate?L(R.enrollmentDate):"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Profile Status"}),e.jsx("p",{className:"mt-1",children:R!=null&&R.status?e.jsx("span",{className:"px-2 py-1 rounded text-xs font-semibold capitalize "+ul(R.status),children:R.status}):e.jsx("span",{className:"text-sm text-gray-500",children:"-"})})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Address Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Address"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(R==null?void 0:R.address)||"-"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Local Address"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(f==null?void 0:f.localAddress)||"-"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Permanent Address"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(f==null?void 0:f.permanentAddress)||"-"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Course Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Course Name"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(f==null?void 0:f.courseName)||"-"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Software List"}),(()=>{let tt=[];const ne=f==null?void 0:f.courseName;if(ne&&(U!=null&&U.data)){const we=U.data.find(Ke=>Ke.name===ne);we!=null&&we.software&&Array.isArray(we.software)&&we.software.length>0&&(tt=we.software)}if(tt.length===0){const we=R==null?void 0:R.softwareList;if(Array.isArray(we))tt=we;else if(we&&typeof we=="string"){const Ke=we.trim();Ke&&(tt=Ke.split(",").map(rt=>rt.trim()).filter(rt=>rt.length>0))}}return tt.length>0?e.jsx("div",{className:"mt-1 flex flex-wrap gap-2",children:tt.map((we,Ke)=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs font-medium",children:we},Ke))}):e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"-"})})()]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Emergency Contact Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Emergency Contact Number"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(me==null?void 0:me.number)||((Ve=f==null?void 0:f.emergencyContact)==null?void 0:Ve.number)||(f==null?void 0:f.emergencyContactNumber)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Emergency Contact Name"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(me==null?void 0:me.name)||((nt=f==null?void 0:f.emergencyContact)==null?void 0:nt.name)||(f==null?void 0:f.emergencyName)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Emergency Relation"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(me==null?void 0:me.relation)||((dt=f==null?void 0:f.emergencyContact)==null?void 0:dt.relation)||(f==null?void 0:f.emergencyRelation)||"-"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Payment Plan"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Total Deal"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(f==null?void 0:f.totalDeal)!==void 0&&(f==null?void 0:f.totalDeal)!==null?""+Number(f.totalDeal).toFixed(2):"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Booking Amount"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(f==null?void 0:f.bookingAmount)!==void 0&&(f==null?void 0:f.bookingAmount)!==null?""+Number(f.bookingAmount).toFixed(2):"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Balance Amount"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(f==null?void 0:f.balanceAmount)!==void 0&&(f==null?void 0:f.balanceAmount)!==null?""+Number(f.balanceAmount).toFixed(2):"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"EMI Plan"}),e.jsx("p",{className:"mt-1",children:e.jsx("span",{className:"px-2 py-1 rounded text-xs font-semibold "+(f!=null&&f.emiPlan?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:f!=null&&f.emiPlan?"Yes":"No"})})]}),(f==null?void 0:f.emiPlanDate)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"EMI Plan Date"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:L(f.emiPlanDate)})]}),(f==null?void 0:f.emiInstallments)&&Array.isArray(f.emiInstallments)&&f.emiInstallments.length>0&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"EMI Installments"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 border border-gray-300",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase",children:"Month"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase",children:"Amount ()"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase",children:"Due Date"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:f.emiInstallments.map((tt,ne)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:tt.month}),e.jsxs("td",{className:"px-4 py-2 text-sm text-gray-900",children:["",Number(tt.amount).toFixed(2)]}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:tt.dueDate?L(tt.dueDate):"-"})]},ne))})]})})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Additional Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Complimentary Software"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(f==null?void 0:f.complimentarySoftware)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Complimentary Gift"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(f==null?void 0:f.complimentaryGift)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Has Reference"}),e.jsx("p",{className:"mt-1",children:e.jsx("span",{className:"px-2 py-1 rounded text-xs font-semibold "+(f!=null&&f.hasReference?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:f!=null&&f.hasReference?"Yes":"No"})})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Reference Details"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(f==null?void 0:f.referenceDetails)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Counselor Name"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(f==null?void 0:f.counselorName)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Lead Source"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(f==null?void 0:f.leadSource)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Walk-in Date"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:f!=null&&f.walkinDate?L(f.walkinDate):"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Master Faculty"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(f==null?void 0:f.masterFaculty)||"-"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Documents"}),(()=>{const tt=[];Ee&&(Ee.photo&&Ee.photo.url&&tt.push({name:Ee.photo.name||"Photo",url:Ee.photo.url,type:"Photo"}),Ee.panCard&&Ee.panCard.url&&tt.push({name:Ee.panCard.name||"PAN Card",url:Ee.panCard.url,type:"PAN Card"}),Ee.aadharCard&&Ee.aadharCard.url&&tt.push({name:Ee.aadharCard.name||"Aadhar Card",url:Ee.aadharCard.url,type:"Aadhar Card"}),Ee.otherDocuments&&Array.isArray(Ee.otherDocuments)&&Ee.otherDocuments.forEach(we=>{we&&we.url&&tt.push({name:we.name||we.url.split("/").pop()||"Other Document",url:we.url,type:"Other Document"})}),Ee.uploadedDocuments&&Array.isArray(Ee.uploadedDocuments)&&Ee.uploadedDocuments.forEach(we=>{we&&we.url&&tt.push({name:we.name||(typeof we=="string"?we.split("/").pop():"Document"),url:typeof we=="string"?we:we.url,type:"Document"})})),tt.length===0&&(f!=null&&f.enrollmentDocuments)&&Array.isArray(f.enrollmentDocuments)&&f.enrollmentDocuments.forEach(we=>{tt.push({name:we.split("/").pop()||"Document",url:we,type:"Document"})});const ne=async(we,Ke)=>{try{const rt=He(we)||we,ct=await fetch(rt,{method:"GET",headers:{Authorization:"Bearer "+(localStorage.getItem("token")||"")}});if(!ct.ok)throw new Error("Failed to download file");const jt=await ct.blob(),Ft=window.URL.createObjectURL(jt),$t=document.createElement("a");$t.href=Ft,$t.download=Ke,document.body.appendChild($t),$t.click(),document.body.removeChild($t),window.URL.revokeObjectURL(Ft)}catch(rt){console.error("Download error:",rt),window.open(He(we)||we,"_blank")}};return tt.length>0?e.jsx("div",{className:"space-y-2",children:tt.map((we,Ke)=>{const rt=we.name,ct=we.url.toLowerCase().match(/\.(jpg|jpeg|png|gif|webp)$/),jt=we.url.toLowerCase().endsWith(".pdf"),Ft=He(we.url)||we.url;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 border border-gray-200 rounded-md hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[e.jsx("div",{className:"flex-shrink-0",children:jt?e.jsx("span",{className:"text-2xl",children:""}):ct?e.jsx("span",{className:"text-2xl",children:""}):e.jsx("span",{className:"text-2xl",children:""})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",title:rt,children:rt}),e.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:[we.type," ",jt?"(PDF)":ct?"(Image)":""]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("a",{href:Ft,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1.5 text-sm text-blue-600 hover:text-blue-800 border border-blue-300 rounded hover:bg-blue-50 transition-colors",title:"View Document",children:" View"}),e.jsx("button",{onClick:()=>ne(we.url,rt),className:"px-3 py-1.5 text-sm text-green-600 hover:text-green-800 border border-green-300 rounded hover:bg-green-50 transition-colors",title:"Download Document",children:" Download"})]})]},Ke)})}):e.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("p",{className:"text-gray-500 mb-2",children:"No documents uploaded for this student."}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"Documents can be uploaded through the Edit Student page."})]})})()]})]}):e.jsx("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:e.jsx("p",{className:"text-gray-500",children:"No student profile information available."})})]})})(),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 border-b pb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Payment Details"}),e.jsx("button",{type:"button",onClick:()=>ae(),className:"px-3 py-1 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700",title:"Refresh Payments",children:" Refresh"})]}),(()=>{var Ee,R,me;const I=((Ee=c==null?void 0:c.data)==null?void 0:Ee.user)||o||null;let E=(R=I==null?void 0:I.studentProfile)==null?void 0:R.documents,f=null;if(E){if(typeof E=="string")try{E=JSON.parse(E)}catch(Oe){console.error("Error parsing documents:",Oe),E=null}if(E&&typeof E=="object"){"enrollmentMetadata"in E?f=E.enrollmentMetadata:(E.totalDeal!==void 0||E.bookingAmount!==void 0||E.lumpSumPayment!==void 0)&&(f=E);const Oe=(me=I==null?void 0:I.enrollments)==null?void 0:me[0];if(Oe!=null&&Oe.paymentPlan&&!f){const Ue=Oe.paymentPlan;f={totalDeal:Ue.totalDeal,bookingAmount:Ue.bookingAmount,balanceAmount:Ue.balanceAmount,emiPlan:Ue.emiPlan,emiPlanDate:Ue.emiPlanDate,emiInstallments:Ue.emiInstallments}}}}if(f&&(f.totalDeal!==void 0||f.bookingAmount!==void 0)){const Oe=f.totalDeal||0,Ue=f.bookingAmount||0,ze=f.balanceAmount!==void 0?f.balanceAmount:Oe-Ue,Ve=f.lumpSumPayment,nt=f.lumpSumPayments||[],dt=f.nextPayDate;return e.jsxs("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Payment Plan"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Total Deal Amount ()"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:["",Number(Oe).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Booking Amount ()"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:["",Number(Ue).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Balance Amount ()"}),e.jsxs("p",{className:"text-lg font-semibold text-orange-600",children:["",Number(ze).toFixed(2)]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Balance = Total Deal - Booking Amount"})]})]}),Ve&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-blue-200",children:[e.jsx("h5",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Lump Sum Payment Details"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Payment Type"}),e.jsx("p",{className:"text-sm font-semibold text-green-600",children:"Lump Sum Payment"})]}),dt&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Next Payment Date"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:L(dt)})]})]}),nt.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-2",children:"Lump Sum Payment Schedule"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 border border-gray-300",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-700 uppercase",children:"Date"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-700 uppercase",children:"Amount ()"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:nt.map((tt,ne)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 py-2 text-sm text-gray-900",children:L(tt.date)}),e.jsxs("td",{className:"px-3 py-2 text-sm text-gray-900",children:["",Number(tt.amount).toFixed(2)]})]},ne))})]})})]})]})]})}return null})(),u?e.jsx("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:e.jsx("p",{className:"text-gray-500",children:"Loading payments..."})}):k?e.jsxs("div",{className:"text-center py-8 bg-red-50 rounded-lg",children:[e.jsxs("p",{className:"text-red-600",children:["Error loading payments: ",k instanceof Error?k.message:String(k)]}),e.jsx("button",{onClick:()=>ae(),className:"mt-2 px-3 py-1 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Retry"})]}):(ot=ce==null?void 0:ce.data)!=null&&ot.payments&&Array.isArray(ce.data.payments)&&ce.data.payments.length>0?e.jsxs("div",{className:"space-y-4",children:[(()=>{var tt,ne,we,Ke;const I=ce.data.payments[0],E=(tt=I==null?void 0:I.enrollment)==null?void 0:tt.paymentPlan,f=(E==null?void 0:E.totalDeal)!==null&&(E==null?void 0:E.totalDeal)!==void 0?Number(E.totalDeal):null,Ee=(E==null?void 0:E.bookingAmount)!==null&&(E==null?void 0:E.bookingAmount)!==void 0?Number(E.bookingAmount):0,R=ce.data.payments.reduce((rt,ct)=>ct.status==="paid"||ct.status==="partial"?rt+(Number(ct.paidAmount)||0):rt,0),me=ce.data.payments.reduce((rt,ct)=>{const jt=Number(ct.amount)||0,Ft=Number(ct.paidAmount)||0;return rt+(jt-Ft)},0),Oe=(E==null?void 0:E.balanceAmount)!==null&&(E==null?void 0:E.balanceAmount)!==void 0?Number(E.balanceAmount):null,Ue=Oe!==null?Oe:f!=null?Math.max(0,f-Ee-R):null,ze=((ne=c==null?void 0:c.data)==null?void 0:ne.user)||o||null;let Ve=(we=ze==null?void 0:ze.studentProfile)==null?void 0:we.documents,nt=null;if(Ve){if(typeof Ve=="string")try{Ve=JSON.parse(Ve)}catch(rt){console.error("Error parsing documents:",rt),Ve=null}if(Ve&&typeof Ve=="object"){"enrollmentMetadata"in Ve?nt=Ve.enrollmentMetadata:(Ve.totalDeal!==void 0||Ve.bookingAmount!==void 0||Ve.lumpSumPayment!==void 0)&&(nt=Ve);const rt=(Ke=ze==null?void 0:ze.enrollments)==null?void 0:Ke[0];if(rt!=null&&rt.paymentPlan&&!nt){const ct=rt.paymentPlan;nt={totalDeal:ct.totalDeal,bookingAmount:ct.bookingAmount,balanceAmount:ct.balanceAmount,emiPlan:ct.emiPlan,emiPlanDate:ct.emiPlanDate,emiInstallments:ct.emiInstallments}}}}const dt=nt==null?void 0:nt.lumpSumPayment;return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 p-4 bg-gray-50 rounded-lg",children:[f!=null&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Total Deal Amount"}),e.jsxs("p",{className:"text-lg font-semibold text-blue-600",children:["",f.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Total Payments"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:ce.data.payments.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Total Paid"}),e.jsxs("p",{className:"text-lg font-semibold text-green-600",children:["",R.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Payment Pending"}),e.jsxs("p",{className:"text-lg font-semibold text-orange-600",children:["",me.toFixed(2)]})]}),Ue!==null&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Balance Pending"}),e.jsxs("p",{className:"text-lg font-semibold text-red-600",children:["",Ue.toFixed(2)]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:f!==null&&Ee>0?"Total Deal: "+f.toFixed(2)+" | Booking: "+Ee.toFixed(2)+" | Paid: "+R.toFixed(2):f!==null?"Total Deal: "+f.toFixed(2)+" | Paid: "+R.toFixed(2):""})]}),dt&&e.jsx("div",{className:"md:col-span-5",children:e.jsx("div",{className:"mt-2 p-2 bg-green-100 border border-green-300 rounded",children:e.jsx("p",{className:"text-sm font-semibold text-green-800",children:"Payment Type: Lump Sum Payment"})})})]})})(),e.jsx("div",{className:"space-y-3",children:ce.data.payments.map(I=>{const E=Number(I.amount)||0,f=Number(I.paidAmount)||0,Ee=E-f;return e.jsx(ml,{payment:I,amount:E,paidAmount:f,pending:Ee,refetchPayments:ae},I.id)})}),(()=>{var Oe,Ue,ze;const I=((Oe=c==null?void 0:c.data)==null?void 0:Oe.user)||o||null;let E=(Ue=I==null?void 0:I.studentProfile)==null?void 0:Ue.documents,f=null;if(E){if(typeof E=="string")try{E=JSON.parse(E)}catch(Ve){console.error("Error parsing documents:",Ve),E=null}if(E&&typeof E=="object"){"enrollmentMetadata"in E?f=E.enrollmentMetadata:(E.totalDeal!==void 0||E.bookingAmount!==void 0||E.lumpSumPayment!==void 0)&&(f=E);const Ve=(ze=I==null?void 0:I.enrollments)==null?void 0:ze[0];if(Ve!=null&&Ve.paymentPlan&&!f){const nt=Ve.paymentPlan;f={totalDeal:nt.totalDeal,bookingAmount:nt.bookingAmount,balanceAmount:nt.balanceAmount,emiPlan:nt.emiPlan,emiPlanDate:nt.emiPlanDate,emiInstallments:nt.emiInstallments}}}}const Ee=f==null?void 0:f.lumpSumPayment,R=(f==null?void 0:f.lumpSumPayments)||[],me=ce.data.payments.some(Ve=>Ve.notes&&Ve.notes.toLowerCase().includes("lump sum"));return Ee&&!me&&R.length>0?e.jsxs("div",{className:"mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Additional Lump Sum Payment Information"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 border border-gray-300",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-700 uppercase",children:"Date"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-700 uppercase",children:"Amount ()"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-700 uppercase",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:R.map((Ve,nt)=>{const dt=ce.data.payments.some(tt=>tt.dueDate===Ve.date||tt.notes&&tt.notes.includes(Ve.date)||Math.abs(Number(tt.amount)-Number(Ve.amount))<.01);return e.jsxs("tr",{className:dt?"":"bg-yellow-100",children:[e.jsx("td",{className:"px-3 py-2 text-sm text-gray-900",children:L(Ve.date)}),e.jsxs("td",{className:"px-3 py-2 text-sm text-gray-900",children:["",Number(Ve.amount).toFixed(2)]}),e.jsx("td",{className:"px-3 py-2 text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${dt?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:dt?"Recorded":"Expected"})})]},nt)})})]})}),e.jsx("p",{className:"mt-2 text-xs text-gray-600",children:"Note: These are expected lump sum payments that may not be recorded as individual transactions yet."})]}):null})(),ce.data.payments.some(I=>I.notes)&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Payment Notes"}),e.jsx("div",{className:"space-y-2",children:ce.data.payments.filter(I=>I.notes).map(I=>e.jsxs("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded-md",children:[e.jsxs("p",{className:"text-xs text-gray-500 mb-1",children:["Payment #",I.id," - ",I.paidDate?L(I.paidDate):I.dueDate?L(I.dueDate):"N/A"]}),e.jsx("p",{className:"text-sm text-gray-900",children:I.notes})]},I.id))})]})]}):e.jsx("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:e.jsx("p",{className:"text-gray-500",children:"No payment records found for this student."})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 border-b pb-2",children:"Software Progress"}),Ce||!c?e.jsx("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:e.jsx("p",{className:"text-gray-500",children:"Loading software progress..."})}):Ze?e.jsxs("div",{className:"text-center py-8 bg-yellow-50 rounded-lg border border-yellow-200",children:[e.jsx("p",{className:"text-yellow-700",children:"Error loading software progress. Please try again."}),e.jsx("p",{className:"text-xs text-yellow-600 mt-2",children:(Ze==null?void 0:Ze.message)||"Unknown error"})]}):Xe&&Xe.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Software"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Course"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Batch"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Start Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"End Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Faculty"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Xe.map((I,E)=>{var f;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900",children:I.softwareName}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsx("span",{className:"px-2 py-1 rounded text-xs font-semibold "+(I.status==="Finished"?"bg-green-100 text-green-800":I.status==="IP"?"bg-blue-100 text-blue-800":I.status==="NO"?"bg-gray-100 text-gray-800":"bg-yellow-100 text-yellow-800"),children:I.status==="Finished"?"Completed":I.status==="IP"?"In Progress":I.status==="NO"?"Not Applicable":"Not Started"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:I.courseName||"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:(f=I.batch)!=null&&f.title||I.batchId?"Batch "+(I.batchId||""):"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:I.batchStartDate?L(I.batchStartDate):"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:I.batchEndDate?L(I.batchEndDate):"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:I.facultyName||"-"})]},I.id||"software-"+E)})})]})}):e.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-gray-500",children:"No software found for this student."}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"Software can be added to the student profile or through enrollments."})]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 border-b pb-2",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Name"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900 font-medium",children:(o==null?void 0:o.name)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(o==null?void 0:o.email)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Phone"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(o==null?void 0:o.phone)||"-"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 border-b pb-2",children:"Profile Details"}),e.jsx("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:e.jsx("p",{className:"text-gray-500",children:"Unable to load student profile information."})})]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:()=>{q(!1),de(null)},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Close"})})]})}),K&&o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-md w-full",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-red-600",children:"Delete Student"}),e.jsxs("p",{className:"mb-4 text-gray-700",children:["Are you sure you want to delete ",e.jsx("strong",{children:o.name}),"? This action cannot be undone."]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:he,disabled:O.isPending,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition-colors disabled:opacity-50",children:O.isPending?"Deleting...":"Delete"}),e.jsx("button",{onClick:()=>{re(!1),de(null)},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})}),T&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Import Students (Unified)"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Import student enrollment data and software progress in one Excel file."}),Ae?e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"p-4 rounded-lg mb-4 "+(Ae.failed===0?"bg-green-50 border border-green-200":"bg-yellow-50 border border-yellow-200"),children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Import Results:"}),e.jsxs("p",{className:"text-green-700 font-medium",children:[" Successfully imported: ",Ae.success," student(s)"]}),Ae.failed>0&&e.jsxs("p",{className:"text-red-700 font-medium mt-1",children:[" Failed: ",Ae.failed," student(s)"]})]}),Ae.errors.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-semibold text-red-700 mb-2",children:"Errors:"}),e.jsx("div",{className:"max-h-40 overflow-y-auto border border-red-200 rounded p-3 bg-red-50",children:Ae.errors.map((I,E)=>e.jsxs("div",{className:"text-sm text-red-700 mb-1",children:["Row ",I.row,": ",I.error]},E))})]}),e.jsx("button",{onClick:()=>{b(!1),Me(null)},className:"w-full px-4 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors",children:"Close"})]}):e.jsxs("form",{onSubmit:Fe,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Excel File (.xlsx, .xls, or .csv)"}),e.jsx("input",{type:"file",name:"file",accept:".xlsx,.xls,.csv,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel,text/csv",required:!0,disabled:J,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 disabled:opacity-50"}),e.jsx("p",{className:"mt-2 text-xs text-gray-600",children:"Maximum file size: 10MB. Download the template to see the required format."})]}),e.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Note:"})," This unified import handles both student enrollment and software progress. Download the template to see all available fields. Required fields: phone or email, studentName."]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:J,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors disabled:opacity-50",children:J?"Importing...":"Import Students"}),e.jsx("button",{type:"button",onClick:()=>{b(!1),Me(null)},disabled:J,className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors disabled:opacity-50",children:"Cancel"})]})]})]})}),w&&pe&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Student Orientation"}),e.jsx("button",{onClick:()=>{$(!1),Pe(null),Y("english")},className:"text-gray-400 hover:text-gray-600",children:""})]}),e.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"border-b border-gray-200 flex",children:[e.jsx("button",{onClick:()=>Y("english"),className:"px-6 py-3 font-medium text-sm "+(te==="english"?"text-orange-600 border-b-2 border-orange-600":"text-gray-600 hover:text-gray-900"),children:"English"}),e.jsx("button",{onClick:()=>Y("gujarati"),className:`px-6 py-3 font-medium text-sm ${te==="gujarati"?"text-orange-600 border-b-2 border-orange-600":"text-gray-600 hover:text-gray-900"}`,children:"Gujarati"})]}),e.jsx("div",{className:"flex-1 overflow-auto p-6 bg-white",children:te==="english"?e.jsxs("div",{className:"max-w-4xl mx-auto prose prose-sm",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Student Orientation"}),e.jsx("p",{className:"text-sm text-gray-600",children:"601 Gala Empire, Opp. Doordarshan metro station, Drive-In Road, Ahmedabad 380052"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Helpdesk: 9033222499 | Technical Help: 9825308959"})]}),e.jsxs("div",{className:"space-y-6 text-gray-800",children:[e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Coaching & Practice"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-3 ml-4",children:[e.jsx("li",{className:"mb-3",children:e.jsx("strong",{children:"3 days classroom coaching and 3 days lab practice is mandatory for every student"})}),e.jsx("li",{className:"mb-3",children:"The batch timing may change with new software"}),e.jsxs("li",{className:"mb-3",children:["If you have given commitment for special batch timing, plz do mention here",e.jsx("div",{className:"border-b-2 border-gray-400 mt-2 mb-2 w-64"})]}),e.jsxs("li",{className:"mb-3",children:["The software practice is necessary in lab to complete assignments, for any reason if you are unable to come for practice at lab then mention here",e.jsx("div",{className:"border-b-2 border-gray-400 mt-2 mb-2 w-64"})]}),e.jsxs("li",{className:"mb-3",children:["For any course, the ratio for coaching and practice is ",e.jsx("strong",{children:"1:2"}),", it means every classroom lecture you will have to make ",e.jsx("strong",{children:"2 hours minimum practice"})," and hence ",e.jsx("strong",{children:"minimum 25 hours practice is compulsory at lab"}),". For the best career ",e.jsx("strong",{children:"monthly 50 hours practice is highly recommended"}),"."]}),e.jsxs("li",{className:"mb-3",children:["Student may bring their own laptop is desirable and if he/she couldn't arrange laptop then he/she may book the practice slot accordingly. Practice lab is open ",e.jsx("strong",{children:"9:00 am to 7:00 pm from Monday to Saturday"}),". Faculty will guide during practice as per their availability"]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Portfolio & Placement"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-3 ml-4",start:7,children:[e.jsx("li",{className:"mb-3",children:"During the study of software, the faculty will guide for portfolio (assignments) and such assignment will have to get approved by faculty at end of each software."}),e.jsxs("li",{className:"mb-3",children:["The placement call will sole depend on the portfolio work and practice hours. ",e.jsx("strong",{children:"The student without approved portfolio is not eligible for placement"})]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Fees payment & monthly EMIs"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-3 ml-4",start:9,children:[e.jsxs("li",{className:"mb-3",children:["The student who enrolled on EMI payment term has to deposits all PDCs (postdated cheques) and such cheques will be deposited in bank latest by ",e.jsx("strong",{children:"10th of every month"})," OR he has to pay monthly EMI between ",e.jsx("strong",{children:"1st to 10th day of every month"}),". Any payment after 10th day will be liable to late payment charges ",e.jsx("strong",{children:"Rs. 50/- per day"}),". Student will get GST paid receipt from A/C dept between ",e.jsx("strong",{children:"15th to 20th day of every month"}),". If any student get any exemption in payment date, plz mention here",e.jsx("div",{className:"border-b-2 border-gray-400 mt-2 mb-2 w-64"}),". All fees payment are including GST and non-refundable"]}),e.jsx("li",{className:"mb-3",children:"Each course and its payment is non-transferable. No course can be down-graded in value or duration but it can be up-graded to bigger course value/duration. Any up gradation is subject to approval and for that student needs to pay difference amount in advance"}),e.jsx("li",{className:"mb-3",children:"The course progress will sole depend on the grasping ability of student, leaves, absenteeism and circumstances and it is no way related to payment made for the course. The payment made is no way connected and co-related with the course completion which please be noted"}),e.jsxs("li",{className:"mb-3",children:["Cheques bounce charges ",e.jsx("strong",{children:"Rs. 350/-"})]}),e.jsxs("li",{className:"mb-3",children:["After the completion of 6 month only, if any student is not able to pay fees for any month then he has to pay ",e.jsx("strong",{children:"Rs. 1200/- as penalty"})," and it is not part of total payment. Student can be considered as dropped out in system in case of fail to payment and study will be paused till clearance of all due with activation charge"]}),e.jsx("li",{className:"mb-3",children:"Student will have to pay their monthly EMI during the long leave for whatever reason."})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Student Orientation"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-3 ml-4",start:15,children:[e.jsx("li",{className:"mb-3",children:"Student will get backup for the lectures/study he/she missed during the approved leaves and there is no backup for leave without approval."}),e.jsx("li",{className:"mb-3",children:"If any student face any difficulty in understanding of any software then on special recommendation of faculty the entire software will get repeated without any extra cost"}),e.jsxs("li",{className:"mb-3",children:["Once you enrolled with us you are our lifetime member and as privilege you may visit us for any technical assistance or job placement in future and all such services are ",e.jsx("strong",{children:"FREE FOREVER"})]})]})]}),e.jsxs("section",{className:"mt-8 p-4 bg-gray-50 rounded border border-gray-200",children:[e.jsx("p",{className:"mb-4 text-sm",children:"If you have given any special commitment by counselor then do mention here/ or leave blank"}),e.jsx("div",{className:"border-b-2 border-gray-400 mb-2"}),e.jsx("div",{className:"border-b-2 border-gray-400 mb-2"}),e.jsx("div",{className:"border-b-2 border-gray-400 mb-4"})]}),e.jsxs("section",{className:"mt-8 space-y-4",children:[e.jsxs("div",{className:"flex gap-8",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"mb-2",children:e.jsx("strong",{children:"Student Name:"})}),e.jsx("div",{className:"border-b-2 border-gray-400 mb-4"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"mb-2",children:e.jsx("strong",{children:"Course:"})}),e.jsx("div",{className:"border-b-2 border-gray-400 mb-4"})]})]}),e.jsx("p",{className:"mt-6 mb-4",children:"I, hereby confirm that I got detailed understanding for all above rule & regulation of institute and I assure to follow the same."}),e.jsxs("div",{className:"mt-8",children:[e.jsx("p",{className:"mb-2",children:e.jsx("strong",{children:"Student Sign / Date"})}),e.jsx("div",{className:"border-b-2 border-gray-400 w-48"})]})]})]})]}):e.jsxs("div",{className:"max-w-4xl mx-auto prose prose-sm",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:" "}),e.jsx("p",{className:"text-sm text-gray-600",children:"401, Shilp Square B, Opp. Sales India, Drive-In Road, Ahmedabad 380052"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Helpdesk: 9033222499 | Technical Help: 9825308959"})]}),e.jsxs("div",{className:"space-y-6 text-gray-800",children:[e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Coaching & Practice"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-3 ml-4",children:[e.jsx("li",{className:"mb-3",children:e.jsx("strong",{children:"                  ."})}),e.jsx("li",{className:"mb-3",children:"        ."}),e.jsxs("li",{className:"mb-3",children:["              .",e.jsx("div",{className:"border-b-2 border-gray-400 mt-2 mb-2 w-64"})]}),e.jsxs("li",{className:"mb-3",children:["      .                 ",e.jsx("div",{className:"border-b-2 border-gray-400 mt-2 mb-2 w-64"})]}),e.jsxs("li",{className:"mb-3",children:["   ",e.jsx("strong",{children:":     "}),".     ",e.jsx("strong",{children:"      "}),".      ",e.jsx("strong",{children:"25     "}),".        ",e.jsx("strong",{children:"     "}),"."]}),e.jsxs("li",{className:"mb-3",children:["             .          .    .      ",e.jsx("strong",{children:"     "}),".             ."]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Portfolio & Placement"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-3 ml-4",start:7,children:[e.jsx("li",{className:"mb-3",children:"            ok   .                 ."}),e.jsx("li",{className:"mb-3",children:e.jsx("strong",{children:"                 ."})})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Fees Payment & Monthly EMIs"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-3 ml-4",start:9,children:[e.jsxs("li",{className:"mb-3",children:["      EMI          ",e.jsx("strong",{children:"            "}),"   PDC     Institute  ",e.jsx("strong",{children:"     "}),".   ",e.jsx("strong",{children:"Rs 50/-       "}),"    .      .                    ",e.jsx("div",{className:"border-b-2 border-gray-400 mt-2 mb-2 w-64"}),"      .",e.jsx("br",{}),"       GST       GST   receipt PDF copy  ",e.jsx("strong",{children:"      "}),".           ."]}),e.jsx("li",{className:"mb-3",children:"         .                         /                        ."}),e.jsx("li",{className:"mb-3",children:"         /  /           EMI     .   EMI                       EMI           ."}),e.jsxs("li",{className:"mb-3",children:["                  ",e.jsx("strong",{children:"Rs /-  "}),"."]}),e.jsxs("li",{className:"mb-3",children:["           ",e.jsx("strong",{children:"Rs /-     "}),"       ",e.jsx("strong",{children:"      "}),".              .           EMI          .          ."]}),e.jsx("li",{className:"mb-3",children:"          EMI    .         ."})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Technical Help"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-3 ml-4",start:15,children:[e.jsx("li",{className:"mb-3",children:"                            ."}),e.jsx("li",{className:"mb-3",children:"                                        ."}),e.jsxs("li",{className:"mb-3",children:["    ",e.jsx("strong",{children:"Lifetime     Technical      institute    "}),".      ",e.jsx("strong",{children:"  "}),"."]})]})]}),e.jsxs("section",{className:"mt-8 p-4 bg-gray-50 rounded border border-gray-200",children:[e.jsx("p",{className:"mb-4 text-sm",children:"                    ."}),e.jsx("div",{className:"border-b-2 border-gray-400 mb-2"}),e.jsx("div",{className:"border-b-2 border-gray-400 mb-2"}),e.jsx("div",{className:"border-b-2 border-gray-400 mb-4"})]}),e.jsxs("section",{className:"mt-8 space-y-4",children:[e.jsxs("div",{className:"flex gap-8",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"mb-2",children:e.jsx("strong",{children:":"})}),e.jsx("div",{className:"border-b-2 border-gray-400 mb-4"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"mb-2",children:e.jsx("strong",{children:"   :"})}),e.jsx("div",{className:"border-b-2 border-gray-400 mb-4"})]})]}),e.jsx("p",{className:"mt-6 mb-4",children:"                ."}),e.jsxs("div",{className:"mt-8",children:[e.jsx("p",{className:"mb-2",children:e.jsx("strong",{children:"   / "})}),e.jsx("div",{className:"border-b-2 border-gray-400 w-48"})]})]})]})]})}),e.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-white",children:(()=>{const I=ve[pe],E=(I==null?void 0:I.english)||!1,f=(I==null?void 0:I.gujarati)||!1,Ee=te==="english"?E:f,R=(I==null?void 0:I.isEligible)||!1;return e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{children:R?e.jsx("span",{className:"text-green-600 font-semibold",children:" Student is eligible (Orientation accepted)"}):e.jsx("span",{className:"text-yellow-600 font-semibold",children:" Pending approval - Please accept orientation"})}),e.jsx("button",{onClick:()=>{Ee?alert("This orientation has already been accepted."):Q.mutate({studentId:pe,language:te==="english"?Js.ENGLISH:Js.GUJARATI})},disabled:Ee||Q.isPending,className:`px-6 py-2 rounded-lg font-semibold transition-colors ${Ee?"bg-gray-300 text-gray-600 cursor-not-allowed":Q.isPending?"bg-orange-400 text-white cursor-wait":"bg-orange-600 text-white hover:bg-orange-700"}`,children:Ee?" Accepted":Q.isPending?"Processing...":"I Agree"})]})})()})]})]})})]})},Qt={getAllEmployees:async()=>(await Re.get("/users",{params:{role:"employee",isActive:!0}})).data,getEmployeeProfile:async t=>(await Re.get(`/employees/${t}`)).data,createEmployeeProfile:async t=>(await Re.post("/employees",t)).data,updateEmployeeProfile:async(t,s)=>(await Re.put(`/users/${t}/employee-profile`,s)).data},zt=["Photoshop","Illustrator","InDesign","After Effects","Premiere Pro","Figma","Sketch","Blender","Maya","3ds Max","Cinema 4D","Lightroom","CorelDRAW","AutoCAD","SolidWorks","Revit","SketchUp","Unity","Unreal Engine","DaVinci Resolve","Final Cut Pro","Procreate","Affinity Designer","Affinity Photo","Canva Pro","Indesign","Premiere","Audition","3ds Max (AR)","V-ray","Lumion","Autocad"],gl=()=>{var we,Ke,rt,ct,jt,Ft,$t,is,ds,cs;const t=Et(),s=vt(),{user:a}=Nt(),r=(a==null?void 0:a.role)==="admin"||(a==null?void 0:a.role)==="superadmin",[n,i]=g.useState(1),h=4,[m,j]=g.useState(!1),[C,q]=g.useState(""),[K,re]=g.useState([]),[T,b]=g.useState([]),[w,$]=g.useState([]),[pe,Pe]=g.useState(zt),[te,Y]=g.useState([]),[o,de]=g.useState({emiInstallments:[],schedule:[],totalDuration:null,startDate:"",endDate:""}),[N,S]=g.useState(""),[x,Z]=g.useState(""),[J,Ie]=g.useState(""),[Ae,Me]=g.useState(""),[W,Ne]=g.useState(""),[V,Qe]=g.useState(""),[ve,p]=g.useState({}),[M,P]=g.useState(new Set),[H,U]=g.useState(new Set),[ce,ae]=g.useState("+91"),[u,k]=g.useState(!1),[c]=g.useState([]),[D,se]=g.useState(null),[ge,G]=g.useState(null),[Ce,Ze]=g.useState(null),[Xe,Be]=g.useState([]),[Q,l]=g.useState(!1),[O,X]=g.useState(!1),[fe,Fe]=g.useState(!1),[je,v]=g.useState(!1),[_,ue]=g.useState({});g.useEffect(()=>{o.lumpSumPayment&&!o.lumpSumPayments&&de(y=>({...y,lumpSumPayments:[]}))},[o.lumpSumPayment]);const[A,L]=g.useState(!1),[z,oe]=g.useState(null),[le,xe]=g.useState(""),[he,B]=g.useState(["Walk-in","Online","Reference","Social Media","Advertisement","Other"]),ye=g.useRef(null);g.useEffect(()=>{ye.current&&(ye.current.scrollTop=0)},[n]);const De=[{code:"+91",country:"India",flag:""},{code:"+1",country:"USA/Canada",flag:""},{code:"+44",country:"UK",flag:""},{code:"+971",country:"UAE",flag:""},{code:"+974",country:"Qatar",flag:""},{code:"+966",country:"Saudi Arabia",flag:""},{code:"+65",country:"Singapore",flag:""},{code:"+60",country:"Malaysia",flag:""},{code:"+61",country:"Australia",flag:""},{code:"+27",country:"South Africa",flag:""},{code:"+92",country:"Pakistan",flag:""},{code:"+880",country:"Bangladesh",flag:""},{code:"+94",country:"Sri Lanka",flag:""},{code:"+977",country:"Nepal",flag:""},{code:"+86",country:"China",flag:""},{code:"+81",country:"Japan",flag:""},{code:"+82",country:"South Korea",flag:""},{code:"+33",country:"France",flag:""},{code:"+49",country:"Germany",flag:""},{code:"+39",country:"Italy",flag:""},{code:"+34",country:"Spain",flag:""},{code:"+7",country:"Russia",flag:""}];g.useEffect(()=>{if(o.totalDeal!==void 0&&o.totalDeal!==null&&o.bookingAmount!==void 0&&o.bookingAmount!==null){const y=Number(o.totalDeal)||0,ee=Number(o.bookingAmount)||0,We=Math.max(0,y-ee);de(Le=>Le.balanceAmount!==We?{...Le,balanceAmount:We}:Le)}},[o.totalDeal,o.bookingAmount]),g.useEffect(()=>{if(o.emiPlan&&o.balanceAmount&&o.balanceAmount>0){const y=Number(o.balanceAmount),ee=10,We=y/ee,Le=[],Ge=Ae?new Date(Ae):new Date;for(let F=1;F<=ee;F++){const ie=new Date(Ge);ie.setMonth(ie.getMonth()+(F-1));const be=ie.toISOString().split("T")[0];Le.push({month:F,amount:Math.round(We*100)/100,dueDate:be})}const Ye=Le.reduce((F,ie)=>F+ie.amount,0);Ye!==y&&(Le[Le.length-1].amount=Math.round((y-(Ye-Le[Le.length-1].amount))*100)/100),de(F=>({...F,emiInstallments:Le}));const d={};Le.forEach((F,ie)=>{F.dueDate&&(d[ie]=Pt(F.dueDate))}),p(d)}else!o.emiPlan&&o.emiInstallments&&o.emiInstallments.length>0&&(de(y=>({...y,emiInstallments:[]})),p({}))},[o.emiPlan,o.balanceAmount,Ae]);const Se=(y,ee)=>{var We,Le;if(de(Ge=>({...Ge,[y]:ee})),y==="phone"&&u&&de(Ge=>({...Ge,whatsappNumber:ee})),y==="courseName"&&ee){const Ge=(We=R==null?void 0:R.data)==null?void 0:We.find(Ye=>Ye.name===ee);if(Ge!=null&&Ge.software&&Array.isArray(Ge.software)&&Ge.software.length>0){const Ye=Ge.software;re(Ye),j(!1),q("")}else re([])}else y==="courseName"&&!ee&&(Pe([...zt,...te]),j(!1),q(""));if(y==="courseName")if(ee){const Ge=(Le=R==null?void 0:R.data)==null?void 0:Le.find(Ye=>Ye.name===ee);if(Ge!=null&&Ge.software&&Array.isArray(Ge.software)&&Ge.software.length>0){const Ye=Ge.software;Pe([...new Set([...Ye,...zt,...te])])}else Pe([...zt,...te])}else Pe([...zt,...te]);_[y]&&ue(Ge=>{const Ye={...Ge};return delete Ye[y],Ye})},at=async y=>{var Le,Ge,Ye;const ee=(Le=y.target.files)==null?void 0:Le[0];if(!ee)return;if(!["image/jpeg","image/jpg","image/png","application/pdf"].includes(ee.type)){alert("Please select a valid file (JPG, PNG, or PDF)"),y.target.value="";return}l(!0);try{const d=await wt.uploadFile(ee);if(d.data&&d.data.files&&d.data.files.length>0){const F=d.data.files[0],ie=He(F.url)||F.url;se({name:F.originalName,url:ie,size:F.size}),alert("Photo uploaded successfully!")}else throw new Error("No file returned from upload")}catch(d){console.error("Photo upload error:",d),alert(((Ye=(Ge=d.response)==null?void 0:Ge.data)==null?void 0:Ye.message)||d.message||"Failed to upload photo")}finally{l(!1),y.target.value=""}},it=async y=>{var Le,Ge,Ye;const ee=(Le=y.target.files)==null?void 0:Le[0];if(!ee)return;if(!["image/jpeg","image/jpg","image/png","application/pdf"].includes(ee.type)){alert("Please select a valid file (JPG, PNG, or PDF)"),y.target.value="";return}X(!0);try{const d=await wt.uploadFile(ee);if(d.data&&d.data.files&&d.data.files.length>0){const F=d.data.files[0],ie=He(F.url)||F.url;G({name:F.originalName,url:ie,size:F.size}),alert("PAN Card uploaded successfully!")}else throw new Error("No file returned from upload")}catch(d){console.error("PAN Card upload error:",d),alert(((Ye=(Ge=d.response)==null?void 0:Ge.data)==null?void 0:Ye.message)||d.message||"Failed to upload PAN Card")}finally{X(!1),y.target.value=""}},ot=async y=>{var Le,Ge,Ye;const ee=(Le=y.target.files)==null?void 0:Le[0];if(!ee)return;if(!["image/jpeg","image/jpg","image/png","application/pdf"].includes(ee.type)){alert("Please select a valid file (JPG, PNG, or PDF)"),y.target.value="";return}Fe(!0);try{const d=await wt.uploadFile(ee);if(d.data&&d.data.files&&d.data.files.length>0){const F=d.data.files[0],ie=He(F.url)||F.url;Ze({name:F.originalName,url:ie,size:F.size}),alert("Aadhar Card uploaded successfully!")}else throw new Error("No file returned from upload")}catch(d){console.error("Aadhar Card upload error:",d),alert(((Ye=(Ge=d.response)==null?void 0:Ge.data)==null?void 0:Ye.message)||d.message||"Failed to upload Aadhar Card")}finally{Fe(!1),y.target.value=""}},I=async y=>{var Ye,d;const ee=y.target.files;if(!ee||ee.length===0)return;const We=["image/jpeg","image/jpg","image/png","application/pdf"],Le=Array.from(ee);if(Le.filter(F=>!We.includes(F.type)).length>0){alert("Please select only valid files (JPG, PNG, or PDF)"),y.target.value="";return}v(!0);try{const F=await wt.uploadMultipleFiles(Le);if(F.data&&F.data.files){const ie=F.data.files.map(be=>{const qe=He(be.url)||be.url;return{name:be.originalName,url:qe,size:be.size}});Be(be=>[...be,...ie]),alert(`${ie.length} document(s) uploaded successfully!`)}else throw new Error("No files returned from upload")}catch(F){console.error("Other documents upload error:",F),alert(((d=(Ye=F.response)==null?void 0:Ye.data)==null?void 0:d.message)||F.message||"Failed to upload documents")}finally{v(!1),y.target.value=""}},E=y=>{Be(ee=>ee.filter((We,Le)=>Le!==y))},{data:f}=_e({queryKey:["batches"],queryFn:()=>St.getAllBatches()}),{data:Ee}=_e({queryKey:["courseNames"],queryFn:()=>kt.getCourseNames()}),{data:R}=_e({queryKey:["courses"],queryFn:()=>Jt.getAllCourses()}),{data:me}=_e({queryKey:["employees"],queryFn:()=>Qt.getAllEmployees()}),{data:Oe}=_e({queryKey:["faculty"],queryFn:()=>Kt.getAllFaculty()}),Ue=st({mutationFn:y=>kt.completeEnrollment(y),onSuccess:()=>{s.invalidateQueries({queryKey:["students"]}),s.invalidateQueries({queryKey:["batches"]}),alert("Student enrolled successfully!"),t("/students")},onError:y=>{var Le,Ge;const ee=(Le=y.response)==null?void 0:Le.data,We=(Ge=y.response)==null?void 0:Ge.status;if(console.error("Enrollment error:",y),console.error("Error status:",We),console.error("Error response:",ee),console.error("Full error object:",JSON.stringify(y,null,2)),We===400&&(ee!=null&&ee.errors)&&Array.isArray(ee.errors)){const Ye=ee.errors,d=ee.message||"Validation failed",F=Ye.length>0?`

Please fix the following errors:
`+Ye.map((ie,be)=>be+1+". "+ie).join(`
`):"";alert(d+F);return}if(We===409){const Ye=(ee==null?void 0:ee.message)||y.message||"Failed to enroll student.",d=ee==null?void 0:ee.existingStudentId,F=(ee==null?void 0:ee.existingStudentName)||"the student";d?window.confirm(`${Ye}

Existing Student: ${F}
Would you like to edit this student's profile instead?`)&&t(`/students/${d}/edit`):alert(Ye)}else{const Ye=(ee==null?void 0:ee.message)||y.message||"Failed to enroll student. Please check all required fields.";alert(Ye)}}}),ze=(f==null?void 0:f.data)||[];g.useEffect(()=>{if(K.length>0){const y=new Date;y.setHours(0,0,0,0);const ee=ze.filter(We=>{const Le=new Date(We.startDate);if(Le.setHours(0,0,0,0),Le<y)return!1;if(We.software){const Ge=We.software.toLowerCase();return K.some(Ye=>Ge.includes(Ye.toLowerCase())||Ye.toLowerCase().includes(Ge))}return!1});$(ee)}else $([])},[K,ze]);const Ve=(y,ee)=>{ee?(re(We=>[...We,y]),pe.includes(y)||(Pe(We=>[...We,y]),!zt.includes(y)&&!te.includes(y)&&Y(We=>[...We,y]))):re(We=>We.filter(Le=>Le!==y))};g.useEffect(()=>{de(y=>({...y,complimentarySoftware:T.length?T.join(", "):""}))},[T]);const nt=()=>{const y={};if((!o.studentName||!o.studentName.trim())&&(y.studentName="Student Name is required"),!o.email||!o.email.trim()?y.email="Email is required":ka(o.email)||(y.email="Please enter a valid email address"),!o.phone||!o.phone.trim()?y.phone="Phone number is required":ts(o.phone)||(y.phone="Please enter a valid 10-digit phone number"),!o.whatsappNumber||!o.whatsappNumber.trim())y.whatsappNumber="WhatsApp number is required";else if(ce==="+91")ts(o.whatsappNumber)||(y.whatsappNumber="Please enter a valid 10-digit WhatsApp number");else{const ee=o.whatsappNumber.replace(/\D/g,"");(ee.length<7||ee.length>15)&&(y.whatsappNumber="Please enter a valid phone number")}if((!x||!x.trim())&&(y.dateOfAdmission="Date of Admission is required"),(!o.localAddress||!o.localAddress.trim())&&(y.localAddress="Local Address is required"),(!o.permanentAddress||!o.permanentAddress.trim())&&(y.permanentAddress="Permanent Address is required"),!o.emergencyContactNumber||!o.emergencyContactNumber.trim()?y.emergencyContactNumber="Emergency Contact Number is required":ts(o.emergencyContactNumber)||(y.emergencyContactNumber="Please enter a valid 10-digit phone number"),(!o.emergencyName||!o.emergencyName.trim())&&(y.emergencyName="Emergency Contact Name is required"),(!o.emergencyRelation||!o.emergencyRelation.trim())&&(y.emergencyRelation="Emergency Contact Relation is required"),K.length===0&&!C.trim()&&(y.softwaresIncluded="At least one software must be selected"),(!o.totalDeal||o.totalDeal<=0)&&(y.totalDeal="Total Deal Amount is required and must be greater than 0"),(!o.bookingAmount||o.bookingAmount<0)&&(y.bookingAmount="Booking Amount is required"),o.totalDeal&&o.bookingAmount&&o.bookingAmount>o.totalDeal&&(y.bookingAmount="Booking Amount cannot be greater than Total Deal Amount"),o.emiPlan&&o.lumpSumPayment&&(y.emiPlan="Cannot select both EMI Plan and Lump Sum Payment",y.lumpSumPayment="Cannot select both EMI Plan and Lump Sum Payment"),o.lumpSumPayment&&o.lumpSumPayments&&o.lumpSumPayments.length>0&&o.lumpSumPayments.forEach((ee,We)=>{if(!ee.date)y[`lumpSumPaymentDate-${We}`]=`Lump Sum Payment ${We+1} date is required`;else if(!/^\d{4}-\d{2}-\d{2}$/.test(ee.date))y[`lumpSumPaymentDate-${We}`]=`Lump Sum Payment ${We+1} date format is invalid`;else{const Ge=new Date(ee.date),Ye=new Date;Ye.setHours(0,0,0,0),Ge<Ye&&(y[`lumpSumPaymentDate-${We}`]=`Lump Sum Payment ${We+1} date cannot be in the past`)}(!ee.amount||ee.amount<=0)&&(y[`lumpSumPaymentAmount-${We}`]=`Lump Sum Payment ${We+1} amount is required and must be greater than 0`)}),o.emiPlan&&((!Ae||!Ae.trim())&&(y.emiPlanDate="EMI Plan Date is required when EMI Plan is selected"),o.emiInstallments&&o.emiInstallments.length>0)){const ee=o.emiInstallments.reduce((Le,Ge)=>Le+(Ge.amount||0),0),We=o.balanceAmount||0;ee>We&&(y.emiInstallments=`Total EMI amount (${ee.toFixed(2)}) cannot exceed Balance Amount (${We.toFixed(2)})`),o.emiInstallments.forEach((Le,Ge)=>{if((!Le.amount||Le.amount<=0)&&(y[`emiInstallment_${Ge}_amount`]="Installment amount is required"),Le.dueDate){const Ye=ve[Ge];Ye&&!rr(Ye)&&(y[`emiInstallment_${Ge}_dueDate`]="Please enter a valid date in DD/MM/YYYY format")}})}if((!o.counselorName||!o.counselorName.trim())&&(y.counselorName="Employee Name is required"),(!o.leadSource||!o.leadSource.trim())&&(y.leadSource="Lead Source is required"),o.leadSource==="Walk-in"&&(!V||!V.trim())){const We=new Date().toISOString().split("T")[0];Qe(We);const Le=Pt(We);Ne(Le)}return(!o.masterFaculty||!o.masterFaculty.trim())&&(y.masterFaculty="Faculty is required"),ue(y),Object.keys(y).length===0},dt=y=>{var ie,be,qe,Je,ke;if(!o.totalDeal||o.totalDeal<=0){i(3),ue({totalDeal:"Total Deal Amount is required and must be greater than 0. Student registration cannot proceed without a deal amount."}),alert("Total Deal Amount is required. Please enter a valid deal amount to proceed with student registration.");return}if(!nt()){let $e=1;_.softwaresIncluded||_.totalDeal||_.bookingAmount?$e=3:_.localAddress||_.permanentAddress||_.emergencyContactNumber?$e=2:(_.counselorName||_.leadSource||_.masterFaculty)&&($e=4),i($e),alert("Please fill all required fields correctly");return}let ee=[...K];if(m&&C.trim()){const $e=C.split(",").map(xt=>xt.trim()).filter(xt=>xt.length>0);ee=[...ee,...$e]}ee=[...new Set(ee.filter($e=>$e&&$e.trim().length>0))];const We=ee.length>0?ee.join(", "):"";console.log("Selected software list:",ee),console.log("Formatted software string:",We);const Le=x,Ge=Ae||void 0,Ye=V||void 0,d=(ie=o.emiInstallments)==null?void 0:ie.map(($e,xt)=>({...$e,dueDate:ve[xt]?ar(ve[xt]):void 0})),F={studentName:o.studentName.trim(),email:o.email.trim(),phone:o.phone.trim(),whatsappNumber:(be=o.whatsappNumber)!=null&&be.trim()?`${ce}${o.whatsappNumber.trim()}`:void 0,dateOfAdmission:Le,localAddress:o.localAddress.trim(),permanentAddress:o.permanentAddress.trim(),emergencyContactNumber:o.emergencyContactNumber.trim(),emergencyName:o.emergencyName.trim(),emergencyRelation:o.emergencyRelation.trim(),courseName:o.courseName.trim(),batchId:o.batchId||void 0,softwaresIncluded:We||void 0,totalDeal:o.totalDeal,bookingAmount:o.bookingAmount,balanceAmount:o.balanceAmount||void 0,emiPlan:o.emiPlan||!1,emiPlanDate:Ge,emiInstallments:d,lumpSumPayment:o.lumpSumPayment||!1,nextPayDate:o.nextPayDate||void 0,lumpSumPayments:o.lumpSumPayments||void 0,complimentarySoftware:((qe=o.complimentarySoftware)==null?void 0:qe.trim())||void 0,complimentaryGift:((Je=o.complimentaryGift)==null?void 0:Je.trim())||void 0,hasReference:o.hasReference||!1,referenceDetails:((ke=o.referenceDetails)==null?void 0:ke.trim())||void 0,counselorName:o.counselorName.trim(),leadSource:o.leadSource,walkinDate:Ye,masterFaculty:o.masterFaculty.trim(),enrollmentDocuments:[...D?[D.url]:[],...ge?[ge.url]:[],...Ce?[Ce.url]:[],...Xe.map($e=>$e.url),...c.map($e=>$e.url)].length>0?[...D?[D.url]:[],...ge?[ge.url]:[],...Ce?[Ce.url]:[],...Xe.map($e=>$e.url),...c.map($e=>$e.url)]:void 0};console.log("Submitting enrollment data:",F),Ue.mutate(F)},tt=async()=>{const y={};if(n===1){if((!o.studentName||!o.studentName.trim())&&(y.studentName="Student Name is required"),!o.email||!o.email.trim()?y.email="Email is required":ka(o.email)||(y.email="Please enter a valid email address"),!o.phone||!o.phone.trim()?y.phone="Phone number is required":ts(o.phone)||(y.phone="Please enter a valid 10-digit phone number"),o.whatsappNumber&&o.whatsappNumber.trim())if(ce==="+91")ts(o.whatsappNumber)||(y.whatsappNumber="Please enter a valid 10-digit WhatsApp number");else{const ee=o.whatsappNumber.replace(/\D/g,"");(ee.length<7||ee.length>15)&&(y.whatsappNumber="Please enter a valid phone number")}if((!x||!x.trim())&&(y.dateOfAdmission="Date of Admission is required"),Object.keys(y).length===0)try{const ee=await kt.checkDuplicate(o.email,o.phone);if(ee.data.exists){const We=ee.data.type,Le=ee.data.studentName,Ge=`A student with this ${We} already exists: ${Le}. Please correct the ${We} before proceeding.`;alert(Ge);return}}catch(ee){console.error("Error checking for duplicates:",ee)}}else n===2?((!o.localAddress||!o.localAddress.trim())&&(y.localAddress="Local Address is required"),(!o.permanentAddress||!o.permanentAddress.trim())&&(y.permanentAddress="Permanent Address is required"),!o.emergencyContactNumber||!o.emergencyContactNumber.trim()?y.emergencyContactNumber="Emergency Contact Number is required":ts(o.emergencyContactNumber)||(y.emergencyContactNumber="Please enter a valid 10-digit phone number"),(!o.emergencyName||!o.emergencyName.trim())&&(y.emergencyName="Emergency Contact Name is required"),(!o.emergencyRelation||!o.emergencyRelation.trim())&&(y.emergencyRelation="Emergency Contact Relation is required")):n===3&&(K.length===0&&!C.trim()&&(y.softwaresIncluded="At least one software must be selected"),(!o.totalDeal||o.totalDeal<=0)&&(y.totalDeal="Total Deal Amount is required and must be greater than 0"),(!o.bookingAmount||o.bookingAmount<0)&&(y.bookingAmount="Booking Amount is required"),o.totalDeal&&o.bookingAmount&&(o.bookingAmount>o.totalDeal&&(y.bookingAmount="Booking Amount cannot be greater than Total Deal Amount"),o.totalDeal-o.bookingAmount<0&&(y.balanceAmount="Balance cannot be negative")),o.emiPlan&&(!Ae||!Ae.trim())&&(y.emiPlanDate="EMI Plan Date is required when EMI Plan is selected"));if(Object.keys(y).length>0){ue(y),alert("Please fill all required fields correctly before proceeding");return}n<h&&i(n+1)},ne=()=>{n>1&&i(n-1)};return e.jsx(et,{children:e.jsx("div",{className:"max-w-4xl mx-auto p-4 md:p-6",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-orange-600 to-orange-500 px-4 md:px-8 py-4 md:py-6",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-white",children:"Student Enrollment Form"}),e.jsx("p",{className:"mt-2 text-sm md:text-base text-orange-100",children:"Complete student registration and enrollment"})]}),e.jsx("div",{className:"px-4 md:px-8 py-4 bg-gray-50 border-b",children:e.jsx("div",{className:"flex items-center justify-between overflow-x-auto",children:[1,2,3,4].map(y=>e.jsxs(At.Fragment,{children:[e.jsxs("div",{className:"flex items-center min-w-0 flex-shrink-0",children:[e.jsx("div",{className:`w-8 h-8 md:w-10 md:h-10 rounded-full flex items-center justify-center font-semibold text-sm md:text-base ${n>=y?"bg-orange-600 text-white":"bg-gray-300 text-gray-600"}`,children:y}),e.jsxs("span",{className:`ml-2 text-xs md:text-sm font-medium hidden sm:inline ${n>=y?"text-orange-600":"text-gray-500"}`,children:[y===1&&"Basic Info",y===2&&"Contact & Address",y===3&&"Course & Financial",y===4&&"Additional Info"]})]}),y<h&&e.jsx("div",{className:`flex-1 h-1 mx-1 md:mx-2 min-w-[20px] ${n>y?"bg-orange-600":"bg-gray-300"}`})]},y))})}),e.jsx("form",{onSubmit:y=>{y.preventDefault()},onKeyDown:y=>{if(y.key==="Enter"){if(y.target.tagName==="TEXTAREA")return;y.preventDefault(),y.stopPropagation()}},children:e.jsxs("div",{ref:ye,className:"p-4 md:p-8 max-h-[calc(100vh-12rem)] overflow-y-auto",children:[n===1&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Student Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"studentName",required:!0,value:o.studentName||"",onChange:y=>Se("studentName",y.target.value),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ${_.studentName?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-orange-500"}`}),_.studentName&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:_.studentName})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Email ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"email",name:"email",required:!0,value:o.email||"",onChange:y=>Se("email",y.target.value),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ${_.email?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-orange-500"}`}),_.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:_.email})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Phone ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"tel",name:"phone",required:!0,value:o.phone||"",onChange:y=>Se("phone",y.target.value),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ${_.phone?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-orange-500"}`}),_.phone&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:_.phone}),e.jsx("div",{className:"mt-2",children:e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:y=>{const ee=y.target.checked;k(ee),ee&&o.phone?Se("whatsappNumber",o.phone):ee||o.whatsappNumber===o.phone&&Se("whatsappNumber","")},className:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Phone number is WhatsApp number"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"WhatsApp Number"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-32 flex-shrink-0",children:e.jsx("select",{name:"whatsappCountryCode",value:ce,onChange:y=>ae(y.target.value),className:"w-full px-2 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 text-sm",children:De.map(y=>e.jsxs("option",{value:y.code,children:[y.flag," ",y.code]},y.code))})}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"tel",name:"whatsappNumber",value:o.whatsappNumber||"",onChange:y=>{Se("whatsappNumber",y.target.value),u&&y.target.value!==o.phone&&k(!1)},disabled:u,placeholder:ce==="+91"?"10-digit number":"Phone number",className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ${_.whatsappNumber?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-orange-500"} ${u?"bg-gray-100 cursor-not-allowed":""}`})})]}),_.whatsappNumber&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:_.whatsappNumber}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:u?e.jsx("span",{className:"text-blue-600",children:" Auto-filled from phone number"}):`Optional - ${ce==="+91"?"Must be 10 digits if provided":"Enter valid phone number"}`})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Date of Admission ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",name:"dateOfAdmission",required:!0,value:x,onChange:y=>{const ee=y.target.value;if(Z(ee),ee){const We=Pt(ee);S(We),ue(Le=>{const Ge={...Le};return delete Ge.dateOfAdmission,Ge})}else S("")},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ${_.dateOfAdmission?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-orange-500"}`}),N&&e.jsxs("p",{className:"mt-1 text-xs text-gray-600",children:["Selected: ",N]}),_.dateOfAdmission&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:_.dateOfAdmission})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date of Birth"}),e.jsx("input",{type:"date",name:"dateOfBirth",value:o.dateOfBirth||"",onChange:y=>{Se("dateOfBirth",y.target.value),ue(ee=>{const We={...ee};return delete We.dateOfBirth,We})},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ${_.dateOfBirth?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-orange-500"}`}),_.dateOfBirth&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:_.dateOfBirth}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Optional - Date of birth for the student"})]})]})]}),n===2&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Contact & Address Information"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Local Address ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{name:"localAddress",rows:3,required:!0,value:o.localAddress||"",onChange:y=>Se("localAddress",y.target.value),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ${_.localAddress?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-orange-500"}`}),_.localAddress&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:_.localAddress})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Permanent Address ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{name:"permanentAddress",rows:3,required:!0,value:o.permanentAddress||"",onChange:y=>Se("permanentAddress",y.target.value),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ${_.permanentAddress?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-orange-500"}`}),_.permanentAddress&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:_.permanentAddress})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Emergency Contact Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"tel",name:"emergencyContactNumber",required:!0,value:o.emergencyContactNumber||"",onChange:y=>Se("emergencyContactNumber",y.target.value),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ${_.emergencyContactNumber?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-orange-500"}`}),_.emergencyContactNumber&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:_.emergencyContactNumber})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Emergency Contact Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"emergencyName",required:!0,value:o.emergencyName||"",onChange:y=>Se("emergencyName",y.target.value),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ${_.emergencyName?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-orange-500"}`}),_.emergencyName&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:_.emergencyName})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Relation ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"emergencyRelation",placeholder:"e.g., Father, Mother, Guardian",required:!0,value:o.emergencyRelation||"",onChange:y=>Se("emergencyRelation",y.target.value),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ${_.emergencyRelation?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-orange-500"}`}),_.emergencyRelation&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:_.emergencyRelation})]})]})]})]}),n===3&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Course & Financial Details"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Course Name"}),e.jsxs("select",{name:"courseName",value:o.courseName||"",onChange:y=>Se("courseName",y.target.value),onKeyDown:y=>{y.key==="Enter"&&(y.preventDefault(),y.stopPropagation())},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select course name (optional)"}),Array.from(new Set([...((we=R==null?void 0:R.data)==null?void 0:we.map(y=>y.name))||[],...((Ke=Ee==null?void 0:Ee.data)==null?void 0:Ke.courseNames)||[]])).sort((y,ee)=>y.localeCompare(ee)).map(y=>e.jsx("option",{value:y,children:y},y))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Batch"}),w.length>0&&e.jsxs("div",{className:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("p",{className:"text-sm font-semibold text-blue-900 mb-2",children:" Suggested Batches (based on your software selection)"}),e.jsx("div",{className:"space-y-2",children:w.map(y=>e.jsx("div",{className:"p-2 bg-white border border-blue-300 rounded hover:bg-blue-50 cursor-pointer",onClick:()=>Se("batchId",y.id),children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:y.title}),y.software&&e.jsxs("span",{className:"text-sm text-gray-600 ml-2",children:["- ",y.software]}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",y.mode,") | Starts: ",lt(y.startDate)]})]}),e.jsx("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded",children:"Suggested"})]})},y.id))})]}),e.jsxs("select",{name:"batchId",value:((rt=o.batchId)==null?void 0:rt.toString())||"",onChange:y=>Se("batchId",y.target.value?parseInt(y.target.value):void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select a batch (optional)"}),w.length>0&&e.jsx("optgroup",{label:"Suggested Batches",children:w.map(y=>e.jsxs("option",{value:y.id,children:[y.title," ",y.software?`- ${y.software}`:""," (",y.mode,") - Starts: ",lt(y.startDate)]},y.id))}),w.length>0&&ze.length>w.length&&e.jsx("optgroup",{label:"All Batches",children:ze.filter(y=>!w.some(ee=>ee.id===y.id)).map(y=>e.jsxs("option",{value:y.id,children:[y.title," ",y.software?`- ${y.software}`:""," (",y.mode,")"]},y.id))}),w.length===0&&ze.map(y=>e.jsxs("option",{value:y.id,children:[y.title," ",y.software?`- ${y.software}`:""," (",y.mode,")"]},y.id))]}),w.length>0&&e.jsx("p",{className:"mt-1 text-xs text-blue-600",children:"Batches matching your software selection are shown above"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Softwares Included ",e.jsx("span",{className:"text-red-500",children:"*"})]}),_.softwaresIncluded&&e.jsx("p",{className:"mb-2 text-sm text-red-600",children:_.softwaresIncluded}),o.courseName?e.jsx("div",{className:"mb-2 p-2 bg-blue-50 border border-blue-200 rounded-md",children:e.jsx("p",{className:"text-xs text-blue-800",children:" Software automatically loaded from selected course. You can manually select software if course is not selected."})}):e.jsx("div",{className:"mb-2 p-2 bg-yellow-50 border border-yellow-200 rounded-md",children:e.jsx("p",{className:"text-xs text-yellow-800",children:" No course selected. You can manually select software from the list below."})}),o.courseName&&pe.length===0&&e.jsx("div",{className:"mb-2 p-2 bg-red-50 border border-red-200 rounded-md",children:e.jsx("p",{className:"text-xs text-red-800",children:"No software found for the selected course"})}),e.jsx("div",{className:"border border-gray-300 rounded-md p-4 max-h-48 overflow-y-auto",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[pe.map(y=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-2 rounded",children:[e.jsx("input",{type:"checkbox",name:"softwaresIncluded",value:y,checked:K.includes(y),onChange:ee=>{Ve(y,ee.target.checked)},className:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:y}),zt.includes(y)&&e.jsx("button",{type:"button",onClick:()=>{Y(ee=>ee.filter(We=>We!==y)),Pe(ee=>ee.filter(We=>We!==y)),K.includes(y)&&Ve(y,!1)},className:"ml-2 text-xs text-red-600 hover:text-red-800",children:""})]},y)),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-2 rounded",children:[e.jsx("input",{type:"checkbox",name:"softwaresIncluded",value:"Other",checked:m,onChange:y=>{j(y.target.checked)},className:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Other"})]},"Other")]})}),m&&!o.courseName&&e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Specify Other Software"}),e.jsx("input",{type:"text",value:C,onChange:y=>{const ee=y.target.value;q(ee),ee.trim()?ee.trim().split(",").map(Ge=>Ge.trim()).filter(Ge=>Ge).forEach(Ge=>{!zt.includes(Ge)&&!te.includes(Ge)&&(Y(Ye=>[...Ye,Ge]),Pe(Ye=>[...Ye,Ge])),K.includes(Ge)||re(Ye=>[...Ye,Ge])}):re(We=>We.filter(Le=>!te.includes(Le)||!ee.includes(Le)))},placeholder:"Enter software names (comma separated)",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:o.courseName?"Software is automatically included from the selected course":"Select all applicable software"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Total Deal Amount () ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"totalDeal",step:"0.01",min:"0",required:!0,value:o.totalDeal||"",onChange:y=>{const ee=y.target.value?parseFloat(y.target.value):void 0;if(Se("totalDeal",ee),ee!==void 0&&o.bookingAmount!==void 0){const We=Math.max(0,(ee||0)-(o.bookingAmount||0));de(Le=>({...Le,balanceAmount:We}))}},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ${_.totalDeal?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-orange-500"}`}),_.totalDeal&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:_.totalDeal})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Booking Amount () ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"bookingAmount",step:"0.01",min:"0",required:!0,value:o.bookingAmount||"",onChange:y=>{const ee=y.target.value?parseFloat(y.target.value):void 0;if(Se("bookingAmount",ee),ee!==void 0&&o.totalDeal!==void 0){const We=Math.max(0,(o.totalDeal||0)-(ee||0));de(Le=>({...Le,balanceAmount:We}))}},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ${_.bookingAmount?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-orange-500"}`}),_.bookingAmount&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:_.bookingAmount})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Balance Amount () ",e.jsx("span",{className:"text-xs text-gray-500",children:"(Auto-calculated)"})]}),e.jsx("input",{type:"number",name:"balanceAmount",step:"0.01",readOnly:!0,value:o.balanceAmount!==void 0&&o.balanceAmount!==null?o.balanceAmount.toFixed(2):"0.00",className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 cursor-not-allowed"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Balance = Total Deal - Booking Amount"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"EMI Plan"}),e.jsxs("select",{name:"emiPlan",value:o.emiPlan?"yes":"no",onChange:y=>{const ee=y.target.value==="yes";Se("emiPlan",ee),ee&&(Se("lumpSumPayment",!1),Se("lumpSumPayments",[]))},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"no",children:"No"}),e.jsx("option",{value:"yes",children:"Yes"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Lump Sum Payment"}),e.jsxs("select",{name:"lumpSumPayment",value:o.lumpSumPayment?"yes":"no",onChange:y=>{const ee=y.target.value==="yes";Se("lumpSumPayment",ee),ee&&Se("emiPlan",!1)},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"no",children:"No"}),e.jsx("option",{value:"yes",children:"Yes"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"EMI Plan Date"}),e.jsx("input",{type:"date",name:"emiPlanDate",disabled:!o.emiPlan,min:new Date().toISOString().split("T")[0],value:o.emiPlan?Ae:"",onChange:y=>{const ee=y.target.value;if(Me(ee),ee){const We=Pt(ee);Ie(We),ue(Le=>{const Ge={...Le};return delete Ge.emiPlanDate,Ge})}else Ie("")},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ${_.emiPlanDate?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-orange-500"} ${o.emiPlan?"":"bg-gray-100 cursor-not-allowed"}`}),J&&o.emiPlan&&e.jsxs("p",{className:"mt-1 text-xs text-gray-600",children:["Selected: ",J]}),_.emiPlanDate&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:_.emiPlanDate})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Next Pay Date"}),e.jsx("input",{type:"date",name:"nextPayDate",disabled:!o.lumpSumPayment||o.lumpSumPayments&&o.lumpSumPayments.length>0,min:new Date().toISOString().split("T")[0],value:o.lumpSumPayment&&(!o.lumpSumPayments||o.lumpSumPayments.length===0)&&o.nextPayDate?o.nextPayDate:"",onChange:y=>{const ee=y.target.value;Se("nextPayDate",ee)},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ${_.nextPayDate?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-orange-500"} ${!o.lumpSumPayment||o.lumpSumPayments&&o.lumpSumPayments.length>0?"bg-gray-100 cursor-not-allowed":""}`}),o.nextPayDate&&o.lumpSumPayment&&(!o.lumpSumPayments||o.lumpSumPayments.length===0)&&e.jsxs("p",{className:"mt-1 text-xs text-gray-600",children:["Selected: ",Pt(o.nextPayDate)]}),_.nextPayDate&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:_.nextPayDate})]})]}),o.lumpSumPayment&&e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Lump Sum Payment Details"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Payment Schedule"}),e.jsx("button",{type:"button",onClick:()=>{const y={date:"",amount:0};Se("lumpSumPayments",[...o.lumpSumPayments||[],y])},className:"px-3 py-1 bg-green-600 text-white text-sm rounded-md hover:bg-green-700 transition-colors",children:"+ Add Payment"})]}),o.lumpSumPayments&&o.lumpSumPayments.length>0&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 border border-gray-300 rounded",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Amount ()"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:(o.lumpSumPayments||[]).map((y,ee)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap",children:[e.jsx("input",{type:"date",min:new Date().toISOString().split("T")[0],value:y.date,onChange:We=>{const Le=[...o.lumpSumPayments||[]];Le[ee]&&(Le[ee]={...Le[ee],date:We.target.value}),Se("lumpSumPayments",Le)},className:"w-full px-2 py-1 border border-gray-300 rounded text-sm"}),_[`lumpSumPaymentDate-${ee}`]&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:_[`lumpSumPaymentDate-${ee}`]})]}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap",children:[e.jsx("input",{type:"number",min:"0",step:"0.01",value:y.amount||"",onChange:We=>{const Le=[...o.lumpSumPayments||[]];Le[ee]&&(Le[ee]={...Le[ee],amount:Number(We.target.value)}),Se("lumpSumPayments",Le)},className:"w-full px-2 py-1 border border-gray-300 rounded text-sm"}),_[`lumpSumPaymentAmount-${ee}`]&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:_[`lumpSumPaymentAmount-${ee}`]})]}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:e.jsx("button",{type:"button",onClick:()=>{const We=[...o.lumpSumPayments||[]];We.splice(ee,1),Se("lumpSumPayments",We)},className:"px-2 py-1 bg-red-600 text-white text-xs rounded hover:bg-red-700 transition-colors",children:"Remove"})})]},ee))})]})})]}),_.lumpSumPayments&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:_.lumpSumPayments})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Class Schedule"}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Add class timings for each day"}),e.jsx("div",{className:"space-y-3 mb-4",children:(o.schedule||[]).map((y,ee)=>e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-end",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Day"}),e.jsxs("select",{value:y.day,onChange:We=>{const Le=[...o.schedule||[]];Le[ee].day=We.target.value,Se("schedule",Le)},className:"w-full px-2 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select Day"}),e.jsx("option",{value:"Monday",children:"Monday"}),e.jsx("option",{value:"Tuesday",children:"Tuesday"}),e.jsx("option",{value:"Wednesday",children:"Wednesday"}),e.jsx("option",{value:"Thursday",children:"Thursday"}),e.jsx("option",{value:"Friday",children:"Friday"}),e.jsx("option",{value:"Saturday",children:"Saturday"}),e.jsx("option",{value:"Sunday",children:"Sunday"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Start Time"}),e.jsx("input",{type:"time",value:y.startTime,onChange:We=>{const Le=[...o.schedule||[]];Le[ee].startTime=We.target.value,Se("schedule",Le)},className:"w-full px-2 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"End Time"}),e.jsx("input",{type:"time",value:y.endTime,onChange:We=>{const Le=[...o.schedule||[]];Le[ee].endTime=We.target.value,Se("schedule",Le)},className:"w-full px-2 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-orange-500"})]})]}),e.jsx("button",{type:"button",onClick:()=>{const We=[...o.schedule||[]];We.splice(ee,1),Se("schedule",We)},className:"px-3 py-2 bg-red-600 text-white rounded-md text-sm hover:bg-red-700",children:"Remove"})]},ee))}),e.jsx("button",{type:"button",onClick:()=>{const y={day:"",startTime:"",endTime:""},ee=[...o.schedule||[],y];Se("schedule",ee)},className:"px-4 py-2 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700",children:"+ Add Time Slot"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Total Duration (days)"}),e.jsx("input",{type:"number",name:"totalDuration",min:"1",value:o.totalDuration??"",onChange:y=>{const ee=y.target.value?parseInt(y.target.value):null;Se("totalDuration",ee)},placeholder:"e.g., 90 days",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Total duration of the course in days"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",name:"startDate",value:o.startDate||"",onChange:y=>Se("startDate",y.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date"}),e.jsx("input",{type:"date",name:"endDate",value:o.endDate||"",onChange:y=>Se("endDate",y.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]})]}),o.emiPlan&&e.jsxs("div",{className:"mt-6",children:[o.balanceAmount&&o.balanceAmount>0&&e.jsx("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Balance Amount"}),e.jsxs("p",{className:"text-lg font-bold text-blue-900",children:["",o.balanceAmount.toFixed(2)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Total EMI Amount"}),e.jsxs("p",{className:`text-lg font-bold ${o.emiInstallments&&o.emiInstallments.length>0&&o.emiInstallments.reduce((y,ee)=>y+(ee.amount||0),0)>o.balanceAmount?"text-red-600":"text-blue-900"}`,children:["",((ct=o.emiInstallments)==null?void 0:ct.reduce((y,ee)=>y+(ee.amount||0),0).toFixed(2))||"0.00"]}),o.emiInstallments&&o.emiInstallments.length>0&&o.emiInstallments.reduce((y,ee)=>y+(ee.amount||0),0)>o.balanceAmount&&e.jsx("p",{className:"text-xs text-red-600 font-semibold mt-1",children:" Exceeds Balance!"})]})]})}),e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("div",{children:e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"EMI Installments (Month-wise)"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{if(!o.balanceAmount||o.balanceAmount<=0){alert("Please enter Total Deal and Booking Amount first to calculate balance");return}if(!Ae){alert("Please select EMI Plan Date first");return}const y=Number(o.balanceAmount),ee=10,We=y/ee,Le=[],Ge=new Date(Ae);for(let F=1;F<=ee;F++){const ie=new Date(Ge);ie.setMonth(ie.getMonth()+(F-1));const be=ie.toISOString().split("T")[0];Le.push({month:F,amount:Math.round(We*100)/100,dueDate:be})}const Ye=Le.reduce((F,ie)=>F+ie.amount,0);Ye!==y&&(Le[Le.length-1].amount=Math.round((y-(Ye-Le[Le.length-1].amount))*100)/100),Se("emiInstallments",Le);const d={};Le.forEach((F,ie)=>{F.dueDate&&(d[ie]=Pt(F.dueDate))}),p(d),U(new Set)},className:"px-3 py-1 text-sm bg-green-600 text-white rounded-md hover:bg-green-700",children:"Auto-Calculate (10 EMIs)"}),e.jsx("button",{type:"button",onClick:()=>{const y=o.emiInstallments||[],ee=y.length>0?Math.max(...y.map(We=>We.month))+1:1;Se("emiInstallments",[...y,{month:ee,amount:0,dueDate:""}])},className:"px-3 py-1 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"+ Add Installment"})]})]}),o.emiInstallments&&o.emiInstallments.length>0?e.jsxs("div",{children:[o.balanceAmount&&e.jsx("div",{className:`mb-3 p-3 rounded-md border ${o.emiInstallments.reduce((y,ee)=>y+(ee.amount||0),0)>o.balanceAmount?"bg-red-50 border-red-300":"bg-green-50 border-green-300"}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold",children:["Balance Amount: ",o.balanceAmount.toFixed(2)]}),e.jsxs("p",{className:"text-sm",children:["Total EMI Amount: ",o.emiInstallments.reduce((y,ee)=>y+(ee.amount||0),0).toFixed(2)]})]}),o.emiInstallments.reduce((y,ee)=>y+(ee.amount||0),0)>o.balanceAmount?e.jsx("span",{className:"text-red-600 font-bold",children:" Exceeds Balance!"}):e.jsx("span",{className:"text-green-600 font-semibold",children:" Valid"})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 border border-gray-300",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase",children:"Month"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase",children:"Amount ()"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase",children:"Due Date"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium text-gray-700 uppercase",children:"Action"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o.emiInstallments.map((y,ee)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"number",min:"1",value:y.month,onChange:We=>{const Le=[...o.emiInstallments||[]];Le[ee].month=parseInt(We.target.value)||1,Se("emiInstallments",Le)},className:"w-20 px-2 py-1 border border-gray-300 rounded-md"})}),e.jsxs("td",{className:"px-4 py-2",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",value:y.amount,onChange:We=>{const Le=[...o.emiInstallments||[]],Ge=parseFloat(We.target.value)||0;if(P(d=>new Set(d).add(ee)),Le[ee].amount=Ge,o.balanceAmount&&Le.length>1){const d=Number(o.balanceAmount),F=Le.reduce((be,qe,Je)=>M.has(Je)||Je===ee?be+(qe.amount||0):be,0),ie=Le.map((be,qe)=>qe).filter(be=>be!==ee&&!M.has(be));if(ie.length>0){const be=d-F;if(be>=0){const qe=be/ie.length;ie.forEach(ke=>{Le[ke].amount=Math.round(qe*100)/100});const Je=Le.reduce((ke,$e)=>ke+($e.amount||0),0);if(Je!==d&&ie.length>0){const ke=ie[ie.length-1],$e=d-(Je-Le[ke].amount);Le[ke].amount=Math.round($e*100)/100}}}}const Ye=Le.reduce((d,F)=>d+(F.amount||0),0);o.balanceAmount&&Ye>o.balanceAmount?ue(d=>({...d,[`emiInstallment_${ee}_amount`]:`Total EMI (${Ye.toFixed(2)}) exceeds Balance (${(o.balanceAmount||0).toFixed(2)})`})):ue(d=>{const F={...d};return delete F[`emiInstallment_${ee}_amount`],F}),Se("emiInstallments",Le)},className:`w-32 px-2 py-1 border rounded-md ${_[`emiInstallment_${ee}_amount`]?"border-red-500":"border-gray-300"}`}),_[`emiInstallment_${ee}_amount`]&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:_[`emiInstallment_${ee}_amount`]})]}),e.jsxs("td",{className:"px-4 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",min:new Date().toISOString().split("T")[0],value:y.dueDate||"",onChange:We=>{const Le=[...o.emiInstallments||[]],Ge=We.target.value;if(Le[ee].dueDate=Ge,!H.has(ee)&&Ge){const Ye=new Date(Ge);for(let d=ee+1;d<Le.length;d++)if(!H.has(d)){const F=new Date(Ye);F.setMonth(F.getMonth()+(d-ee)),Le[d].dueDate=F.toISOString().split("T")[0]}}if(Se("emiInstallments",Le),Ge){const Ye=Pt(Ge);if(p(d=>({...d,[ee]:Ye})),!H.has(ee)){const d={...ve};for(let F=ee+1;F<Le.length;F++)!H.has(F)&&Le[F].dueDate&&(d[F]=Pt(Le[F].dueDate));p(d)}}else p(Ye=>{const d={...Ye};return delete d[ee],d});ue(Ye=>{const d={...Ye};return delete d[`emiInstallment_${ee}_dueDate`],d})},className:`flex-1 px-2 py-1 border rounded-md ${_[`emiInstallment_${ee}_dueDate`]?"border-red-500":"border-gray-300"}`}),e.jsxs("label",{className:"flex items-center gap-1 text-xs text-gray-600 whitespace-nowrap",children:[e.jsx("input",{type:"checkbox",checked:H.has(ee),onChange:We=>{var Le;if(We.target.checked)U(Ge=>new Set(Ge).add(ee));else{U(Ye=>{const d=new Set(Ye);return d.delete(ee),d});const Ge=[...o.emiInstallments||[]];if(ee>0&&((Le=Ge[ee-1])!=null&&Le.dueDate)){const Ye=new Date(Ge[ee-1].dueDate);Ye.setMonth(Ye.getMonth()+1),Ge[ee].dueDate=Ye.toISOString().split("T")[0];for(let d=ee+1;d<Ge.length;d++)if(!H.has(d)){const F=new Date(Ye);F.setMonth(F.getMonth()+(d-ee)),Ge[d].dueDate=F.toISOString().split("T")[0]}Se("emiInstallments",Ge)}}},className:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500",title:"Mark as custom date (won't auto-update)"}),e.jsx("span",{children:"Custom"})]})]}),_[`emiInstallment_${ee}_dueDate`]&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:_[`emiInstallment_${ee}_dueDate`]})]}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("button",{type:"button",onClick:()=>{const We=[...o.emiInstallments||[]];if(We.splice(ee,1),U(Le=>{const Ge=new Set;return Le.forEach(Ye=>{Ye<ee?Ge.add(Ye):Ye>ee&&Ge.add(Ye-1)}),Ge}),P(Le=>{const Ge=new Set;return Le.forEach(Ye=>{Ye<ee?Ge.add(Ye):Ye>ee&&Ge.add(Ye-1)}),Ge}),o.balanceAmount&&We.length>0){const Le=Number(o.balanceAmount),Ge=We.length,Ye=Le/Ge;We.forEach(F=>{F.amount=Math.round(Ye*100)/100});const d=We.reduce((F,ie)=>F+ie.amount,0);if(d!==Le){const F=We.length-1,ie=Le-(d-We[F].amount);We[F].amount=Math.round(ie*100)/100}if(We.forEach((F,ie)=>{F.month=ie+1}),Ae){const F=new Date(Ae);We.forEach((be,qe)=>{const Je=new Date(F);Je.setMonth(Je.getMonth()+qe),be.dueDate=Je.toISOString().split("T")[0]});const ie={};We.forEach((be,qe)=>{be.dueDate&&(ie[qe]=Pt(be.dueDate))}),p(ie)}}Se("emiInstallments",We)},className:"px-2 py-1 text-sm text-red-600 hover:text-red-800",children:"Remove"})})]},ee))})]})})]}):e.jsx("p",{className:"text-sm text-gray-500 italic",children:'No installments added. Click "Auto-Calculate" to generate 10 equal installments or "Add Installment" to add manually.'}),_.emiInstallments&&e.jsx("p",{className:"mt-2 text-sm text-red-600 font-semibold",children:_.emiInstallments})]})]})]}),n===4&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Additional Information"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Complimentary Software"}),e.jsx("div",{className:"border border-gray-300 rounded-md p-3 max-h-56 overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:zt.map(y=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-1 rounded",children:[e.jsx("input",{type:"checkbox",value:y,checked:T.includes(y),onChange:ee=>{const We=ee.target.checked;b(Le=>We?[...Le,y]:Le.filter(Ge=>Ge!==y))},className:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:y})]},y))})}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Select all complimentary software given to the student."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Complimentary Gift"}),e.jsx("input",{type:"text",name:"complimentaryGift",value:o.complimentaryGift||"",onChange:y=>Se("complimentaryGift",y.target.value),onKeyDown:y=>{y.key==="Enter"&&(y.preventDefault(),y.stopPropagation())},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Has Reference"}),e.jsxs("select",{name:"hasReference",value:o.hasReference?"yes":"no",onChange:y=>Se("hasReference",y.target.value==="yes"),onKeyDown:y=>{y.key==="Enter"&&(y.preventDefault(),y.stopPropagation())},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"no",children:"No"}),e.jsx("option",{value:"yes",children:"Yes"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reference Details"}),e.jsx("textarea",{name:"referenceDetails",rows:3,value:o.referenceDetails||"",onChange:y=>Se("referenceDetails",y.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Employee Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"counselorName",required:!0,value:o.counselorName||"",onChange:y=>Se("counselorName",y.target.value),onKeyDown:y=>{y.key==="Enter"&&(y.preventDefault(),y.stopPropagation())},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ${_.counselorName?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-orange-500"}`,children:[e.jsx("option",{value:"",children:"Select employee"}),(Ft=(jt=me==null?void 0:me.data)==null?void 0:jt.users)==null?void 0:Ft.map(y=>e.jsx("option",{value:y.name,children:y.name},y.id))]}),_.counselorName&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:_.counselorName})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Lead Source ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{name:"leadSource",required:!0,value:o.leadSource||"",onChange:y=>{const ee=y.target.value;if(Se("leadSource",ee),ee==="Walk-in"&&(!V||!V.trim())){const Le=new Date().toISOString().split("T")[0];Qe(Le);const Ge=Pt(Le);Ne(Ge),ue(Ye=>{const d={...Ye};return delete d.walkinDate,d})}},onKeyDown:y=>{y.key==="Enter"&&(y.preventDefault(),y.stopPropagation())},className:`flex-1 px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ${_.leadSource?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-orange-500"}`,children:[e.jsx("option",{value:"",children:"Select lead source"}),he.map(y=>e.jsx("option",{value:y,children:y},y))]}),r&&e.jsx("button",{type:"button",onClick:()=>{oe(null),xe(""),L(!0)},className:"px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm",title:"Manage Lead Sources",children:""})]}),_.leadSource&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:_.leadSource})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Walk-in Date",o.leadSource==="Walk-in"&&e.jsx("span",{className:"text-xs text-gray-500 ml-1",children:"(Auto-filled if not entered)"})]}),e.jsx("input",{type:"date",name:"walkinDate",value:V,onChange:y=>{const ee=y.target.value;if(Qe(ee),ee){const We=Pt(ee);Ne(We),ue(Le=>{const Ge={...Le};return delete Ge.walkinDate,Ge})}else Ne("")},onKeyDown:y=>{y.key==="Enter"&&(y.preventDefault(),y.stopPropagation())},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ${_.walkinDate?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-orange-500"}`}),W&&e.jsxs("p",{className:"mt-1 text-xs text-gray-600",children:["Selected: ",W]}),_.walkinDate&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:_.walkinDate})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Faculty ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"masterFaculty",required:!0,value:o.masterFaculty||"",onChange:y=>Se("masterFaculty",y.target.value),onKeyDown:y=>{y.key==="Enter"&&(y.preventDefault(),y.stopPropagation())},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ${_.masterFaculty?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-orange-500"}`,children:[e.jsx("option",{value:"",children:"Select faculty"}),((is=($t=Oe==null?void 0:Oe.data)==null?void 0:$t.users)==null?void 0:is.map(y=>e.jsx("option",{value:y.name,children:y.name},y.id)))||((cs=(ds=Oe==null?void 0:Oe.data)==null?void 0:ds.faculty)==null?void 0:cs.map(y=>e.jsx("option",{value:y.name,children:y.name},y.id)))]}),_.masterFaculty&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:_.masterFaculty})]})]}),e.jsxs("div",{className:"border-t pt-6 mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Student Documents"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Photo ",e.jsx("span",{className:"text-xs text-gray-500",children:"(JPG, PNG, PDF)"})]}),e.jsx("input",{type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:at,onKeyDown:y=>{y.key==="Enter"&&(y.preventDefault(),y.stopPropagation())},disabled:Q,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 disabled:opacity-50"}),Q&&e.jsx("p",{className:"mt-2 text-sm text-blue-600",children:"Uploading photo..."}),D&&e.jsx("div",{className:"mt-3 p-3 bg-gray-50 border border-gray-200 rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[e.jsx("div",{className:"flex-shrink-0",children:D.url.toLowerCase().endsWith(".pdf")?e.jsx("span",{className:"text-2xl",children:""}):e.jsx("span",{className:"text-2xl",children:""})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:D.name}),D.size&&e.jsxs("p",{className:"text-xs text-gray-500",children:[(D.size/1024).toFixed(2)," KB"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("a",{href:He(D.url)||D.url,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1 text-sm text-blue-600 hover:text-blue-800 border border-blue-300 rounded hover:bg-blue-50",children:"View"}),e.jsx("button",{type:"button",onClick:()=>se(null),className:"px-3 py-1 text-sm text-red-600 hover:text-red-800 border border-red-300 rounded hover:bg-red-50",children:"Remove"})]})]})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["PAN Card ",e.jsx("span",{className:"text-xs text-gray-500",children:"(JPG, PNG, PDF)"})]}),e.jsx("input",{type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:it,onKeyDown:y=>{y.key==="Enter"&&(y.preventDefault(),y.stopPropagation())},disabled:O,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 disabled:opacity-50"}),O&&e.jsx("p",{className:"mt-2 text-sm text-blue-600",children:"Uploading PAN Card..."}),ge&&e.jsx("div",{className:"mt-3 p-3 bg-gray-50 border border-gray-200 rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[e.jsx("div",{className:"flex-shrink-0",children:ge.url.toLowerCase().endsWith(".pdf")?e.jsx("span",{className:"text-2xl",children:""}):e.jsx("span",{className:"text-2xl",children:""})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:ge.name}),ge.size&&e.jsxs("p",{className:"text-xs text-gray-500",children:[(ge.size/1024).toFixed(2)," KB"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("a",{href:He(ge.url)||ge.url,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1 text-sm text-blue-600 hover:text-blue-800 border border-blue-300 rounded hover:bg-blue-50",children:"View"}),e.jsx("button",{type:"button",onClick:()=>G(null),className:"px-3 py-1 text-sm text-red-600 hover:text-red-800 border border-red-300 rounded hover:bg-red-50",children:"Remove"})]})]})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Aadhar Card ",e.jsx("span",{className:"text-xs text-gray-500",children:"(JPG, PNG, PDF)"})]}),e.jsx("input",{type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:ot,onKeyDown:y=>{y.key==="Enter"&&(y.preventDefault(),y.stopPropagation())},disabled:fe,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 disabled:opacity-50"}),fe&&e.jsx("p",{className:"mt-2 text-sm text-blue-600",children:"Uploading Aadhar Card..."}),Ce&&e.jsx("div",{className:"mt-3 p-3 bg-gray-50 border border-gray-200 rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[e.jsx("div",{className:"flex-shrink-0",children:Ce.url.toLowerCase().endsWith(".pdf")?e.jsx("span",{className:"text-2xl",children:""}):e.jsx("span",{className:"text-2xl",children:""})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:Ce.name}),Ce.size&&e.jsxs("p",{className:"text-xs text-gray-500",children:[(Ce.size/1024).toFixed(2)," KB"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("a",{href:He(Ce.url)||Ce.url,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1 text-sm text-blue-600 hover:text-blue-800 border border-blue-300 rounded hover:bg-blue-50",children:"View"}),e.jsx("button",{type:"button",onClick:()=>Ze(null),className:"px-3 py-1 text-sm text-red-600 hover:text-red-800 border border-red-300 rounded hover:bg-red-50",children:"Remove"})]})]})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Other Documents ",e.jsx("span",{className:"text-xs text-gray-500",children:"(Multiple files - JPG, PNG, PDF)"})]}),e.jsx("input",{type:"file",multiple:!0,accept:".pdf,.jpg,.jpeg,.png",onChange:I,onKeyDown:y=>{y.key==="Enter"&&(y.preventDefault(),y.stopPropagation())},disabled:je,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 disabled:opacity-50"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"You can upload multiple files. Supported formats: PDF, JPG, PNG (Max 10MB per file)"}),je&&e.jsx("p",{className:"mt-2 text-sm text-blue-600",children:"Uploading documents..."}),Xe.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Uploaded Other Documents (",Xe.length,")"]}),e.jsx("div",{className:"space-y-2",children:Xe.map((y,ee)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 border border-gray-200 rounded-md",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[e.jsx("div",{className:"flex-shrink-0",children:y.url.toLowerCase().endsWith(".pdf")?e.jsx("span",{className:"text-2xl",children:""}):e.jsx("span",{className:"text-2xl",children:""})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:y.name}),y.size&&e.jsxs("p",{className:"text-xs text-gray-500",children:[(y.size/1024).toFixed(2)," KB"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("a",{href:He(y.url)||y.url,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1 text-sm text-blue-600 hover:text-blue-800 border border-blue-300 rounded hover:bg-blue-50",children:"View"}),e.jsx("button",{type:"button",onClick:()=>E(ee),className:"px-3 py-1 text-sm text-red-600 hover:text-red-800 border border-red-300 rounded hover:bg-red-50",children:"Remove"})]})]},ee))})]})]})]})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-3 mt-6 md:mt-8 pt-6 border-t",children:[e.jsx("button",{type:"button",onClick:ne,disabled:n===1,className:"w-full sm:w-auto px-6 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),n<h?e.jsx("button",{type:"button",onClick:tt,className:"w-full sm:w-auto px-6 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors",children:"Next"}):e.jsx("button",{type:"button",onClick:y=>{y.preventDefault(),y.stopPropagation(),y.currentTarget.closest("form")&&dt()},disabled:Ue.isPending,className:"w-full sm:w-auto px-6 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:Ue.isPending?"Submitting...":"Submit Enrollment"})]})]})}),A&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Manage Lead Sources"}),e.jsx("button",{type:"button",onClick:()=>{L(!1),oe(null),xe("")},className:"text-gray-400 hover:text-gray-600 text-xl",children:""})]}),e.jsxs("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:z?"Edit Lead Source":"Add New Lead Source"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:le,onChange:y=>xe(y.target.value),placeholder:"Enter lead source name",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",autoFocus:!0,onKeyDown:y=>{y.key==="Enter"?(y.preventDefault(),le.trim()&&(z?(B(ee=>ee.map(We=>We===z?le.trim():We)),o.leadSource===z&&Se("leadSource",le.trim())):he.includes(le.trim())||B(ee=>[...ee,le.trim()]),oe(null),xe(""))):y.key==="Escape"&&(oe(null),xe(""))}}),e.jsx("button",{type:"button",onClick:()=>{le.trim()&&(z?(B(y=>y.map(ee=>ee===z?le.trim():ee)),o.leadSource===z&&Se("leadSource",le.trim())):he.includes(le.trim())||B(y=>[...y,le.trim()]),oe(null),xe(""))},className:"px-4 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700",children:z?"Update":"Add"}),z&&e.jsx("button",{type:"button",onClick:()=>{oe(null),xe("")},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300",children:"Cancel"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["All Lead Sources (",he.length,")"]}),he.length===0?e.jsx("p",{className:"text-sm text-gray-500 italic p-4 text-center",children:"No lead sources added yet"}):e.jsx("div",{className:"border border-gray-300 rounded-md divide-y divide-gray-200 max-h-64 overflow-y-auto",children:he.map(y=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50",children:[e.jsx("span",{className:"text-sm text-gray-900 flex-1",children:y}),r&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{oe(y),xe(y)},className:"px-3 py-1 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700",title:"Edit",children:" Edit"}),e.jsx("button",{type:"button",onClick:()=>{window.confirm(`Are you sure you want to delete "${y}"?`)&&(B(ee=>ee.filter(We=>We!==y)),o.leadSource===y&&Se("leadSource",""),z===y&&(oe(null),xe("")))},className:"px-3 py-1 text-sm bg-red-600 text-white rounded-md hover:bg-red-700",title:"Delete",children:" Delete"})]})]},y))})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"button",onClick:()=>{L(!1),oe(null),xe("")},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300",children:"Close"})})]})})]})})})},Bt=["Photoshop","Illustrator","InDesign","After Effects","Premiere Pro","Figma","Sketch","Blender","Maya","3ds Max","Cinema 4D","Lightroom","CorelDRAW","AutoCAD","SolidWorks","Revit","SketchUp","Unity","Unreal Engine","DaVinci Resolve","Final Cut Pro","Procreate","Affinity Designer","Affinity Photo","Canva Pro"],hl=()=>{var Ke,rt,ct,jt,Ft,$t,is,ds,cs,y,ee,We,Le,Ge,Ye;const{id:t}=xs(),{user:s}=Nt(),a=Et(),r=vt(),n=(s==null?void 0:s.role)==="admin"||(s==null?void 0:s.role)==="superadmin",[i,h]=g.useState(1),m=4,[j,C]=g.useState(null),[q,K]=g.useState(null),[re,T]=g.useState([]),[b,w]=g.useState(!1),[$,pe]=g.useState(""),[Pe,te]=g.useState(Bt),[Y,o]=g.useState([]),[de,N]=g.useState(!1),[S,x]=g.useState([]),[Z,J]=g.useState(null),[Ie,Ae]=g.useState(null),[Me,W]=g.useState(null),[Ne,V]=g.useState([]),{uploadPhoto:Qe,uploading:ve,error:p,getPhotoUrl:M}=na(),[P,H]=g.useState(!1),[U,ce]=g.useState(!1),[ae,u]=g.useState(!1),[k,c]=g.useState(!1),[D,se]=g.useState(null),[ge,G]=g.useState(""),[Ce,Ze]=g.useState(["Walk-in","Online","Reference","Social Media","Advertisement","Other"]),Xe=g.useRef(null);g.useEffect(()=>{Xe.current&&(Xe.current.scrollTop=0)},[i]);const[Be,Q]=g.useState(!1),[l,O]=g.useState({amount:"",dueDate:"",paymentMethod:"",transactionId:"",notes:""}),[X,fe]=g.useState(new Set),[Fe,je]=g.useState(new Set),[v,_]=g.useState({}),{data:ue,isLoading:A,error:L,refetch:z}=_e({queryKey:["student-details",t],queryFn:async()=>{var ie,be;if(!t)throw new Error("Student ID is required");try{const qe=await kt.getStudentDetails(Number(t));if((ie=qe==null?void 0:qe.data)!=null&&ie.student)return qe.data.student}catch(qe){console.log("Student details endpoint failed, trying getUserById:",qe)}const d=await yt.getUser(Number(t));if(!((be=d==null?void 0:d.data)!=null&&be.user))throw new Error("Student data not found");const F=d.data.user;return{id:F.id,name:F.name,email:F.email,phone:F.phone,avatarUrl:F.avatarUrl,isActive:F.isActive,createdAt:F.createdAt,updatedAt:F.updatedAt,studentProfile:F.studentProfile||null,enrollments:[]}},enabled:!!t&&!!s&&n,retry:1}),oe=ue,{data:le}=_e({queryKey:["courses"],queryFn:()=>Jt.getAllCourses()});g.useEffect(()=>{var d,F,ie,be;if(oe){const qe=oe.studentProfile;let Je=qe==null?void 0:qe.documents;if(Je&&typeof Je=="string")try{Je=JSON.parse(Je)}catch(gt){console.error("Error parsing documents string:",gt),Je=void 0}const ke=Je&&typeof Je=="object"&&"enrollmentMetadata"in Je?Je.enrollmentMetadata:null;_({name:oe.name||"",email:oe.email||"",phone:oe.phone||"",whatsappNumber:(ke==null?void 0:ke.whatsappNumber)||"",dateOfAdmission:(ke==null?void 0:ke.dateOfAdmission)||(qe==null?void 0:qe.enrollmentDate)||"",isActive:oe.isActive??!0,localAddress:(ke==null?void 0:ke.localAddress)||(qe==null?void 0:qe.address)||"",permanentAddress:(ke==null?void 0:ke.permanentAddress)||"",emergencyContactNumber:((d=ke==null?void 0:ke.emergencyContact)==null?void 0:d.number)||"",emergencyName:((F=ke==null?void 0:ke.emergencyContact)==null?void 0:F.name)||"",emergencyRelation:((ie=ke==null?void 0:ke.emergencyContact)==null?void 0:ie.relation)||"",courseName:(ke==null?void 0:ke.courseName)||"",totalDeal:ke==null?void 0:ke.totalDeal,bookingAmount:ke==null?void 0:ke.bookingAmount,balanceAmount:ke==null?void 0:ke.balanceAmount,emiPlan:(ke==null?void 0:ke.emiPlan)||!1,emiPlanDate:(ke==null?void 0:ke.emiPlanDate)||"",emiInstallments:(ke==null?void 0:ke.emiInstallments)||[],enrollmentDocuments:(ke==null?void 0:ke.enrollmentDocuments)||[],complimentarySoftware:(ke==null?void 0:ke.complimentarySoftware)||"",complimentaryGift:(ke==null?void 0:ke.complimentaryGift)||"",hasReference:(ke==null?void 0:ke.hasReference)||!1,referenceDetails:(ke==null?void 0:ke.referenceDetails)||"",counselorName:(ke==null?void 0:ke.counselorName)||"",leadSource:(ke==null?void 0:ke.leadSource)||"",walkinDate:(ke==null?void 0:ke.walkinDate)||"",masterFaculty:(ke==null?void 0:ke.masterFaculty)||"",dob:(qe==null?void 0:qe.dob)||"",address:(qe==null?void 0:qe.address)||"",enrollmentDate:(qe==null?void 0:qe.enrollmentDate)||"",status:(qe==null?void 0:qe.status)||"active",softwareList:(qe==null?void 0:qe.softwareList)||[],lumpSumPayment:(ke==null?void 0:ke.lumpSumPayment)||!1,nextPayDate:(ke==null?void 0:ke.nextPayDate)||"",lumpSumPayments:(ke==null?void 0:ke.lumpSumPayments)||[],schedule:(ke==null?void 0:ke.schedule)||[],totalDuration:(ke==null?void 0:ke.totalDuration)||null,startDate:(ke==null?void 0:ke.startDate)||"",endDate:(ke==null?void 0:ke.endDate)||""});let $e=ke==null?void 0:ke.documents;if(!$e&&Je&&typeof Je=="object"&&(Je.photo||Je.panCard||Je.aadharCard||Je.otherDocuments)&&($e=Je),console.log("Loading documents:",{documents:Je,enrollmentMetadata:ke,structuredDocuments:$e,hasPhoto:!!($e!=null&&$e.photo),hasPanCard:!!($e!=null&&$e.panCard),hasAadharCard:!!($e!=null&&$e.aadharCard),otherDocsCount:((be=$e==null?void 0:$e.otherDocuments)==null?void 0:be.length)||0}),$e&&typeof $e=="object"){if($e.photo&&$e.photo.url&&J({name:$e.photo.name||$e.photo.url.split("/").pop()||"Photo",url:$e.photo.url,size:$e.photo.size}),$e.panCard&&$e.panCard.url&&Ae({name:$e.panCard.name||$e.panCard.url.split("/").pop()||"PAN Card",url:$e.panCard.url,size:$e.panCard.size}),$e.aadharCard&&$e.aadharCard.url&&W({name:$e.aadharCard.name||$e.aadharCard.url.split("/").pop()||"Aadhar Card",url:$e.aadharCard.url,size:$e.aadharCard.size}),$e.otherDocuments&&Array.isArray($e.otherDocuments)){const gt=$e.otherDocuments.filter(bt=>bt&&bt.url);gt.length>0&&V(gt.map(bt=>({name:bt.name||bt.url.split("/").pop()||"Document",url:bt.url,size:bt.size})))}if($e.uploadedDocuments&&Array.isArray($e.uploadedDocuments)){const gt=$e.uploadedDocuments.map(bt=>({name:bt.name||(typeof bt=="string"?bt.split("/").pop():"Document"),url:typeof bt=="string"?bt:bt.url,size:typeof bt=="string"?void 0:bt.size}));x(gt)}}else if(ke!=null&&ke.enrollmentDocuments&&Array.isArray(ke.enrollmentDocuments)){const gt=ke.enrollmentDocuments.map(bt=>({name:bt.split("/").pop()||"Document",url:bt}));x(gt)}if(qe!=null&&qe.softwareList&&Array.isArray(qe.softwareList)&&T(qe.softwareList),ke!=null&&ke.courseName&&(le!=null&&le.data)){const gt=le.data.find(bt=>bt.name===ke.courseName);gt!=null&&gt.software&&Array.isArray(gt.software)&&gt.software.length>0?te(gt.software):te(Bt)}else te(Bt);const xt=v.phone||"",pt=v.whatsappNumber||"";if(xt&&pt&&xt===pt&&N(!0),qe!=null&&qe.photoUrl||oe.avatarUrl){const gt=(qe==null?void 0:qe.photoUrl)||oe.avatarUrl,bt=gt?He(gt)||gt:null;C(bt)}}},[oe]),g.useEffect(()=>{if(v.courseName&&(le!=null&&le.data)){const d=le.data.find(F=>F.name===v.courseName);d!=null&&d.software&&Array.isArray(d.software)&&d.software.length>0?te(d.software):te([...Bt,...Y])}else v.courseName||te([...Bt,...Y])},[v.courseName,le,Y]);const{data:xe}=_e({queryKey:["batches"],queryFn:()=>St.getAllBatches()}),{data:he}=_e({queryKey:["employees"],queryFn:()=>Qt.getAllEmployees()}),{data:B}=_e({queryKey:["faculty"],queryFn:()=>Kt.getAllFaculty()}),{data:ye}=_e({queryKey:["courseNames"],queryFn:()=>kt.getCourseNames()}),{data:De}=_e({queryKey:["enrollments",t],queryFn:async()=>{var d;if(!t)return{data:[]};try{const F=await fetch(`https://api.prashantthakar.com/api/api/enrollments?studentId=${t}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(F.ok){const ie=await F.json();return{data:Array.isArray(ie.data)?ie.data:((d=ie.data)==null?void 0:d.enrollments)||[]}}return{data:[]}}catch(F){return console.error("Error fetching enrollments:",F),{data:[]}}},enabled:!!t}),{data:Se,refetch:at}=_e({queryKey:["student-payments-edit",t],queryFn:async()=>{if(!t)return{status:"success",data:{payments:[]}};try{return await qt.getAllPayments({studentId:Number(t)})}catch(d){return console.error("Error fetching payments:",d),{status:"success",data:{payments:[]}}}},enabled:!!t,staleTime:3e4,gcTime:3e5,refetchOnWindowFocus:!1,refetchOnMount:!1});g.useEffect(()=>{if(v.totalDeal!==void 0&&v.totalDeal!==null&&v.bookingAmount!==void 0&&v.bookingAmount!==null){const d=Number(v.totalDeal)||0,F=Number(v.bookingAmount)||0,ie=Math.max(0,d-F);_(be=>be.balanceAmount!==ie?{...be,balanceAmount:ie}:be)}},[v.totalDeal,v.bookingAmount]),g.useEffect(()=>{v.emiPlan&&v.lumpSumPayment&&_(d=>({...d,lumpSumPayment:!1}))},[v.emiPlan,v.lumpSumPayment]),g.useEffect(()=>{if(v.emiPlan&&v.balanceAmount&&v.balanceAmount>0&&v.emiPlanDate){const d=Number(v.balanceAmount),F=10,ie=d/F,be=[],qe=new Date(v.emiPlanDate);for(let ke=1;ke<=F;ke++){const $e=new Date(qe);$e.setMonth($e.getMonth()+(ke-1));const xt=$e.toISOString().split("T")[0];be.push({month:ke,amount:Math.round(ie*100)/100,dueDate:xt})}const Je=be.reduce((ke,$e)=>ke+$e.amount,0);Je!==d&&(be[be.length-1].amount=Math.round((d-(Je-be[be.length-1].amount))*100)/100),f("emiInstallments",be),fe(new Set),je(new Set)}else!v.emiPlan&&v.emiInstallments&&v.emiInstallments.length>0&&(f("emiInstallments",[]),fe(new Set),je(new Set))},[v.emiPlan,v.balanceAmount,v.emiPlanDate]);const it=(xe==null?void 0:xe.data)||[],ot=st({mutationFn:d=>yt.updateUser(Number(t),d),onSuccess:()=>{r.invalidateQueries({queryKey:["student-details",t]}),r.invalidateQueries({queryKey:["students"]}),r.invalidateQueries({queryKey:["student-profile",t]})},onError:d=>{var F,ie;alert(((ie=(F=d.response)==null?void 0:F.data)==null?void 0:ie.message)||"Failed to update user information")}}),I=st({mutationFn:d=>yt.updateStudentProfile(Number(t),d),onSuccess:()=>{r.invalidateQueries({queryKey:["student-details",t]}),r.invalidateQueries({queryKey:["students"]}),r.invalidateQueries({queryKey:["student-profile",t]}),r.invalidateQueries({queryKey:["student-payments",t]}),r.invalidateQueries({queryKey:["student-payments-edit",t]})},onError:d=>{var F,ie;alert(((ie=(F=d.response)==null?void 0:F.data)==null?void 0:ie.message)||"Failed to update student profile")}}),E=st({mutationFn:d=>(console.log("Creating payment with data:",d),console.log("Student ID from URL:",t,"Type:",typeof t),console.log("Student ID in request:",d.studentId,"Type:",typeof d.studentId),qt.createPayment(d)),onSuccess:d=>{var F,ie,be,qe,Je,ke,$e,xt;console.log("Payment created successfully! Response:",d),console.log("Created payment studentId:",(ie=(F=d==null?void 0:d.data)==null?void 0:F.payment)==null?void 0:ie.studentId),r.invalidateQueries({queryKey:["payments"]}),r.invalidateQueries({queryKey:["student-payments"]}),r.invalidateQueries({queryKey:["student-payments",t]}),r.invalidateQueries({queryKey:["student-payments-edit",t]}),r.invalidateQueries({queryKey:["enrollments"]}),Q(!1),O({amount:"",dueDate:"",paymentMethod:"",transactionId:"",notes:""}),alert(`Payment created successfully!

Payment ID: ${(qe=(be=d==null?void 0:d.data)==null?void 0:be.payment)==null?void 0:qe.id}
Student ID: ${(ke=(Je=d==null?void 0:d.data)==null?void 0:Je.payment)==null?void 0:ke.studentId}
Amount: ${(xt=($e=d==null?void 0:d.data)==null?void 0:$e.payment)==null?void 0:xt.amount}

The payment will appear in the Payment History section below.`)},onError:d=>{var ie,be;const F=((be=(ie=d.response)==null?void 0:ie.data)==null?void 0:be.message)||d.message||"Failed to create payment";console.error("Payment creation error:",d),console.error("Error response:",d.response),alert(`Error: ${F}

Check console for details.`)}}),f=(d,F)=>{var ie;if(_(be=>({...be,[d]:F})),d==="emiPlan"&&F===!0?_(be=>({...be,lumpSumPayment:!1})):d==="lumpSumPayment"&&F===!0&&_(be=>({...be,emiPlan:!1})),d==="phone"&&de&&_(be=>({...be,whatsappNumber:F})),d==="courseName"&&F){const be=(ie=le==null?void 0:le.data)==null?void 0:ie.find(qe=>qe.name===F);if(be!=null&&be.software&&Array.isArray(be.software)&&be.software.length>0){const qe=be.software;te(qe),T(qe),w(!1),pe("")}else te([...Bt,...Y]),T([])}else d==="courseName"&&!F&&(te([...Bt,...Y]),T([]),w(!1),pe(""))},Ee=d=>{var qe;if(d.preventDefault(),!t){alert("Student ID is required");return}const F=parseFloat(l.amount);if(!F||isNaN(F)||F<=0){alert("Please enter a valid amount greater than 0");return}if(!l.dueDate){alert("Please select a due date");return}const ie=(qe=document.getElementById("paymentEnrollmentId"))==null?void 0:qe.value,be={studentId:Number(t),enrollmentId:ie?Number(ie):void 0,amount:F,dueDate:l.dueDate,paymentMethod:l.paymentMethod||void 0,transactionId:l.transactionId||void 0,notes:l.notes||void 0};console.log("Creating payment with data:",be),console.log("Student ID:",t,"Type:",typeof t,"Parsed:",Number(t)),E.mutate(be)},R=(d,F)=>{F?(T(ie=>[...ie,d]),Pe.includes(d)||(te(ie=>[...ie,d]),!Bt.includes(d)&&!Y.includes(d)&&o(ie=>[...ie,d]))):T(ie=>ie.filter(be=>be!==d))},me=d=>{if(!d)return"";try{const F=new Date(d);if(!isNaN(F.getTime()))return F.toISOString().split("T")[0]}catch(F){console.error("Error parsing date:",F)}return""},Oe=async d=>{var qe;const F=(qe=d.target.files)==null?void 0:qe[0];if(!F){console.log("No file selected"),d.target.value="";return}console.log("Photo upload initiated:",{fileName:F.name,fileType:F.type,fileSize:F.size});const ie=await Qe(F);if(!ie){const Je=p||"Failed to upload photo. Please try again.";console.error("Photo upload failed:",Je),alert(Je),d.target.value="";return}console.log("Photo uploaded successfully, updating state:",ie),J(ie),K(ie.url);const be=M(ie.url)||ie.url;if(C(be),t)try{console.log("Updating avatarUrl and photoUrl in database:",ie.url),await yt.updateUser(Number(t),{avatarUrl:ie.url}),oe!=null&&oe.studentProfile&&await yt.updateStudentProfile(Number(t),{photoUrl:ie.url}),r.invalidateQueries({queryKey:["student-details",t]}),console.log("Photo URLs updated successfully")}catch(Je){console.error("Error updating photo URLs:",Je),alert("Photo uploaded but failed to update profile. Please refresh the page.")}alert("Photo uploaded successfully!"),d.target.value=""},Ue=async d=>{var be,qe,Je;const F=(be=d.target.files)==null?void 0:be[0];if(!F)return;if(!["image/jpeg","image/jpg","image/png","application/pdf"].includes(F.type)){alert("Please select a valid file (JPG, PNG, or PDF)"),d.target.value="";return}H(!0);try{const ke=await wt.uploadFile(F);if(ke.data&&ke.data.files&&ke.data.files.length>0){const $e=ke.data.files[0];Ae({name:$e.originalName,url:$e.url,size:$e.size}),alert("PAN Card uploaded successfully!")}else throw new Error("No file returned from upload")}catch(ke){console.error("PAN Card upload error:",ke),alert(((Je=(qe=ke.response)==null?void 0:qe.data)==null?void 0:Je.message)||ke.message||"Failed to upload PAN Card")}finally{H(!1),d.target.value=""}},ze=async d=>{var be,qe,Je;const F=(be=d.target.files)==null?void 0:be[0];if(!F)return;if(!["image/jpeg","image/jpg","image/png","application/pdf"].includes(F.type)){alert("Please select a valid file (JPG, PNG, or PDF)"),d.target.value="";return}ce(!0);try{const ke=await wt.uploadFile(F);if(ke.data&&ke.data.files&&ke.data.files.length>0){const $e=ke.data.files[0];W({name:$e.originalName,url:$e.url,size:$e.size}),alert("Aadhar Card uploaded successfully!")}else throw new Error("No file returned from upload")}catch(ke){console.error("Aadhar Card upload error:",ke),alert(((Je=(qe=ke.response)==null?void 0:qe.data)==null?void 0:Je.message)||ke.message||"Failed to upload Aadhar Card")}finally{ce(!1),d.target.value=""}},Ve=async d=>{var Je,ke;const F=d.target.files;if(!F||F.length===0)return;const ie=["image/jpeg","image/jpg","image/png","application/pdf"],be=Array.from(F);if(be.filter($e=>!ie.includes($e.type)).length>0){alert("Please select only valid files (JPG, PNG, or PDF)"),d.target.value="";return}u(!0);try{const $e=await wt.uploadMultipleFiles(be);if($e.data&&$e.data.files){const xt=$e.data.files.map(pt=>({name:pt.originalName,url:pt.url,size:pt.size}));V(pt=>[...pt,...xt]),alert(`${xt.length} document(s) uploaded successfully!`)}else throw new Error("No files returned from upload")}catch($e){console.error("Other documents upload error:",$e),alert(((ke=(Je=$e.response)==null?void 0:Je.data)==null?void 0:ke.message)||$e.message||"Failed to upload documents")}finally{u(!1),d.target.value=""}},nt=d=>{V(F=>F.filter((ie,be)=>be!==d))},dt=()=>{const d=[];if((!v.name||!v.name.trim())&&d.push("Student Name is required"),!v.email||!v.email.trim()?d.push("Email is required"):/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v.email.trim())||d.push("Please enter a valid email address"),!v.phone||!v.phone.trim()?d.push("Phone number is required"):v.phone.replace(/\D/g,"").length!==10&&d.push("Please enter a valid 10-digit phone number"),(!v.localAddress||!v.localAddress.trim())&&d.push("Local Address is required"),(!v.permanentAddress||!v.permanentAddress.trim())&&d.push("Permanent Address is required"),!v.whatsappNumber||!v.whatsappNumber.trim()?d.push("WhatsApp number is required"):v.whatsappNumber.replace(/\D/g,"").length!==10&&d.push("Please enter a valid 10-digit WhatsApp number"),!v.emergencyContactNumber||!v.emergencyContactNumber.trim()?d.push("Emergency Contact Number is required"):v.emergencyContactNumber.replace(/\D/g,"").length!==10&&d.push("Please enter a valid 10-digit emergency contact number"),(!v.emergencyName||!v.emergencyName.trim())&&d.push("Emergency Contact Name is required"),(!v.emergencyRelation||!v.emergencyRelation.trim())&&d.push("Emergency Contact Relation is required"),v.dob){const F=new Date(v.dob);if(!isNaN(F.getTime()))if(F>new Date)d.push("Date of birth cannot be in the future");else{const ie=new Date;let be=ie.getFullYear()-F.getFullYear();const qe=ie.getMonth()-F.getMonth(),Je=ie.getDate()-F.getDate();(qe<0||qe===0&&Je<0)&&be--,be<18&&d.push("Student must be at least 18 years old")}}return d.length>0?(alert(`Please fill all required fields correctly:
${d.join(`
`)}`),!1):!0},tt=async d=>{var xt;if(!oe){alert("Student data is not loaded. Please try again.");return}if(!dt())return;try{const pt=await kt.checkDuplicate(v.email,v.phone,Number(t));if(pt.data.exists&&pt.data.studentId){const gt=pt.data.type,bt=pt.data.studentName,ms=`A student with this ${gt} already exists: ${bt}. Please correct the ${gt} before proceeding.`;alert(ms);return}}catch(pt){console.error("Error checking for duplicates:",pt)}let F=[...re];if(b&&$.trim()){const pt=$.split(",").map(gt=>gt.trim()).filter(gt=>gt.length>0);F=[...F,...pt]}F=[...new Set(F.filter(pt=>pt&&pt.trim().length>0))],console.log("Selected software list for update:",F);const ie={};v.whatsappNumber&&(ie.whatsappNumber=v.whatsappNumber),v.localAddress&&(ie.localAddress=v.localAddress),v.permanentAddress&&(ie.permanentAddress=v.permanentAddress),(v.emergencyContactNumber||v.emergencyName||v.emergencyRelation)&&(ie.emergencyContact={number:v.emergencyContactNumber||null,name:v.emergencyName||null,relation:v.emergencyRelation||null}),v.courseName&&(ie.courseName=v.courseName),v.totalDeal!==void 0&&(ie.totalDeal=v.totalDeal),v.bookingAmount!==void 0&&(ie.bookingAmount=v.bookingAmount),v.balanceAmount!==void 0&&(ie.balanceAmount=v.balanceAmount),v.emiPlan!==void 0&&(ie.emiPlan=v.emiPlan),v.emiPlanDate&&(ie.emiPlanDate=v.emiPlanDate),v.emiInstallments&&v.emiInstallments.length>0&&(ie.emiInstallments=v.emiInstallments);const be={};Z&&(be.photo=Z),Ie&&(be.panCard=Ie),Me&&(be.aadharCard=Me),Ne.length>0&&(be.otherDocuments=Ne),S.length>0&&(be.uploadedDocuments=S);const qe=[...Z?[Z.url]:[],...Ie?[Ie.url]:[],...Me?[Me.url]:[],...Ne.map(pt=>pt.url),...S.map(pt=>pt.url)];qe.length>0&&(ie.enrollmentDocuments=qe),Object.keys(be).length>0&&(ie.documents=be),v.complimentarySoftware&&(ie.complimentarySoftware=v.complimentarySoftware),v.complimentaryGift&&(ie.complimentaryGift=v.complimentaryGift),v.hasReference!==void 0&&(ie.hasReference=v.hasReference),v.referenceDetails&&(ie.referenceDetails=v.referenceDetails),v.counselorName&&(ie.counselorName=v.counselorName),v.leadSource&&(ie.leadSource=v.leadSource),v.walkinDate&&(ie.walkinDate=v.walkinDate),v.masterFaculty&&(ie.masterFaculty=v.masterFaculty),v.dateOfAdmission&&(ie.dateOfAdmission=v.dateOfAdmission),v.lumpSumPayment!==void 0&&(ie.lumpSumPayment=v.lumpSumPayment),v.nextPayDate&&(ie.nextPayDate=v.nextPayDate),v.lumpSumPayments&&v.lumpSumPayments.length>0&&(ie.lumpSumPayments=v.lumpSumPayments),v.schedule&&v.schedule.length>0&&(ie.schedule=v.schedule),v.totalDuration!==void 0&&v.totalDuration!==null&&(ie.totalDuration=v.totalDuration),v.startDate&&(ie.startDate=v.startDate),v.endDate&&(ie.endDate=v.endDate);let Je;q?Je=q:(xt=oe==null?void 0:oe.studentProfile)!=null&&xt.photoUrl?Je=oe.studentProfile.photoUrl:oe!=null&&oe.avatarUrl&&(Je=oe.avatarUrl);const ke={name:v.name,email:v.email,phone:v.phone,isActive:v.isActive,avatarUrl:Je},$e={dob:v.dob,address:v.localAddress||v.address,enrollmentDate:v.enrollmentDate||v.dateOfAdmission,status:v.status,softwareList:F.length>0?F:void 0,photoUrl:Je,documents:{enrollmentMetadata:ie}};try{await ot.mutateAsync(ke),await I.mutateAsync($e),K(null),alert("Student updated successfully!"),a("/students")}catch(pt){console.error("Error updating student:",pt)}},ne=async()=>{if(i===1){if(!v.name||!v.name.trim()){alert("Student Name is required");return}if(!v.phone||!v.phone.trim()){alert("Phone number is required");return}try{const d=await kt.checkDuplicate(v.email,v.phone,Number(t));if(d.data.exists&&d.data.studentId){const F=d.data.type,ie=d.data.studentName,be=`A student with this ${F} already exists: ${ie}. Please correct the ${F} before proceeding.`;alert(be);return}}catch(d){console.error("Error checking for duplicates:",d)}}i<m&&h(i+1)},we=()=>{i>1&&h(i-1)};return s?n?A?e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto p-4 md:p-6",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6",children:[e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}),e.jsx("p",{className:"text-center text-gray-600 mt-4",children:"Loading student data..."})]})})}):L||!oe?e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto p-4 md:p-6",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6",children:[e.jsx("p",{className:"text-red-600 text-lg font-semibold",children:"Error loading student data"}),e.jsx("p",{className:"text-gray-600 mt-2",children:((rt=(Ke=L==null?void 0:L.response)==null?void 0:Ke.data)==null?void 0:rt.message)||(L instanceof Error?L.message:"Student not found")||"Internal server error while fetching user"}),((ct=L==null?void 0:L.response)==null?void 0:ct.status)&&e.jsxs("p",{className:"text-gray-500 text-xs mt-1",children:["Status Code: ",L.response.status]}),e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row gap-3",children:[e.jsx("button",{onClick:()=>z(),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Retry"}),e.jsx("button",{onClick:()=>a("/students"),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:"Back to Students"})]})]})})}):e.jsx(et,{children:e.jsx("div",{className:"max-w-4xl mx-auto p-4 md:p-6",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-orange-500 px-4 md:px-8 py-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-white",children:"Edit Student"}),e.jsx("p",{className:"mt-2 text-orange-100 text-sm md:text-base",children:"Update student information"})]}),e.jsx("button",{onClick:()=>a("/students"),className:"px-4 py-2 bg-white text-orange-600 rounded-lg font-semibold hover:bg-orange-50 transition-colors text-sm md:text-base",children:" Back"})]})}),e.jsx("div",{className:"px-4 md:px-8 py-4 bg-gray-50 border-b",children:e.jsx("div",{className:"flex items-center justify-between overflow-x-auto",children:[1,2,3,4].map(d=>e.jsxs(At.Fragment,{children:[e.jsxs("div",{className:"flex items-center min-w-0 flex-shrink-0",children:[e.jsx("div",{className:`w-8 h-8 md:w-10 md:h-10 rounded-full flex items-center justify-center font-semibold text-sm md:text-base ${i>=d?"bg-orange-600 text-white":"bg-gray-300 text-gray-600"}`,children:d}),e.jsxs("span",{className:`ml-2 text-xs md:text-sm font-medium hidden sm:inline ${i>=d?"text-orange-600":"text-gray-500"}`,children:[d===1&&"Basic Info",d===2&&"Contact & Address",d===3&&"Course & Financial",d===4&&"Additional Info"]})]}),d<m&&e.jsx("div",{className:`flex-1 h-1 mx-1 md:mx-2 min-w-[20px] ${i>d?"bg-orange-600":"bg-gray-300"}`})]},d))})}),e.jsx("form",{onSubmit:d=>{d.preventDefault()},onKeyDown:d=>{if(d.key==="Enter"){if(d.target.tagName==="TEXTAREA")return;d.preventDefault(),d.stopPropagation()}},children:e.jsxs("div",{ref:Xe,className:"p-4 md:p-8 max-h-[calc(100vh-12rem)] overflow-y-auto",children:[i===1&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-900 mb-6",children:"Basic Information"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Student Photo"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:items-start gap-4",children:[(()=>{var ie;let d=j;if(d)d.startsWith("data:")||(d=He(d)||d);else{const be=((ie=oe==null?void 0:oe.studentProfile)==null?void 0:ie.photoUrl)||(oe==null?void 0:oe.avatarUrl);d=be?He(be)||be:null}const F=v.name||(oe==null?void 0:oe.name)||"Student";if(d){const be=d+(d.includes("?")?"&":"?")+`t=${Date.now()}`;return e.jsx("img",{src:be,alt:F,className:"w-24 h-24 md:w-32 md:h-32 rounded-full object-cover border-4 border-orange-500 shadow-lg",crossOrigin:"anonymous",onError:qe=>{console.error("Student photo failed to load:",d),qe.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZmY5NTAwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSI0OCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPnt7c3R1ZGVudE5hbWUuY2hhckF0KDApfX08L3RleHQ+PC9zdmc+"}},`student-photo-${d}-${Date.now()}`)}else return e.jsx("div",{className:"w-24 h-24 md:w-32 md:h-32 rounded-full bg-orange-500 flex items-center justify-center text-white font-bold text-2xl md:text-3xl shadow-lg",children:F.charAt(0).toUpperCase()})})(),e.jsxs("div",{className:"flex-1 w-full sm:w-auto",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload Photo"}),e.jsx("input",{type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp,image/gif",onChange:Oe,disabled:ve,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 text-sm"}),ve&&e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Uploading..."}),p&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:p}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"JPG, PNG, WEBP, GIF - Max 5MB"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Student Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:v.name||"",onChange:d=>f("name",d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Email ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"email",required:!0,value:v.email||"",onChange:d=>f("email",d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Phone ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"tel",required:!0,value:v.phone||"",onChange:d=>f("phone",d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"}),e.jsx("div",{className:"mt-2",children:e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:de,onChange:d=>{const F=d.target.checked;N(F),F&&v.phone?f("whatsappNumber",v.phone):F||v.whatsappNumber===v.phone&&f("whatsappNumber","")},className:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Phone number is WhatsApp number"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"WhatsApp Number"}),e.jsx("input",{type:"tel",value:v.whatsappNumber||"",onChange:d=>{f("whatsappNumber",d.target.value),de&&d.target.value!==v.phone&&N(!1)},disabled:de,className:`w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 ${de?"bg-gray-100 cursor-not-allowed":""}`}),de&&e.jsx("p",{className:"mt-1 text-xs text-blue-600",children:" Auto-filled from phone number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date of Birth"}),e.jsx("input",{type:"date",value:me(v.dob),onChange:d=>f("dob",d.target.value),max:new Date().toISOString().split("T")[0],className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Must be at least 18 years old"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date of Admission"}),e.jsx("input",{type:"date",value:me(v.dateOfAdmission),onChange:d=>f("dateOfAdmission",d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Account Status ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:v.isActive?"true":"false",onChange:d=>f("isActive",d.target.value==="true"),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Profile Status"}),e.jsxs("select",{value:v.status||"active",onChange:d=>f("status",d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"active plus",children:"Active Plus"}),e.jsx("option",{value:"dropped",children:"Dropped"}),e.jsx("option",{value:"finished",children:"Finished"}),e.jsx("option",{value:"deactive",children:"Deactive"})]})]})]})]}),i===2&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-900 mb-6",children:"Contact & Address Information"}),e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Local Address"}),e.jsx("textarea",{rows:3,value:v.localAddress||"",onChange:d=>f("localAddress",d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Permanent Address"}),e.jsx("textarea",{rows:3,value:v.permanentAddress||"",onChange:d=>f("permanentAddress",d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Emergency Contact Number"}),e.jsx("input",{type:"tel",value:v.emergencyContactNumber||"",onChange:d=>f("emergencyContactNumber",d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Emergency Contact Name"}),e.jsx("input",{type:"text",value:v.emergencyName||"",onChange:d=>f("emergencyName",d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Relation"}),e.jsx("input",{type:"text",placeholder:"e.g., Father, Mother, Guardian",value:v.emergencyRelation||"",onChange:d=>f("emergencyRelation",d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]})]})]})]}),i===3&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-900 mb-6",children:"Course & Financial Details"}),e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Course Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:v.courseName||"",onChange:d=>{var ie;f("courseName",d.target.value);const F=(ie=le==null?void 0:le.data)==null?void 0:ie.find(be=>be.name===d.target.value);if(F!=null&&F.software&&Array.isArray(F.software)&&F.software.length>0){const be=F.software;te(be),T(be)}else te(Bt),T([])},onKeyDown:d=>{d.key==="Enter"&&(d.preventDefault(),d.stopPropagation())},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select course name"}),Array.from(new Set([...((jt=le==null?void 0:le.data)==null?void 0:jt.map(d=>d.name))||[],...((Ft=ye==null?void 0:ye.data)==null?void 0:Ft.courseNames)||[]])).sort((d,F)=>d.localeCompare(F)).map(d=>e.jsx("option",{value:d,children:d},d))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Batch"}),e.jsxs("select",{value:(($t=v.batchId)==null?void 0:$t.toString())||"",onChange:d=>f("batchId",d.target.value?parseInt(d.target.value):void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select a batch (optional)"}),it.map(d=>e.jsxs("option",{value:d.id,children:[d.title," ",d.software?`- ${d.software}`:""," (",d.mode,")"]},d.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Softwares Included ",e.jsx("span",{className:"text-red-500",children:"*"})]}),v.courseName?e.jsx("div",{className:"mb-2 p-2 bg-blue-50 border border-blue-200 rounded-md",children:e.jsx("p",{className:"text-xs text-blue-800",children:" Software automatically loaded from selected course. You can manually select software if course is not selected."})}):e.jsx("div",{className:"mb-2 p-2 bg-yellow-50 border border-yellow-200 rounded-md",children:e.jsx("p",{className:"text-xs text-yellow-800",children:" No course selected. You can manually select software from the list below."})}),v.courseName&&Pe.length===0&&e.jsx("div",{className:"mb-2 p-2 bg-red-50 border border-red-200 rounded-md",children:e.jsx("p",{className:"text-xs text-red-800",children:"No software found for the selected course"})}),e.jsx("div",{className:`border border-gray-300 rounded-md p-3 md:p-4 max-h-64 overflow-y-auto ${v.courseName?"bg-gray-50":""}`,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 md:gap-3",children:[Pe.map(d=>e.jsxs("label",{className:`flex items-center space-x-2 p-1 md:p-2 rounded text-sm ${v.courseName?"cursor-not-allowed opacity-75":"cursor-pointer hover:bg-gray-50"}`,children:[e.jsx("input",{type:"checkbox",checked:re.includes(d),onChange:F=>{v.courseName||R(d,F.target.checked)},disabled:!!v.courseName,className:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500 disabled:opacity-50 disabled:cursor-not-allowed"}),e.jsx("span",{className:`text-xs md:text-sm ${v.courseName?"text-gray-500":"text-gray-700"}`,children:d}),Bt.includes(d)&&e.jsx("button",{type:"button",onClick:()=>{o(F=>F.filter(ie=>ie!==d)),te(F=>F.filter(ie=>ie!==d)),re.includes(d)&&R(d,!1)},className:"ml-2 text-xs text-red-600 hover:text-red-800",children:""})]},d)),!v.courseName&&e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-1 md:p-2 rounded text-sm",children:[e.jsx("input",{type:"checkbox",checked:b,onChange:d=>{w(d.target.checked)},className:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("span",{className:"text-xs md:text-sm text-gray-700",children:"Other"})]},"Other")]})}),b&&!v.courseName&&e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Specify Other Software"}),e.jsx("input",{type:"text",value:$,onChange:d=>{const F=d.target.value;pe(F),F.trim()?F.trim().split(",").map(qe=>qe.trim()).filter(qe=>qe).forEach(qe=>{!Bt.includes(qe)&&!Y.includes(qe)&&(o(Je=>[...Je,qe]),te(Je=>[...Je,qe])),re.includes(qe)||T(Je=>[...Je,qe])}):T(ie=>ie.filter(be=>!Y.includes(be)||!F.includes(be)))},placeholder:"Enter software names (comma separated)",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:v.courseName?"Software is automatically included from the selected course":"Select all applicable software"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Total Deal Amount ()"}),e.jsx("input",{type:"number",step:"0.01",value:v.totalDeal||"",onChange:d=>f("totalDeal",d.target.value?parseFloat(d.target.value):void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Booking Amount ()"}),e.jsx("input",{type:"number",step:"0.01",value:v.bookingAmount||"",onChange:d=>f("bookingAmount",d.target.value?parseFloat(d.target.value):void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Balance Amount () ",e.jsx("span",{className:"text-xs text-gray-500",children:"(Auto-calculated)"})]}),e.jsx("input",{type:"number",step:"0.01",readOnly:!0,value:v.balanceAmount!==void 0&&v.balanceAmount!==null?v.balanceAmount.toFixed(2):"0.00",className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 cursor-not-allowed"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Balance = Total Deal - Booking Amount"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{type:"button",onClick:()=>{v.balanceAmount&&v.balanceAmount>0&&O(d=>({...d,amount:v.balanceAmount.toFixed(2)})),Q(!0)},className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm font-medium",children:"+ Add Payment"})}),e.jsxs("div",{className:"mt-6 border-t pt-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Payment History"}),e.jsx("button",{type:"button",onClick:()=>at(),className:"px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700",title:"Refresh Payments",children:" Refresh"})]}),Se?(is=Se==null?void 0:Se.data)!=null&&is.payments&&Array.isArray(Se.data.payments)&&Se.data.payments.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 p-4 bg-gray-50 rounded-lg mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Total Payments"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:Se.data.payments.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Total Amount"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:["",Se.data.payments.reduce((d,F)=>d+(Number(F.amount)||0),0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Total Paid"}),e.jsxs("p",{className:"text-lg font-semibold text-green-600",children:["",Se.data.payments.reduce((d,F)=>d+(Number(F.paidAmount)||0),0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Pending"}),e.jsxs("p",{className:"text-lg font-semibold text-orange-600",children:["",Se.data.payments.reduce((d,F)=>{const ie=Number(F.amount)||0,be=Number(F.paidAmount)||0;return d+(ie-be)},0).toFixed(2)]})]})]}),e.jsx("div",{className:"space-y-3",children:Se.data.payments.map(d=>{const F=Number(d.amount)||0,ie=Number(d.paidAmount)||0,be=F-ie,qe=Je=>{switch(Je==null?void 0:Je.toLowerCase()){case"paid":return"bg-green-100 text-green-800";case"partial":return"bg-yellow-100 text-yellow-800";case"pending":return"bg-gray-100 text-gray-800";case"overdue":return"bg-red-100 text-red-800";case"cancelled":return"bg-gray-100 text-gray-500";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-white",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4 items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Payment ID"}),e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:["#",d.id]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Amount"}),e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:["",F.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Paid"}),e.jsxs("p",{className:"text-sm font-semibold text-green-600",children:["",ie.toFixed(2),be>0&&e.jsxs("span",{className:"text-xs text-orange-600 block",children:["Pending: ",be.toFixed(2)]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Due Date"}),e.jsx("p",{className:"text-sm text-gray-900",children:d.dueDate?lt(d.dueDate):"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Status"}),e.jsx("span",{className:`inline-block px-2 py-1 rounded text-xs font-semibold capitalize ${qe(d.status)}`,children:d.status||"pending"})]}),e.jsx("div",{children:d.receiptUrl&&e.jsx("a",{href:`https://api.prashantthakar.com/api${d.receiptUrl}`,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:text-blue-800 underline",children:"View Receipt"})})]}),(d.paymentMethod||d.transactionId||d.notes)&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200 text-xs text-gray-600",children:[d.paymentMethod&&e.jsxs("p",{children:[e.jsx("strong",{children:"Method:"})," ",d.paymentMethod]}),d.transactionId&&e.jsxs("p",{children:[e.jsx("strong",{children:"Transaction ID:"})," ",d.transactionId]}),d.notes&&e.jsxs("p",{children:[e.jsx("strong",{children:"Notes:"})," ",d.notes]})]})]},d.id)})})]}):e.jsx("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:e.jsx("p",{className:"text-gray-500",children:"No payment records found for this student."})}):e.jsx("div",{className:"text-center py-4 text-gray-500",children:"Loading payments..."})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Payment Options"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"EMI Plan"}),e.jsxs("select",{value:v.emiPlan?"yes":"no",onChange:d=>f("emiPlan",d.target.value==="yes"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"no",children:"No"}),e.jsx("option",{value:"yes",children:"Yes"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Lump Sum Payment"}),e.jsxs("select",{value:v.lumpSumPayment?"yes":"no",onChange:d=>{const F=d.target.value==="yes";f("lumpSumPayment",F),F&&f("emiPlan",!1)},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"no",children:"No"}),e.jsx("option",{value:"yes",children:"Yes"})]})]})]}),v.emiPlan&&e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"EMI Plan Date"}),e.jsx("input",{type:"date",min:new Date().toISOString().split("T")[0],value:me(v.emiPlanDate),onChange:d=>f("emiPlanDate",d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]})}),v.balanceAmount&&v.balanceAmount>0&&e.jsx("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Balance Amount"}),e.jsxs("p",{className:"text-lg font-bold text-blue-900",children:["",v.balanceAmount.toFixed(2)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Total EMI Amount"}),e.jsxs("p",{className:`text-lg font-bold ${v.emiInstallments&&v.emiInstallments.length>0&&v.emiInstallments.reduce((d,F)=>d+(F.amount||0),0)>v.balanceAmount?"text-red-600":"text-blue-900"}`,children:["",((ds=v.emiInstallments)==null?void 0:ds.reduce((d,F)=>d+(F.amount||0),0).toFixed(2))||"0.00"]}),v.emiInstallments&&v.emiInstallments.length>0&&v.emiInstallments.reduce((d,F)=>d+(F.amount||0),0)>v.balanceAmount&&e.jsx("p",{className:"text-xs text-red-600 font-semibold mt-1",children:" Exceeds Balance!"})]})]})}),e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("div",{children:e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"EMI Installments (Month-wise)"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{if(!v.balanceAmount||v.balanceAmount<=0){alert("Please enter Total Deal and Booking Amount first to calculate balance");return}if(!v.emiPlanDate){alert("Please select EMI Plan Date first");return}const d=Number(v.balanceAmount),F=10,ie=d/F,be=[],qe=new Date(v.emiPlanDate);for(let ke=1;ke<=F;ke++){const $e=new Date(qe);$e.setMonth($e.getMonth()+(ke-1));const xt=$e.toISOString().split("T")[0];be.push({month:ke,amount:Math.round(ie*100)/100,dueDate:xt})}const Je=be.reduce((ke,$e)=>ke+$e.amount,0);Je!==d&&(be[be.length-1].amount=Math.round((d-(Je-be[be.length-1].amount))*100)/100),f("emiInstallments",be),fe(new Set),je(new Set)},className:"px-3 py-1 text-sm bg-green-600 text-white rounded-md hover:bg-green-700",children:"Auto-Calculate (10 EMIs)"}),e.jsx("button",{type:"button",onClick:()=>{const d=v.emiInstallments||[],F=d.length>0?Math.max(...d.map(ie=>ie.month))+1:1;f("emiInstallments",[...d,{month:F,amount:0,dueDate:""}])},className:"px-3 py-1 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"+ Add Installment"})]})]}),v.emiInstallments&&v.emiInstallments.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 border border-gray-300",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase",children:"Month"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase",children:"Amount ()"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase",children:"Due Date"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium text-gray-700 uppercase",children:"Action"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:v.emiInstallments.map((d,F)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"number",min:"1",value:d.month,onChange:ie=>{const be=[...v.emiInstallments||[]];be[F].month=parseInt(ie.target.value)||1,f("emiInstallments",be)},className:"w-20 px-2 py-1 border border-gray-300 rounded-md"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"number",step:"0.01",min:"0",value:d.amount,onChange:ie=>{const be=[...v.emiInstallments||[]],qe=parseFloat(ie.target.value)||0;if(fe(Je=>new Set(Je).add(F)),be[F].amount=qe,v.balanceAmount&&be.length>1){const Je=Number(v.balanceAmount),ke=be.reduce((xt,pt,gt)=>X.has(gt)||gt===F?xt+(pt.amount||0):xt,0),$e=be.map((xt,pt)=>pt).filter(xt=>xt!==F&&!X.has(xt));if($e.length>0){const xt=Je-ke;if(xt>=0){const pt=xt/$e.length;$e.forEach(bt=>{be[bt].amount=Math.round(pt*100)/100});const gt=be.reduce((bt,ms)=>bt+(ms.amount||0),0);if(gt!==Je&&$e.length>0){const bt=$e[$e.length-1],ms=Je-(gt-be[bt].amount);be[bt].amount=Math.round(ms*100)/100}}}}f("emiInstallments",be)},className:"w-32 px-2 py-1 border border-gray-300 rounded-md"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",min:new Date().toISOString().split("T")[0],value:me(d.dueDate),onChange:ie=>{const be=[...v.emiInstallments||[]],qe=ie.target.value;if(be[F].dueDate=qe,!Fe.has(F)&&qe){const Je=new Date(qe);for(let ke=F+1;ke<be.length;ke++)if(!Fe.has(ke)){const $e=new Date(Je);$e.setMonth($e.getMonth()+(ke-F)),be[ke].dueDate=$e.toISOString().split("T")[0]}}f("emiInstallments",be)},className:"flex-1 px-2 py-1 border border-gray-300 rounded-md"}),e.jsxs("label",{className:"flex items-center gap-1 text-xs text-gray-600 whitespace-nowrap",children:[e.jsx("input",{type:"checkbox",checked:Fe.has(F),onChange:ie=>{var be;if(ie.target.checked)je(qe=>new Set(qe).add(F));else{je(Je=>{const ke=new Set(Je);return ke.delete(F),ke});const qe=[...v.emiInstallments||[]];if(F>0&&((be=qe[F-1])!=null&&be.dueDate)){const Je=new Date(qe[F-1].dueDate);Je.setMonth(Je.getMonth()+1),qe[F].dueDate=Je.toISOString().split("T")[0];for(let ke=F+1;ke<qe.length;ke++)if(!Fe.has(ke)){const $e=new Date(Je);$e.setMonth($e.getMonth()+(ke-F)),qe[ke].dueDate=$e.toISOString().split("T")[0]}f("emiInstallments",qe)}}},className:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500",title:"Mark as custom date (won't auto-update)"}),e.jsx("span",{children:"Custom"})]})]})}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("button",{type:"button",onClick:()=>{const ie=[...v.emiInstallments||[]];if(ie.splice(F,1),je(be=>{const qe=new Set;return be.forEach(Je=>{Je<F?qe.add(Je):Je>F&&qe.add(Je-1)}),qe}),fe(be=>{const qe=new Set;return be.forEach(Je=>{Je<F?qe.add(Je):Je>F&&qe.add(Je-1)}),qe}),v.balanceAmount&&ie.length>0){const be=Number(v.balanceAmount),qe=ie.length,Je=be/qe;ie.forEach($e=>{$e.amount=Math.round(Je*100)/100});const ke=ie.reduce(($e,xt)=>$e+xt.amount,0);if(ke!==be){const $e=ie.length-1,xt=be-(ke-ie[$e].amount);ie[$e].amount=Math.round(xt*100)/100}if(ie.forEach(($e,xt)=>{$e.month=xt+1}),v.emiPlanDate){const $e=new Date(v.emiPlanDate);ie.forEach((xt,pt)=>{const gt=new Date($e);gt.setMonth(gt.getMonth()+pt),xt.dueDate=gt.toISOString().split("T")[0]})}}f("emiInstallments",ie)},className:"px-2 py-1 text-sm text-red-600 hover:text-red-800",children:"Remove"})})]},F))})]})}):e.jsx("p",{className:"text-sm text-gray-500 italic",children:'No installments added. Click "Add Installment" to add month-wise EMI details.'})]}),v.lumpSumPayment&&e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Lump Sum Payment Details"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Next Pay Date"}),e.jsx("input",{type:"date",value:v.lumpSumPayment&&(!v.lumpSumPayments||v.lumpSumPayments.length===0)&&v.nextPayDate||"",onChange:d=>{f("nextPayDate",d.target.value)},disabled:!v.lumpSumPayment||v.lumpSumPayments&&v.lumpSumPayments.length>0,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 border-gray-300 focus:ring-orange-500 ${!v.lumpSumPayment||v.lumpSumPayments&&v.lumpSumPayments.length>0?"bg-gray-100 cursor-not-allowed":""}`})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Payment Schedule"}),e.jsx("button",{type:"button",onClick:()=>{const d={date:"",amount:0};f("lumpSumPayments",[...v.lumpSumPayments||[],d])},className:"px-3 py-1 bg-green-600 text-white text-sm rounded-md hover:bg-green-700 transition-colors",children:"+ Add Payment"})]}),v.lumpSumPayments&&v.lumpSumPayments.length>0&&e.jsx("div",{className:"overflow-x-auto mt-4",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 border border-gray-300 rounded",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Amount ()"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:(v.lumpSumPayments||[]).map((d,F)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("input",{type:"date",min:new Date().toISOString().split("T")[0],value:d.date,onChange:ie=>{const be=[...v.lumpSumPayments||[]];be[F]&&(be[F]={...be[F],date:ie.target.value}),f("lumpSumPayments",be)},className:"w-full px-2 py-1 border border-gray-300 rounded text-sm"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("input",{type:"number",min:"0",step:"0.01",value:d.amount||"",onChange:ie=>{const be=[...v.lumpSumPayments||[]];be[F]&&(be[F]={...be[F],amount:Number(ie.target.value)}),f("lumpSumPayments",be)},className:"w-full px-2 py-1 border border-gray-300 rounded text-sm"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:e.jsx("button",{type:"button",onClick:()=>{const ie=[...v.lumpSumPayments||[]];ie.splice(F,1),f("lumpSumPayments",ie)},className:"px-2 py-1 bg-red-600 text-white text-xs rounded hover:bg-red-700 transition-colors",children:"Remove"})})]},F))})]})})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6 mt-6",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Class Schedule"}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Add class timings for each day"}),e.jsx("div",{className:"space-y-3 mb-4",children:(v.schedule||[]).map((d,F)=>e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-end",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Day"}),e.jsxs("select",{value:d.day,onChange:ie=>{const be=[...v.schedule||[]];be[F].day=ie.target.value,f("schedule",be)},className:"w-full px-2 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select Day"}),e.jsx("option",{value:"Monday",children:"Monday"}),e.jsx("option",{value:"Tuesday",children:"Tuesday"}),e.jsx("option",{value:"Wednesday",children:"Wednesday"}),e.jsx("option",{value:"Thursday",children:"Thursday"}),e.jsx("option",{value:"Friday",children:"Friday"}),e.jsx("option",{value:"Saturday",children:"Saturday"}),e.jsx("option",{value:"Sunday",children:"Sunday"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Start Time"}),e.jsx("input",{type:"time",value:d.startTime,onChange:ie=>{const be=[...v.schedule||[]];be[F].startTime=ie.target.value,f("schedule",be)},className:"w-full px-2 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"End Time"}),e.jsx("input",{type:"time",value:d.endTime,onChange:ie=>{const be=[...v.schedule||[]];be[F].endTime=ie.target.value,f("schedule",be)},className:"w-full px-2 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-orange-500"})]})]}),e.jsx("button",{type:"button",onClick:()=>{const ie=[...v.schedule||[]];ie.splice(F,1),f("schedule",ie)},className:"px-3 py-2 bg-red-600 text-white rounded-md text-sm hover:bg-red-700",children:"Remove"})]},F))}),e.jsx("button",{type:"button",onClick:()=>{const d={day:"",startTime:"",endTime:""},F=[...v.schedule||[],d];f("schedule",F)},className:"px-4 py-2 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700",children:"+ Add Time Slot"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mt-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Total Duration (days)"}),e.jsx("input",{type:"number",min:"1",value:v.totalDuration??"",onChange:d=>{const F=d.target.value?parseInt(d.target.value):null;f("totalDuration",F)},placeholder:"e.g., 90 days",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Total duration of the course in days"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",value:v.startDate||"",onChange:d=>f("startDate",d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date"}),e.jsx("input",{type:"date",value:v.endDate||"",onChange:d=>f("endDate",d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]})]})]}),i===4&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-900 mb-6",children:"Additional Information"}),e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Complimentary Software"}),e.jsx("div",{className:"border border-gray-300 rounded-md p-3 max-h-56 overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:Bt.map(d=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-1 rounded",children:[e.jsx("input",{type:"checkbox",value:d,checked:(v.complimentarySoftware||"").split(",").map(F=>F.trim()).filter(Boolean).includes(d),onChange:F=>{const ie=F.target.checked,be=(v.complimentarySoftware||"").split(",").map(Je=>Je.trim()).filter(Boolean),qe=ie?Array.from(new Set([...be,d])):be.filter(Je=>Je!==d);f("complimentarySoftware",qe.join(", "))},className:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:d})]},d))})}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Select all complimentary software given to the student."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Complimentary Gift"}),e.jsx("input",{type:"text",value:v.complimentaryGift||"",onChange:d=>f("complimentaryGift",d.target.value),onKeyDown:d=>{d.key==="Enter"&&(d.preventDefault(),d.stopPropagation())},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Has Reference"}),e.jsxs("select",{value:v.hasReference?"yes":"no",onChange:d=>f("hasReference",d.target.value==="yes"),onKeyDown:d=>{d.key==="Enter"&&(d.preventDefault(),d.stopPropagation())},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"no",children:"No"}),e.jsx("option",{value:"yes",children:"Yes"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reference Details"}),e.jsx("textarea",{rows:3,value:v.referenceDetails||"",onChange:d=>f("referenceDetails",d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Employee Name"}),e.jsxs("select",{value:v.counselorName||"",onChange:d=>f("counselorName",d.target.value),onKeyDown:d=>{d.key==="Enter"&&(d.preventDefault(),d.stopPropagation())},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select employee"}),(y=(cs=he==null?void 0:he.data)==null?void 0:cs.users)==null?void 0:y.map(d=>e.jsx("option",{value:d.name,children:d.name},d.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Lead Source"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:v.leadSource||"",onChange:d=>{const F=d.target.value;if(f("leadSource",F),F==="Walk-in"&&(!v.walkinDate||!v.walkinDate.trim())){const be=new Date().toISOString().split("T")[0];f("walkinDate",be)}},onKeyDown:d=>{d.key==="Enter"&&(d.preventDefault(),d.stopPropagation())},className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select lead source"}),Ce.map(d=>e.jsx("option",{value:d,children:d},d))]}),n&&e.jsx("button",{type:"button",onClick:()=>{se(null),G(""),c(!0)},className:"px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm",title:"Manage Lead Sources",children:""})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Walk-in Date",v.leadSource==="Walk-in"&&e.jsx("span",{className:"text-xs text-gray-500 ml-1",children:"(Auto-filled if not entered)"})]}),e.jsx("input",{type:"date",value:me(v.walkinDate),onChange:d=>f("walkinDate",d.target.value),onKeyDown:d=>{d.key==="Enter"&&(d.preventDefault(),d.stopPropagation())},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Faculty"}),e.jsxs("select",{value:v.masterFaculty||"",onChange:d=>f("masterFaculty",d.target.value),onKeyDown:d=>{d.key==="Enter"&&(d.preventDefault(),d.stopPropagation())},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select faculty"}),((We=(ee=B==null?void 0:B.data)==null?void 0:ee.users)==null?void 0:We.map(d=>e.jsx("option",{value:d.name,children:d.name},d.id)))||((Ge=(Le=B==null?void 0:B.data)==null?void 0:Le.faculty)==null?void 0:Ge.map(d=>e.jsx("option",{value:d.name,children:d.name},d.id)))]})]})]}),e.jsxs("div",{className:"border-t pt-6 mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Student Documents"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Photo ",e.jsx("span",{className:"text-xs text-gray-500",children:"(JPG, PNG, PDF)"})]}),e.jsx("input",{type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:Oe,onKeyDown:d=>{d.key==="Enter"&&(d.preventDefault(),d.stopPropagation())},disabled:ve,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 disabled:opacity-50"}),ve&&e.jsx("p",{className:"mt-2 text-sm text-blue-600",children:"Uploading photo..."}),Z&&e.jsx("div",{className:"mt-3 p-3 bg-gray-50 border border-gray-200 rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[e.jsx("div",{className:"flex-shrink-0",children:Z.url.toLowerCase().endsWith(".pdf")?e.jsx("span",{className:"text-2xl",children:""}):e.jsx("span",{className:"text-2xl",children:""})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:Z.name}),Z.size&&e.jsxs("p",{className:"text-xs text-gray-500",children:[(Z.size/1024).toFixed(2)," KB"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("a",{href:He(Z.url)||Z.url,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1 text-sm text-blue-600 hover:text-blue-800 border border-blue-300 rounded hover:bg-blue-50",children:"View"}),e.jsx("button",{type:"button",onClick:()=>J(null),className:"px-3 py-1 text-sm text-red-600 hover:text-red-800 border border-red-300 rounded hover:bg-red-50",children:"Remove"})]})]})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["PAN Card ",e.jsx("span",{className:"text-xs text-gray-500",children:"(JPG, PNG, PDF)"})]}),e.jsx("input",{type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:Ue,onKeyDown:d=>{d.key==="Enter"&&(d.preventDefault(),d.stopPropagation())},disabled:P,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 disabled:opacity-50"}),P&&e.jsx("p",{className:"mt-2 text-sm text-blue-600",children:"Uploading PAN Card..."}),Ie&&e.jsx("div",{className:"mt-3 p-3 bg-gray-50 border border-gray-200 rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[e.jsx("div",{className:"flex-shrink-0",children:Ie.url.toLowerCase().endsWith(".pdf")?e.jsx("span",{className:"text-2xl",children:""}):e.jsx("span",{className:"text-2xl",children:""})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:Ie.name}),Ie.size&&e.jsxs("p",{className:"text-xs text-gray-500",children:[(Ie.size/1024).toFixed(2)," KB"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("a",{href:He(Ie.url)||Ie.url,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1 text-sm text-blue-600 hover:text-blue-800 border border-blue-300 rounded hover:bg-blue-50",children:"View"}),e.jsx("button",{type:"button",onClick:()=>Ae(null),className:"px-3 py-1 text-sm text-red-600 hover:text-red-800 border border-red-300 rounded hover:bg-red-50",children:"Remove"})]})]})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Aadhar Card ",e.jsx("span",{className:"text-xs text-gray-500",children:"(JPG, PNG, PDF)"})]}),e.jsx("input",{type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:ze,onKeyDown:d=>{d.key==="Enter"&&(d.preventDefault(),d.stopPropagation())},disabled:U,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 disabled:opacity-50"}),U&&e.jsx("p",{className:"mt-2 text-sm text-blue-600",children:"Uploading Aadhar Card..."}),Me&&e.jsx("div",{className:"mt-3 p-3 bg-gray-50 border border-gray-200 rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[e.jsx("div",{className:"flex-shrink-0",children:Me.url.toLowerCase().endsWith(".pdf")?e.jsx("span",{className:"text-2xl",children:""}):e.jsx("span",{className:"text-2xl",children:""})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:Me.name}),Me.size&&e.jsxs("p",{className:"text-xs text-gray-500",children:[(Me.size/1024).toFixed(2)," KB"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("a",{href:He(Me.url)||Me.url,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1 text-sm text-blue-600 hover:text-blue-800 border border-blue-300 rounded hover:bg-blue-50",children:"View"}),e.jsx("button",{type:"button",onClick:()=>W(null),className:"px-3 py-1 text-sm text-red-600 hover:text-red-800 border border-red-300 rounded hover:bg-red-50",children:"Remove"})]})]})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Other Documents ",e.jsx("span",{className:"text-xs text-gray-500",children:"(Multiple files - JPG, PNG, PDF)"})]}),e.jsx("input",{type:"file",multiple:!0,accept:".pdf,.jpg,.jpeg,.png",onChange:Ve,onKeyDown:d=>{d.key==="Enter"&&(d.preventDefault(),d.stopPropagation())},disabled:ae,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 disabled:opacity-50"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"You can upload multiple files. Supported formats: PDF, JPG, PNG (Max 10MB per file)"}),ae&&e.jsx("p",{className:"mt-2 text-sm text-blue-600",children:"Uploading documents..."}),Ne.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Uploaded Other Documents (",Ne.length,")"]}),e.jsx("div",{className:"space-y-2",children:Ne.map((d,F)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 border border-gray-200 rounded-md",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[e.jsx("div",{className:"flex-shrink-0",children:d.url.toLowerCase().endsWith(".pdf")?e.jsx("span",{className:"text-2xl",children:""}):e.jsx("span",{className:"text-2xl",children:""})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:d.name}),d.size&&e.jsxs("p",{className:"text-xs text-gray-500",children:[(d.size/1024).toFixed(2)," KB"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("a",{href:He(d.url)||d.url,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1 text-sm text-blue-600 hover:text-blue-800 border border-blue-300 rounded hover:bg-blue-50",children:"View"}),e.jsx("button",{type:"button",onClick:()=>nt(F),className:"px-3 py-1 text-sm text-red-600 hover:text-red-800 border border-red-300 rounded hover:bg-red-50",children:"Remove"})]})]},F))})]})]})]})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-3 mt-6 md:mt-8 pt-6 border-t",children:[e.jsx("button",{type:"button",onClick:we,disabled:i===1,className:"w-full sm:w-auto px-6 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),i<m?e.jsx("button",{type:"button",onClick:ne,className:"w-full sm:w-auto px-6 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors",children:"Next"}):e.jsx("button",{type:"button",onClick:d=>{d.preventDefault(),d.stopPropagation(),d.currentTarget.closest("form")&&tt()},disabled:ot.isPending||I.isPending,className:"w-full sm:w-auto px-6 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:ot.isPending||I.isPending?"Saving...":"Save All Changes"})]})]})}),k&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Manage Lead Sources"}),e.jsx("button",{type:"button",onClick:()=>{c(!1),se(null),G("")},className:"text-gray-400 hover:text-gray-600 text-xl",children:""})]}),e.jsxs("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:D?"Edit Lead Source":"Add New Lead Source"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:ge,onChange:d=>G(d.target.value),placeholder:"Enter lead source name",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",autoFocus:!0,onKeyDown:d=>{d.key==="Enter"?(d.preventDefault(),ge.trim()&&(D?(Ze(F=>F.map(ie=>ie===D?ge.trim():ie)),v.leadSource===D&&f("leadSource",ge.trim())):Ce.includes(ge.trim())||Ze(F=>[...F,ge.trim()]),se(null),G(""))):d.key==="Escape"&&(se(null),G(""))}}),e.jsx("button",{type:"button",onClick:()=>{ge.trim()&&(D?(Ze(d=>d.map(F=>F===D?ge.trim():F)),v.leadSource===D&&f("leadSource",ge.trim())):Ce.includes(ge.trim())||Ze(d=>[...d,ge.trim()]),se(null),G(""))},className:"px-4 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700",children:D?"Update":"Add"}),D&&e.jsx("button",{type:"button",onClick:()=>{se(null),G("")},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300",children:"Cancel"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["All Lead Sources (",Ce.length,")"]}),Ce.length===0?e.jsx("p",{className:"text-sm text-gray-500 italic p-4 text-center",children:"No lead sources added yet"}):e.jsx("div",{className:"border border-gray-300 rounded-md divide-y divide-gray-200 max-h-64 overflow-y-auto",children:Ce.map(d=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50",children:[e.jsx("span",{className:"text-sm text-gray-900 flex-1",children:d}),n&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{se(d),G(d)},className:"px-3 py-1 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700",title:"Edit",children:" Edit"}),e.jsx("button",{type:"button",onClick:()=>{window.confirm(`Are you sure you want to delete "${d}"?`)&&(Ze(F=>F.filter(ie=>ie!==d)),v.leadSource===d&&f("leadSource",""),D===d&&(se(null),G("")))},className:"px-3 py-1 text-sm bg-red-600 text-white rounded-md hover:bg-red-700",title:"Delete",children:" Delete"})]})]},d))})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"button",onClick:()=>{c(!1),se(null),G("")},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300",children:"Close"})})]})}),Be&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Create Payment"}),e.jsx("button",{type:"button",onClick:()=>{Q(!1),O({amount:"",dueDate:"",paymentMethod:"",transactionId:"",notes:""})},className:"text-gray-400 hover:text-gray-600 text-xl",children:""})]}),e.jsxs("form",{onSubmit:Ee,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Enrollment (Optional)"}),e.jsxs("select",{id:"paymentEnrollmentId",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"No enrollment (Manual payment)"}),(Ye=De==null?void 0:De.data)==null?void 0:Ye.map(d=>{var ie;const F=d.status==="exception"||d.enrollmentStatus==="exception";return e.jsxs("option",{value:d.id,children:[((ie=d.batch)==null?void 0:ie.title)||`Enrollment #${d.id}`,F?" (Exception)":""]},d.id)})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Amount () ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",required:!0,value:l.amount,onChange:d=>O(F=>({...F,amount:d.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Due Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",required:!0,value:l.dueDate,onChange:d=>O(F=>({...F,dueDate:d.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Method"}),e.jsxs("select",{value:l.paymentMethod,onChange:d=>O(F=>({...F,paymentMethod:d.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select payment method"}),e.jsx("option",{value:"Cash",children:"Cash"}),e.jsx("option",{value:"Cheque",children:"Cheque"}),e.jsx("option",{value:"Bank Transfer",children:"Bank Transfer"}),e.jsx("option",{value:"UPI",children:"UPI"}),e.jsx("option",{value:"Credit Card",children:"Credit Card"}),e.jsx("option",{value:"Debit Card",children:"Debit Card"}),e.jsx("option",{value:"Online",children:"Online"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Transaction ID"}),e.jsx("input",{type:"text",value:l.transactionId,onChange:d=>O(F=>({...F,transactionId:d.target.value})),placeholder:"Enter transaction ID or reference number",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{rows:3,value:l.notes,onChange:d=>O(F=>({...F,notes:d.target.value})),placeholder:"Additional notes about this payment",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>{Q(!1),O({amount:"",dueDate:"",paymentMethod:"",transactionId:"",notes:""})},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:E.isPending,className:"px-4 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700 disabled:opacity-50",children:E.isPending?"Creating...":"Create Payment"})]})]})]})})]})})}):e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto p-4 md:p-6",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6",children:[e.jsx("p",{className:"text-red-600 text-lg font-semibold",children:"You don't have permission to edit students."}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Only administrators can edit student information."}),e.jsx("button",{onClick:()=>a("/students"),className:"mt-4 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Back to Students"})]})})}):e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto p-4 md:p-6",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6",children:[e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}),e.jsx("p",{className:"text-center text-gray-600 mt-4",children:"Loading user information..."})]})})})},pl=()=>{var W,Ne,V,Qe;const{user:t}=Nt(),s=Et(),a=vt(),[r,n]=g.useState(null),[i,h]=g.useState(!1),[m,j]=g.useState(!1),[C,q]=g.useState(!1),[K,re]=g.useState(null),[T,b]=g.useState(!1),[w,$]=g.useState(""),{data:pe,isLoading:Pe,error:te}=_e({queryKey:["employees"],queryFn:()=>Qt.getAllEmployees(),retry:1}),{data:Y,isLoading:o,error:de,refetch:N}=_e({queryKey:["employee-profile",r==null?void 0:r.id],queryFn:async()=>{var ve,p,M,P;if(!(r!=null&&r.id))return null;try{const H=await yt.getUser(r.id);if(console.log("User response:",H),(ve=H==null?void 0:H.data)!=null&&ve.user){const U=H.data.user;let ce=U.employeeProfile||null;if(!ce||!ce.documents)try{const ae=await Qt.getEmployeeProfile(r.id);(p=ae==null?void 0:ae.data)!=null&&p.employeeProfile&&(ce=ae.data.employeeProfile,U.employeeProfile=ce)}catch(ae){console.warn("Profile fetch failed, using profile from user response:",ae==null?void 0:ae.message)}return console.log("Employee profile from user response:",ce),{user:U,profile:ce}}}catch(H){console.warn("Failed to fetch user with profile, trying profile endpoint:",H==null?void 0:H.message)}try{const H=await yt.getUser(r.id),U=await Qt.getEmployeeProfile(r.id);if(console.log("Profile response:",U),(M=U==null?void 0:U.data)!=null&&M.employeeProfile&&((P=H==null?void 0:H.data)!=null&&P.user))return{user:H.data.user,profile:U.data.employeeProfile}}catch(H){console.warn("Profile fetch also failed:",H==null?void 0:H.message)}return console.log("Using selectedEmployee data as fallback:",r),{user:r,profile:r.employeeProfile||null}},enabled:!!(r!=null&&r.id)&&C,retry:2,staleTime:0,gcTime:0});At.useEffect(()=>{C&&r&&(a.invalidateQueries({queryKey:["employee-profile",r.id]}),a.invalidateQueries({queryKey:["employee",r.id]}),a.invalidateQueries({queryKey:["employees"]}),N())},[C,r,a,N]),At.useEffect(()=>{a.invalidateQueries({queryKey:["employees"]})},[a]);const S=st({mutationFn:ve=>yt.deleteUser(ve),onSuccess:()=>{a.invalidateQueries({queryKey:["employees"]}),h(!1),n(null),alert("Employee deleted successfully!")},onError:ve=>{var p,M;alert(((M=(p=ve.response)==null?void 0:p.data)==null?void 0:M.message)||"Failed to delete employee")}}),x=st({mutationFn:({userId:ve,avatarUrl:p})=>yt.updateUser(ve,{avatarUrl:p}),onSuccess:(ve,p)=>{if(a.invalidateQueries({queryKey:["employees"]}),a.invalidateQueries({queryKey:["users"]}),a.invalidateQueries({queryKey:["employee-profile",r==null?void 0:r.id]}),r){const M={...r,avatarUrl:p.avatarUrl};n(M);const P=He(p.avatarUrl)||p.avatarUrl,H=P+(P.includes("?")?"&":"?")+`t=${Date.now()}`;re(H)}b(!1),alert("Image updated successfully!"),setTimeout(()=>{j(!1),n(null),re(null)},1e3)},onError:ve=>{var p,M;alert(((M=(p=ve.response)==null?void 0:p.data)==null?void 0:M.message)||"Failed to update image"),b(!1)}}),Z=async ve=>{var P,H,U;const p=(P=ve.target.files)==null?void 0:P[0];if(!p||!r)return;if(!p.type.startsWith("image/")){alert("Please select an image file");return}if(p.size>5*1024*1024){alert("Image size must be less than 5MB");return}const M=new FileReader;M.onloadend=()=>{re(M.result)},M.readAsDataURL(p),b(!0);try{const ce=await wt.uploadFile(p);if(console.log("Upload response:",ce),ce.data&&ce.data.files&&ce.data.files.length>0){const ae=ce.data.files[0].url;console.log("Uploaded image URL (relative):",ae);const u=He(ae)||ae,k=u+(u.includes("?")?"&":"?")+`t=${Date.now()}`;console.log("Full image URL for preview (with cache-busting):",k),re(k),x.mutate({userId:r.id,avatarUrl:ae})}else throw new Error("No files returned from upload")}catch(ce){console.error("Upload error:",ce),alert(((U=(H=ce.response)==null?void 0:H.data)==null?void 0:U.message)||ce.message||"Failed to upload image"),b(!1),re(null)}},J=(pe==null?void 0:pe.data.users)||[],Ie=J.filter(ve=>{var M,P,H,U,ce,ae,u;if(!w.trim())return!0;const p=w.toLowerCase();return((M=ve.name)==null?void 0:M.toLowerCase().includes(p))||((P=ve.email)==null?void 0:P.toLowerCase().includes(p))||((H=ve.phone)==null?void 0:H.toLowerCase().includes(p))||((ce=(U=ve.employeeProfile)==null?void 0:U.department)==null?void 0:ce.toLowerCase().includes(p))||((u=(ae=ve.employeeProfile)==null?void 0:ae.designation)==null?void 0:u.toLowerCase().includes(p))}),Ae=ve=>{n(ve),h(!0)},Me=()=>{r&&S.mutate(r.id)};return Pe?e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})})})}):te?e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"bg-white shadow-xl rounded-lg p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-red-600 text-lg mb-4",children:"Error loading employee data"}),e.jsx("p",{className:"text-gray-500 text-sm",children:((Ne=(W=te==null?void 0:te.response)==null?void 0:W.data)==null?void 0:Ne.message)||(te==null?void 0:te.message)||"Unknown error"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Retry"})]})})})}):e.jsxs(et,{children:[e.jsx("div",{className:"max-w-7xl mx-auto p-4 md:p-6",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden overflow-x-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-orange-500 px-4 md:px-8 py-4 md:py-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-white",children:"Employee Management"}),e.jsx("p",{className:"mt-2 text-sm md:text-base text-orange-100",children:"Manage employees"})]}),((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")&&e.jsx("button",{onClick:()=>window.location.href="/employees/register",className:"px-4 py-2 bg-white text-orange-600 rounded-lg font-semibold hover:bg-orange-50 transition-colors text-sm md:text-base whitespace-nowrap",children:"+ New Employee Registration"})]})}),e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"relative max-w-md",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Search employees by name, email, phone, department, or designation...",value:w,onChange:ve=>$(ve.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"}),w&&e.jsx("button",{onClick:()=>$(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400 hover:text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),w&&e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Showing ",Ie.length," of ",J.length," employees"]})]}),Ie.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500 text-lg",children:w?"No employees found matching your search":"No employees found"}),w&&e.jsx("button",{onClick:()=>$(""),className:"mt-2 text-orange-600 hover:text-orange-700 text-sm",children:"Clear search"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"S.No"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Photo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Department"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Designation"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")&&e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Ie.map((ve,p)=>{var M,P;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:p+1})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"flex items-center",children:ve.avatarUrl?e.jsx("img",{src:(He(ve.avatarUrl)||ve.avatarUrl)+(ve.avatarUrl.includes("?")?"&":"?")+`t=${Date.now()}`,alt:ve.name,className:"h-12 w-12 rounded-full object-cover border-2 border-gray-200",crossOrigin:"anonymous",onError:H=>{console.error("Employee photo failed to load:",ve.avatarUrl),H.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2ZmOTUwMCIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMjAiIGZpbGw9IiNmZmYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj57e2VtcGxveWVlLm5hbWUuY2hhckF0KDApfX08L3RleHQ+PC9zdmc+"}},`employee-${ve.id}-${ve.avatarUrl}`):e.jsx("div",{className:"h-12 w-12 rounded-full bg-orange-500 flex items-center justify-center text-white font-semibold text-lg",children:ve.name.charAt(0).toUpperCase()})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:ve.name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:ve.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:ve.phone||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:((M=ve.employeeProfile)==null?void 0:M.department)||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:((P=ve.employeeProfile)==null?void 0:P.designation)||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${ve.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:ve.isActive?"Active":"Inactive"})}),((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")&&e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{onClick:()=>{n(ve),q(!0)},className:"text-blue-600 hover:text-blue-900 text-xs",title:"View Employee",children:" View"}),e.jsx("button",{onClick:()=>{n(ve),re(ve.avatarUrl||null),j(!0)},className:"text-orange-600 hover:text-orange-900 text-xs",title:"Update Photo",children:" Photo"}),e.jsx("button",{onClick:()=>s(`/employees/${ve.id}/edit`),className:"text-orange-600 hover:text-orange-900 text-xs",title:"Edit Employee",children:" Edit"}),(t==null?void 0:t.role)==="superadmin"&&e.jsx("button",{onClick:()=>Ae(ve),className:"text-red-600 hover:text-red-900 text-xs",title:"Delete Employee",children:" Delete"})]})})]},ve.id)})})]})})]})]})}),i&&r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-red-600",children:"Delete Employee"}),e.jsxs("p",{className:"mb-4 text-gray-700",children:["Are you sure you want to delete ",e.jsx("strong",{children:r.name}),"? This action cannot be undone."]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:Me,disabled:S.isPending,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition-colors disabled:opacity-50",children:S.isPending?"Deleting...":"Delete"}),e.jsx("button",{onClick:()=>{h(!1),n(null)},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})}),m&&r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Update Employee Photo"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("strong",{children:"Employee:"})," ",r.name]}),e.jsx("div",{className:"flex justify-center mb-4",children:K?e.jsx("img",{src:K.startsWith("data:")?K:(He(K)||K)+(K.includes("?")?"&":"?")+`t=${Date.now()}`,alt:"Preview",className:"h-32 w-32 rounded-full object-cover border-4 border-orange-500",crossOrigin:"anonymous",onError:ve=>{console.error("Image preview failed to load:",K),ve.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZmY5NTAwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSI0OCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPnt7c2VsZWN0ZWRFbXBsb3llZS5uYW1lLmNoYXJBdCgwKX19PC90ZXh0Pjwvc3ZnPg=="}},`preview-${K}-${Date.now()}`):r!=null&&r.avatarUrl?e.jsx("img",{src:(He(r.avatarUrl)||r.avatarUrl)+(r.avatarUrl.includes("?")?"&":"?")+`t=${Date.now()}`,alt:"Current",className:"h-32 w-32 rounded-full object-cover border-4 border-orange-500",crossOrigin:"anonymous",onError:ve=>{console.error("Current employee photo failed to load:",r.avatarUrl),ve.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZmY5NTAwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSI0OCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPnt7c2VsZWN0ZWRFbXBsb3llZS5uYW1lLmNoYXJBdCgwKX19PC90ZXh0Pjwvc3ZnPg=="}},`current-${r.avatarUrl}-${Date.now()}`):e.jsx("div",{className:"h-32 w-32 rounded-full bg-gray-200 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-400",children:"No image"})})}),e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Image (JPG, PNG - Max 5MB)"}),e.jsx("input",{type:"file",accept:"image/jpeg,image/jpg,image/png",onChange:Z,disabled:T,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 disabled:opacity-50"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{type:"button",onClick:()=>{j(!1),n(null),re(null)},disabled:T,className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors disabled:opacity-50",children:T?"Uploading...":"Close"})})]})}),C&&r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center z-10",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Employee Details"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>N(),className:"px-3 py-1 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700",title:"Refresh Employee Data",children:" Refresh"}),e.jsx("button",{onClick:()=>{q(!1),n(null)},className:"text-gray-400 hover:text-gray-600 text-2xl font-bold",children:""})]})]}),e.jsx("div",{className:"p-6",children:o?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"Loading employee details..."})}):de?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-red-600 font-semibold mb-2",children:"Failed to load employee details"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:((Qe=(V=de==null?void 0:de.response)==null?void 0:V.data)==null?void 0:Qe.message)||(de==null?void 0:de.message)||"An error occurred while fetching employee details"}),e.jsx("button",{onClick:()=>{a.invalidateQueries({queryKey:["employee-profile",r==null?void 0:r.id]})},className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Retry"})]}):Y?(()=>{var U,ce,ae,u,k,c,D,se,ge,G,Ce,Ze,Xe,Be,Q,l,O,X,fe,Fe,je,v,_,ue,A,L,z,oe,le;const ve=(U=Y.profile)==null?void 0:U.documents;let p=null;if(ve)if(typeof ve=="string")try{p=JSON.parse(ve)}catch(xe){console.error("Error parsing documents string:",xe)}else typeof ve=="object"&&ve!==null&&(p=ve);const M=(p==null?void 0:p.personalInfo)||{},P=(p==null?void 0:p.employmentInfo)||{},H=(p==null?void 0:p.bankInfo)||{};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 border-b pb-2",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Photo"}),e.jsx("div",{className:"mt-2",children:Y.user.avatarUrl?e.jsx("img",{src:He(Y.user.avatarUrl)||"",alt:Y.user.name,className:"h-24 w-24 rounded-full object-cover border-2 border-gray-200",crossOrigin:"anonymous",onError:xe=>{xe.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iOTYiIGhlaWdodD0iOTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2ZmOTUwMCIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMzYiIGZpbGw9IiNmZmYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj57e2VtcGxveWVlUHJvZmlsZURhdGEudXNlci5uYW1lLmNoYXJBdCgwKX19PC90ZXh0Pjwvc3ZnPg=="}}):e.jsx("div",{className:"h-24 w-24 rounded-full bg-orange-500 flex items-center justify-center text-white font-semibold text-2xl",children:Y.user.name.charAt(0).toUpperCase()})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Name"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:Y.user.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:Y.user.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Phone"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:Y.user.phone||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Employee ID"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:((ce=Y.profile)==null?void 0:ce.employeeId)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Department"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(P==null?void 0:P.department)||((ae=Y.profile)==null?void 0:ae.department)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Designation"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(P==null?void 0:P.designation)||((u=Y.profile)==null?void 0:u.designation)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Status"}),e.jsx("p",{className:"mt-1",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${Y.user.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:Y.user.isActive?"Active":"Inactive"})})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 border-b pb-2",children:"Personal Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Gender"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(M==null?void 0:M.gender)||((k=Y.profile)==null?void 0:k.gender)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Date of Birth"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:M!=null&&M.dateOfBirth?lt(M.dateOfBirth):(c=Y.profile)!=null&&c.dateOfBirth?lt(Y.profile.dateOfBirth):"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Nationality"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(M==null?void 0:M.nationality)||((D=Y.profile)==null?void 0:D.nationality)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Marital Status"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(M==null?void 0:M.maritalStatus)||((se=Y.profile)==null?void 0:se.maritalStatus)||"-"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 border-b pb-2",children:"Employment Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Date of Joining"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:P!=null&&P.dateOfJoining?lt(P.dateOfJoining):(ge=Y.profile)!=null&&ge.dateOfJoining?lt(Y.profile.dateOfJoining):"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Employment Type"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(P==null?void 0:P.employmentType)||((G=Y.profile)==null?void 0:G.employmentType)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Reporting Manager"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(P==null?void 0:P.reportingManager)||((Ce=Y.profile)==null?void 0:Ce.reportingManager)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Work Location"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(P==null?void 0:P.workLocation)||((Ze=Y.profile)==null?void 0:Ze.workLocation)||"-"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 border-b pb-2",children:"Bank Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Bank Name"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(H==null?void 0:H.bankName)||((Xe=Y.profile)==null?void 0:Xe.bankName)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Account Number"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(H==null?void 0:H.accountNumber)||((Be=Y.profile)==null?void 0:Be.accountNumber)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"IFSC Code"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(H==null?void 0:H.ifscCode)||((Q=Y.profile)==null?void 0:Q.ifscCode)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Branch"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(H==null?void 0:H.branch)||((l=Y.profile)==null?void 0:l.branch)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"PAN Number"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(H==null?void 0:H.panNumber)||((O=Y.profile)==null?void 0:O.panNumber)||"-"})]})]})]}),(((X=Y.profile)==null?void 0:X.address)||((fe=Y.profile)==null?void 0:fe.city)||((Fe=Y.profile)==null?void 0:Fe.state)||((je=Y.profile)==null?void 0:je.postalCode)||(M==null?void 0:M.address)||(M==null?void 0:M.city)||(M==null?void 0:M.state)||(M==null?void 0:M.postalCode))&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 border-b pb-2",children:"Address Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(((v=Y.profile)==null?void 0:v.address)||(M==null?void 0:M.address))&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Full Address"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:((_=Y.profile)==null?void 0:_.address)||(M==null?void 0:M.address)||"-"})]}),(((ue=Y.profile)==null?void 0:ue.city)||(M==null?void 0:M.city))&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"City"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:((A=Y.profile)==null?void 0:A.city)||(M==null?void 0:M.city)||"-"})]}),(((L=Y.profile)==null?void 0:L.state)||(M==null?void 0:M.state))&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"State"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:((z=Y.profile)==null?void 0:z.state)||(M==null?void 0:M.state)||"-"})]}),(((oe=Y.profile)==null?void 0:oe.postalCode)||(M==null?void 0:M.postalCode))&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Postal Code"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:((le=Y.profile)==null?void 0:le.postalCode)||(M==null?void 0:M.postalCode)||"-"})]})]})]}),(()=>{const xe=(p==null?void 0:p.emergencyInfo)||{},he=(p==null?void 0:p.emergencyContact)||{},B=(xe==null?void 0:xe.emergencyContactName)||(he==null?void 0:he.emergencyContactName)||(p==null?void 0:p.emergencyContactName)||"",ye=(xe==null?void 0:xe.emergencyRelationship)||(he==null?void 0:he.emergencyRelationship)||(p==null?void 0:p.emergencyRelationship)||"",De=(xe==null?void 0:xe.emergencyPhoneNumber)||(he==null?void 0:he.emergencyPhoneNumber)||(p==null?void 0:p.emergencyPhoneNumber)||"",Se=(xe==null?void 0:xe.emergencyAlternatePhone)||(he==null?void 0:he.emergencyAlternatePhone)||(p==null?void 0:p.emergencyAlternatePhone)||"";return e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 border-b pb-2",children:"Emergency Contact Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Contact Name"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:B||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Relationship"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:ye||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Phone Number"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:De||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Alternate Phone Number"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:Se||"-"})]})]})]})})(),(()=>{if(!Y.profile)return null;const xe=E=>{if(!E)return!1;if(typeof E=="string")return E.trim()!=="";if(typeof E=="object"){const f=E.url||E.URL||E.path||E.file;return f&&typeof f=="string"&&f.trim()!==""}return!1},he=p==null?void 0:p.photo,B=(p==null?void 0:p.panCard)||(p==null?void 0:p.pan),ye=(p==null?void 0:p.aadharCard)||(p==null?void 0:p.aadhar),De=(p==null?void 0:p.otherDocuments)||(p==null?void 0:p.other)||[],Se=xe(he),at=xe(B),it=xe(ye),ot=Array.isArray(De)&&De.length>0&&De.some(E=>xe(E)),I=Se||at||it||ot;return e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 border-b pb-2",children:"Documents"}),I?e.jsxs("div",{className:"space-y-4",children:[Se&&(()=>{const E=p.photo,f=(E==null?void 0:E.url)||(E==null?void 0:E.URL)||(E==null?void 0:E.path)||(E==null?void 0:E.file)||(typeof E=="string"?E:null),Ee=(E==null?void 0:E.name)||(E==null?void 0:E.filename)||"Photo";return f?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Photo"}),e.jsxs("div",{className:"flex items-center space-x-4 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:He(f)||"",alt:"Photo",className:"h-16 w-16 object-cover rounded border border-gray-300",crossOrigin:"anonymous",onError:R=>{console.error("Error loading photo:",f),R.target.style.display="none"}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:Ee}),e.jsx("p",{className:"text-xs text-gray-500",children:"Image File"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:(()=>{const R=He(f)||f||"#";return R!=="#"&&R.trim()!==""?e.jsxs(e.Fragment,{children:[e.jsx("a",{href:R,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1.5 text-sm text-blue-600 hover:text-blue-800 border border-blue-300 rounded hover:bg-blue-50",children:" View"}),e.jsx("a",{href:R,download:!0,className:"px-3 py-1.5 text-sm text-green-600 hover:text-green-800 border border-green-300 rounded hover:bg-green-50",children:" Download"})]}):e.jsx("span",{className:"px-3 py-1.5 text-sm text-gray-400 italic",children:"Invalid URL"})})()})]})]}):null})(),at&&(()=>{const E=p.panCard||p.pan,f=(E==null?void 0:E.url)||(E==null?void 0:E.URL)||(E==null?void 0:E.path)||(E==null?void 0:E.file)||(typeof E=="string"?E:null),Ee=(E==null?void 0:E.name)||(E==null?void 0:E.filename)||"PAN Card";if(!f)return null;const R=f.endsWith(".pdf")||f.includes("application/pdf");return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"PAN Card"}),e.jsxs("div",{className:"flex items-center space-x-4 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex-shrink-0",children:[R?e.jsx("div",{className:"h-16 w-16 bg-gray-200 rounded border border-gray-300 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:""})}):e.jsx("img",{src:He(f)||"",alt:"PAN Card",className:"h-16 w-16 object-cover rounded border border-gray-300",crossOrigin:"anonymous",onError:me=>{var Oe;console.error("Error loading PAN card:",f),me.target.style.display="none",(Oe=me.target.nextElementSibling)==null||Oe.classList.remove("hidden")}}),e.jsx("div",{className:"h-16 w-16 bg-gray-200 rounded border border-gray-300 flex items-center justify-center hidden",children:e.jsx("span",{className:"text-2xl",children:""})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:Ee}),e.jsx("p",{className:"text-xs text-gray-500",children:R?"PDF Document":"Image File"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:(()=>{const me=He(f)||f||"#";return me!=="#"&&me.trim()!==""?e.jsxs(e.Fragment,{children:[e.jsx("a",{href:me,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1.5 text-sm text-blue-600 hover:text-blue-800 border border-blue-300 rounded hover:bg-blue-50",children:" View"}),e.jsx("a",{href:me,download:!0,className:"px-3 py-1.5 text-sm text-green-600 hover:text-green-800 border border-green-300 rounded hover:bg-green-50",children:" Download"})]}):e.jsx("span",{className:"px-3 py-1.5 text-sm text-gray-400 italic",children:"Invalid URL"})})()})]})]})})(),it&&(()=>{const E=p.aadharCard||p.aadhar,f=(E==null?void 0:E.url)||(E==null?void 0:E.URL)||(E==null?void 0:E.path)||(E==null?void 0:E.file)||(typeof E=="string"?E:null),Ee=(E==null?void 0:E.name)||(E==null?void 0:E.filename)||"Aadhar Card";if(!f)return null;const R=f.endsWith(".pdf")||f.includes("application/pdf");return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Aadhar Card"}),e.jsxs("div",{className:"flex items-center space-x-4 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex-shrink-0",children:[R?e.jsx("div",{className:"h-16 w-16 bg-gray-200 rounded border border-gray-300 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:""})}):e.jsx("img",{src:He(f)||"",alt:"Aadhar Card",className:"h-16 w-16 object-cover rounded border border-gray-300",crossOrigin:"anonymous",onError:me=>{var Oe;console.error("Error loading Aadhar card:",f),me.target.style.display="none",(Oe=me.target.nextElementSibling)==null||Oe.classList.remove("hidden")}}),e.jsx("div",{className:"h-16 w-16 bg-gray-200 rounded border border-gray-300 flex items-center justify-center hidden",children:e.jsx("span",{className:"text-2xl",children:""})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:Ee}),e.jsx("p",{className:"text-xs text-gray-500",children:R?"PDF Document":"Image File"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:(()=>{const me=He(f)||f||"#";return me!=="#"&&me.trim()!==""?e.jsxs(e.Fragment,{children:[e.jsx("a",{href:me,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1.5 text-sm text-blue-600 hover:text-blue-800 border border-blue-300 rounded hover:bg-blue-50",children:" View"}),e.jsx("a",{href:me,download:!0,className:"px-3 py-1.5 text-sm text-green-600 hover:text-green-800 border border-green-300 rounded hover:bg-green-50",children:" Download"})]}):e.jsx("span",{className:"px-3 py-1.5 text-sm text-gray-400 italic",children:"Invalid URL"})})()})]})]})})(),ot&&(()=>{const E=p.otherDocuments||p.other||[],f=Array.isArray(E)?E.filter(Ee=>{const R=typeof Ee=="string"?Ee:(Ee==null?void 0:Ee.url)||(Ee==null?void 0:Ee.URL)||(Ee==null?void 0:Ee.path)||(Ee==null?void 0:Ee.file);return R&&typeof R=="string"&&R.trim()!==""}):[];return f.length===0?null:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Other Documents"}),e.jsx("div",{className:"space-y-2",children:f.map((Ee,R)=>{const me=typeof Ee=="string"?Ee:(Ee==null?void 0:Ee.url)||(Ee==null?void 0:Ee.URL)||(Ee==null?void 0:Ee.path)||(Ee==null?void 0:Ee.file),Oe=typeof Ee=="string"?`Document ${R+1}`:(Ee==null?void 0:Ee.name)||(Ee==null?void 0:Ee.filename)||`Document ${R+1}`,Ue=He(me)||me||"#",ze=(me==null?void 0:me.endsWith(".pdf"))||(me==null?void 0:me.includes("application/pdf")),Ve=me==null?void 0:me.match(/\.(jpg|jpeg|png|gif|webp)$/i),nt=Ue!=="#"&&Ue.trim()!=="";return e.jsxs("div",{className:"flex items-center space-x-4 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex-shrink-0",children:[Ve&&me&&nt?e.jsx("img",{src:Ue,alt:Oe,className:"h-16 w-16 object-cover rounded border border-gray-300",crossOrigin:"anonymous",onError:dt=>{var tt;dt.target.style.display="none",(tt=dt.target.nextElementSibling)==null||tt.classList.remove("hidden")}}):e.jsx("div",{className:"h-16 w-16 bg-gray-200 rounded border border-gray-300 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:ze?"":""})}),e.jsx("div",{className:"h-16 w-16 bg-gray-200 rounded border border-gray-300 flex items-center justify-center hidden",children:e.jsx("span",{className:"text-2xl",children:""})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",title:Oe,children:Oe}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:ze?"PDF Document":Ve?"Image File":"Document"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:nt?e.jsxs(e.Fragment,{children:[e.jsx("a",{href:Ue,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1.5 text-sm text-blue-600 hover:text-blue-800 border border-blue-300 rounded hover:bg-blue-50",title:"View Document",children:" View"}),e.jsx("a",{href:Ue,download:!0,className:"px-3 py-1.5 text-sm text-green-600 hover:text-green-800 border border-green-300 rounded hover:bg-green-50",title:"Download Document",children:" Download"})]}):e.jsx("span",{className:"px-3 py-1.5 text-sm text-gray-400 italic",children:"Invalid URL"})})]},R)})})]})})()]}):e.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("p",{className:"text-gray-500 mb-2",children:"No documents uploaded for this employee."}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"Documents can be uploaded through the Edit Employee page."})]})]})})()]})})():e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"Failed to load employee details."})})}),e.jsxs("div",{className:"sticky bottom-0 bg-gray-50 border-t px-6 py-4 flex justify-between items-center",children:[((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")&&e.jsx("button",{onClick:()=>{r&&(q(!1),a.invalidateQueries({queryKey:["employee-profile",r.id]}),a.invalidateQueries({queryKey:["employee",r.id]}),a.invalidateQueries({queryKey:["employees"]}),s(`/employees/${r.id}/edit`))},className:"px-6 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors",children:" Edit Employee"}),e.jsx("button",{onClick:()=>{q(!1),n(null)},className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300",children:"Close"})]})]})})]})},fl=t=>!t||t.trim()===""?"Email is required":/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)?null:"Please enter a valid email address",Mt=t=>{if(!t||t.trim()==="")return"Phone number is required";const s=t.replace(/\D/g,"");if(s.length===10){if(!/^[6-9][0-9]{9}$/.test(s))return"Phone number must start with 6, 7, 8, or 9 and be 10 digits"}else if(s.length===12&&s.startsWith("91")){if(!/^91[6-9][0-9]{9}$/.test(s))return"Invalid phone number format"}else if(s.length===13&&s.startsWith("9191")){if(!/^9191[6-9][0-9]{9}$/.test(s))return"Invalid phone number format"}else return"Phone number must be 10 digits (or 12 digits with country code 91)";return null},mt=(t,s)=>!t||t.trim()===""?`${s} is required`:null,Qs=t=>!t||t.trim()===""?"PAN number is required":/^[A-Z]{5}[0-9]{4}[A-Z]{1}$/.test(t.toUpperCase())?null:"PAN must be in format: ABCDE1234F (5 letters, 4 digits, 1 letter)",Hs=t=>!t||t.trim()===""?"IFSC code is required":/^[A-Z]{4}0[A-Z0-9]{6}$/.test(t.toUpperCase())?null:"IFSC code must be in format: ABCD0123456 (4 letters, 0, 6 alphanumeric)",Ys=t=>!t||t.trim()===""?"Account number is required":/^[0-9]{9,18}$/.test(t.replace(/\s/g,""))?null:"Account number must be 9-18 digits",Xs=t=>!t||t.trim()===""?"Postal code is required":/^[0-9]{6}$/.test(t)?null:"Postal code must be 6 digits",rs=(t,s)=>{if(!t||t.trim()==="")return`${s} is required`;const a=new Date(t);if(isNaN(a.getTime()))return`Please enter a valid ${s}`;if(s.toLowerCase().includes("birth")){if(a>new Date)return"Date of birth cannot be in the future";const r=new Date;let n=r.getFullYear()-a.getFullYear();const i=r.getMonth()-a.getMonth(),h=r.getDate()-a.getDate();if((i<0||i===0&&h<0)&&n--,n<18)return`${s.toLowerCase().includes("employee")?"Employee":s.toLowerCase().includes("faculty")?"Faculty":"Person"} must be at least 18 years old`}return null},ea=t=>!t||t.trim()===""?"Employee ID is required":t.trim().length<3?"Employee ID must be at least 3 characters":null,yl=()=>{const t=Et(),s=vt(),[a,r]=g.useState(1),n=6,[i,h]=g.useState(null),[m,j]=g.useState({}),[C,q]=g.useState(null),[K,re]=g.useState(null),[T,b]=g.useState(null),[w,$]=g.useState([]),[pe,Pe]=g.useState(!1),[te,Y]=g.useState(!1),[o,de]=g.useState(!1),[N,S]=g.useState(!1),[x,Z]=g.useState({employeeId:"",gender:"",dateOfBirth:"",nationality:"",maritalStatus:"",department:"",designation:"",dateOfJoining:"",employmentType:"",reportingManager:"",workLocation:"",bankName:"",accountNumber:"",ifscCode:"",branch:"",panNumber:"",city:"",state:"",postalCode:"",address:"",emergencyContactName:"",emergencyRelationship:"",emergencyPhoneNumber:"",emergencyAlternatePhone:"",documents:[],fullName:"",email:"",contactNumber:"",password:""}),J=st({mutationFn:async u=>(await Re.post("/auth/register",u)).data,onSuccess:u=>{h(u.data.user.id),r(2)},onError:u=>{var k,c,D,se,ge,G,Ce,Ze;(D=(c=(k=u.response)==null?void 0:k.data)==null?void 0:c.message)!=null&&D.includes("already exists")||(G=(ge=(se=u.response)==null?void 0:se.data)==null?void 0:ge.message)!=null&&G.includes("duplicate")?Ie():alert(((Ze=(Ce=u.response)==null?void 0:Ce.data)==null?void 0:Ze.message)||"Failed to create user account")}}),Ie=async()=>{const u=x.email||"";try{const k=await Re.get(`/users?email=${encodeURIComponent(u)}`);if(k.data&&k.data.length>0){const c=k.data[0];h(c.id),r(2)}}catch(k){console.error("Error getting existing user:",k),alert("User with this email already exists, but could not retrieve user details. Please contact support.")}},Ae=st({mutationFn:u=>Qt.createEmployeeProfile(u),onSuccess:()=>{s.invalidateQueries({queryKey:["employees"]}),s.invalidateQueries({queryKey:["users"]}),alert("Employee registration completed successfully!"),t("/employees")},onError:u=>{var k,c;alert(((c=(k=u.response)==null?void 0:k.data)==null?void 0:c.message)||"Failed to create employee profile")}}),Me=u=>{const{name:k,value:c}=u.target;Z(D=>({...D,[k]:c}))},W=(u,k)=>{Z(c=>({...c,[u]:k}))},Ne=(u,k)=>{Z(c=>({...c,documents:k?[...c.documents,u]:c.documents.filter(D=>D!==u)}))},V=u=>{const k=document.querySelector("form");if(!k)return;const c=new FormData(k);Z(D=>{const se={...D};if(u===1)se.fullName=c.get("fullName")||D.fullName,se.email=c.get("email")||D.email,se.contactNumber=c.get("contactNumber")||D.contactNumber,se.password=c.get("password")||D.password;else if(u===2)se.employeeId=c.get("employeeId")||D.employeeId,se.gender=c.get("gender")||D.gender,se.dateOfBirth=c.get("dateOfBirth")||D.dateOfBirth,se.nationality=c.get("nationality")||D.nationality,se.maritalStatus=c.get("maritalStatus")||D.maritalStatus,se.address=c.get("address")||D.address,se.city=c.get("city")||D.city,se.state=c.get("state")||D.state,se.postalCode=c.get("postalCode")||D.postalCode;else if(u===3)se.department=c.get("department")||D.department,se.designation=c.get("designation")||D.designation,se.dateOfJoining=c.get("dateOfJoining")||D.dateOfJoining,se.employmentType=c.get("employmentType")||D.employmentType,se.reportingManager=c.get("reportingManager")||D.reportingManager,se.workLocation=c.get("workLocation")||D.workLocation;else if(u===4)se.bankName=c.get("bankName")||D.bankName,se.accountNumber=c.get("accountNumber")||D.accountNumber,se.ifscCode=c.get("ifscCode")||D.ifscCode,se.branch=c.get("branch")||D.branch,se.panNumber=c.get("panNumber")||D.panNumber;else if(u===5)se.emergencyContactName=c.get("emergencyContactName")||D.emergencyContactName,se.emergencyRelationship=c.get("emergencyRelationship")||D.emergencyRelationship,se.emergencyPhoneNumber=c.get("emergencyPhoneNumber")||D.emergencyPhoneNumber,se.emergencyAlternatePhone=c.get("emergencyAlternatePhone")||D.emergencyAlternatePhone;else if(u===6){const ge=c.getAll("documents");se.documents=ge.length>0?ge:D.documents}return se})},Qe=u=>{const k={};if(u===2){const c=ea(x.employeeId);c&&(k.employeeId=c);const D=mt(x.gender,"Gender");D&&(k.gender=D);const se=rs(x.dateOfBirth,"Date of Birth");se&&(k.dateOfBirth=se);const ge=mt(x.nationality,"Nationality");ge&&(k.nationality=ge);const G=mt(x.maritalStatus,"Marital Status");G&&(k.maritalStatus=G);const Ce=mt(x.address,"Address");Ce&&(k.address=Ce);const Ze=mt(x.city,"City");Ze&&(k.city=Ze);const Xe=mt(x.state,"State");Xe&&(k.state=Xe);const Be=Xs(x.postalCode);Be&&(k.postalCode=Be)}else if(u===3){const c=mt(x.department,"Department");c&&(k.department=c);const D=mt(x.designation,"Designation");D&&(k.designation=D);const se=rs(x.dateOfJoining,"Date of Joining");se&&(k.dateOfJoining=se);const ge=mt(x.employmentType,"Employment Type");ge&&(k.employmentType=ge);const G=mt(x.reportingManager,"Reporting Manager");G&&(k.reportingManager=G);const Ce=mt(x.workLocation,"Work Location");Ce&&(k.workLocation=Ce)}else if(u===4){const c=mt(x.bankName,"Bank Name");c&&(k.bankName=c);const D=Ys(x.accountNumber);D&&(k.accountNumber=D);const se=Hs(x.ifscCode);se&&(k.ifscCode=se);const ge=mt(x.branch,"Branch");ge&&(k.branch=ge);const G=Qs(x.panNumber);G&&(k.panNumber=G)}else if(u===5){const c=mt(x.emergencyContactName,"Emergency Contact Name");c&&(k.emergencyContactName=c);const D=mt(x.emergencyRelationship,"Relationship");if(D&&(k.emergencyRelationship=D),!x.emergencyPhoneNumber||x.emergencyPhoneNumber.trim()==="")k.emergencyPhoneNumber="Phone number is required";else{const se=Mt(x.emergencyPhoneNumber);se&&(k.emergencyPhoneNumber=se)}if(!x.emergencyAlternatePhone||x.emergencyAlternatePhone.trim()==="")k.emergencyAlternatePhone="Alternate phone number is required";else{const se=Mt(x.emergencyAlternatePhone);se&&(k.emergencyAlternatePhone=se)}}return j(k),Object.keys(k).length===0},ve=()=>{if(a<n){if(a===1&&!i){const u=document.querySelector("form");u&&u.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}));return}if(a>1&&!Qe(a)){alert("Please fill in all required fields correctly before proceeding.");return}V(a),j({}),r(a+1)}},p=()=>{a>1&&(V(a),r(a-1))},M=async u=>{if(u.preventDefault(),a!==n){const k=new FormData(u.currentTarget);if(a===1&&!i)try{const se=x.email||"",ge=x.contactNumber||"",G=await Re.get(`/users?email=${encodeURIComponent(se)}`);if(G.data&&Array.isArray(G.data)&&G.data.length>0){alert("A user with this email already exists. Please use a different email address.");return}const Ce=await Re.get(`/users?phone=${encodeURIComponent(ge)}`);if(Ce.data&&Array.isArray(Ce.data)&&Ce.data.length>0){alert("A user with this phone number already exists. Please use a different phone number.");return}const Ze={name:x.fullName||"",email:x.email||"",phone:x.contactNumber||"",password:x.password||"",role:"employee"};J.mutate(Ze);return}catch(se){console.error("Error checking existing users:",se),alert("Error checking existing users. Please try again.");return}else if(a===1&&i){r(2);return}let c=!1;const D={};if(a===2){const se=k.get("employeeId"),ge=k.get("gender"),G=k.get("dateOfBirth"),Ce=k.get("nationality"),Ze=k.get("maritalStatus"),Xe=k.get("address"),Be=k.get("city"),Q=k.get("state"),l=k.get("postalCode"),O=ea(se);O&&(D.employeeId=O);const X=mt(ge,"Gender");X&&(D.gender=X);const fe=rs(G,"Date of Birth");fe&&(D.dateOfBirth=fe);const Fe=mt(Ce,"Nationality");Fe&&(D.nationality=Fe);const je=mt(Ze,"Marital Status");je&&(D.maritalStatus=je);const v=mt(Xe,"Address");v&&(D.address=v);const _=mt(Be,"City");_&&(D.city=_);const ue=mt(Q,"State");ue&&(D.state=ue);const A=Xs(l);A&&(D.postalCode=A),c=Object.keys(D).length>0}else if(a===3){const se=k.get("department"),ge=k.get("designation"),G=k.get("dateOfJoining"),Ce=k.get("employmentType"),Ze=k.get("reportingManager"),Xe=k.get("workLocation"),Be=mt(se,"Department");Be&&(D.department=Be);const Q=mt(ge,"Designation");Q&&(D.designation=Q);const l=rs(G,"Date of Joining");l&&(D.dateOfJoining=l);const O=mt(Ce,"Employment Type");O&&(D.employmentType=O);const X=mt(Ze,"Reporting Manager");X&&(D.reportingManager=X);const fe=mt(Xe,"Work Location");fe&&(D.workLocation=fe),c=Object.keys(D).length>0}else if(a===4){const se=k.get("bankName"),ge=k.get("accountNumber"),G=k.get("ifscCode"),Ce=k.get("branch"),Ze=k.get("panNumber"),Xe=mt(se,"Bank Name");Xe&&(D.bankName=Xe);const Be=Ys(ge);Be&&(D.accountNumber=Be);const Q=Hs(G);Q&&(D.ifscCode=Q);const l=mt(Ce,"Branch");l&&(D.branch=l);const O=Qs(Ze);O&&(D.panNumber=O),c=Object.keys(D).length>0}else if(a===5){const se=k.get("emergencyContactName"),ge=k.get("emergencyRelationship"),G=k.get("emergencyPhoneNumber"),Ce=k.get("emergencyAlternatePhone"),Ze=mt(se,"Emergency Contact Name");Ze&&(D.emergencyContactName=Ze);const Xe=mt(ge,"Relationship");Xe&&(D.emergencyRelationship=Xe);const Be=G.trim();if(!Be)D.emergencyPhoneNumber="Phone number is required";else if(Be.length!==10)D.emergencyPhoneNumber="Phone number must be exactly 10 digits";else{const l=Mt(Be);l&&(D.emergencyPhoneNumber=l)}const Q=Ce.trim();if(!Q)D.emergencyAlternatePhone="Alternate phone number is required";else if(Q.length!==10)D.emergencyAlternatePhone="Phone number must be exactly 10 digits";else{const l=Mt(Q);l&&(D.emergencyAlternatePhone=l)}c=Object.keys(D).length>0}if(c){j(D),a===2&&(D.employeeId||D.gender||D.dateOfBirth||D.nationality||D.maritalStatus||D.address||D.city||D.state||D.postalCode)?r(2):a===3&&(D.department||D.designation||D.dateOfJoining||D.employmentType||D.reportingManager||D.workLocation)?r(3):a===4&&(D.bankName||D.accountNumber||D.ifscCode||D.branch||D.panNumber)?r(4):a===5&&(D.emergencyContactName||D.emergencyRelationship||D.emergencyPhoneNumber||D.emergencyAlternatePhone)&&r(5),alert("Please fill in all required fields correctly before proceeding.");return}V(a),j({}),r(a+1)}else{if(!i){alert("Please complete user registration first");return}const k={},c=mt(x.emergencyContactName||"","Emergency Contact Name");c&&(k.emergencyContactName=c);const D=mt(x.emergencyRelationship||"","Relationship");if(D&&(k.emergencyRelationship=D),!x.emergencyPhoneNumber||x.emergencyPhoneNumber.trim()==="")k.emergencyPhoneNumber="Phone number is required";else{const G=Mt(x.emergencyPhoneNumber);G&&(k.emergencyPhoneNumber=G)}if(!x.emergencyAlternatePhone||x.emergencyAlternatePhone.trim()==="")k.emergencyAlternatePhone="Alternate phone number is required";else{const G=Mt(x.emergencyAlternatePhone);G&&(k.emergencyAlternatePhone=G)}if(Object.keys(k).length>0){j(k),alert("Please fill in all required fields correctly. Going back to incomplete step."),r(5);return}const se={};C&&(se.photo=C),K&&(se.panCard=K),T&&(se.aadharCard=T),w.length>0&&(se.otherDocuments=w);const ge={userId:i,employeeId:x.employeeId.trim(),gender:x.gender||void 0,dateOfBirth:x.dateOfBirth||void 0,nationality:x.nationality||void 0,maritalStatus:x.maritalStatus||void 0,department:x.department||void 0,designation:x.designation||void 0,dateOfJoining:x.dateOfJoining||void 0,employmentType:x.employmentType||void 0,reportingManager:x.reportingManager||void 0,workLocation:x.workLocation||void 0,bankName:x.bankName||void 0,accountNumber:x.accountNumber||void 0,ifscCode:x.ifscCode||void 0,branch:x.branch||void 0,panNumber:x.panNumber||void 0,city:x.city||void 0,state:x.state||void 0,postalCode:x.postalCode||void 0,address:x.address||void 0,emergencyContactName:x.emergencyContactName||void 0,emergencyRelationship:x.emergencyRelationship||void 0,emergencyPhoneNumber:x.emergencyPhoneNumber||void 0,emergencyAlternatePhone:x.emergencyAlternatePhone||void 0,documentsSubmitted:x.documents.length>0?x.documents.join(", "):void 0};Object.keys(se).length>0&&(ge.metadata={documents:se}),Ae.mutate(ge)}},P=async u=>{var D,se,ge;const k=(D=u.target.files)==null?void 0:D[0];if(!k)return;if(!["image/jpeg","image/jpg","image/png"].includes(k.type)){alert("Please select a valid image file (JPG or PNG)"),u.target.value="";return}Pe(!0);try{const G=await wt.uploadFile(k);if(G.data&&G.data.files&&G.data.files.length>0){const Ce=G.data.files[0],Ze=He(Ce.url)||Ce.url;q({name:Ce.originalName,url:Ze,size:Ce.size}),alert("Photo uploaded successfully!")}else throw new Error("No file returned from upload")}catch(G){console.error("Photo upload error:",G),alert(((ge=(se=G.response)==null?void 0:se.data)==null?void 0:ge.message)||G.message||"Failed to upload photo")}finally{Pe(!1),u.target.value=""}},H=async u=>{var D,se,ge;const k=(D=u.target.files)==null?void 0:D[0];if(!k)return;if(!["image/jpeg","image/jpg","image/png","application/pdf"].includes(k.type)){alert("Please select a valid file (JPG, PNG, or PDF)"),u.target.value="";return}Y(!0);try{const G=await wt.uploadFile(k);if(G.data&&G.data.files&&G.data.files.length>0){const Ce=G.data.files[0],Ze=He(Ce.url)||Ce.url;re({name:Ce.originalName,url:Ze,size:Ce.size}),alert("PAN Card uploaded successfully!")}else throw new Error("No file returned from upload")}catch(G){console.error("PAN Card upload error:",G),alert(((ge=(se=G.response)==null?void 0:se.data)==null?void 0:ge.message)||G.message||"Failed to upload PAN Card")}finally{Y(!1),u.target.value=""}},U=async u=>{var D,se,ge;const k=(D=u.target.files)==null?void 0:D[0];if(!k)return;if(!["image/jpeg","image/jpg","image/png","application/pdf"].includes(k.type)){alert("Please select a valid file (JPG, PNG, or PDF)"),u.target.value="";return}de(!0);try{const G=await wt.uploadFile(k);if(G.data&&G.data.files&&G.data.files.length>0){const Ce=G.data.files[0],Ze=He(Ce.url)||Ce.url;b({name:Ce.originalName,url:Ze,size:Ce.size}),alert("Aadhar Card uploaded successfully!")}else throw new Error("No file returned from upload")}catch(G){console.error("Aadhar Card upload error:",G),alert(((ge=(se=G.response)==null?void 0:se.data)==null?void 0:ge.message)||G.message||"Failed to upload Aadhar Card")}finally{de(!1),u.target.value=""}},ce=async u=>{var se,ge;const k=u.target.files;if(!k||k.length===0)return;const c=["image/jpeg","image/jpg","image/png","application/pdf"],D=[];for(let G=0;G<k.length;G++)c.includes(k[G].type)&&D.push(k[G]);if(D.length===0){alert("Please select valid files (JPG, PNG, or PDF)"),u.target.value="";return}S(!0);try{const G=await wt.uploadMultipleFiles(D);if(G.data&&G.data.files&&G.data.files.length>0){const Ce=G.data.files.map(Ze=>({name:Ze.originalName,url:He(Ze.url)||Ze.url,size:Ze.size}));$(Ze=>[...Ze,...Ce]),alert(`${Ce.length} document(s) uploaded successfully!`)}else throw new Error("No files returned from upload")}catch(G){console.error("Other documents upload error:",G),alert(((ge=(se=G.response)==null?void 0:se.data)==null?void 0:ge.message)||G.message||"Failed to upload documents")}finally{S(!1),u.target.value=""}},ae=u=>{$(k=>k.filter((c,D)=>D!==u))};return e.jsx(et,{children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden overflow-x-auto",children:[e.jsxs("div",{className:"bg-gradient-to-r from-orange-600 to-orange-500 px-8 py-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Employee Registration Form"}),e.jsx("p",{className:"mt-2 text-orange-100",children:"Complete employee registration and profile setup"})]}),e.jsx("div",{className:"px-8 py-4 bg-gray-50 border-b",children:e.jsx("div",{className:"flex items-center justify-between",children:[1,2,3,4,5,6].map(u=>e.jsxs(At.Fragment,{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-xs font-semibold ${a>=u?"bg-orange-600 text-white":"bg-gray-300 text-gray-600"}`,children:u}),e.jsxs("span",{className:`ml-1 text-xs font-medium ${a>=u?"text-orange-600":"text-gray-500"}`,children:[u===1&&"Account",u===2&&"Personal",u===3&&"Employment",u===4&&"Bank",u===5&&"Emergency",u===6&&"Documents"]})]}),u<n&&e.jsx("div",{className:`flex-1 h-1 mx-1 ${a>u?"bg-orange-600":"bg-gray-300"}`})]},u))})}),a===1&&e.jsxs("form",{onSubmit:M,className:"p-8 max-h-[calc(100vh-12rem)] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Step 1: Create User Account"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Full Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"fullName",value:x.fullName||"",onChange:u=>{Z(k=>({...k,fullName:u.target.value})),m.fullName&&j(k=>{const c={...k};return delete c.fullName,c})},required:!0,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 ${m.fullName?"border-red-500":"border-gray-300"}`}),m.fullName&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.fullName})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Email Address ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"email",name:"email",value:x.email||"",onChange:u=>{Z(k=>({...k,email:u.target.value})),m.email&&j(k=>{const c={...k};return delete c.email,c})},required:!0,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 ${m.email?"border-red-500":"border-gray-300"}`}),m.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.email})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Contact Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"tel",name:"contactNumber",value:x.contactNumber||"",onChange:u=>{Z(k=>({...k,contactNumber:u.target.value})),m.contactNumber&&j(k=>{const c={...k};return delete c.contactNumber,c})},required:!0,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 ${m.contactNumber?"border-red-500":"border-gray-300"}`}),m.contactNumber&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.contactNumber})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"password",name:"password",value:x.password||"",onChange:u=>{Z(k=>({...k,password:u.target.value})),m.password&&j(k=>{const c={...k};return delete c.password,c})},required:!0,minLength:6,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 ${m.password?"border-red-500":"border-gray-300"}`}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Minimum 6 characters"}),m.password&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.password})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:J.isPending,className:"px-6 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:J.isPending?"Creating Account...":"Create Account & Continue"})})]})]}),a>1&&e.jsx("form",{onSubmit:u=>{u.preventDefault()},onKeyDown:u=>{if(u.key==="Enter"){if(u.target.tagName==="TEXTAREA")return;u.preventDefault(),u.stopPropagation()}},children:e.jsxs("div",{className:"p-8",children:[a===2&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Step 2: Personal Information"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Employee ID ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"employeeId",required:!0,value:x.employeeId,onChange:u=>{Me(u),m.employeeId&&j(k=>{const c={...k};return delete c.employeeId,c})},placeholder:"e.g., EMP001",className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 ${m.employeeId?"border-red-500":"border-gray-300"}`}),m.employeeId&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.employeeId})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Gender ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-4 mt-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"gender",value:"Male",checked:x.gender==="Male",onChange:u=>{W("gender",u.target.value),m.gender&&j(k=>{const c={...k};return delete c.gender,c})},className:"mr-2"}),e.jsx("span",{children:"Male"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"gender",value:"Female",checked:x.gender==="Female",onChange:u=>{W("gender",u.target.value),m.gender&&j(k=>{const c={...k};return delete c.gender,c})},className:"mr-2"}),e.jsx("span",{children:"Female"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"gender",value:"Other",checked:x.gender==="Other",onChange:u=>{W("gender",u.target.value),m.gender&&j(k=>{const c={...k};return delete c.gender,c})},className:"mr-2"}),e.jsx("span",{children:"Other"})]})]}),m.gender&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.gender})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Date of Birth ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",name:"dateOfBirth",required:!0,value:x.dateOfBirth,onChange:u=>{Me(u),m.dateOfBirth&&j(k=>{const c={...k};return delete c.dateOfBirth,c})},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 ${m.dateOfBirth?"border-red-500":"border-gray-300"}`}),m.dateOfBirth&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.dateOfBirth})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Nationality ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"nationality",required:!0,value:x.nationality,onChange:u=>{Me(u),m.nationality&&j(k=>{const c={...k};return delete c.nationality,c})},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 ${m.nationality?"border-red-500":"border-gray-300"}`}),m.nationality&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.nationality})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Marital Status ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-4 mt-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"maritalStatus",value:"Single",checked:x.maritalStatus==="Single",onChange:u=>{W("maritalStatus",u.target.value),m.maritalStatus&&j(k=>{const c={...k};return delete c.maritalStatus,c})},className:"mr-2"}),e.jsx("span",{children:"Single"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"maritalStatus",value:"Married",checked:x.maritalStatus==="Married",onChange:u=>{W("maritalStatus",u.target.value),m.maritalStatus&&j(k=>{const c={...k};return delete c.maritalStatus,c})},className:"mr-2"}),e.jsx("span",{children:"Married"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"maritalStatus",value:"Other",checked:x.maritalStatus==="Other",onChange:u=>{W("maritalStatus",u.target.value),m.maritalStatus&&j(k=>{const c={...k};return delete c.maritalStatus,c})},className:"mr-2"}),e.jsx("span",{children:"Other"})]})]}),m.maritalStatus&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.maritalStatus})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Address ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{name:"address",required:!0,rows:3,value:x.address,onChange:u=>{Me(u),m.address&&j(k=>{const c={...k};return delete c.address,c})},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 ${m.address?"border-red-500":"border-gray-300"}`}),m.address&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.address})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["City ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"city",required:!0,value:x.city,onChange:u=>{Me(u),m.city&&j(k=>{const c={...k};return delete c.city,c})},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 ${m.city?"border-red-500":"border-gray-300"}`}),m.city&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.city})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["State/Province ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"state",required:!0,value:x.state,onChange:u=>{Me(u),m.state&&j(k=>{const c={...k};return delete c.state,c})},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 ${m.state?"border-red-500":"border-gray-300"}`}),m.state&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.state})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Postal Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"postalCode",required:!0,maxLength:6,value:x.postalCode,onChange:u=>{Me(u),m.postalCode&&j(k=>{const c={...k};return delete c.postalCode,c})},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 ${m.postalCode?"border-red-500":"border-gray-300"}`}),m.postalCode&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.postalCode})]})]})]}),a===3&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Step 3: Employment Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Department ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"department",required:!0,value:x.department,onChange:u=>{Me(u),m.department&&j(k=>{const c={...k};return delete c.department,c})},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 ${m.department?"border-red-500":"border-gray-300"}`}),m.department&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.department})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Designation / Job Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"designation",required:!0,value:x.designation,onChange:u=>{Me(u),m.designation&&j(k=>{const c={...k};return delete c.designation,c})},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 ${m.designation?"border-red-500":"border-gray-300"}`}),m.designation&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.designation})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Date of Joining ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",name:"dateOfJoining",required:!0,value:x.dateOfJoining,onChange:u=>{Me(u),m.dateOfJoining&&j(k=>{const c={...k};return delete c.dateOfJoining,c})},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 ${m.dateOfJoining?"border-red-500":"border-gray-300"}`}),m.dateOfJoining&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.dateOfJoining})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Employment Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"employmentType",value:"Full-Time",checked:x.employmentType==="Full-Time",onChange:u=>{W("employmentType",u.target.value),m.employmentType&&j(k=>{const c={...k};return delete c.employmentType,c})},className:"mr-2"}),e.jsx("span",{children:"Full-Time"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"employmentType",value:"Part-Time",checked:x.employmentType==="Part-Time",onChange:u=>{W("employmentType",u.target.value),m.employmentType&&j(k=>{const c={...k};return delete c.employmentType,c})},className:"mr-2"}),e.jsx("span",{children:"Part-Time"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"employmentType",value:"Contract",checked:x.employmentType==="Contract",onChange:u=>{W("employmentType",u.target.value),m.employmentType&&j(k=>{const c={...k};return delete c.employmentType,c})},className:"mr-2"}),e.jsx("span",{children:"Contract"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"employmentType",value:"Intern",checked:x.employmentType==="Intern",onChange:u=>{W("employmentType",u.target.value),m.employmentType&&j(k=>{const c={...k};return delete c.employmentType,c})},className:"mr-2"}),e.jsx("span",{children:"Intern"})]})]}),m.employmentType&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.employmentType})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Reporting Manager ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"reportingManager",required:!0,value:x.reportingManager,onChange:u=>{Me(u),m.reportingManager&&j(k=>{const c={...k};return delete c.reportingManager,c})},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 ${m.reportingManager?"border-red-500":"border-gray-300"}`}),m.reportingManager&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.reportingManager})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Work Location ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"workLocation",required:!0,value:x.workLocation,onChange:u=>{Me(u),m.workLocation&&j(k=>{const c={...k};return delete c.workLocation,c})},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 ${m.workLocation?"border-red-500":"border-gray-300"}`}),m.workLocation&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.workLocation})]})]})]}),a===4&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Step 4: Bank Details"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Bank Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"bankName",required:!0,value:x.bankName,onChange:u=>{Me(u),m.bankName&&j(k=>{const c={...k};return delete c.bankName,c})},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 ${m.bankName?"border-red-500":"border-gray-300"}`}),m.bankName&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.bankName})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Account Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"accountNumber",required:!0,value:x.accountNumber,onChange:u=>{Me(u),m.accountNumber&&j(k=>{const c={...k};return delete c.accountNumber,c})},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 ${m.accountNumber?"border-red-500":"border-gray-300"}`}),m.accountNumber&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.accountNumber})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["IFSC Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"ifscCode",required:!0,value:x.ifscCode,onChange:u=>{Me(u),m.ifscCode&&j(k=>{const c={...k};return delete c.ifscCode,c})},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 uppercase ${m.ifscCode?"border-red-500":"border-gray-300"}`,style:{textTransform:"uppercase"}}),m.ifscCode&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.ifscCode})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Branch ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"branch",required:!0,value:x.branch,onChange:u=>{Me(u),m.branch&&j(k=>{const c={...k};return delete c.branch,c})},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 ${m.branch?"border-red-500":"border-gray-300"}`}),m.branch&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.branch})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["PAN Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"panNumber",required:!0,maxLength:10,value:x.panNumber,onChange:u=>{Me(u),m.panNumber&&j(k=>{const c={...k};return delete c.panNumber,c})},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 uppercase ${m.panNumber?"border-red-500":"border-gray-300"}`,style:{textTransform:"uppercase"}}),m.panNumber&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.panNumber})]})]}),a===5&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Step 5: Emergency Contact Information"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Contact Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"emergencyContactName",required:!0,value:x.emergencyContactName,onChange:u=>{Me(u),m.emergencyContactName&&j(k=>{const c={...k};return delete c.emergencyContactName,c})},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 ${m.emergencyContactName?"border-red-500":"border-gray-300"}`}),m.emergencyContactName&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.emergencyContactName})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Relationship ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"emergencyRelationship",required:!0,value:x.emergencyRelationship,onChange:u=>{Me(u),m.emergencyRelationship&&j(k=>{const c={...k};return delete c.emergencyRelationship,c})},placeholder:"e.g., Father, Mother, Spouse, Guardian",className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 ${m.emergencyRelationship?"border-red-500":"border-gray-300"}`}),m.emergencyRelationship&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.emergencyRelationship})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Phone Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"tel",name:"emergencyPhoneNumber",required:!0,pattern:"[0-9]{10}",minLength:10,maxLength:10,placeholder:"10 digit phone number",value:x.emergencyPhoneNumber,onChange:u=>{const k=u.target.value.replace(/\D/g,"").slice(0,10);Z(c=>({...c,emergencyPhoneNumber:k})),m.emergencyPhoneNumber&&j(c=>{const D={...c};return delete D.emergencyPhoneNumber,D})},onBlur:()=>{if(!x.emergencyPhoneNumber||x.emergencyPhoneNumber.trim()==="")j(u=>({...u,emergencyPhoneNumber:"Phone number is required"}));else if(x.emergencyPhoneNumber.length!==10)j(u=>({...u,emergencyPhoneNumber:"Phone number must be exactly 10 digits"}));else{const u=Mt(x.emergencyPhoneNumber);j(u?k=>({...k,emergencyPhoneNumber:u}):k=>{const c={...k};return delete c.emergencyPhoneNumber,c})}},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 ${m.emergencyPhoneNumber?"border-red-500":"border-gray-300"}`}),m.emergencyPhoneNumber&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.emergencyPhoneNumber}),!m.emergencyPhoneNumber&&x.emergencyPhoneNumber&&e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Enter 10 digit phone number"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Alternate Phone Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"tel",name:"emergencyAlternatePhone",required:!0,pattern:"[0-9]{10}",minLength:10,maxLength:10,placeholder:"10 digit phone number",value:x.emergencyAlternatePhone,onChange:u=>{const k=u.target.value.replace(/\D/g,"").slice(0,10);Z(c=>({...c,emergencyAlternatePhone:k})),m.emergencyAlternatePhone&&j(c=>{const D={...c};return delete D.emergencyAlternatePhone,D})},onBlur:()=>{if(!x.emergencyAlternatePhone||x.emergencyAlternatePhone.trim()==="")j(u=>({...u,emergencyAlternatePhone:"Alternate phone number is required"}));else if(x.emergencyAlternatePhone.length!==10)j(u=>({...u,emergencyAlternatePhone:"Phone number must be exactly 10 digits"}));else{const u=Mt(x.emergencyAlternatePhone);j(u?k=>({...k,emergencyAlternatePhone:u}):k=>{const c={...k};return delete c.emergencyAlternatePhone,c})}},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 ${m.emergencyAlternatePhone?"border-red-500":"border-gray-300"}`}),m.emergencyAlternatePhone&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.emergencyAlternatePhone}),!m.emergencyAlternatePhone&&x.emergencyAlternatePhone&&e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Enter 10 digit phone number"})]})]})]}),a===6&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Step 6: Documents & Declaration"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Photo"}),e.jsx("input",{type:"file",accept:"image/jpeg,image/jpg,image/png",onChange:P,disabled:pe,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 disabled:opacity-50"}),pe&&e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Uploading..."}),C&&C.url&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg border border-gray-200 flex items-center space-x-4",children:[e.jsx("img",{src:He(C.url)||"",alt:"Photo",className:"h-16 w-16 object-cover rounded border border-gray-300",crossOrigin:"anonymous"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:C.name||"Photo"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Image File"})]}),e.jsx("button",{type:"button",onClick:()=>q(null),className:"px-3 py-1.5 text-sm text-red-600 hover:text-red-800 border border-red-300 rounded hover:bg-red-50",children:"Remove"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"PAN Card"}),e.jsx("input",{type:"file",accept:"image/jpeg,image/jpg,image/png,application/pdf",onChange:H,disabled:te,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 disabled:opacity-50"}),te&&e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Uploading..."}),K&&K.url&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg border border-gray-200 flex items-center space-x-4",children:[K.url.endsWith(".pdf")?e.jsx("div",{className:"h-16 w-16 bg-gray-200 rounded border border-gray-300 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:""})}):e.jsx("img",{src:He(K.url)||"",alt:"PAN Card",className:"h-16 w-16 object-cover rounded border border-gray-300",crossOrigin:"anonymous"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:K.name||"PAN Card"}),e.jsx("p",{className:"text-xs text-gray-500",children:K.url.endsWith(".pdf")?"PDF Document":"Image File"})]}),e.jsx("button",{type:"button",onClick:()=>re(null),className:"px-3 py-1.5 text-sm text-red-600 hover:text-red-800 border border-red-300 rounded hover:bg-red-50",children:"Remove"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Aadhar Card"}),e.jsx("input",{type:"file",accept:"image/jpeg,image/jpg,image/png,application/pdf",onChange:U,disabled:o,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 disabled:opacity-50"}),o&&e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Uploading..."}),T&&T.url&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg border border-gray-200 flex items-center space-x-4",children:[T.url.endsWith(".pdf")?e.jsx("div",{className:"h-16 w-16 bg-gray-200 rounded border border-gray-300 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:""})}):e.jsx("img",{src:He(T.url)||"",alt:"Aadhar Card",className:"h-16 w-16 object-cover rounded border border-gray-300",crossOrigin:"anonymous"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:T.name||"Aadhar Card"}),e.jsx("p",{className:"text-xs text-gray-500",children:T.url.endsWith(".pdf")?"PDF Document":"Image File"})]}),e.jsx("button",{type:"button",onClick:()=>b(null),className:"px-3 py-1.5 text-sm text-red-600 hover:text-red-800 border border-red-300 rounded hover:bg-red-50",children:"Remove"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Other Documents (Multiple files allowed)"}),e.jsx("input",{type:"file",accept:"image/jpeg,image/jpg,image/png,application/pdf",multiple:!0,onChange:ce,disabled:N,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 disabled:opacity-50"}),N&&e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Uploading..."}),w.length>0&&e.jsx("div",{className:"mt-3 space-y-2",children:w.map((u,k)=>{const c=u.url.endsWith(".pdf"),D=u.url.match(/\.(jpg|jpeg|png|gif|webp)$/i);return e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg border border-gray-200 flex items-center space-x-4",children:[D?e.jsx("img",{src:He(u.url)||"",alt:u.name,className:"h-16 w-16 object-cover rounded border border-gray-300",crossOrigin:"anonymous"}):e.jsx("div",{className:"h-16 w-16 bg-gray-200 rounded border border-gray-300 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:c?"":""})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",title:u.name,children:u.name}),e.jsx("p",{className:"text-xs text-gray-500",children:c?"PDF Document":D?"Image File":"Document"})]}),e.jsx("button",{type:"button",onClick:()=>ae(k),className:"px-3 py-1.5 text-sm text-red-600 hover:text-red-800 border border-red-300 rounded hover:bg-red-50",children:"Remove"})]},k)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Documents Submitted (Optional)"}),e.jsx("div",{className:"space-y-2 border border-gray-300 rounded-md p-4",children:["Resume","ID Proof","Previous Salary Payslip","Educational Certificates","Experience Certificates","Relieving letter"].map(u=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"documents",value:u,checked:x.documents.includes(u),onChange:k=>Ne(u,k.target.checked),onKeyDown:k=>{k.key==="Enter"&&(k.preventDefault(),k.stopPropagation())},className:"mr-2"}),e.jsx("span",{children:u})]},u))})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Declaration"}),e.jsx("p",{className:"text-sm text-gray-700 mb-4",children:"I hereby declare that the above information is true and correct to the best of my knowledge."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Employee Signature"}),e.jsx("div",{className:"border-b-2 border-gray-400 h-10"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date"}),e.jsx("input",{type:"date",defaultValue:new Date().toISOString().split("T")[0],className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",readOnly:!0,onKeyDown:u=>{u.key==="Enter"&&(u.preventDefault(),u.stopPropagation())}})]})]})]})]}),e.jsxs("div",{className:"flex justify-between mt-8 pt-6 border-t",children:[e.jsx("button",{type:"button",onClick:p,disabled:a===1,className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),a<n?e.jsx("button",{type:"button",onClick:ve,className:"px-6 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors",children:"Next"}):e.jsx("button",{type:"submit",disabled:Ae.isPending,className:"px-6 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:Ae.isPending?"Submitting...":"Submit Registration"})]})]})})]})})})},bl=()=>{var se,ge,G,Ce,Ze,Xe,Be,Q,l,O,X,fe,Fe,je,v;const{id:t}=xs(),{user:s}=Nt(),a=Et(),r=vt(),[n,i]=g.useState(1),h=6,[m,j]=g.useState(null),[C,q]=g.useState(null),[K,re]=g.useState(null),[T,b]=g.useState([]),{uploadPhoto:w,uploading:$,error:pe,getPhotoUrl:Pe}=na(),[te,Y]=g.useState(!1),[o,de]=g.useState(!1),[N,S]=g.useState(!1),[x,Z]=g.useState({});console.log("EmployeeEdit component rendering",{id:t,user:s,hasId:!!t}),At.useEffect(()=>{console.log("EmployeeEdit component mounted",{id:t,user:s})},[t,s]);const{data:J,isLoading:Ie,error:Ae}=_e({queryKey:["employee",t],queryFn:async()=>{var _,ue,A,L;try{if(console.log("Fetching employee data for ID:",t),!t)throw new Error("Employee ID is required");const z=await Re.get(`/users/${t}`);if(console.log("User response:",z),!(z!=null&&z.data))throw new Error("No data in user response");let oe=null;const le=z.data;if((_=le==null?void 0:le.data)!=null&&_.user?oe=le.data.user:le!=null&&le.data&&!le.data.user&&le.data.id?oe=le.data:le!=null&&le.user?oe=le.user:le!=null&&le.id&&(oe=le),!oe||!oe.id)throw console.error("User response structure:",le),new Error("Invalid user response structure - user not found");let xe=oe.employeeProfile||null;if(xe)console.log("Profile found in user response:",xe);else try{const he=await Qt.getEmployeeProfile(Number(t));console.log("Profile response:",he);const B=he;(ue=B==null?void 0:B.data)!=null&&ue.employeeProfile?xe=B.data.employeeProfile:B!=null&&B.employeeProfile?xe=B.employeeProfile:B!=null&&B.data&&B.data.id?xe=B.data:B!=null&&B.id&&(xe=B),console.log("Extracted profile from separate fetch:",xe)}catch(he){console.warn("Could not fetch employee profile separately:",he==null?void 0:he.message)}return console.log("Employee data fetched successfully:",{userId:oe==null?void 0:oe.id,userName:oe==null?void 0:oe.name,hasProfile:!!xe,profileId:xe==null?void 0:xe.id,hasAddress:!!(xe!=null&&xe.address),address:xe==null?void 0:xe.address,hasCity:!!(xe!=null&&xe.city),city:xe==null?void 0:xe.city,hasState:!!(xe!=null&&xe.state),state:xe==null?void 0:xe.state,hasPostalCode:!!(xe!=null&&xe.postalCode),postalCode:xe==null?void 0:xe.postalCode}),{user:oe,profile:xe}}catch(z){throw console.error("Error fetching employee data:",z),console.error("Error details:",{message:z==null?void 0:z.message,response:(A=z==null?void 0:z.response)==null?void 0:A.data,status:(L=z==null?void 0:z.response)==null?void 0:L.status}),z}},enabled:!!t,retry:1}),Me=st({mutationFn:_=>yt.updateUser(Number(t),_),onSuccess:()=>{r.invalidateQueries({queryKey:["employee",t]}),r.invalidateQueries({queryKey:["employees"]}),r.invalidateQueries({queryKey:["employee-profile",t]})}}),W=st({mutationFn:_=>{const{isFinalStep:ue,...A}=_;return Qt.updateEmployeeProfile(Number(t),A)},onSuccess:(_,ue)=>{r.invalidateQueries({queryKey:["employee",t]}),r.invalidateQueries({queryKey:["employees"]}),r.invalidateQueries({queryKey:["employee-profile",t]}),ue!=null&&ue.isFinalStep&&(alert("Employee updated successfully!"),a("/employees"))},onError:_=>{console.error("Update profile error:",_)}}),Ne=J==null?void 0:J.user,V=J==null?void 0:J.profile,Qe=()=>{if(!(V!=null&&V.documents))return null;let _=null;if(typeof V.documents=="string")try{_=JSON.parse(V.documents)}catch(ue){return console.error("Error parsing documents string:",ue),null}else typeof V.documents=="object"&&V.documents!==null&&(_=V.documents);return _},ve=Qe();if(At.useEffect(()=>{var ue;console.log("Loading documents from profile:",{hasProfile:!!V,hasDocuments:!!(V!=null&&V.documents),documentsType:typeof(V==null?void 0:V.documents),documentsValue:V==null?void 0:V.documents});const _=Qe();if(_&&typeof _=="object"){if(console.log("Setting document state:",{hasPhoto:!!_.photo,hasPanCard:!!_.panCard,hasAadharCard:!!_.aadharCard,otherDocsCount:((ue=_.otherDocuments)==null?void 0:ue.length)||0,hasEmergencyContact:!!_.emergencyContact,emergencyContact:_.emergencyContact}),_.photo&&_.photo.url&&j(_.photo),_.panCard&&_.panCard.url&&q(_.panCard),_.aadharCard&&_.aadharCard.url&&re(_.aadharCard),_.otherDocuments&&Array.isArray(_.otherDocuments)&&_.otherDocuments.length>0){const A=_.otherDocuments.filter(L=>L&&L.url);A.length>0&&b(A)}}else console.log("No valid parsed documents found in profile")},[V]),!t)return e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6",children:[e.jsx("p",{className:"text-red-600 font-semibold mb-2",children:"Invalid Employee ID"}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"No employee ID provided in the URL."}),e.jsx("button",{onClick:()=>a("/employees"),className:"mt-4 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Back to Employees"})]})})});if(!s)return e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6",children:[e.jsx("p",{className:"text-red-600",children:"Please log in to continue."}),e.jsx("button",{onClick:()=>a("/login"),className:"mt-4 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Go to Login"})]})})});if((s==null?void 0:s.role)!=="admin"&&(s==null?void 0:s.role)!=="superadmin")return e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6",children:[e.jsx("p",{className:"text-red-600",children:"You don't have permission to edit employees."}),e.jsx("button",{onClick:()=>a("/employees"),className:"mt-4 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Back to Employees"})]})})});if(Ie)return e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})})})});if(Ae){const _=((ge=(se=Ae==null?void 0:Ae.response)==null?void 0:se.data)==null?void 0:ge.message)||(Ae==null?void 0:Ae.message)||"An error occurred while loading employee data",ue=(G=Ae==null?void 0:Ae.response)==null?void 0:G.status;return console.error("EmployeeEdit Error:",{error:Ae,message:_,status:ue,id:t,user:s}),e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6",children:[e.jsx("p",{className:"text-red-600 font-semibold mb-2",children:"Error loading employee data"}),e.jsx("p",{className:"text-gray-600 text-sm mb-2",children:_}),ue&&e.jsxs("p",{className:"text-gray-500 text-xs mb-4",children:["Status Code: ",ue]}),e.jsxs("div",{className:"mt-4 space-x-2",children:[e.jsx("button",{onClick:()=>a("/employees"),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Back to Employees"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:"Retry"})]})]})})})}if(!J&&!Ie)return console.warn("EmployeeEdit: No employee data and not loading",{id:t,isLoading:Ie,employeeError:Ae}),e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6",children:[e.jsx("p",{className:"text-red-600 font-semibold mb-2",children:"Employee not found"}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Unable to load employee data. Please check if the employee ID is correct."}),e.jsxs("div",{className:"mt-4 space-x-2",children:[e.jsx("button",{onClick:()=>a("/employees"),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Back to Employees"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:"Retry"})]})]})})});const p=async _=>{var L;const ue=(L=_.target.files)==null?void 0:L[0];if(!ue){console.log("No file selected"),_.target.value="";return}console.log("Photo upload initiated:",{fileName:ue.name,fileType:ue.type,fileSize:ue.size});const A=await w(ue);if(!A){const z=pe||"Failed to upload photo. Please try again.";console.error("Photo upload failed:",z),alert(z),_.target.value="";return}if(console.log("Photo uploaded successfully, updating state:",A),j(A),t)try{console.log("Updating avatarUrl in database:",A.url),await yt.updateUser(Number(t),{avatarUrl:A.url}),r.invalidateQueries({queryKey:["employee",t]}),r.invalidateQueries({queryKey:["employees"]}),console.log("AvatarUrl updated successfully")}catch(z){console.error("Error updating avatarUrl:",z),alert("Photo uploaded but failed to update profile. Please refresh the page.")}alert("Photo uploaded successfully!"),_.target.value=""},M=async _=>{var L,z,oe;const ue=(L=_.target.files)==null?void 0:L[0];if(!ue)return;if(!["image/jpeg","image/jpg","image/png","application/pdf"].includes(ue.type)){alert("Please select a valid file (JPG, PNG, or PDF)"),_.target.value="";return}Y(!0);try{const le=await wt.uploadFile(ue);if(le.data&&le.data.files&&le.data.files.length>0){const xe=le.data.files[0],he=He(xe.url)||xe.url;q({name:xe.originalName,url:he,size:xe.size}),alert("PAN Card uploaded successfully!")}else throw new Error("No file returned from upload")}catch(le){console.error("PAN Card upload error:",le),alert(((oe=(z=le.response)==null?void 0:z.data)==null?void 0:oe.message)||le.message||"Failed to upload PAN Card")}finally{Y(!1),_.target.value=""}},P=async _=>{var L,z,oe;const ue=(L=_.target.files)==null?void 0:L[0];if(!ue)return;if(!["image/jpeg","image/jpg","image/png","application/pdf"].includes(ue.type)){alert("Please select a valid file (JPG, PNG, or PDF)"),_.target.value="";return}de(!0);try{const le=await wt.uploadFile(ue);if(le.data&&le.data.files&&le.data.files.length>0){const xe=le.data.files[0],he=He(xe.url)||xe.url;re({name:xe.originalName,url:he,size:xe.size}),alert("Aadhar Card uploaded successfully!")}else throw new Error("No file returned from upload")}catch(le){console.error("Aadhar Card upload error:",le),alert(((oe=(z=le.response)==null?void 0:z.data)==null?void 0:oe.message)||le.message||"Failed to upload Aadhar Card")}finally{de(!1),_.target.value=""}},H=async _=>{var z,oe;const ue=_.target.files;if(!ue||ue.length===0)return;const A=["image/jpeg","image/jpg","image/png","application/pdf"],L=[];for(let le=0;le<ue.length;le++)A.includes(ue[le].type)&&L.push(ue[le]);if(L.length===0){alert("Please select valid files (JPG, PNG, or PDF)"),_.target.value="";return}S(!0);try{const le=L.map(B=>wt.uploadFile(B)),he=(await Promise.all(le)).filter(B=>B.data&&B.data.files&&B.data.files.length>0).map(B=>{const ye=He(B.data.files[0].url)||B.data.files[0].url;return{name:B.data.files[0].originalName,url:ye,size:B.data.files[0].size}});b(B=>[...B,...he]),alert(`${he.length} document(s) uploaded successfully!`)}catch(le){console.error("Other documents upload error:",le),alert(((oe=(z=le.response)==null?void 0:z.data)==null?void 0:oe.message)||le.message||"Failed to upload documents")}finally{S(!1),_.target.value=""}},U=_=>{b(ue=>ue.filter((A,L)=>L!==_))},ce=async _=>{var ye,De;_.preventDefault();const ue=new FormData(_.currentTarget),A=ue.get("name")||"",L=ue.get("email")||"",z=ue.get("phone")||"",oe={},le=mt(A,"Name");le&&(oe.name=le);const xe=fl(L);xe&&(oe.email=xe);const he=Mt(z);if(he&&(oe.phone=he),Z(oe),Object.keys(oe).length>0)return;try{if(L){const Se=await Re.get(`/users?email=${encodeURIComponent(L)}`);if(Se.data&&Array.isArray(Se.data)&&Se.data.length>0&&Se.data.find(it=>it.id!==Number(t))){alert("A user with this email already exists. Please use a different email address."),Z({email:"A user with this email already exists"});return}}if(z){const Se=await Re.get(`/users?phone=${encodeURIComponent(z)}`);if(Se.data&&Array.isArray(Se.data)&&Se.data.length>0&&Se.data.find(it=>it.id!==Number(t))){alert("A user with this phone number already exists. Please use a different phone number."),Z({phone:"A user with this phone number already exists"});return}}}catch(Se){console.error("Error checking existing users:",Se),alert("Error checking existing users. Please try again.");return}const B={name:A||void 0,email:L||void 0,phone:z||void 0,isActive:ue.get("isActive")==="true"};try{await Me.mutateAsync(B),Z({}),i(2)}catch(Se){console.error("Error updating user:",Se);const at=((De=(ye=Se.response)==null?void 0:ye.data)==null?void 0:De.message)||"Failed to update user information";confirm(`${at}. Do you want to continue to the next step anyway?`)&&i(2)}},ae=async _=>{var Oe,Ue;_.preventDefault();const ue=new FormData(_.currentTarget),A=ue.get("employeeId")||"",L=ue.get("gender")||"",z=ue.get("dateOfBirth")||"",oe=ue.get("nationality")||"",le=ue.get("maritalStatus")||"",xe=ue.get("address")||"",he=ue.get("city")||"",B=ue.get("state")||"",ye=ue.get("postalCode")||"",De={},Se=ea(A);Se&&(De.employeeId=Se);const at=mt(L,"Gender");at&&(De.gender=at);const it=rs(z,"Date of Birth");it&&(De.dateOfBirth=it);const ot=mt(oe,"Nationality");ot&&(De.nationality=ot);const I=mt(le,"Marital Status");I&&(De.maritalStatus=I);const E=mt(xe,"Address");E&&(De.address=E);const f=mt(he,"City");f&&(De.city=f);const Ee=mt(B,"State");Ee&&(De.state=Ee);const R=Xs(ye);if(R&&(De.postalCode=R),Z(De),Object.keys(De).length>0)return;const me={employeeId:A||void 0,gender:L||void 0,dateOfBirth:z||void 0,nationality:oe||void 0,maritalStatus:le||void 0,address:xe||void 0,city:he||void 0,state:B||void 0,postalCode:ye||void 0,isFinalStep:!1};try{await W.mutateAsync(me),Z({}),i(3)}catch(ze){console.error("Error updating profile:",ze);const Ve=((Ue=(Oe=ze.response)==null?void 0:Oe.data)==null?void 0:Ue.message)||"Failed to update profile";confirm(`${Ve}. Do you want to continue to the next step anyway?`)&&i(3)}},u=async _=>{var I,E;_.preventDefault();const ue=new FormData(_.currentTarget),A=ue.get("department")||"",L=ue.get("designation")||"",z=ue.get("dateOfJoining")||"",oe=ue.get("employmentType")||"",le=ue.get("reportingManager")||"",xe=ue.get("workLocation")||"",he={},B=mt(A,"Department");B&&(he.department=B);const ye=mt(L,"Designation");ye&&(he.designation=ye);const De=rs(z,"Date of Joining");De&&(he.dateOfJoining=De);const Se=mt(oe,"Employment Type");Se&&(he.employmentType=Se);const at=mt(le,"Reporting Manager");at&&(he.reportingManager=at);const it=mt(xe,"Work Location");if(it&&(he.workLocation=it),Z(he),Object.keys(he).length>0)return;const ot={department:A||void 0,designation:L||void 0,dateOfJoining:z||void 0,employmentType:oe||void 0,reportingManager:le||void 0,workLocation:xe||void 0,isFinalStep:!1};try{await W.mutateAsync(ot),Z({}),i(4)}catch(f){console.error("Error updating profile:",f);const Ee=((E=(I=f.response)==null?void 0:I.data)==null?void 0:E.message)||"Failed to update profile";confirm(`${Ee}. Do you want to continue to the next step anyway?`)&&i(4)}},k=async _=>{var it,ot;_.preventDefault();const ue=new FormData(_.currentTarget),A=ue.get("bankName")||"",L=ue.get("accountNumber")||"",z=ue.get("ifscCode")||"",oe=ue.get("branch")||"",le=ue.get("panNumber")||"",xe={},he=mt(A,"Bank Name");he&&(xe.bankName=he);const B=Ys(L);B&&(xe.accountNumber=B);const ye=Hs(z);ye&&(xe.ifscCode=ye);const De=mt(oe,"Branch");De&&(xe.branch=De);const Se=Qs(le);if(Se&&(xe.panNumber=Se),Z(xe),Object.keys(xe).length>0)return;const at={bankName:A||void 0,accountNumber:L||void 0,ifscCode:z||void 0,branch:oe||void 0,panNumber:le||void 0,isFinalStep:!1};try{await W.mutateAsync(at),Z({}),i(5)}catch(I){console.error("Error updating profile:",I);const E=((ot=(it=I.response)==null?void 0:it.data)==null?void 0:ot.message)||"Failed to update profile";confirm(`${E}. Do you want to continue to the next step anyway?`)&&i(5)}},c=async _=>{var I,E;_.preventDefault();const ue=new FormData(_.currentTarget),A=ue.get("emergencyContactName")||"",L=ue.get("emergencyRelationship")||"",z=ue.get("emergencyPhoneNumber")||"",oe=ue.get("emergencyAlternatePhone")||"",le={},xe=mt(A,"Emergency Contact Name");xe&&(le.emergencyContactName=xe);const he=mt(L,"Relationship");he&&(le.emergencyRelationship=he);const B=z.trim();if(!B)le.emergencyPhoneNumber="Phone number is required";else if(B.length!==10)le.emergencyPhoneNumber="Phone number must be exactly 10 digits";else{const f=Mt(B);f&&(le.emergencyPhoneNumber=f)}const ye=oe.trim();if(!ye)le.emergencyAlternatePhone="Alternate phone number is required";else if(ye.length!==10)le.emergencyAlternatePhone="Phone number must be exactly 10 digits";else{const f=Mt(ye);f&&(le.emergencyAlternatePhone=f)}if(Z(le),Object.keys(le).length>0)return;const De={emergencyContactName:A||void 0,emergencyRelationship:L||void 0,emergencyPhoneNumber:z||void 0,emergencyAlternatePhone:oe||void 0},Se=(V==null?void 0:V.documents)||{};let at={};if(typeof Se=="string")try{at=JSON.parse(Se)}catch(f){console.error("Error parsing documents:",f),at={}}else typeof Se=="object"&&!Array.isArray(Se)&&(at=Se);const ot={documents:{...at,emergencyContact:Object.keys(De).some(f=>De[f])?De:at.emergencyContact},isFinalStep:!1};try{await W.mutateAsync(ot),Z({}),i(6)}catch(f){console.error("Error updating emergency contact:",f);const Ee=((E=(I=f.response)==null?void 0:I.data)==null?void 0:E.message)||"Failed to update emergency contact";confirm(`${Ee}. Do you want to continue to the next step anyway?`)&&i(6)}},D=async _=>{var oe,le;_.preventDefault();const ue={};m&&(ue.photo=m),C&&(ue.panCard=C),K&&(ue.aadharCard=K),T.length>0&&(ue.otherDocuments=T);const A=(V==null?void 0:V.documents)||{},L=typeof A=="string"?JSON.parse(A):A;L.emergencyContact&&(ue.emergencyContact=L.emergencyContact);const z={documents:Object.keys(ue).length>0?ue:void 0,isFinalStep:!0};try{if(await W.mutateAsync(z),m&&m.url&&t)try{await yt.updateUser(Number(t),{avatarUrl:m.url}),r.invalidateQueries({queryKey:["employee",t]}),r.invalidateQueries({queryKey:["employees"]})}catch(xe){console.error("Error updating avatarUrl:",xe)}}catch(xe){console.error("Error updating documents:",xe);const he=((le=(oe=xe.response)==null?void 0:oe.data)==null?void 0:le.message)||"Failed to update documents";alert(he)}};return Ie?e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"bg-white shadow-xl rounded-lg p-6",children:e.jsx("p",{className:"text-gray-600",children:"Loading employee data..."})})})}):!Ne||!Ne.id?(console.error("EmployeeEdit: Cannot render - missing employee user data",{employeeUser:Ne,profile:V,employeeData:J,isLoading:Ie,employeeError:Ae}),e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6",children:[e.jsx("p",{className:"text-red-600 font-semibold mb-2",children:"Cannot render employee edit form"}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Required employee data is missing."}),Ae&&e.jsxs("p",{className:"text-red-500 text-sm mb-4",children:["Error: ",(Ae==null?void 0:Ae.message)||"Failed to load employee data"]}),e.jsx("button",{onClick:()=>a("/employees"),className:"mt-4 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Back to Employees"})]})})})):(console.log("EmployeeEdit: Rendering main form",{employeeUser:{id:Ne.id,name:Ne.name},hasProfile:!!V,currentStep:n}),e.jsx(et,{children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden overflow-x-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-orange-500 px-8 py-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Edit Employee"}),e.jsx("p",{className:"mt-2 text-orange-100",children:"Update employee information"})]}),e.jsx("button",{onClick:()=>a("/employees"),className:"px-4 py-2 bg-white text-orange-600 rounded-lg font-semibold hover:bg-orange-50 transition-colors",children:" Back"})]})}),e.jsx("div",{className:"px-8 py-4 bg-gray-50 border-b",children:e.jsx("div",{className:"flex items-center justify-between",children:[1,2,3,4,5,6].map(_=>e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsxs("div",{className:"flex flex-col items-center flex-1",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center font-semibold ${n>=_?"bg-orange-600 text-white":"bg-gray-300 text-gray-600"}`,children:_}),e.jsxs("span",{className:"mt-2 text-xs text-gray-600 text-center",children:[_===1&&"Basic Info",_===2&&"Personal Info",_===3&&"Employment",_===4&&"Bank Details",_===5&&"Emergency",_===6&&"Documents"]})]}),_<h&&e.jsx("div",{className:`flex-1 h-1 mx-2 ${n>_?"bg-orange-600":"bg-gray-300"}`})]},_))})}),e.jsxs("div",{className:"p-8 max-h-[calc(100vh-12rem)] overflow-y-auto",children:[n===1&&e.jsxs("form",{onSubmit:ce,className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Name *"}),e.jsx("input",{type:"text",name:"name",defaultValue:(Ne==null?void 0:Ne.name)||"",required:!0,className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 ${x.name?"border-red-500":"border-gray-300"}`}),x.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),e.jsx("input",{type:"email",name:"email",defaultValue:(Ne==null?void 0:Ne.email)||"",required:!0,className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 ${x.email?"border-red-500":"border-gray-300"}`}),x.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone *"}),e.jsx("input",{type:"tel",name:"phone",required:!0,defaultValue:(Ne==null?void 0:Ne.phone)||"",className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 ${x.phone?"border-red-500":"border-gray-300"}`}),x.phone&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.phone})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status *"}),e.jsxs("select",{name:"isActive",defaultValue:(Ne==null?void 0:Ne.isActive)!==void 0?Ne.isActive?"true":"false":"true",required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]})]})]}),e.jsx("div",{className:"flex gap-4 pt-6",children:e.jsx("button",{type:"submit",disabled:Me.isPending,className:"flex-1 px-6 py-3 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:Me.isPending?"Saving...":"Save & Continue"})})]},`step1-${Ne==null?void 0:Ne.id}-${Ne==null?void 0:Ne.name}`),n===2&&e.jsxs("form",{onSubmit:ae,className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Personal Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Employee ID *"}),e.jsx("input",{type:"text",name:"employeeId",defaultValue:(V==null?void 0:V.employeeId)||"",required:!0,className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 ${x.employeeId?"border-red-500":"border-gray-300"}`}),x.employeeId&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.employeeId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Gender *"}),e.jsxs("select",{name:"gender",required:!0,defaultValue:(V==null?void 0:V.gender)||"",className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 ${x.gender?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"Male",children:"Male"}),e.jsx("option",{value:"Female",children:"Female"}),e.jsx("option",{value:"Other",children:"Other"})]}),x.gender&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.gender})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date of Birth *"}),e.jsx("input",{type:"date",name:"dateOfBirth",required:!0,defaultValue:V!=null&&V.dateOfBirth?V.dateOfBirth.split("T")[0]:"",className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 ${x.dateOfBirth?"border-red-500":"border-gray-300"}`}),x.dateOfBirth&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.dateOfBirth})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nationality *"}),e.jsx("input",{type:"text",name:"nationality",required:!0,defaultValue:(V==null?void 0:V.nationality)||"",className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 ${x.nationality?"border-red-500":"border-gray-300"}`}),x.nationality&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.nationality})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Marital Status *"}),e.jsxs("select",{name:"maritalStatus",required:!0,defaultValue:(V==null?void 0:V.maritalStatus)||"",className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 ${x.maritalStatus?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"Single",children:"Single"}),e.jsx("option",{value:"Married",children:"Married"}),e.jsx("option",{value:"Other",children:"Other"})]}),x.maritalStatus&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.maritalStatus})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address *"}),e.jsx("textarea",{name:"address",required:!0,rows:3,defaultValue:(V==null?void 0:V.address)||"",className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 ${x.address?"border-red-500":"border-gray-300"}`},`address-${(V==null?void 0:V.address)||"empty"}`),x.address&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.address})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mt-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City *"}),e.jsx("input",{type:"text",name:"city",required:!0,defaultValue:(V==null?void 0:V.city)||"",className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 ${x.city?"border-red-500":"border-gray-300"}`},`city-${(V==null?void 0:V.city)||"empty"}`),x.city&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.city})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"State/Province *"}),e.jsx("input",{type:"text",name:"state",required:!0,defaultValue:(V==null?void 0:V.state)||"",className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 ${x.state?"border-red-500":"border-gray-300"}`},`state-${(V==null?void 0:V.state)||"empty"}`),x.state&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.state})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Postal Code *"}),e.jsx("input",{type:"text",name:"postalCode",required:!0,maxLength:6,defaultValue:(V==null?void 0:V.postalCode)||"",className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 ${x.postalCode?"border-red-500":"border-gray-300"}`},`postalCode-${(V==null?void 0:V.postalCode)||"empty"}`),x.postalCode&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.postalCode})]})]})]}),e.jsxs("div",{className:"flex gap-4 pt-6",children:[e.jsx("button",{type:"button",onClick:()=>i(1),className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Previous"}),e.jsx("button",{type:"submit",disabled:W.isPending,className:"flex-1 px-6 py-3 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:W.isPending?"Saving...":"Save & Continue"})]})]},`step2-${Ne==null?void 0:Ne.id}-${V==null?void 0:V.employeeId}-${V==null?void 0:V.gender}-${V==null?void 0:V.dateOfBirth}-${(V==null?void 0:V.address)||""}-${(V==null?void 0:V.city)||""}-${(V==null?void 0:V.state)||""}-${(V==null?void 0:V.postalCode)||""}`),n===3&&e.jsxs("form",{onSubmit:u,className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Employment Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department *"}),e.jsx("input",{type:"text",name:"department",required:!0,defaultValue:(V==null?void 0:V.department)||"",className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 ${x.department?"border-red-500":"border-gray-300"}`}),x.department&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.department})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Designation *"}),e.jsx("input",{type:"text",name:"designation",required:!0,defaultValue:(V==null?void 0:V.designation)||"",className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 ${x.designation?"border-red-500":"border-gray-300"}`}),x.designation&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.designation})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date of Joining *"}),e.jsx("input",{type:"date",name:"dateOfJoining",required:!0,defaultValue:V!=null&&V.dateOfJoining?V.dateOfJoining.split("T")[0]:"",className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 ${x.dateOfJoining?"border-red-500":"border-gray-300"}`}),x.dateOfJoining&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.dateOfJoining})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Employment Type *"}),e.jsxs("select",{name:"employmentType",required:!0,defaultValue:(V==null?void 0:V.employmentType)||"",className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 ${x.employmentType?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"Full-Time",children:"Full-Time"}),e.jsx("option",{value:"Part-Time",children:"Part-Time"}),e.jsx("option",{value:"Contract",children:"Contract"}),e.jsx("option",{value:"Intern",children:"Intern"})]}),x.employmentType&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.employmentType})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reporting Manager *"}),e.jsx("input",{type:"text",name:"reportingManager",required:!0,defaultValue:(V==null?void 0:V.reportingManager)||"",className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 ${x.reportingManager?"border-red-500":"border-gray-300"}`}),x.reportingManager&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.reportingManager})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Work Location *"}),e.jsx("input",{type:"text",name:"workLocation",required:!0,defaultValue:(V==null?void 0:V.workLocation)||"",className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 ${x.workLocation?"border-red-500":"border-gray-300"}`}),x.workLocation&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.workLocation})]})]}),e.jsxs("div",{className:"flex gap-4 pt-6",children:[e.jsx("button",{type:"button",onClick:()=>i(2),className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Previous"}),e.jsx("button",{type:"submit",disabled:W.isPending,className:"flex-1 px-6 py-3 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:W.isPending?"Saving...":"Save & Continue"})]})]},`step3-${Ne==null?void 0:Ne.id}-${V==null?void 0:V.department}-${V==null?void 0:V.designation}`),n===4&&e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Bank Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bank Name *"}),e.jsx("input",{type:"text",name:"bankName",required:!0,defaultValue:(V==null?void 0:V.bankName)||"",className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 ${x.bankName?"border-red-500":"border-gray-300"}`}),x.bankName&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.bankName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Account Number *"}),e.jsx("input",{type:"text",name:"accountNumber",required:!0,defaultValue:(V==null?void 0:V.accountNumber)||"",className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 ${x.accountNumber?"border-red-500":"border-gray-300"}`}),x.accountNumber&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.accountNumber})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"IFSC Code *"}),e.jsx("input",{type:"text",name:"ifscCode",required:!0,defaultValue:(V==null?void 0:V.ifscCode)||"",className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 uppercase ${x.ifscCode?"border-red-500":"border-gray-300"}`,style:{textTransform:"uppercase"}}),x.ifscCode&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.ifscCode})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Branch *"}),e.jsx("input",{type:"text",name:"branch",required:!0,defaultValue:(V==null?void 0:V.branch)||"",className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 ${x.branch?"border-red-500":"border-gray-300"}`}),x.branch&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.branch})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"PAN Number *"}),e.jsx("input",{type:"text",name:"panNumber",required:!0,maxLength:10,defaultValue:(V==null?void 0:V.panNumber)||"",className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 uppercase ${x.panNumber?"border-red-500":"border-gray-300"}`,style:{textTransform:"uppercase"}}),x.panNumber&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.panNumber})]})]}),e.jsxs("div",{className:"flex gap-4 pt-6",children:[e.jsx("button",{type:"button",onClick:()=>i(3),className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Previous"}),e.jsx("button",{type:"submit",disabled:W.isPending,className:"flex-1 px-6 py-3 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:W.isPending?"Saving...":"Save & Continue"})]})]},`step4-${Ne==null?void 0:Ne.id}-${V==null?void 0:V.bankName}-${V==null?void 0:V.accountNumber}`),n===5&&e.jsxs("form",{onSubmit:c,className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Emergency Contact Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Name *"}),e.jsx("input",{type:"text",name:"emergencyContactName",required:!0,defaultValue:((Ce=ve==null?void 0:ve.emergencyContact)==null?void 0:Ce.emergencyContactName)||V!=null&&V.documents&&typeof V.documents=="object"&&!Array.isArray(V.documents)&&((Xe=(Ze=V.documents)==null?void 0:Ze.emergencyContact)==null?void 0:Xe.emergencyContactName)||"",className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 ${x.emergencyContactName?"border-red-500":"border-gray-300"}`}),x.emergencyContactName&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.emergencyContactName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Relationship *"}),e.jsx("input",{type:"text",name:"emergencyRelationship",required:!0,placeholder:"e.g., Father, Mother, Spouse, Guardian",defaultValue:((Be=ve==null?void 0:ve.emergencyContact)==null?void 0:Be.emergencyRelationship)||V!=null&&V.documents&&typeof V.documents=="object"&&!Array.isArray(V.documents)&&((l=(Q=V.documents)==null?void 0:Q.emergencyContact)==null?void 0:l.emergencyRelationship)||"",className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 ${x.emergencyRelationship?"border-red-500":"border-gray-300"}`}),x.emergencyRelationship&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.emergencyRelationship})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number *"}),e.jsx("input",{type:"tel",name:"emergencyPhoneNumber",required:!0,pattern:"[0-9]{10}",minLength:10,maxLength:10,placeholder:"10 digit phone number",defaultValue:((O=ve==null?void 0:ve.emergencyContact)==null?void 0:O.emergencyPhoneNumber)||V!=null&&V.documents&&typeof V.documents=="object"&&!Array.isArray(V.documents)&&((fe=(X=V.documents)==null?void 0:X.emergencyContact)==null?void 0:fe.emergencyPhoneNumber)||"",onChange:_=>{const ue=_.target.value.replace(/\D/g,"").slice(0,10);_.target.value=ue,x.emergencyPhoneNumber&&Z(A=>{const L={...A};return delete L.emergencyPhoneNumber,L})},onBlur:_=>{const ue=_.target.value.trim();if(!ue)Z(A=>({...A,emergencyPhoneNumber:"Phone number is required"}));else if(ue.length!==10)Z(A=>({...A,emergencyPhoneNumber:"Phone number must be exactly 10 digits"}));else{const A=Mt(ue);Z(A?L=>({...L,emergencyPhoneNumber:A}):L=>{const z={...L};return delete z.emergencyPhoneNumber,z})}},className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 ${x.emergencyPhoneNumber?"border-red-500":"border-gray-300"}`}),x.emergencyPhoneNumber&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.emergencyPhoneNumber}),!x.emergencyPhoneNumber&&e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Enter 10 digit phone number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Alternate Phone Number *"}),e.jsx("input",{type:"tel",name:"emergencyAlternatePhone",required:!0,pattern:"[0-9]{10}",minLength:10,maxLength:10,placeholder:"10 digit phone number",defaultValue:((Fe=ve==null?void 0:ve.emergencyContact)==null?void 0:Fe.emergencyAlternatePhone)||V!=null&&V.documents&&typeof V.documents=="object"&&!Array.isArray(V.documents)&&((v=(je=V.documents)==null?void 0:je.emergencyContact)==null?void 0:v.emergencyAlternatePhone)||"",onChange:_=>{const ue=_.target.value.replace(/\D/g,"").slice(0,10);_.target.value=ue,x.emergencyAlternatePhone&&Z(A=>{const L={...A};return delete L.emergencyAlternatePhone,L})},onBlur:_=>{const ue=_.target.value.trim();if(!ue)Z(A=>({...A,emergencyAlternatePhone:"Alternate phone number is required"}));else if(ue.length!==10)Z(A=>({...A,emergencyAlternatePhone:"Phone number must be exactly 10 digits"}));else{const A=Mt(ue);Z(A?L=>({...L,emergencyAlternatePhone:A}):L=>{const z={...L};return delete z.emergencyAlternatePhone,z})}},className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 ${x.emergencyAlternatePhone?"border-red-500":"border-gray-300"}`}),x.emergencyAlternatePhone&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.emergencyAlternatePhone}),!x.emergencyAlternatePhone&&e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Enter 10 digit phone number"})]})]}),e.jsxs("div",{className:"flex gap-4 pt-6",children:[e.jsx("button",{type:"button",onClick:()=>i(4),className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Previous"}),e.jsx("button",{type:"submit",disabled:W.isPending,className:"flex-1 px-6 py-3 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:W.isPending?"Saving...":"Save & Continue"})]})]},`step5-${Ne==null?void 0:Ne.id}-${JSON.stringify(ve==null?void 0:ve.emergencyContact)}`),n===6&&e.jsxs("form",{onSubmit:D,className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Documents"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Photo"}),e.jsx("input",{type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp,image/gif",onChange:p,disabled:$,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 disabled:opacity-50"}),$&&e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Uploading..."}),m&&m.url&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg border border-gray-200 flex items-center space-x-4",children:[e.jsx("img",{src:(Pe(m.url)||m.url)+(m.url.includes("?")?"&":"?")+`t=${Date.now()}`,alt:"Photo",className:"h-16 w-16 object-cover rounded border border-gray-300",crossOrigin:"anonymous",onError:_=>{console.error("Photo failed to load:",m.url),_.target.style.display="none"}},`photo-${m.url}-${Date.now()}`),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:m.name||"Photo"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Image File"})]}),e.jsx("button",{type:"button",onClick:()=>j(null),className:"px-3 py-1.5 text-sm text-red-600 hover:text-red-800 border border-red-300 rounded hover:bg-red-50",children:"Remove"})]}),pe&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:pe})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"PAN Card"}),e.jsx("input",{type:"file",accept:"image/jpeg,image/jpg,image/png,application/pdf",onChange:M,disabled:te,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 disabled:opacity-50"}),te&&e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Uploading..."}),(()=>{const _=Qe(),ue=C||(_==null?void 0:_.panCard)||null;return ue&&ue.url?e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg border border-gray-200 flex items-center space-x-4",children:[ue.url.endsWith(".pdf")?e.jsx("div",{className:"h-16 w-16 bg-gray-200 rounded border border-gray-300 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:""})}):e.jsx("img",{src:He(ue.url)||"",alt:"PAN Card",className:"h-16 w-16 object-cover rounded border border-gray-300",crossOrigin:"anonymous"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:ue.name||"PAN Card"}),e.jsx("p",{className:"text-xs text-gray-500",children:ue.url.endsWith(".pdf")?"PDF Document":"Image File"})]}),e.jsx("button",{type:"button",onClick:()=>q(null),className:"px-3 py-1.5 text-sm text-red-600 hover:text-red-800 border border-red-300 rounded hover:bg-red-50",children:"Remove"})]}):null})()]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Aadhar Card"}),e.jsx("input",{type:"file",accept:"image/jpeg,image/jpg,image/png,application/pdf",onChange:P,disabled:o,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 disabled:opacity-50"}),o&&e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Uploading..."}),(()=>{const _=Qe(),ue=K||(_==null?void 0:_.aadharCard)||null;return ue&&ue.url?e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg border border-gray-200 flex items-center space-x-4",children:[ue.url.endsWith(".pdf")?e.jsx("div",{className:"h-16 w-16 bg-gray-200 rounded border border-gray-300 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:""})}):e.jsx("img",{src:He(ue.url)||"",alt:"Aadhar Card",className:"h-16 w-16 object-cover rounded border border-gray-300",crossOrigin:"anonymous"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:ue.name||"Aadhar Card"}),e.jsx("p",{className:"text-xs text-gray-500",children:ue.url.endsWith(".pdf")?"PDF Document":"Image File"})]}),e.jsx("button",{type:"button",onClick:()=>re(null),className:"px-3 py-1.5 text-sm text-red-600 hover:text-red-800 border border-red-300 rounded hover:bg-red-50",children:"Remove"})]}):null})()]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Other Documents (Multiple files allowed)"}),e.jsx("input",{type:"file",accept:"image/jpeg,image/jpg,image/png,application/pdf",multiple:!0,onChange:H,disabled:N,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 disabled:opacity-50"}),N&&e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Uploading..."}),(()=>{const _=Qe(),ue=T.length>0?T:_!=null&&_.otherDocuments&&Array.isArray(_.otherDocuments)?_.otherDocuments.filter(A=>A&&A.url):[];return ue.length>0?e.jsx("div",{className:"mt-3 space-y-2",children:ue.map((A,L)=>{const z=A.url.endsWith(".pdf"),oe=A.url.match(/\.(jpg|jpeg|png|gif|webp)$/i);return e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg border border-gray-200 flex items-center space-x-4",children:[oe?e.jsx("img",{src:He(A.url)||"",alt:A.name,className:"h-16 w-16 object-cover rounded border border-gray-300",crossOrigin:"anonymous"}):e.jsx("div",{className:"h-16 w-16 bg-gray-200 rounded border border-gray-300 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:z?"":""})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",title:A.name,children:A.name}),e.jsx("p",{className:"text-xs text-gray-500",children:z?"PDF Document":oe?"Image File":"Document"})]}),e.jsx("button",{type:"button",onClick:()=>{if(T.length===0&&ue.length>0){const le=ue.filter((xe,he)=>he!==L);b(le)}else U(L)},className:"px-3 py-1.5 text-sm text-red-600 hover:text-red-800 border border-red-300 rounded hover:bg-red-50",children:"Remove"})]},L)})}):null})()]}),e.jsxs("div",{className:"flex gap-4 pt-6",children:[e.jsx("button",{type:"button",onClick:()=>i(5),className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Previous"}),e.jsx("button",{type:"submit",disabled:W.isPending,className:"flex-1 px-6 py-3 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:W.isPending?"Saving...":"Save & Finish"})]})]},`step6-${Ne==null?void 0:Ne.id}-${JSON.stringify(ve)}`)]})]})})}))},jl=()=>{const t=Et(),s=vt(),[a,r]=g.useState(1),n=7,[i,h]=g.useState(null),[m,j]=g.useState(!1),[C,q]=g.useState(""),[K,re]=g.useState({fullName:"",email:"",contactNumber:"",password:""}),[T,b]=g.useState({name:"",email:"",phone:"",gender:"",dateOfBirth:"",nationality:"",maritalStatus:"",address:"",city:"",state:"",postalCode:"",department:"",designation:"",dateOfJoining:"",employmentType:"",reportingManager:"",workLocation:"",bankName:"",accountNumber:"",ifscCode:"",branch:"",panNumber:"",emergencyContactName:"",emergencyRelationship:"",emergencyPhoneNumber:"",emergencyAlternatePhone:"",expertise:"",availability:"",softwareProficiency:[],documents:[]});g.useEffect(()=>{i&&T.name&&T.email&&T.phone&&re(N=>({...N,fullName:T.name,email:T.email,contactNumber:T.phone}))},[i,T.name,T.email,T.phone]);const w=st({mutationFn:async N=>(await Re.post("/auth/register",N)).data,onSuccess:N=>{h(N.data.user.id),r(2),b(S=>({...S,name:K.fullName,email:K.email,phone:K.contactNumber}))},onError:N=>{var S,x,Z,J,Ie,Ae,Me,W;(Z=(x=(S=N.response)==null?void 0:S.data)==null?void 0:x.message)!=null&&Z.includes("already exists")||(Ae=(Ie=(J=N.response)==null?void 0:J.data)==null?void 0:Ie.message)!=null&&Ae.includes("duplicate")?$():alert(((W=(Me=N.response)==null?void 0:Me.data)==null?void 0:W.message)||"Failed to create user account")}}),$=async()=>{try{const N=await Re.get(`/users?email=${encodeURIComponent(K.email)}`);if(N.data&&N.data.length>0){const S=N.data[0];h(S.id),b(x=>({...x,name:S.name,email:S.email,phone:S.phone})),re(x=>({...x,fullName:S.name,email:S.email,contactNumber:S.phone})),r(2)}}catch(N){console.error("Error getting existing user:",N),alert("User with this email already exists, but could not retrieve user details. Please contact support.")}},pe=st({mutationFn:N=>Kt.createFacultyProfile(N),onSuccess:N=>{console.log("Faculty profile created successfully:",N),s.invalidateQueries({queryKey:["faculty"]}),s.invalidateQueries({queryKey:["users"]}),s.invalidateQueries({queryKey:["faculty-profile"]}),alert("Faculty registration completed successfully!"),t("/faculty")},onError:N=>{var S,x,Z;console.error("Failed to create faculty profile:",N),console.error("Error response:",(S=N==null?void 0:N.response)==null?void 0:S.data),alert(((Z=(x=N.response)==null?void 0:x.data)==null?void 0:Z.message)||(N==null?void 0:N.message)||"Failed to create faculty profile")}}),Pe=async N=>{if(N.preventDefault(),i){r(2);return}try{const S=await Re.get(`/users?email=${encodeURIComponent(K.email)}`);if(S.data&&S.data.length>0){alert("A user with this email already exists. Please use a different email address.");return}const x=await Re.get(`/users?phone=${encodeURIComponent(K.contactNumber)}`);if(x.data&&x.data.length>0){alert("A user with this phone number already exists. Please use a different phone number.");return}const Z={name:K.fullName,email:K.email,phone:K.contactNumber,password:K.password,role:"faculty"};w.mutate(Z)}catch(S){console.error("Error checking existing user:",S),alert("Error checking existing users. Please try again.")}},te=N=>{const S={};if((!N.get("gender")||!N.get("gender").trim())&&(S.gender="Gender is required"),!N.get("dateOfBirth")||!N.get("dateOfBirth").trim())S.dateOfBirth="Date of Birth is required";else{const J=N.get("dateOfBirth"),Ie=new Date(J);if(!isNaN(Ie.getTime()))if(Ie>new Date)S.dateOfBirth="Date of birth cannot be in the future";else{const Ae=new Date;let Me=Ae.getFullYear()-Ie.getFullYear();const W=Ae.getMonth()-Ie.getMonth(),Ne=Ae.getDate()-Ie.getDate();(W<0||W===0&&Ne<0)&&Me--,Me<18&&(S.dateOfBirth="Faculty must be at least 18 years old")}}if((!N.get("nationality")||!N.get("nationality").trim())&&(S.nationality="Nationality is required"),(!N.get("maritalStatus")||!N.get("maritalStatus").trim())&&(S.maritalStatus="Marital Status is required"),(!N.get("address")||!N.get("address").trim())&&(S.address="Address is required"),(!N.get("city")||!N.get("city").trim())&&(S.city="City is required"),(!N.get("state")||!N.get("state").trim())&&(S.state="State is required"),(!N.get("postalCode")||!N.get("postalCode").trim())&&(S.postalCode="Postal Code is required"),(!N.get("department")||!N.get("department").trim())&&(S.department="Department is required"),(!N.get("designation")||!N.get("designation").trim())&&(S.designation="Designation is required"),(!N.get("dateOfJoining")||!N.get("dateOfJoining").trim())&&(S.dateOfJoining="Date of Joining is required"),(!N.get("employmentType")||!N.get("employmentType").trim())&&(S.employmentType="Employment Type is required"),(!N.get("workLocation")||!N.get("workLocation").trim())&&(S.workLocation="Work Location is required"),(!N.get("bankName")||!N.get("bankName").trim())&&(S.bankName="Bank Name is required"),(!N.get("accountNumber")||!N.get("accountNumber").trim())&&(S.accountNumber="Account Number is required"),(!N.get("ifscCode")||!N.get("ifscCode").trim())&&(S.ifscCode="IFSC Code is required"),(!N.get("branch")||!N.get("branch").trim())&&(S.branch="Branch is required"),!N.get("panNumber")||!N.get("panNumber").trim())S.panNumber="PAN Number is required";else{const J=N.get("panNumber").toUpperCase();/^[A-Z]{5}[0-9]{4}[A-Z]{1}$/.test(J)||(S.panNumber="Invalid PAN Number format. PAN should be 10 characters (e.g., ABCDE1234F)")}if(N.get("ifscCode")){const J=N.get("ifscCode").toUpperCase();/^[A-Z]{4}0[A-Z0-9]{6}$/.test(J)||(S.ifscCode="Invalid IFSC Code format. IFSC should be 11 characters (e.g., ABCD0123456)")}return(!N.get("emergencyContactName")||!N.get("emergencyContactName").trim())&&(S.emergencyContactName="Emergency Contact Name is required"),(!N.get("emergencyRelationship")||!N.get("emergencyRelationship").trim())&&(S.emergencyRelationship="Emergency Relationship is required"),!N.get("emergencyPhoneNumber")||!N.get("emergencyPhoneNumber").trim()?S.emergencyPhoneNumber="Emergency Phone Number is required":N.get("emergencyPhoneNumber").replace(/\D/g,"").length!==10&&(S.emergencyPhoneNumber="Please enter a valid 10-digit phone number"),(!N.get("expertise")||!N.get("expertise").trim())&&(S.expertise="Expertise is required"),(!N.get("availability")||!N.get("availability").trim())&&(S.availability="Availability is required"),[...N.getAll("softwareProficiency").filter(J=>J!=="Other"),...m&&C.trim()?[C.trim()]:[]].length===0&&(S.softwareProficiency="At least one software proficiency must be selected"),{isValid:Object.keys(S).length===0,errors:S}},Y=async N=>{if(N.preventDefault(),a!==n){const P=new FormData(N.currentTarget);if(a===1&&!i)try{const ce=await Re.get(`/users?email=${encodeURIComponent(K.email)}`);if(ce.data&&ce.data.length>0){alert("A user with this email already exists. Please use a different email address.");return}const ae=await Re.get(`/users?phone=${encodeURIComponent(K.contactNumber)}`);if(ae.data&&ae.data.length>0){alert("A user with this phone number already exists. Please use a different phone number.");return}}catch(ce){console.error("Error checking existing users:",ce),alert("Error checking existing users. Please try again.");return}else if(a===1&&i){r(2);return}let H=!1;const U={};if(a===2){if((!P.get("gender")||!P.get("gender").trim())&&(U.gender="Gender is required",H=!0),!P.get("dateOfBirth")||!P.get("dateOfBirth").trim())U.dateOfBirth="Date of Birth is required",H=!0;else{const ce=P.get("dateOfBirth"),ae=new Date(ce);if(!isNaN(ae.getTime()))if(ae>new Date)U.dateOfBirth="Date of birth cannot be in the future",H=!0;else{const u=new Date;let k=u.getFullYear()-ae.getFullYear();const c=u.getMonth()-ae.getMonth(),D=u.getDate()-ae.getDate();(c<0||c===0&&D<0)&&k--,k<18&&(U.dateOfBirth="Faculty must be at least 18 years old",H=!0)}}(!P.get("nationality")||!P.get("nationality").trim())&&(U.nationality="Nationality is required",H=!0),(!P.get("maritalStatus")||!P.get("maritalStatus").trim())&&(U.maritalStatus="Marital Status is required",H=!0),(!P.get("address")||!P.get("address").trim())&&(U.address="Address is required",H=!0),(!P.get("city")||!P.get("city").trim())&&(U.city="City is required",H=!0),(!P.get("state")||!P.get("state").trim())&&(U.state="State/Province is required",H=!0),(!P.get("postalCode")||!P.get("postalCode").trim())&&(U.postalCode="Postal Code is required",H=!0)}else if(a===3)(!P.get("department")||!P.get("department").trim())&&(U.department="Department is required",H=!0),(!P.get("designation")||!P.get("designation").trim())&&(U.designation="Designation is required",H=!0),(!P.get("dateOfJoining")||!P.get("dateOfJoining").trim())&&(U.dateOfJoining="Date of Joining is required",H=!0),(!P.get("employmentType")||!P.get("employmentType").trim())&&(U.employmentType="Employment Type is required",H=!0),(!P.get("workLocation")||!P.get("workLocation").trim())&&(U.workLocation="Work Location is required",H=!0),(!P.get("expertise")||!P.get("expertise").trim())&&(U.expertise="Expertise is required",H=!0),(!P.get("availability")||!P.get("availability").trim())&&(U.availability="Availability is required",H=!0);else if(a===4){const ce=P.getAll("softwareProficiency"),ae=m&&C.trim();ce.length===0&&!ae&&(U.softwareProficiency="At least one software proficiency must be selected",H=!0)}else a===5?((!P.get("bankName")||!P.get("bankName").trim())&&(U.bankName="Bank Name is required",H=!0),(!P.get("accountNumber")||!P.get("accountNumber").trim())&&(U.accountNumber="Account Number is required",H=!0),(!P.get("ifscCode")||!P.get("ifscCode").trim())&&(U.ifscCode="IFSC Code is required",H=!0),(!P.get("branch")||!P.get("branch").trim())&&(U.branch="Branch is required",H=!0),(!P.get("panNumber")||!P.get("panNumber").trim())&&(U.panNumber="PAN Number is required",H=!0)):a===6&&((!P.get("emergencyContactName")||!P.get("emergencyContactName").trim())&&(U.emergencyContactName="Emergency Contact Name is required",H=!0),(!P.get("emergencyRelationship")||!P.get("emergencyRelationship").trim())&&(U.emergencyRelationship="Emergency Relationship is required",H=!0),(!P.get("emergencyPhoneNumber")||!P.get("emergencyPhoneNumber").trim())&&(U.emergencyPhoneNumber="Emergency Phone Number is required",H=!0));if(H){const ce=Object.values(U)[0];alert(`Please fill all required fields correctly. ${ce}`);return}b(ce=>{const ae={...ce};for(const[u,k]of P.entries())if(u==="softwareProficiency"||u==="documents"){const c=ce[u];if(Array.isArray(c)){const D=P.getAll(u);ae[u]=[...new Set([...c,...D])]}else ae[u]=P.getAll(u)}else ae[u]=k;return ae}),de();return}const S=new FormData(N.currentTarget),x=new FormData;Object.entries(T).forEach(([P,H])=>{Array.isArray(H)?H.forEach(U=>x.append(P,U)):H!=null&&x.append(P,H)});for(const[P,H]of S.entries())x.set(P,H);if(!x.has("dateOfBirth")&&T.dateOfBirth&&x.set("dateOfBirth",T.dateOfBirth),!i){alert("Please complete user registration first");return}const Z=te(x);if(!Z.isValid){let P=1;Z.errors.gender||Z.errors.dateOfBirth||Z.errors.nationality||Z.errors.maritalStatus||Z.errors.address||Z.errors.city||Z.errors.state||Z.errors.postalCode?P=2:Z.errors.department||Z.errors.designation||Z.errors.dateOfJoining||Z.errors.employmentType||Z.errors.workLocation?P=3:Z.errors.expertise||Z.errors.availability?P=4:Z.errors.softwareProficiency?P=5:Z.errors.bankName||Z.errors.accountNumber||Z.errors.ifscCode||Z.errors.branch||Z.errors.panNumber?P=6:(Z.errors.emergencyContactName||Z.errors.emergencyRelationship||Z.errors.emergencyPhoneNumber)&&(P=7),r(P);const H=Object.values(Z.errors)[0];alert(`Please fill all required fields correctly. ${H}`);return}const Ie=[...x.getAll("softwareProficiency").filter(P=>P!=="Other"),...m&&C.trim()?[C.trim()]:[]],Ae=Ie.length>0?Ie.join(", "):void 0,Me=x.getAll("documents"),W=x.get("dateOfBirth")||T.dateOfBirth;if(!W||!W.trim()){r(2),alert("Date of Birth is required. Please enter your date of birth.");return}const Ne={gender:x.get("gender")||T.gender,dateOfBirth:W,nationality:x.get("nationality")||T.nationality,maritalStatus:x.get("maritalStatus")||T.maritalStatus,address:x.get("address")||T.address,city:x.get("city")||T.city,state:x.get("state")||T.state,postalCode:x.get("postalCode")||T.postalCode},V={department:x.get("department")||T.department,designation:x.get("designation")||T.designation,dateOfJoining:x.get("dateOfJoining")||T.dateOfJoining,employmentType:x.get("employmentType")||T.employmentType,reportingManager:x.get("reportingManager")||T.reportingManager||void 0,workLocation:x.get("workLocation")||T.workLocation},Qe={bankName:x.get("bankName")||T.bankName,accountNumber:x.get("accountNumber")||T.accountNumber,ifscCode:x.get("ifscCode")||T.ifscCode,branch:x.get("branch")||T.branch,panNumber:x.get("panNumber")||T.panNumber},ve={emergencyContactName:x.get("emergencyContactName")||T.emergencyContactName,emergencyRelationship:x.get("emergencyRelationship")||T.emergencyRelationship,emergencyPhoneNumber:x.get("emergencyPhoneNumber")||T.emergencyPhoneNumber,emergencyAlternatePhone:x.get("emergencyAlternatePhone")||T.emergencyAlternatePhone||void 0},p={personalInfo:Ne,employmentInfo:V,bankInfo:Qe,emergencyInfo:ve,documents:Me.length>0?Me:void 0},M={userId:i,expertise:x.get("expertise")||T.expertise,availability:x.get("availability")||T.availability,documents:p,softwareProficiency:Ae};pe.mutate(M)},o=()=>{if(a>1){const N=document.querySelector("form");if(N){const S=new FormData(N);b(x=>{const Z={...x};if(a===2)Z.gender=S.get("gender")||x.gender,Z.dateOfBirth=S.get("dateOfBirth")||x.dateOfBirth,Z.nationality=S.get("nationality")||x.nationality,Z.maritalStatus=S.get("maritalStatus")||x.maritalStatus,Z.address=S.get("address")||x.address,Z.city=S.get("city")||x.city,Z.state=S.get("state")||x.state,Z.postalCode=S.get("postalCode")||x.postalCode;else if(a===3)Z.department=S.get("department")||x.department,Z.designation=S.get("designation")||x.designation,Z.dateOfJoining=S.get("dateOfJoining")||x.dateOfJoining,Z.employmentType=S.get("employmentType")||x.employmentType,Z.reportingManager=S.get("reportingManager")||x.reportingManager,Z.workLocation=S.get("workLocation")||x.workLocation,Z.expertise=S.get("expertise")||x.expertise,Z.availability=S.get("availability")||x.availability;else if(a===4){const Ie=[...S.getAll("softwareProficiency").filter(Ae=>Ae!=="Other"),...m&&C.trim()?[C.trim()]:[]];Z.softwareProficiency=Ie}else a===5?(Z.bankName=S.get("bankName")||x.bankName,Z.accountNumber=S.get("accountNumber")||x.accountNumber,Z.ifscCode=S.get("ifscCode")||x.ifscCode,Z.branch=S.get("branch")||x.branch,Z.panNumber=S.get("panNumber")||x.panNumber):a===6&&(Z.emergencyContactName=S.get("emergencyContactName")||x.emergencyContactName,Z.emergencyRelationship=S.get("emergencyRelationship")||x.emergencyRelationship,Z.emergencyPhoneNumber=S.get("emergencyPhoneNumber")||x.emergencyPhoneNumber,Z.emergencyAlternatePhone=S.get("emergencyAlternatePhone")||x.emergencyAlternatePhone);return Z})}a===2&&re(S=>({...S,fullName:T.name,email:T.email,contactNumber:T.phone})),r(a-1)}},de=N=>{a<n&&r(a+1)};return e.jsx(et,{children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-orange-600 to-orange-500 px-8 py-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Faculty Registration Form"}),e.jsx("p",{className:"mt-2 text-orange-100",children:"Complete faculty registration and profile setup"})]}),e.jsx("div",{className:"px-8 py-4 bg-gray-50 border-b",children:e.jsx("div",{className:"flex items-center justify-between",children:[1,2,3,4,5,6,7].map(N=>e.jsxs(At.Fragment,{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-xs font-semibold ${a>=N?"bg-orange-600 text-white":"bg-gray-300 text-gray-600"}`,children:N}),e.jsxs("span",{className:`ml-1 text-xs font-medium ${a>=N?"text-orange-600":"text-gray-500"}`,children:[N===1&&"Account",N===2&&"Personal",N===3&&"Employment",N===4&&"Software",N===5&&"Bank",N===6&&"Emergency",N===7&&"Documents"]})]}),N<n&&e.jsx("div",{className:`flex-1 h-1 mx-1 ${a>N?"bg-orange-600":"bg-gray-300"}`})]},N))})}),a===1&&e.jsxs("form",{onSubmit:Pe,className:"p-8 max-h-[calc(100vh-12rem)] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Step 1: Create User Account"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Full Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"fullName",required:!0,value:K.fullName,onChange:N=>re(S=>({...S,fullName:N.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Email Address ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"email",name:"email",required:!0,value:K.email,onChange:N=>re(S=>({...S,email:N.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Contact Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"tel",name:"contactNumber",required:!0,pattern:"[0-9]{10}",title:"Phone number should be 10 digits",value:K.contactNumber,onChange:N=>re(S=>({...S,contactNumber:N.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"password",name:"password",required:!0,minLength:6,value:K.password,onChange:N=>re(S=>({...S,password:N.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Minimum 6 characters"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:w.isPending,className:"px-6 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:w.isPending?"Creating Account...":"Create Account & Continue"})})]})]}),a>1&&e.jsx("form",{onSubmit:Y,children:e.jsxs("div",{className:"p-8",children:[a===2&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Step 2: Personal Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Gender ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-4 mt-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"gender",value:"male",required:!0,checked:T.gender==="male",onChange:N=>b(S=>({...S,gender:N.target.value})),className:"mr-2"}),e.jsx("span",{children:"Male"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"gender",value:"female",required:!0,checked:T.gender==="female",onChange:N=>b(S=>({...S,gender:N.target.value})),className:"mr-2"}),e.jsx("span",{children:"Female"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"gender",value:"other",required:!0,checked:T.gender==="other",onChange:N=>b(S=>({...S,gender:N.target.value})),className:"mr-2"}),e.jsx("span",{children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Date of Birth ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",name:"dateOfBirth",required:!0,value:T.dateOfBirth,onChange:N=>b(S=>({...S,dateOfBirth:N.target.value})),max:new Date().toISOString().split("T")[0],className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Must be at least 18 years old"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Nationality ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"nationality",required:!0,value:T.nationality,onChange:N=>b(S=>({...S,nationality:N.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Marital Status ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-4 mt-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"maritalStatus",value:"single",required:!0,checked:T.maritalStatus==="single",onChange:N=>b(S=>({...S,maritalStatus:N.target.value})),className:"mr-2"}),e.jsx("span",{children:"Single"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"maritalStatus",value:"married",required:!0,checked:T.maritalStatus==="married",onChange:N=>b(S=>({...S,maritalStatus:N.target.value})),className:"mr-2"}),e.jsx("span",{children:"Married"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"maritalStatus",value:"other",required:!0,checked:T.maritalStatus==="other",onChange:N=>b(S=>({...S,maritalStatus:N.target.value})),className:"mr-2"}),e.jsx("span",{children:"Other"})]})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Address ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{name:"address",rows:3,required:!0,value:T.address,onChange:N=>b(S=>({...S,address:N.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["City ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"city",required:!0,value:T.city,onChange:N=>b(S=>({...S,city:N.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["State/Province ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"state",required:!0,value:T.state,onChange:N=>b(S=>({...S,state:N.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Postal Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"postalCode",required:!0,pattern:"[0-9]{5,6}",title:"Postal code should be 5-6 digits",value:T.postalCode,onChange:N=>b(S=>({...S,postalCode:N.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]})]})]}),a===3&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Step 3: Employment Information"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Department ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"department",required:!0,value:T.department,onChange:N=>b(S=>({...S,department:N.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Designation / Job Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"designation",required:!0,value:T.designation,onChange:N=>b(S=>({...S,designation:N.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Date of Joining ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",name:"dateOfJoining",required:!0,value:T.dateOfJoining,onChange:N=>b(S=>({...S,dateOfJoining:N.target.value})),max:new Date().toISOString().split("T")[0],className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Employment Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"employmentType",value:"full-time",required:!0,checked:T.employmentType==="full-time",onChange:N=>b(S=>({...S,employmentType:N.target.value})),className:"mr-2"}),e.jsx("span",{children:"Full-Time"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"employmentType",value:"part-time",required:!0,checked:T.employmentType==="part-time",onChange:N=>b(S=>({...S,employmentType:N.target.value})),className:"mr-2"}),e.jsx("span",{children:"Part-Time"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"employmentType",value:"contract",required:!0,checked:T.employmentType==="contract",onChange:N=>b(S=>({...S,employmentType:N.target.value})),className:"mr-2"}),e.jsx("span",{children:"Contract"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"employmentType",value:"intern",required:!0,checked:T.employmentType==="intern",onChange:N=>b(S=>({...S,employmentType:N.target.value})),className:"mr-2"}),e.jsx("span",{children:"Intern"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reporting Manager"}),e.jsx("input",{type:"text",name:"reportingManager",value:T.reportingManager,onChange:N=>b(S=>({...S,reportingManager:N.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Work Location ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"workLocation",required:!0,value:T.workLocation,onChange:N=>b(S=>({...S,workLocation:N.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Expertise / Specialization ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{name:"expertise",rows:3,required:!0,value:T.expertise,onChange:N=>b(S=>({...S,expertise:N.target.value})),placeholder:"Describe your areas of expertise and specialization",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Availability ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{name:"availability",rows:2,required:!0,value:T.availability,onChange:N=>b(S=>({...S,availability:N.target.value})),placeholder:"e.g., Monday-Friday 9 AM - 5 PM",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]})]}),a===4&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Step 4: Software Proficiency"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Software Proficiency ",e.jsx("span",{className:"text-gray-500",children:"(Select all applicable)"})]}),e.jsx("div",{className:"border border-gray-300 rounded-md p-4 max-h-64 overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:["Photoshop","Illustrator","InDesign","After Effects","Premiere Pro","Figma","Sketch","Blender","Maya","3ds Max","Cinema 4D","Lightroom","CorelDRAW","AutoCAD","SolidWorks","Revit","SketchUp","Unity","Unreal Engine","DaVinci Resolve","Final Cut Pro","Procreate","Affinity Designer","Affinity Photo","Canva Pro","Other"].map(N=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-2 rounded",children:[e.jsx("input",{type:"checkbox",name:"softwareProficiency",value:N,checked:T.softwareProficiency.includes(N),onChange:S=>{const x=S.target.checked;b(Z=>({...Z,softwareProficiency:x?[...Z.softwareProficiency,N]:Z.softwareProficiency.filter(J=>J!==N)})),N==="Other"&&j(x)},className:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:N})]},N))})}),m&&e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Specify Other Software"}),e.jsx("input",{type:"text",value:C,onChange:N=>q(N.target.value),placeholder:"Enter software names (comma separated)",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]})]})]}),a===5&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Step 5: Bank Details"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Bank Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"bankName",required:!0,value:T.bankName,onChange:N=>b(S=>({...S,bankName:N.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Account Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"accountNumber",required:!0,pattern:"[0-9]{9,18}",title:"Account number should be 9-18 digits",value:T.accountNumber,onChange:N=>b(S=>({...S,accountNumber:N.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["IFSC / Routing Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"ifscCode",required:!0,pattern:"[A-Z]{4}0[A-Z0-9]{6}",title:"IFSC code should be 11 characters (e.g., ABCD0123456)",value:T.ifscCode,onChange:N=>b(S=>({...S,ifscCode:N.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 uppercase",style:{textTransform:"uppercase"}})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Branch ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"branch",required:!0,value:T.branch,onChange:N=>b(S=>({...S,branch:N.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["PAN / Tax ID ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"panNumber",required:!0,maxLength:10,pattern:"[A-Za-z]{5}[0-9]{4}[A-Za-z]{1}",title:"PAN should be 10 characters (e.g., ABCDE1234F)",value:T.panNumber,onChange:N=>b(S=>({...S,panNumber:N.target.value.toUpperCase()})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 uppercase",style:{textTransform:"uppercase"}})]})]}),a===6&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Step 6: Emergency Contact Information"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Contact Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"emergencyContactName",required:!0,value:T.emergencyContactName,onChange:N=>b(S=>({...S,emergencyContactName:N.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Relationship ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"emergencyRelationship",required:!0,value:T.emergencyRelationship,onChange:N=>b(S=>({...S,emergencyRelationship:N.target.value})),placeholder:"e.g., Father, Mother, Spouse, Guardian",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Phone Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"tel",name:"emergencyPhoneNumber",required:!0,pattern:"[0-9]{10}",title:"Phone number should be 10 digits",value:T.emergencyPhoneNumber,onChange:N=>b(S=>({...S,emergencyPhoneNumber:N.target.value.replace(/\D/g,"").slice(0,10)})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Alternate Phone Number"}),e.jsx("input",{type:"tel",name:"emergencyAlternatePhone",pattern:"[0-9]{10}",title:"Phone number should be 10 digits",value:T.emergencyAlternatePhone,onChange:N=>b(S=>({...S,emergencyAlternatePhone:N.target.value.replace(/\D/g,"").slice(0,10)})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]})]})]}),a===7&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Step 7: Documents & Declaration"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Documents Submitted"}),e.jsx("div",{className:"space-y-2 border border-gray-300 rounded-md p-4",children:["Resume","ID Proof","Previous Salary Payslip","Educational Certificates","Experience Certificates","Relieving letter"].map(N=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"documents",value:N,className:"mr-2"}),e.jsx("span",{children:N})]},N))})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Declaration"}),e.jsx("p",{className:"text-sm text-gray-700 mb-4",children:"I hereby declare that the above information is true and correct to the best of my knowledge."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Faculty Signature"}),e.jsx("div",{className:"border-b-2 border-gray-400 h-10"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date"}),e.jsx("input",{type:"date",defaultValue:new Date().toISOString().split("T")[0],className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",readOnly:!0})]})]})]})]}),e.jsxs("div",{className:"flex justify-between mt-8 pt-6 border-t",children:[e.jsx("button",{type:"button",onClick:o,disabled:a===1,className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),a<n?e.jsx("button",{type:"submit",className:"px-6 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors",children:"Next"}):e.jsx("button",{type:"submit",disabled:pe.isPending,className:"px-6 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:pe.isPending?"Submitting...":"Submit Registration"})]})]})})]})})})},Ut={getFacultyBatches:async()=>(await Re.get("/sessions/faculty/assigned")).data.data,startSession:async(t,s)=>(await Re.post(`/sessions/${t}/start`,s)).data.data,endSession:async t=>(await Re.post(`/sessions/${t}/end`)).data.data,submitAttendance:async(t,s)=>(await Re.post(`/sessions/${t}/attendance`,s)).data.data,getBatchStudents:async t=>(await Re.get(`/batches/${t}/enrollments`)).data.data.map(a=>({studentId:a.student.id,name:a.student.name,email:a.student.email,status:"present",present:!0})),getBatchHistory:async t=>(await Re.get(`/sessions/batch/${t}/history`)).data.data,getAllSessions:async t=>(await Re.get("/sessions",{params:t})).data,getSession:async t=>(await Re.get(`/sessions/${t}`)).data,createSession:async t=>(await Re.post("/sessions",t)).data,checkInSession:async t=>(await Re.post(`/sessions/${t}/checkin`)).data,checkOutSession:async t=>(await Re.post(`/sessions/${t}/checkout`)).data},Aa=t=>{const s=new FormData;if(t.photoFile)s.append("photo",t.photoFile);else if(t.photo)if(typeof t.photo=="string"&&t.photo.startsWith("data:")){const a=t.photo.split(","),r=a[0].match(/:(.*?);/),n=r?r[1]:"image/jpeg",i=atob(a[1]);let h=i.length;const m=new Uint8Array(h);for(;h--;)m[h]=i.charCodeAt(h);const j=new Blob([m],{type:n});s.append("photo",j,`attendance-${Date.now()}.jpg`)}else s.append("photo",t.photo);return t.fingerprint&&s.append("fingerprint",t.fingerprint),t.location&&s.append("location",JSON.stringify(t.location)),s},Gt={getSessionAttendance:async t=>(await Re.get(`/sessions/${t}/attendance`)).data,markAttendance:async(t,s)=>(await Re.post(`/sessions/${t}/attendance`,s)).data,getStudentAttendance:async(t,s)=>(await Re.get(`/students/${t}/attendance`,{params:s})).data,punchIn:async t=>(await Re.post("/student-attendance/punch-in",Aa(t),{headers:{"Content-Type":"multipart/form-data"}})).data,punchOut:async t=>(await Re.post("/student-attendance/punch-out",Aa(t),{headers:{"Content-Type":"multipart/form-data"}})).data,getTodayPunch:async()=>(await Re.get("/student-attendance/today")).data,getStudentPunchHistory:async t=>(await Re.get("/student-attendance/history",{params:t})).data,breakIn:async t=>(await Re.post("/student-attendance/break-in",{reason:t})).data,breakOut:async()=>(await Re.post("/student-attendance/break-out")).data},Nl=()=>{var ve;const{user:t}=Nt(),s=vt(),[a,r]=g.useState(!1),[n,i]=g.useState(null),[h,m]=g.useState(!1),[j,C]=g.useState(""),[q,K]=g.useState(""),[re,T]=g.useState(""),[b,w]=g.useState(""),[$,pe]=g.useState(""),[Pe,te]=g.useState(""),{data:Y,isLoading:o}=_e({queryKey:["sessions",j,q,re],queryFn:()=>Ut.getAllSessions({batchId:j?Number(j):void 0,facultyId:q?Number(q):void 0,status:re||void 0})}),{data:de,isLoading:N}=_e({queryKey:["attendance",n==null?void 0:n.id],queryFn:()=>Gt.getSessionAttendance(n.id),enabled:!!n&&h}),{data:S}=_e({queryKey:["batches"],queryFn:()=>St.getAllBatches()}),{data:x}=_e({queryKey:["faculty"],queryFn:()=>Kt.getAllFaculty()}),Z=st({mutationFn:p=>Ut.createSession(p),onSuccess:()=>{s.invalidateQueries({queryKey:["sessions"]}),r(!1),alert("Session created successfully!")},onError:p=>{var M,P;alert(((P=(M=p.response)==null?void 0:M.data)==null?void 0:P.message)||"Failed to create session")}}),J=st({mutationFn:p=>Ut.checkOutSession(p),onSuccess:()=>{s.invalidateQueries({queryKey:["sessions"]}),alert("Session checked out successfully!")},onError:p=>{var M,P;alert(((P=(M=p.response)==null?void 0:M.data)==null?void 0:P.message)||"Failed to check out session")}}),Ie=st({mutationFn:p=>Ut.checkInSession(p),onSuccess:()=>{s.invalidateQueries({queryKey:["sessions"]}),alert("Session checked in successfully!")},onError:p=>{var M,P;alert(((P=(M=p.response)==null?void 0:M.data)==null?void 0:P.message)||"Failed to check in session")}});let Ae=(Y==null?void 0:Y.data.sessions)||[];const Me=(S==null?void 0:S.data)||[],W=(x==null?void 0:x.data.users)||[];let Ne=Ae;(b||$)&&(Ne=Ne.filter(p=>{const M=new Date(p.date);return!(b&&M<new Date(b)||$&&M>new Date($))}));const V=Ne.filter(p=>{var P,H,U,ce,ae,u;if(!Pe.trim())return!0;const M=Pe.toLowerCase();return((P=p.topic)==null?void 0:P.toLowerCase().includes(M))||((U=(H=p.batch)==null?void 0:H.title)==null?void 0:U.toLowerCase().includes(M))||((ae=(ce=p.faculty)==null?void 0:ce.name)==null?void 0:ae.toLowerCase().includes(M))||((u=p.status)==null?void 0:u.toLowerCase().includes(M))}),Qe=p=>{p.preventDefault();const M=new FormData(p.currentTarget),P={batchId:parseInt(M.get("batchId")),facultyId:parseInt(M.get("facultyId")),date:M.get("date"),startTime:M.get("startTime"),endTime:M.get("endTime"),topic:M.get("topic")||void 0,isBackup:M.get("isBackup")==="true"};Z.mutate(P)};return o?e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})})})}):e.jsxs(et,{children:[e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-orange-500 px-8 py-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Session Management"}),e.jsx("p",{className:"mt-2 text-orange-100",children:"Manage class sessions"})]}),((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin"||(t==null?void 0:t.role)==="faculty")&&e.jsx("button",{onClick:()=>r(!0),className:"px-4 py-2 bg-white text-orange-600 rounded-lg font-semibold hover:bg-orange-50 transition-colors",children:"+ Create Session"})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Filter by Batch"}),e.jsxs("select",{value:j,onChange:p=>C(p.target.value?Number(p.target.value):""),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"All Batches"}),Me.map(p=>e.jsx("option",{value:p.id,children:p.title},p.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Filter by Faculty"}),e.jsxs("select",{value:q,onChange:p=>K(p.target.value?Number(p.target.value):""),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"All Faculty"}),W.map(p=>e.jsx("option",{value:p.id,children:p.name},p.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Filter by Status"}),e.jsxs("select",{value:re,onChange:p=>T(p.target.value),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"scheduled",children:"Scheduled"}),e.jsx("option",{value:"ongoing",children:"Ongoing"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"From Date"}),e.jsx("input",{type:"date",value:b,onChange:p=>w(p.target.value),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"To Date"}),e.jsx("input",{type:"date",value:$,onChange:p=>pe(p.target.value),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"relative max-w-md",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Search sessions by topic, batch, faculty, or status...",value:Pe,onChange:p=>te(p.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"}),Pe&&e.jsx("button",{onClick:()=>te(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400 hover:text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),Pe&&e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Showing ",V.length," of ",Ae.length," sessions"]})]}),e.jsxs("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Sessions"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:V.length})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Completed"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:V.filter(p=>p.status==="completed").length})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Ongoing"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:V.filter(p=>p.status==="ongoing").length})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Scheduled"}),e.jsx("p",{className:"text-2xl font-bold text-gray-600",children:V.filter(p=>p.status==="scheduled").length})]})]}),V.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500 text-lg",children:Pe?"No sessions found matching your search":"No sessions found"}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:Pe?"":"Try adjusting your filters or create a new session"}),Pe&&e.jsx("button",{onClick:()=>te(""),className:"mt-2 text-orange-600 hover:text-orange-700 text-sm",children:"Clear search"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Time"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Batch"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Faculty"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Topic"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:V.map(p=>{var M,P;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:lt(p.date)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm text-gray-500",children:[p.startTime," - ",p.endTime]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:((M=p.batch)==null?void 0:M.title)||`Batch ${p.batchId}`})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:((P=p.faculty)==null?void 0:P.name)||`Faculty ${p.facultyId}`})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-gray-500",children:p.topic||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${p.status==="completed"?"bg-green-100 text-green-800":p.status==="ongoing"?"bg-blue-100 text-blue-800":p.status==="cancelled"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:p.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex gap-2",children:[p.status==="scheduled"&&((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin"||(t==null?void 0:t.role)==="faculty")&&e.jsx("button",{onClick:()=>Ie.mutate(p.id),disabled:Ie.isPending,className:"px-3 py-1 bg-orange-600 text-white rounded hover:bg-orange-700 transition-colors disabled:opacity-50 text-xs",children:"Check In"}),p.status==="ongoing"&&((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin"||(t==null?void 0:t.role)==="faculty")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>J.mutate(p.id),disabled:J.isPending,className:"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 transition-colors disabled:opacity-50 text-xs",children:"Check Out"}),e.jsx("button",{onClick:()=>{i(p),m(!0)},className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors text-xs",children:"View Attendance"})]}),(p.status==="completed"||p.status==="ongoing")&&e.jsx("button",{onClick:()=>{i(p),m(!0)},className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors text-xs",children:"View Attendance"})]})})]},p.id)})})]})})]})]})}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Create New Session"}),e.jsxs("form",{onSubmit:Qe,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Batch *"}),e.jsxs("select",{name:"batchId",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select a batch"}),Me.map(p=>e.jsx("option",{value:p.id,children:p.title},p.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Faculty *"}),e.jsxs("select",{name:"facultyId",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select a faculty"}),W.map(p=>e.jsx("option",{value:p.id,children:p.name},p.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date *"}),e.jsx("input",{type:"date",name:"date",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Time *"}),e.jsx("input",{type:"time",name:"startTime",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Time *"}),e.jsx("input",{type:"time",name:"endTime",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Topic"}),e.jsx("input",{type:"text",name:"topic",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"isBackup",value:"true",className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Is Backup Session"})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:Z.isPending,className:"flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:Z.isPending?"Creating...":"Create"}),e.jsx("button",{type:"button",onClick:()=>r(!1),className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})}),h&&n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Session Attendance"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[(ve=n.batch)==null?void 0:ve.title," - ",lt(n.date)]})]}),e.jsx("button",{onClick:()=>{m(!1),i(null)},className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),N?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):de!=null&&de.data.attendances&&de.data.attendances.length>0?e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Student"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Marked At"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:de.data.attendances.map(p=>{var M,P;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:((M=p.student)==null?void 0:M.name)||`Student ${p.studentId}`}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:((P=p.student)==null?void 0:P.email)||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${p.status==="present"||p.status==="manual_present"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:p.status==="manual_present"?"Present (Manual)":p.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:p.isManual?"Manual":"Automatic"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:p.markedAt?new Date(p.markedAt).toLocaleString():"-"})]},p.id)})})]}),e.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:["Total: ",de.data.attendances.length," attendance records"]})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No attendance records found for this session"})})]})})]})},$s=async(t,s,a)=>{const r=await Re.get(t,{params:{...s||{},format:"csv"},responseType:"blob"}),n=new Blob([r.data],{type:"text/csv"}),i=window.URL.createObjectURL(n),h=document.createElement("a");h.href=i,h.download=a,document.body.appendChild(h),h.click(),h.remove(),window.URL.revokeObjectURL(i)},Zt={getFacultyAttendance:async t=>(await Re.get("/attendance-reports/faculty",{params:t})).data.data,downloadFacultyAttendanceCsv:t=>$s("/attendance-reports/faculty",t,"faculty-attendance.csv"),getStudentAttendance:async t=>(await Re.get("/attendance-reports/students",{params:t})).data.data,downloadStudentAttendanceCsv:t=>$s("/attendance-reports/students",t,"student-attendance.csv"),getPunchSummary:async t=>(await Re.get("/attendance-reports/punches",{params:t})).data.data,downloadPunchSummaryCsv:t=>$s("/attendance-reports/punches",t,"punch-summary.csv")},js=e.jsx("div",{className:"text-center py-12 text-gray-500 bg-gray-50 rounded-lg",children:"No data found for the selected filters."}),vl=()=>{var Ne,V,Qe;const{user:t}=Nt(),s=(t==null?void 0:t.role)==="superadmin"||(t==null?void 0:t.role)==="admin",[a,r]=g.useState("batches"),[n,i]=g.useState(null),[h,m]=g.useState({from:"",to:""}),[j,C]=g.useState("student"),[q,K]=g.useState(null),[re,T]=g.useState({from:"",to:""});if(!s)return e.jsx(et,{children:e.jsxs("div",{className:"max-w-4xl mx-auto bg-white shadow-xl rounded-lg p-8 mt-10 text-center space-y-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Attendance Management"}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:"This dashboard is available for Admin and Superadmin roles. Please use the Attendance tab for punch in/out and session management."})]})});const{data:b,isLoading:w}=_e({queryKey:["attendance-batches"],queryFn:()=>St.getAllBatches()}),$=(b==null?void 0:b.data)||[];g.useEffect(()=>{!n&&$.length>0&&i($[0].id)},[$,n]);const pe=g.useMemo(()=>({...h.from?{from:h.from}:{},...h.to?{to:h.to}:{}}),[h.from,h.to]),Pe=g.useMemo(()=>({...re.from?{from:re.from}:{},...re.to?{to:re.to}:{}}),[re.from,re.to]),{data:te,isFetching:Y}=_e({queryKey:["batch-attendance-report",n,h.from,h.to],queryFn:()=>Zt.getStudentAttendance({batchId:n,...pe}),enabled:!!n}),{data:o}=_e({queryKey:["attendance-faculty"],queryFn:()=>Kt.getAllFaculty(500)}),{data:de}=_e({queryKey:["attendance-employees"],queryFn:()=>Qt.getAllEmployees()}),{data:N}=_e({queryKey:["attendance-students"],queryFn:()=>kt.getAllStudents()}),S=((Ne=o==null?void 0:o.data)==null?void 0:Ne.users)||((V=o==null?void 0:o.data)==null?void 0:V.faculty)||[],x=((Qe=de==null?void 0:de.data)==null?void 0:Qe.users)||[],Z=(N==null?void 0:N.data.students)||[],J=g.useMemo(()=>j==="student"?Z.map(ve=>({id:ve.id,name:ve.name,email:ve.email})):j==="faculty"?S.map(ve=>({id:ve.id,name:ve.name,email:ve.email})):x.map(ve=>({id:ve.id,name:ve.name,email:ve.email})),[x,S,Z,j]);g.useEffect(()=>{J&&J.length>0?K(J[0].id):K(null)},[J]);const{data:Ie,isFetching:Ae}=_e({queryKey:["user-attendance",j,q,re.from,re.to],queryFn:async()=>{if(!q)return null;if(j==="student")return{type:"student",rows:(await Gt.getStudentAttendance(q,Pe)).data.attendances};const ve=await Zt.getPunchSummary({userId:q,role:j,...Pe});return{type:"punch",rows:ve.rows,summary:ve.summary}},enabled:!!q}),Me=()=>{if(w)return e.jsx("div",{className:"py-12 text-center text-gray-500",children:"Loading batches..."});if($.length===0)return e.jsx("div",{className:"py-12 text-center text-gray-500",children:"No batches available."});const ve=(te==null?void 0:te.rows)||[];return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex flex-wrap items-end gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Batch"}),e.jsx("select",{value:n||"",onChange:p=>i(Number(p.target.value)||null),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",children:$.map(p=>e.jsxs("option",{value:p.id,children:[p.title," (#",p.id,")"]},p.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"From"}),e.jsx("input",{type:"date",value:h.from,onChange:p=>m(M=>({...M,from:p.target.value})),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"To"}),e.jsx("input",{type:"date",value:h.to,onChange:p=>m(M=>({...M,to:p.target.value})),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:()=>Zt.downloadStudentAttendanceCsv({batchId:n,...pe}),disabled:!n,className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 disabled:opacity-50",children:"Download CSV"})})]}),Y?e.jsx("div",{className:"py-12 text-center text-gray-500",children:"Loading attendance..."}):ve.length===0?js:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Student"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Present"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Absent"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Late"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Attendance %"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:ve.map(p=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 text-sm text-gray-900",children:[e.jsx("p",{className:"font-semibold",children:p.studentName}),e.jsx("p",{className:"text-xs text-gray-500",children:p.studentEmail})]}),e.jsx("td",{className:"px-6 py-4 text-center text-sm text-green-700 font-semibold",children:p.present}),e.jsx("td",{className:"px-6 py-4 text-center text-sm text-red-600 font-semibold",children:p.absent}),e.jsx("td",{className:"px-6 py-4 text-center text-sm text-blue-600 font-semibold",children:p.manualPresent}),e.jsx("td",{className:"px-6 py-4 text-center text-sm text-gray-900 font-semibold",children:p.total}),e.jsx("td",{className:"px-6 py-4 text-center text-sm",children:e.jsxs("span",{className:"px-3 py-1 rounded-full bg-green-50 text-green-700 font-semibold",children:[p.attendanceRate,"%"]})})]},p.studentId))})]})})]})},W=()=>{var ve,p;return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex flex-wrap items-end gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"User Type"}),e.jsxs("select",{value:j,onChange:M=>C(M.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"student",children:"Students"}),e.jsx("option",{value:"faculty",children:"Faculty"}),e.jsx("option",{value:"employee",children:"Employees"})]})]}),e.jsxs("div",{className:"flex-1 min-w-[220px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"User"}),e.jsx("select",{value:q||"",onChange:M=>K(M.target.value?Number(M.target.value):null),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",children:(J==null?void 0:J.map(M=>e.jsxs("option",{value:M.id,children:[M.name," ",M.email?`(${M.email})`:""]},M.id)))||e.jsx("option",{value:"",children:"No users available"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"From"}),e.jsx("input",{type:"date",value:re.from,onChange:M=>T(P=>({...P,from:M.target.value})),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"To"}),e.jsx("input",{type:"date",value:re.to,onChange:M=>T(P=>({...P,to:M.target.value})),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsx("div",{className:"flex gap-2",children:j!=="student"&&e.jsx("button",{onClick:()=>Zt.downloadPunchSummaryCsv({userId:q||void 0,role:j,...Pe}),disabled:!q,className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 disabled:opacity-50",children:"Download CSV"})})]}),Ae?e.jsx("div",{className:"py-10 text-center text-gray-500",children:"Loading user attendance..."}):!Ie||!q?js:Ie.type==="student"?e.jsx(e.Fragment,{children:Ie.rows.length===0?js:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Session / Topic"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Marked At"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Ie.rows.map(M=>{var P,H;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:(P=M.session)!=null&&P.date?lt(M.session.date):"N/A"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:((H=M.session)==null?void 0:H.topic)||`Session #${M.sessionId}`}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${M.status==="absent"?"bg-red-100 text-red-700":M.status==="manual_present"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:M.status.replace("_"," ")})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:M.markedAt?new Date(M.markedAt).toLocaleString():"-"})]},M.id)})})]})})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-green-700 uppercase tracking-wide",children:"Total Punch Days"}),e.jsx("p",{className:"text-2xl font-bold text-green-900 mt-1",children:((ve=Ie.summary)==null?void 0:ve.punches)??0})]}),e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-orange-700 uppercase tracking-wide",children:"Total Hours"}),e.jsx("p",{className:"text-2xl font-bold text-orange-900 mt-1",children:((p=Ie.summary)==null?void 0:p.totalHours)??"0.00"})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-blue-700 uppercase tracking-wide",children:"Role"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900 mt-1 capitalize",children:j})]})]}),Ie.rows.length===0?js:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Punch In"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Punch Out"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Hours"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Ie.rows.map((M,P)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:lt(M.date)}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:M.punchInAt?new Date(M.punchInAt).toLocaleTimeString():"-"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:M.punchOutAt?new Date(M.punchOutAt).toLocaleTimeString():"-"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 font-semibold",children:M.hours})]},`${M.date}-${P}`))})]})})]})]})};return e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto space-y-8",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-orange-600 to-orange-500 px-8 py-6 flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Attendance Management"}),e.jsx("p",{className:"mt-1 text-orange-100",children:"Monitor attendance by batch or individual users."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>r("batches"),className:`px-4 py-2 rounded-lg font-semibold text-sm ${a==="batches"?"bg-white text-orange-600":"bg-white/20 text-white hover:bg-white/30"}`,children:"Batch Attendance"}),e.jsx("button",{onClick:()=>r("users"),className:`px-4 py-2 rounded-lg font-semibold text-sm ${a==="users"?"bg-white text-orange-600":"bg-white/20 text-white hover:bg-white/30"}`,children:"User Attendance"})]})]}),e.jsx("div",{className:"p-8",children:a==="batches"?Me():W()})]})})})},wl=["present","absent","late"],Sl=()=>{var I,E,f,Ee;const{user:t}=Nt(),s=vt(),a=(t==null?void 0:t.role)==="faculty",r=(t==null?void 0:t.role)==="employee",[n,i]=g.useState(null),h=g.useRef(null),m=g.useCallback((R,me="success")=>{h.current&&window.clearTimeout(h.current),i({message:R,type:me}),h.current=window.setTimeout(()=>{i(null),h.current=null},3e3)},[]);g.useEffect(()=>()=>{h.current&&window.clearTimeout(h.current)},[]);const[j,C]=g.useState(!1),[q,K]=g.useState(null),[re,T]=g.useState(null),[b,w]=g.useState(null),[$,pe]=g.useState(null),Pe=g.useRef(null),te=g.useRef(null),Y=g.useRef(null),[o,de]=g.useState(null),[N,S]=g.useState({}),[x,Z]=g.useState(!1),[J,Ie]=g.useState(!1),[Ae,Me]=g.useState([]),[W,Ne]=g.useState(null),[V,Qe]=g.useState(()=>(t==null?void 0:t.role)==="faculty"?"batches":((t==null?void 0:t.role)==="employee","punch")),[ve,p]=g.useState(!1),[M,P]=g.useState(""),H=!a||V==="punch"||V==="history",{data:U,isLoading:ce,error:ae}=_e({queryKey:["today-punch"],queryFn:()=>Gt.getTodayPunch(),enabled:H&&!!t,retry:1}),{data:u,error:k}=_e({queryKey:["punch-history"],queryFn:()=>Gt.getStudentPunchHistory(),enabled:H&&!!t,retry:1}),{data:c,error:D}=_e({queryKey:["faculty-batches"],queryFn:()=>Ut.getFacultyBatches(),enabled:a,retry:1}),se=st({mutationFn:R=>Gt.punchIn(R),onSuccess:()=>{s.invalidateQueries({queryKey:["today-punch"]}),s.invalidateQueries({queryKey:["punch-history"]}),K(null),pe(null),T(null),m("Punched in successfully!")},onError:R=>{var me,Oe;m(((Oe=(me=R.response)==null?void 0:me.data)==null?void 0:Oe.message)||"Failed to punch in","error")}}),ge=st({mutationFn:R=>Gt.punchOut(R),onSuccess:()=>{s.invalidateQueries({queryKey:["today-punch"]}),s.invalidateQueries({queryKey:["punch-history"]}),K(null),pe(null),T(null),m("Punched out successfully!")},onError:R=>{var me,Oe;m(((Oe=(me=R.response)==null?void 0:me.data)==null?void 0:Oe.message)||"Failed to punch out","error")}}),[G,Ce]=g.useState({});g.useEffect(()=>{c&&Ce(R=>{const me={...R};return c.forEach(Oe=>{Oe.activeSession&&delete me[Oe.batch.id]}),me})},[c]);const Ze=st({mutationFn:({batchId:R,topicValue:me})=>Ut.startSession(R,me?{topic:me}:void 0),onSuccess:async(R,me)=>{Ce(Ue=>({...Ue,[me.batchId]:R})),s.setQueryData(["faculty-batches"],Ue=>Ue&&Ue.map(ze=>ze.batch.id===me.batchId?{...ze,activeSession:R}:ze)),await new Promise(Ue=>setTimeout(Ue,1200)),await s.invalidateQueries({queryKey:["faculty-batches"]});let Oe=c==null?void 0:c.find(Ue=>Ue.batch.id===me.batchId);if(!Oe){const Ue=await s.fetchQuery({queryKey:["faculty-batches"],queryFn:()=>Ut.getFacultyBatches()});Oe=Ue==null?void 0:Ue.find(ze=>ze.batch.id===me.batchId)}Oe&&fe({batch:Oe.batch,activeSession:R}),m("Session started!")},onError:R=>{var me,Oe;m(((Oe=(me=R.response)==null?void 0:me.data)==null?void 0:Oe.message)||"Failed to start session","error")}}),Xe=st({mutationFn:R=>Ut.endSession(R),onSuccess:R=>{s.invalidateQueries({queryKey:["faculty-batches"]}),Z(!1),de(null),Ce(me=>{const Oe={...me};return R!=null&&R.batchId&&delete Oe[R.batchId],Oe}),m("Session ended!")},onError:R=>{var me,Oe;m(((Oe=(me=R.response)==null?void 0:me.data)==null?void 0:Oe.message)||"Failed to end session","error")}}),Be=st({mutationFn:({sessionId:R,payload:me})=>Ut.submitAttendance(R,{attendance:Object.entries(me).map(([Oe,Ue])=>({studentId:Number(Oe),status:Ue}))}),onSuccess:()=>{m("Attendance submitted!"),s.invalidateQueries({queryKey:["faculty-batches"]})},onError:R=>{var me,Oe;m(((Oe=(me=R.response)==null?void 0:me.data)==null?void 0:Oe.message)||"Failed to submit attendance","error")}}),Q=st({mutationFn:R=>Gt.breakIn(R),onSuccess:()=>{s.invalidateQueries({queryKey:["today-punch"]}),p(!1),P(""),m("Break started successfully!")},onError:R=>{var me,Oe;m(((Oe=(me=R.response)==null?void 0:me.data)==null?void 0:Oe.message)||"Failed to start break","error"),p(!1),P("")}}),l=st({mutationFn:()=>Gt.breakOut(),onSuccess:()=>{s.invalidateQueries({queryKey:["today-punch"]}),m("Break ended successfully!")},onError:R=>{var me,Oe;m(((Oe=(me=R.response)==null?void 0:me.data)==null?void 0:Oe.message)||"Failed to end break","error")}}),{data:O,isLoading:X}=_e({queryKey:["batch-history",W],queryFn:()=>Ut.getBatchHistory(W),enabled:!!W}),fe=g.useCallback(async R=>{var me,Oe;try{Ie(!0);const Ue=await Ut.getBatchStudents(R.batch.id);Me(Ue);const ze={};Ue.forEach(Ve=>{const nt=Ve.status??(Ve.present?"present":"absent");ze[Ve.studentId]=nt||"present"}),S(ze),de(R),Z(!0),Qe("batches")}catch(Ue){m(((Oe=(me=Ue.response)==null?void 0:me.data)==null?void 0:Oe.message)||"Failed to load students","error")}finally{Ie(!1)}},[]),Fe=(R,me)=>{S(Oe=>({...Oe,[R]:me}))},je=g.useCallback(()=>{if(!navigator.geolocation){w({address:"Geolocation not supported"});return}navigator.geolocation.getCurrentPosition(R=>{w({latitude:R.coords.latitude,longitude:R.coords.longitude})},R=>{console.error("Error getting location:",R),w({address:"Location access denied"})})},[]),v=g.useCallback((R,me)=>{const Oe=R.split(","),Ue=Oe[0].match(/:(.*?);/),ze=Ue?Ue[1]:"image/jpeg",Ve=atob(Oe[1]);let nt=Ve.length;const dt=new Uint8Array(nt);for(;nt--;)dt[nt]=Ve.charCodeAt(nt);return new File([dt],me,{type:ze})},[]),_=g.useCallback(async()=>{try{const R=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:640,height:480},audio:!1});te.current=R,Pe.current&&(Pe.current.srcObject=R,C(!0),je())}catch(R){console.error("Error accessing webcam:",R),m("Unable to access webcam. Please check permissions.","error")}},[je]),ue=g.useCallback(()=>{te.current&&(te.current.getTracks().forEach(R=>R.stop()),te.current=null),Pe.current&&(Pe.current.srcObject=null),C(!1)},[]),A=g.useCallback(()=>{if(Pe.current&&Y.current){const R=Pe.current,me=Y.current,Oe=me.getContext("2d");if(Oe){me.width=R.videoWidth,me.height=R.videoHeight,Oe.drawImage(R,0,0);const Ue=me.toDataURL("image/jpeg",.8);K(Ue),pe(v(Ue,`attendance-${Date.now()}.jpg`))}}},[v]),L=g.useCallback(async()=>{const R=`FP_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;T(R),m("Fingerprint captured! (Simulated - connect actual scanner in production)")},[]),z=g.useCallback(async()=>{let R=b;if(!R)try{if(navigator.geolocation){const Oe=await new Promise((Ue,ze)=>{navigator.geolocation.getCurrentPosition(Ue,ze,{timeout:5e3})});R={latitude:Oe.coords.latitude,longitude:Oe.coords.longitude}}}catch(Oe){console.log("Location not available:",Oe)}const me={photo:q||void 0,photoFile:$||void 0,fingerprint:re||void 0,location:R||void 0};se.mutate(me),ue()},[q,$,re,b,se,ue]),oe=g.useCallback(async()=>{let R=b;if(!R)try{if(navigator.geolocation){const Oe=await new Promise((Ue,ze)=>{navigator.geolocation.getCurrentPosition(Ue,ze,{timeout:5e3})});R={latitude:Oe.coords.latitude,longitude:Oe.coords.longitude}}}catch(Oe){console.log("Location not available:",Oe)}const me={photo:q||void 0,photoFile:$||void 0,fingerprint:re||void 0,location:R||void 0};ge.mutate(me),ue()},[q,$,re,b,ge,ue]);g.useEffect(()=>()=>{ue()},[ue]);const le=g.useMemo(()=>"https://api.prashantthakar.com/api".replace(/\/api\/?$/,"/").replace(/\/+$/,"")||"",[]),xe=g.useCallback(R=>{if(!R)return null;if(R.startsWith("http"))return R;const me=R.startsWith("/")?R.slice(1):R;return`${le}/${me}`},[le]),he=(I=U==null?void 0:U.data)!=null&&I.punch?{...U.data.punch,punchInPhoto:xe(U.data.punch.punchInPhoto),punchOutPhoto:xe(U.data.punch.punchOutPhoto)}:null,B=((E=U==null?void 0:U.data)==null?void 0:E.hasPunchedIn)||!1,ye=((f=U==null?void 0:U.data)==null?void 0:f.hasPunchedOut)||!1,De=g.useMemo(()=>{if(!(he!=null&&he.breaks))return[];try{const R=typeof he.breaks=="string"?JSON.parse(he.breaks):he.breaks;return Array.isArray(R)?R:[]}catch{return[]}},[he==null?void 0:he.breaks]),Se=g.useMemo(()=>De.find(R=>R.startTime&&!R.endTime)||null,[De]),at=g.useMemo(()=>{let R=0;return De.forEach(me=>{if(me.startTime&&me.endTime){const Oe=new Date(me.startTime),Ue=new Date(me.endTime);R+=(Ue.getTime()-Oe.getTime())/(1e3*60)}else if(me.startTime&&!me.endTime){const Oe=new Date(me.startTime);R+=(new Date().getTime()-Oe.getTime())/(1e3*60)}}),R},[De]),it=(((Ee=u==null?void 0:u.data)==null?void 0:Ee.punches)||[]).map(R=>({...R,punchInPhoto:xe(R.punchInPhoto),punchOutPhoto:xe(R.punchOutPhoto)})),ot=g.useMemo(()=>(o==null?void 0:o.activeSession)??null,[o]);return!t||!a&&!r?e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"bg-white shadow-xl rounded-lg p-6",children:e.jsx("p",{className:"text-gray-600",children:"This page is only available for faculty and employees."})})})}):e.jsxs(et,{children:[n&&e.jsx("div",{className:`fixed top-6 right-6 z-50 px-4 py-2 rounded-lg shadow-lg text-sm text-white ${n.type==="success"?"bg-green-600":"bg-red-600"}`,children:n.message}),e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-orange-600 to-orange-500 px-8 py-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Attendance"}),e.jsx("p",{className:"mt-2 text-orange-100",children:a?"Manage your attendance and student batch attendance":"Punch in and punch out (photo and fingerprint optional)"})]}),e.jsxs("div",{className:"p-6",children:[(ae||k||D)&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-red-800 text-sm",children:[ae&&"Error loading today's punch status. ",k&&"Error loading attendance history. ",D&&"Error loading batches. ","Please refresh the page or contact support."]})}),a&&e.jsx("div",{className:"mb-6 border-b border-gray-200",children:e.jsxs("nav",{className:"flex space-x-8",children:[e.jsx("button",{onClick:()=>Qe("batches"),className:`py-4 px-1 border-b-2 font-medium text-sm ${V==="batches"?"border-orange-500 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"My Batches"}),e.jsx("button",{onClick:()=>Qe("punch"),className:`py-4 px-1 border-b-2 font-medium text-sm ${V==="punch"?"border-orange-500 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Punch In/Out"}),e.jsx("button",{onClick:()=>Qe("history"),className:`py-4 px-1 border-b-2 font-medium text-sm ${V==="history"?"border-orange-500 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"History"})]})}),r&&e.jsx("div",{className:"mb-6 border-b border-gray-200",children:e.jsxs("nav",{className:"flex space-x-8",children:[e.jsx("button",{onClick:()=>Qe("punch"),className:`py-4 px-1 border-b-2 font-medium text-sm ${V==="punch"?"border-orange-500 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Punch In/Out"}),e.jsx("button",{onClick:()=>Qe("history"),className:`py-4 px-1 border-b-2 font-medium text-sm ${V==="history"?"border-orange-500 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"History"})]})}),a&&V==="batches"&&e.jsxs("div",{className:"space-y-6",children:[D?e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[e.jsx("p",{className:"text-red-800 text-sm font-semibold mb-2",children:"Error loading batches"}),e.jsx("p",{className:"text-red-600 text-xs",children:D instanceof Error?D.message:"Failed to fetch assigned batches. Please refresh the page."}),e.jsx("button",{onClick:()=>s.invalidateQueries({queryKey:["faculty-batches"]}),className:"mt-2 px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700",children:"Retry"})]}):c?c.length===0?e.jsxs("div",{className:"text-center text-gray-500 py-12 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-lg font-medium mb-2",children:"No batches assigned yet."}),e.jsx("p",{className:"text-sm",children:"Contact your administrator to get assigned to a batch."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:(()=>{const R=c==null?void 0:c.some(me=>{const Oe=me.activeSession||G[me.batch.id];return Oe&&Oe.status==="ongoing"&&!Oe.actualEndAt});return c==null?void 0:c.map(me=>{var tt;const Oe=o&&o.batch.id===me.batch.id?o.activeSession:null,Ue=me.activeSession||G[me.batch.id]||Oe,ze=Ue&&Ue.status==="ongoing"&&!Ue.actualEndAt,Ve=!Ue&&!R,nt=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],dt=(tt=me.batch.schedule)==null?void 0:tt[nt[new Date().getDay()]];return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-5 space-y-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:me.batch.title}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Batch #",me.batch.id]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${ze?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500"}`,children:ze?"Running":"Idle"})]}),dt&&e.jsx("div",{className:"bg-blue-50 p-3 rounded-lg border border-blue-200",children:e.jsxs("p",{className:"text-sm font-medium text-blue-900",children:["Today's Schedule: ",dt.startTime," - ",dt.endTime]})}),Ue&&e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Started:"})," ",Ue.actualStartAt?new Date(Ue.actualStartAt).toLocaleTimeString():"Not started"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Topic:"})," ",Ue.topic||"N/A"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[!Ue&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{const ne=prompt("Enter session topic (optional):");Ze.mutate({batchId:me.batch.id,topicValue:ne||void 0})},disabled:!Ve,className:`flex-1 px-4 py-2 rounded-lg font-semibold transition-colors ${Ve?"bg-green-600 text-white hover:bg-green-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,title:!Ve&&R?"You already have an active session running. Please end it before starting a new one.":"",children:"Start Session"}),!Ve&&R&&e.jsx("p",{className:"text-xs text-red-600 mt-1 w-full",children:"You have an active session in another batch. End it first."})]}),Ue&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>fe(me),className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors",children:"Mark Attendance"}),e.jsx("button",{onClick:()=>Xe.mutate(Ue.id),className:"px-4 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition-colors",children:"End Session"})]})]}),e.jsx("button",{onClick:()=>Ne(me.batch.id),className:"w-full px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors text-sm",children:"View History"})]},me.batch.id)})})()}):e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500"}),e.jsx("span",{className:"ml-3 text-gray-500",children:"Loading batches..."})]}),x&&o&&e.jsxs("div",{className:"mt-6 bg-white border border-gray-200 rounded-lg p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:[o.batch.title," - Attendance"]}),ot&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Session started at ",ot.actualStartAt?new Date(ot.actualStartAt).toLocaleTimeString():"N/A"]})]}),e.jsx("button",{onClick:()=>{Z(!1),de(null)},className:"text-gray-500 hover:text-gray-700",children:" Close"})]}),J?e.jsx("div",{className:"flex items-center justify-center py-12 text-gray-500",children:"Loading students..."}):Ae.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No students enrolled in this batch."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto mb-4",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase",children:"Student"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-semibold text-gray-500 uppercase",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Ae.map(R=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:R.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:R.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("div",{className:"flex items-center justify-center gap-4",children:wl.map(me=>e.jsxs("label",{className:"flex items-center space-x-1 text-sm cursor-pointer",children:[e.jsx("input",{type:"radio",name:`attendance-${R.studentId}`,value:me,checked:(N[R.studentId]??"present")===me,onChange:()=>Fe(R.studentId,me),className:"text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"capitalize",children:me})]},me))})})]},R.studentId))})]})}),ot&&e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>Xe.mutate(ot.id),className:"px-4 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition-colors",children:"End Session"}),e.jsx("button",{onClick:()=>Be.mutate({sessionId:ot.id,payload:N}),disabled:Be.isPending,className:"px-6 py-2 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition-colors disabled:opacity-50",children:Be.isPending?"Saving...":"Save Attendance"})]})]})]}),W&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Batch History"}),e.jsx("button",{onClick:()=>{Ne(null)},className:"text-gray-500 hover:text-gray-700",children:" Close"})]}),X?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500"})}):!O||O.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No session history available"}):e.jsx("div",{className:"space-y-4",children:O.map(R=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:lt(R.date)}),e.jsx("p",{className:"text-sm text-gray-600",children:R.topic&&`Topic: ${R.topic}`})]}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${R.status==="ongoing"?"bg-green-100 text-green-700":R.status==="completed"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:R.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Start:"})," ",R.actualStartAt?new Date(R.actualStartAt).toLocaleString():"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"End:"})," ",R.actualEndAt?new Date(R.actualEndAt).toLocaleString():"N/A"]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-3",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700 mb-2",children:["Attendance: ",R.attendance.present," Present, ",R.attendance.absent," Absent",R.attendance.total>0&&` (Total: ${R.attendance.total})`]}),R.attendance.students.length>0&&e.jsx("div",{className:"max-h-40 overflow-y-auto",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-1 text-left",children:"Student"}),e.jsx("th",{className:"px-2 py-1 text-center",children:"Status"}),e.jsx("th",{className:"px-2 py-1 text-left",children:"Marked At"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:R.attendance.students.map((me,Oe)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-1",children:me.studentName}),e.jsx("td",{className:"px-2 py-1 text-center",children:e.jsx("span",{className:`px-2 py-0.5 rounded ${me.status==="present"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:me.status})}),e.jsx("td",{className:"px-2 py-1 text-gray-500",children:me.markedAt?new Date(me.markedAt).toLocaleTimeString():"-"})]},Oe))})]})})]})]},R.id))})]})})]}),V==="punch"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Today's Status"}),ae?e.jsx("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:e.jsx("p",{className:"text-red-800 text-sm",children:"Error loading today's status. Please try again."})}):ce?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500"})}):he?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Punch In"}),e.jsx("p",{className:"text-lg font-semibold text-green-700",children:he.punchInAt?new Date(he.punchInAt).toLocaleTimeString():"Not punched in"})]}),e.jsxs("div",{className:`p-4 rounded-lg border ${ye?"bg-blue-50 border-blue-200":"bg-gray-50 border-gray-200"}`,children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Punch Out"}),e.jsx("p",{className:`text-lg font-semibold ${ye?"text-blue-700":"text-gray-500"}`,children:he.punchOutAt?new Date(he.punchOutAt).toLocaleTimeString():"Not punched out"})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg border border-yellow-200",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Break Time"}),e.jsx("p",{className:"text-lg font-semibold text-yellow-700",children:De.length>0?`${Math.floor(at/60)}h ${Math.round(at%60)}m`:"0m"})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-200",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Working Hours"}),e.jsx("p",{className:"text-lg font-semibold text-orange-700",children:(()=>{const R=he.effectiveWorkingHours??he.effectiveHours;if(R==null)return"-";const me=typeof R=="number"?R:parseFloat(String(R));return isNaN(me)?"-":`${me.toFixed(2)} hrs`})()})]})]}):e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:e.jsx("p",{className:"text-gray-600",children:"No punch record for today"})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Capture Photo (Optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative bg-gray-900 rounded-lg overflow-hidden",style:{aspectRatio:"4/3"},children:[j?e.jsx("video",{ref:Pe,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("svg",{className:"w-16 h-16 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("p",{children:"Camera not active"})]})}),e.jsx("canvas",{ref:Y,className:"hidden"})]}),e.jsx("div",{className:"flex gap-2",children:j?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:A,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition-colors",children:" Capture"}),e.jsx("button",{onClick:ue,className:"px-4 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition-colors",children:"Stop"})]}):e.jsx("button",{onClick:_,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors",children:" Start Camera"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative bg-gray-900 rounded-lg overflow-hidden",style:{aspectRatio:"4/3"},children:q?e.jsx("img",{src:q,alt:"Captured",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:e.jsx("p",{children:"No photo captured"})})}),q&&e.jsx("button",{onClick:()=>{K(null),pe(null)},className:"w-full px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Clear Photo"})]})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Fingerprint (Optional)"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Fingerprint Status"}),e.jsx("p",{className:"text-sm font-medium",children:re?" Fingerprint captured":"No fingerprint captured"})]}),e.jsx("button",{onClick:L,className:"px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 transition-colors",children:" Capture"})]})})]}),B&&!ye&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Break Management"}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Break Status"}),e.jsx("p",{className:"text-sm font-medium",children:Se?e.jsxs("span",{className:"text-orange-600",children:["On Break since ",new Date(Se.startTime).toLocaleTimeString()]}):e.jsx("span",{className:"text-gray-500",children:"Not on break"})}),De.length>0&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Total Break Time Today: ",Math.floor(at/60),"h ",Math.round(at%60),"m"]})]}),e.jsx("div",{className:"flex gap-2",children:Se?e.jsx("button",{onClick:()=>l.mutate(),disabled:l.isPending,className:"px-4 py-2 bg-yellow-700 text-white rounded-lg font-semibold hover:bg-yellow-800 transition-colors disabled:opacity-50",children:l.isPending?"Ending...":" Break Out"}):e.jsx("button",{onClick:()=>p(!0),disabled:Q.isPending,className:"px-4 py-2 bg-yellow-600 text-white rounded-lg font-semibold hover:bg-yellow-700 transition-colors disabled:opacity-50",children:Q.isPending?"Starting...":" Break In"})})]}),De.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Today's Breaks:"}),e.jsx("div",{className:"space-y-2",children:De.map((R,me)=>e.jsx("div",{className:"bg-white p-3 rounded border border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-900",children:[e.jsxs("span",{className:"font-medium",children:["Break ",me+1,":"]})," ",R.startTime?new Date(R.startTime).toLocaleTimeString():"-",R.endTime?` - ${new Date(R.endTime).toLocaleTimeString()}`:" (Active)"]}),R.reason&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Reason: ",R.reason]})]}),e.jsx("div",{className:"text-sm text-gray-600",children:R.startTime&&R.endTime?(()=>{const Oe=new Date(R.startTime),Ue=new Date(R.endTime),ze=Math.round((Ue.getTime()-Oe.getTime())/(1e3*60));return`${Math.floor(ze/60)}h ${ze%60}m`})():Se&&R.startTime?(()=>{const Oe=new Date(R.startTime),ze=Math.round((new Date().getTime()-Oe.getTime())/(1e3*60));return`${Math.floor(ze/60)}h ${ze%60}m`})():"-"})]})},me))})]})]})]}),ve&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Start Break"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Break Reason (Optional)"}),e.jsx("input",{type:"text",value:M,onChange:R=>P(R.target.value),placeholder:"e.g., Lunch, Tea Break, Personal",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",onKeyDown:R=>{R.key==="Enter"?Q.mutate(M||void 0):R.key==="Escape"&&(p(!1),P(""))},autoFocus:!0})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>{p(!1),P("")},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>Q.mutate(M||void 0),disabled:Q.isPending,className:"px-4 py-2 bg-yellow-600 text-white rounded-lg font-semibold hover:bg-yellow-700 transition-colors disabled:opacity-50",children:"Start Break"})]})]})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Actions"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:z,disabled:B||se.isPending,className:"flex-1 px-6 py-4 bg-green-600 text-white rounded-lg font-semibold text-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:se.isPending?"Punching In...":B?" Already Punched In":" Punch In"}),e.jsx("button",{onClick:oe,disabled:!B||ye||ge.isPending,className:"flex-1 px-6 py-4 bg-red-600 text-white rounded-lg font-semibold text-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:ge.isPending?"Punching Out...":ye?" Already Punched Out":" Punch Out"})]})]})]}),V==="history"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Attendance History"}),k?e.jsx("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:e.jsx("p",{className:"text-red-800 text-sm",children:"Error loading attendance history. Please try again."})}):it.length===0?e.jsx("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:e.jsx("p",{className:"text-gray-500",children:"No attendance history available"})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Punch In"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Punch Out"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Break Time"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Hours"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:it.map(R=>{const Oe=(()=>{if(!R.breaks)return[];try{const Ue=typeof R.breaks=="string"?JSON.parse(R.breaks):R.breaks;return Array.isArray(Ue)?Ue:[]}catch{return[]}})().reduce((Ue,ze)=>{if(ze.startTime&&ze.endTime){const Ve=new Date(ze.startTime),nt=new Date(ze.endTime);return Ue+(nt.getTime()-Ve.getTime())/(1e3*60)}return Ue},0);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:lt(R.date)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:R.punchInAt?new Date(R.punchInAt).toLocaleTimeString():"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:R.punchOutAt?new Date(R.punchOutAt).toLocaleTimeString():"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:Oe>0?`${Math.floor(Oe/60)}h ${Math.round(Oe%60)}m`:"0m"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(()=>{const Ue=R.effectiveWorkingHours??R.effectiveHours;if(Ue==null)return"-";const ze=typeof Ue=="number"?Ue:parseFloat(String(Ue));return isNaN(ze)?"-":`${ze.toFixed(2)} hrs`})()})]},R.id)})})]})})]})]})]})})]})},lr={getAllEnrollments:async t=>(await Re.get("/enrollments",{params:t})).data,getEnrollmentById:async t=>(await Re.get(`/enrollments/${t}`)).data,createEnrollment:async t=>(await Re.post("/enrollments",t)).data,updateEnrollment:async(t,s)=>(await Re.put(`/enrollments/${t}`,s)).data,deleteEnrollment:async t=>(await Re.delete(`/enrollments/${t}`)).data},kl=()=>{var b;const{user:t}=Nt(),[s,a]=g.useState(null),[r,n]=g.useState({}),{data:i}=_e({queryKey:["student-enrollments",(t==null?void 0:t.id)||(t==null?void 0:t.userId)],queryFn:async()=>{if(!t)return{data:[]};const w=t.id||t.userId;return w?await lr.getAllEnrollments({studentId:w}):{data:[]}},enabled:!!t&&(!!t.id||!!t.userId)}),h=(i==null?void 0:i.data)||[],m=h.map(w=>{var $,pe;return{id:(($=w.batch)==null?void 0:$.id)||w.batchId,title:((pe=w.batch)==null?void 0:pe.title)||"Unknown Batch"}}).filter(w=>w.id),{data:j,isLoading:C}=_e({queryKey:["student-attendance",(t==null?void 0:t.id)||(t==null?void 0:t.userId),r],queryFn:async()=>{if(!t)return{data:{attendances:[]}};const w=t.id||t.userId;return w?await Gt.getStudentAttendance(w,r):{data:{attendances:[]}}},enabled:!!t&&(!!t.id||!!t.userId)}),q=((b=j==null?void 0:j.data)==null?void 0:b.attendances)||[],K=g.useMemo(()=>{const w=new Map;return q.forEach($=>{var de,N,S;const pe=$.session;if(!pe)return;const Pe=pe,te=Pe.batchId||((de=Pe.batch)==null?void 0:de.id);if(!te){const x=h.find(Z=>Z.batchId&&m.some(J=>J.id===Z.batchId));if(x){const Z=m.find(J=>J.id===x.batchId);if(Z){const J=w.get(Z.id)||{batchId:Z.id,batchTitle:Z.title,attendances:[],stats:{total:0,present:0,absent:0,manualPresent:0,attendanceRate:0}};J.attendances.push($),J.stats.total++,$.status==="present"?J.stats.present++:$.status==="absent"?J.stats.absent++:$.status==="manual_present"&&J.stats.manualPresent++,w.set(Z.id,J)}}return}const Y=((N=Pe.batch)==null?void 0:N.title)||((S=m.find(x=>x.id===te))==null?void 0:S.title)||`Batch ${te}`;w.has(te)||w.set(te,{batchId:te,batchTitle:Y,attendances:[],stats:{total:0,present:0,absent:0,manualPresent:0,attendanceRate:0}});const o=w.get(te);o.attendances.push($),o.stats.total++,$.status==="present"?o.stats.present++:$.status==="absent"?o.stats.absent++:$.status==="manual_present"&&o.stats.manualPresent++}),w.forEach($=>{const pe=$.stats.present+$.stats.manualPresent;$.stats.attendanceRate=$.stats.total>0?Math.round(pe/$.stats.total*100):0}),w},[q,m]),re=Array.from(K.values()),T=s?re.filter(w=>w.batchId===s):re;return T.forEach(w=>{w.attendances.sort(($,pe)=>{var Y,o;const Pe=(Y=$.session)!=null&&Y.date?new Date($.session.date).getTime():0;return((o=pe.session)!=null&&o.date?new Date(pe.session.date).getTime():0)-Pe})}),(t==null?void 0:t.role)!=="student"?e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto p-4 md:p-6",children:e.jsx("div",{className:"bg-white shadow-xl rounded-lg p-6",children:e.jsx("p",{className:"text-red-600",children:"This page is only available for students."})})})}):e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto p-4 md:p-6",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-orange-500 px-4 md:px-8 py-4 md:py-6",children:e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-white",children:"My Attendance"}),e.jsx("p",{className:"mt-2 text-sm md:text-base text-orange-100",children:"View your attendance by batch and day"})]})})}),e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Filter by Batch"}),e.jsxs("select",{value:s||"",onChange:w=>a(w.target.value?Number(w.target.value):null),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"All Batches"}),m.map(w=>e.jsx("option",{value:w.id,children:w.title},w.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"From Date"}),e.jsx("input",{type:"date",value:r.from||"",onChange:w=>n({...r,from:w.target.value||void 0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"To Date"}),e.jsx("input",{type:"date",value:r.to||"",onChange:w=>n({...r,to:w.target.value||void 0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]})]}),C?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading attendance..."})]}):T.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500 text-lg",children:"No attendance records found"}),q.length===0&&e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"You don't have any attendance records yet."})]}):e.jsx("div",{className:"space-y-6",children:T.map(w=>e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-4 py-3 border-b border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:w.batchTitle}),e.jsxs("p",{className:"text-sm text-gray-600",children:[w.attendances.length," session(s)"]})]}),e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-green-600",children:w.stats.present+w.stats.manualPresent}),e.jsx("div",{className:"text-gray-600",children:"Present"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-red-600",children:w.stats.absent}),e.jsx("div",{className:"text-gray-600",children:"Absent"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:w.stats.total}),e.jsx("div",{className:"text-gray-600",children:"Total"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"font-semibold text-blue-600",children:[w.stats.attendanceRate,"%"]}),e.jsx("div",{className:"text-gray-600",children:"Rate"})]})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Session / Topic"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Marked At"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:w.attendances.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-8 text-center text-gray-500",children:"No attendance records for this batch"})}):w.attendances.map($=>{var pe,Pe;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-900",children:(pe=$.session)!=null&&pe.date?lt($.session.date):"-"}),e.jsxs("td",{className:"px-4 py-4 text-sm text-gray-900",children:[e.jsx("div",{children:((Pe=$.session)==null?void 0:Pe.topic)||"No topic"}),$.isManual&&e.jsx("span",{className:"text-xs text-gray-500",children:"(Manually marked)"})]}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${$.status==="present"||$.status==="manual_present"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:$.status==="present"?"Present":$.status==="manual_present"?"Present (Manual)":"Absent"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-500",children:$.markedAt?lt($.markedAt):"-"})]},$.id)})})]})})]},w.batchId))})]})]})})})},Cl=()=>{var u,k,c,D,se,ge,G,Ce,Ze,Xe,Be;const{user:t}=Nt(),s=vt(),[a,r]=g.useState(!1),[n,i]=g.useState(!1),[h,m]=g.useState(!1),[j,C]=g.useState(null),[q,K]=g.useState(""),[re,T]=g.useState(!1),[b,w]=g.useState(null),[$,pe]=g.useState("all"),{data:Pe,isLoading:te,error:Y}=_e({queryKey:["payments",(t==null?void 0:t.id)||(t==null?void 0:t.userId)],queryFn:async()=>{var Q,l;try{if((t==null?void 0:t.role)==="student"){const O=t.id||t.userId;if(!O)throw new Error("Student ID not found");return console.log("Fetching payments for student:",O),await qt.getAllPayments({studentId:O})}return await qt.getAllPayments()}catch(O){throw console.error("Payment fetch error details:",{error:O,message:O==null?void 0:O.message,response:(Q=O==null?void 0:O.response)==null?void 0:Q.data,status:(l=O==null?void 0:O.response)==null?void 0:l.status,user:t?{id:t.id,userId:t.userId,role:t.role}:null}),O}},retry:2,enabled:!!t});Y&&console.error("Error fetching payments:",{error:Y,message:Y==null?void 0:Y.message,response:(u=Y==null?void 0:Y.response)==null?void 0:u.data,status:(k=Y==null?void 0:Y.response)==null?void 0:k.status,user:t?{id:t.id,userId:t.userId,role:t.role}:null});const{data:o}=_e({queryKey:["students"],queryFn:()=>kt.getAllStudents()}),[de,N]=g.useState(""),[S,x]=g.useState(""),{data:Z}=_e({queryKey:["enrollments",de],queryFn:async()=>{var Q,l,O,X;if(!de)return{data:[],studentProfile:null};try{const fe=await fetch(`https://api.prashantthakar.com/api/api/enrollments?studentId=${de}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});let Fe=[];if(fe.ok){const v=await fe.json();Fe=Array.isArray(v.data)?v.data:((Q=v.data)==null?void 0:Q.enrollments)||[]}let je=null;try{const v=await fetch(`https://api.prashantthakar.com/api/api/attendance-reports/students/${de}/details`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(v.ok){if(je=(O=(l=(await v.json()).data)==null?void 0:l.student)==null?void 0:O.studentProfile,je!=null&&je.documents&&typeof je.documents=="string")try{je.documents=JSON.parse(je.documents),console.log("Parsed student profile documents:",je.documents)}catch(ue){console.error("Error parsing student profile documents:",ue)}(X=je==null?void 0:je.documents)!=null&&X.enrollmentMetadata?console.log("Found enrollmentMetadata:",je.documents.enrollmentMetadata):console.log("No enrollmentMetadata found in student profile documents:",je==null?void 0:je.documents)}}catch(v){console.error("Error fetching student profile:",v)}return{data:Fe,studentProfile:je}}catch(fe){return console.error("Error fetching enrollments:",fe),{data:[],studentProfile:null}}},enabled:!!de}),J=st({mutationFn:Q=>qt.createPayment(Q),onSuccess:()=>{s.invalidateQueries({queryKey:["payments"]}),s.invalidateQueries({queryKey:["student-payments"]}),s.invalidateQueries({queryKey:["enrollments"]}),s.invalidateQueries({queryKey:["student-profile"]}),r(!1),alert("Payment created successfully!")},onError:Q=>{var O,X;const l=((X=(O=Q.response)==null?void 0:O.data)==null?void 0:X.message)||Q.message||"Failed to create payment";console.error("Payment creation error:",Q),alert(`Error: ${l}

Please check:
1. All required fields are filled
2. Database migrations are up to date
3. Backend server logs for details`)}}),Ie=st({mutationFn:({id:Q,data:l})=>qt.updatePayment(Q,l),onSuccess:()=>{s.invalidateQueries({queryKey:["payments"]}),s.invalidateQueries({queryKey:["student-payments"]}),s.invalidateQueries({queryKey:["enrollments"]}),s.invalidateQueries({queryKey:["student-profile"]}),s.refetchQueries({queryKey:["payments"]}),i(!1),C(null),alert("Payment updated successfully!")},onError:Q=>{var l,O;alert(((O=(l=Q.response)==null?void 0:l.data)==null?void 0:O.message)||"Failed to update payment")}}),Ae=st({mutationFn:Q=>qt.generateReceipt(Q),onSuccess:()=>{s.invalidateQueries({queryKey:["payments"]}),alert("Receipt generated successfully!")},onError:Q=>{var l,O;alert(((O=(l=Q.response)==null?void 0:l.data)==null?void 0:O.message)||"Failed to generate receipt")}}),Me=((c=Pe==null?void 0:Pe.data)==null?void 0:c.payments)||[],W=((D=o==null?void 0:o.data)==null?void 0:D.students)||[],Ne=Me.filter(Q=>{var fe,Fe,je,v,_,ue;if(!q.trim())return!0;const l=q.toLowerCase(),O=((Fe=(fe=Q.student)==null?void 0:fe.name)==null?void 0:Fe.toLowerCase())||"",X=((v=(je=Q.student)==null?void 0:je.email)==null?void 0:v.toLowerCase())||"";return O.includes(l)||X.includes(l)||((_=Q.amount)==null?void 0:_.toString().includes(l))||((ue=Q.status)==null?void 0:ue.toLowerCase().includes(l))}),V=Ne.reduce((Q,l)=>{var Fe;const O=l.studentId;Q[O]||(Q[O]={student:l.student,payments:[],totalAmount:0,totalPaid:0,totalPending:0,paymentPlan:null}),Q[O].payments.push(l),Q[O].totalAmount+=Number(l.amount)||0;const X=l.paidAmount!==void 0&&l.paidAmount!==null?Number(l.paidAmount):0,fe=Number(l.amount)||0;return l.id===10&&console.log("Payment #10 details:",{id:l.id,amount:fe,paidAmount:X,paidAmountRaw:l.paidAmount,status:l.status,willBeCounted:X>0||l.status==="paid"&&fe>0}),X>0?Q[O].totalPaid+=X:l.status==="paid"&&fe>0?Q[O].totalPaid+=fe:l.status==="partial"&&fe>0&&X===0&&console.warn(`Payment #${l.id} has status 'partial' but paidAmount is 0. Please update the payment with the correct paidAmount.`),Q[O].totalPending+=fe-X,Q[O].paymentPlan||(l.paymentPlan?Q[O].paymentPlan=l.paymentPlan:(Fe=l.enrollment)!=null&&Fe.paymentPlan&&(Q[O].paymentPlan=l.enrollment.paymentPlan)),Q},{}),Qe=Object.values(V),ve=st({mutationFn:async Q=>{const l=new FormData;l.append("file",Q);const O=await fetch("https://api.prashantthakar.com/api/api/payments/bulk-upload",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:l});if(!O.ok){const X=await O.json();throw new Error(X.message||"Failed to upload payments")}return O.json()},onSuccess:Q=>{s.invalidateQueries({queryKey:["payments"]}),w(Q.data),Q.data.success>0?alert(`Successfully uploaded ${Q.data.success} payment(s)!${Q.data.failed>0?` ${Q.data.failed} failed.`:""}`):alert(`Upload failed: ${Q.data.errors.length>0?Q.data.errors[0].error:"Unknown error"}`)},onError:Q=>{alert(Q.message||"Failed to upload payments")}}),p=async Q=>{Q.preventDefault();const O=new FormData(Q.currentTarget).get("file");if(!O){alert("Please select a file");return}if(!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","text/csv"].includes(O.type)){alert("Invalid file type. Only Excel files (.xlsx, .xls) and CSV files are allowed.");return}T(!0),w(null),ve.mutate(O),T(!1)},M=()=>{const Q=["Photoshop","Illustrator","InDesign","After Effects","Premiere Pro","Figma","Sketch","Blender","Maya","3ds Max","Cinema 4D","Lightroom","CorelDRAW","AutoCAD","SolidWorks","Revit","SketchUp","Unity","Unreal Engine","DaVinci Resolve","Final Cut Pro","Procreate","Affinity Designer","Affinity Photo","Canva Pro"],l=["Email","Phone","Software List (Comma-separated)","Amount","Due Date","Enrollment ID (Optional)","Payment Method (Optional)","Transaction ID (Optional)","Notes (Optional)"],O=["student@example.com","+1234567890","Photoshop, Illustrator, Figma","5000.00","31/12/2025","","cash","","Payment notes"],X=[l.join(","),O.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(","),"","=== INSTRUCTIONS ===","1. Due Date should be in DD/MM/YYYY format (e.g., 31/12/2025)",'2. Software List: Enter comma-separated software names (e.g., "Photoshop, Illustrator, Figma")',"3. Available Software Options:",...Q.map(v=>`   - ${v}`),"4. You can use any combination of the above software or add custom software names","5. Email OR Phone is required to identify the student","6. Amount and Due Date are required fields","7. All other fields are optional"].join(`
`),fe=new Blob([X],{type:"text/csv;charset=utf-8;"}),Fe=document.createElement("a"),je=URL.createObjectURL(fe);Fe.setAttribute("href",je),Fe.setAttribute("download",`payment_upload_template_${new Date().toISOString().split("T")[0]}.csv`),Fe.style.visibility="hidden",document.body.appendChild(Fe),Fe.click(),document.body.removeChild(Fe)},P=()=>{const Q=["Student Name","Student Email","Student Phone","Total Amount","Paid Amount","Balance","Due Date","Paid Date","Status","Payment Method","Transaction ID","Notes"],l=Ne.map(je=>{var ue,A,L;const v=je.paidAmount!==void 0&&je.paidAmount!==null?Number(je.paidAmount):0,_=je.amount-v;return[((ue=je.student)==null?void 0:ue.name)||`Student ${je.studentId}`,((A=je.student)==null?void 0:A.email)||"-",((L=je.student)==null?void 0:L.phone)||"-",je.amount.toFixed(2),v.toFixed(2),_.toFixed(2),je.dueDate?lt(je.dueDate):"-",je.paidDate?lt(je.paidDate):"-",je.status,je.paymentMethod||"-",je.transactionId||"-",je.notes||"-"]}),O=[Q.join(","),...l.map(je=>je.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(","))].join(`
`),X=new Blob([O],{type:"text/csv;charset=utf-8;"}),fe=document.createElement("a"),Fe=URL.createObjectURL(X);fe.setAttribute("href",Fe),fe.setAttribute("download",`payments_${new Date().toISOString().split("T")[0]}.csv`),fe.style.visibility="hidden",document.body.appendChild(fe),fe.click(),document.body.removeChild(fe)},H=Q=>{Q.preventDefault();const l=new FormData(Q.currentTarget),O=parseInt(l.get("studentId")),X=l.get("enrollmentId"),fe=X?parseInt(X):void 0,Fe=parseFloat(l.get("amount")),je=l.get("dueDate"),v=l.get("paymentMethod"),_=l.get("transactionId"),ue=l.get("bankName"),A=l.get("bankAccount");if(!O||isNaN(O)){alert("Please select a valid student");return}if(!Fe||isNaN(Fe)||Fe<=0){alert("Please enter a valid amount greater than 0");return}if(!je){alert("Please select a due date");return}const L={studentId:O,enrollmentId:fe,amount:Fe,dueDate:je,notes:l.get("notes")||void 0,paymentMethod:v||void 0,transactionId:_||void 0,bankName:ue||void 0,bankAccount:A||void 0};console.log("Creating payment with data:",L),J.mutate(L)},U=Q=>{const l=Q.target.value?parseInt(Q.target.value):"";N(l),x("")},ce=Q=>{const l=Q.target.value?parseInt(Q.target.value):"";if(x(l),l&&(Z!=null&&Z.data)&&Array.isArray(Z.data)){const O=Z.data.find(X=>X.id===l);if(O!=null&&O.paymentPlan){const X=O.paymentPlan,fe=X.balanceAmount||X.totalDeal||X.bookingAmount||0;fe>0&&setTimeout(()=>{const Fe=document.querySelector('input[name="amount"]');Fe&&(Fe.value=fe.toString(),Fe.dispatchEvent(new Event("input",{bubbles:!0})))},100)}}};At.useEffect(()=>{var Q,l;if(de&&!S&&((l=(Q=Z==null?void 0:Z.studentProfile)==null?void 0:Q.documents)!=null&&l.enrollmentMetadata)){const O=Z.studentProfile.documents.enrollmentMetadata;let X=O.balanceAmount;if(X==null||X===0){const fe=O.totalDeal,Fe=O.bookingAmount;fe!=null&&(X=Fe!=null?fe-Fe:fe)}X&&X>0&&setTimeout(()=>{const fe=document.querySelector('input[name="amount"]');fe&&!fe.value&&(fe.value=X.toString(),fe.dispatchEvent(new Event("input",{bubbles:!0})))},200)}},[de,S,Z]);const ae=Q=>{if(Q.preventDefault(),!j)return;const l=new FormData(Q.currentTarget),O=l.get("paidAmount"),X=O&&O.trim()!==""?parseFloat(O):void 0,fe=l.get("status")||void 0;let Fe=fe,je=X;if(fe==="partial"){if(X==null||isNaN(X)||X<=0){alert("Please enter a Paid Amount greater than 0 when status is set to Partial");return}X>=j.amount?(Fe="paid",je=j.amount):je=X}else fe==="paid"?X==null||isNaN(X)||X===0?je=j.amount:je=Math.min(X,j.amount):X!=null&&!isNaN(X)&&X>0&&(X>=j.amount?(Fe="paid",je=j.amount):(Fe="partial",je=X));const v={status:Fe,paidDate:l.get("paidDate")||void 0,paymentMethod:l.get("paymentMethod")||void 0,transactionId:l.get("transactionId")||void 0,bankName:l.get("bankName")||void 0,bankAccount:l.get("bankAccount")||void 0,notes:l.get("notes")||void 0,paidAmount:je};console.log("Updating payment:",{id:j.id,data:v}),Ie.mutate({id:j.id,data:v})};return te?e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})})})}):Y?e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto p-4 md:p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-red-800 mb-2",children:"Error Loading Payments"}),e.jsx("p",{className:"text-red-600 mb-4",children:Y instanceof Error?Y.message:"Failed to load payments. Please try again."}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Retry"})]})})}):e.jsxs(et,{children:[e.jsx("div",{className:"max-w-7xl mx-auto p-4 md:p-6",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-orange-500 px-4 md:px-8 py-4 md:py-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-white",children:(t==null?void 0:t.role)==="student"?"My Payments":"Payment Management"}),e.jsx("p",{className:"mt-2 text-sm md:text-base text-orange-100",children:(t==null?void 0:t.role)==="student"?"View your payment details":"Manage payments"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 md:gap-3 w-full sm:w-auto",children:[e.jsxs("button",{onClick:P,className:"px-4 py-2 bg-white text-orange-600 rounded-lg font-semibold hover:bg-orange-50 transition-colors flex items-center gap-2 text-sm md:text-base",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download CSV"]}),((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>m(!0),className:"px-4 py-2 bg-white text-orange-600 rounded-lg font-semibold hover:bg-orange-50 transition-colors flex items-center gap-2 text-sm md:text-base",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Upload Excel"]}),e.jsx("button",{onClick:()=>r(!0),className:"px-4 py-2 bg-white text-orange-600 rounded-lg font-semibold hover:bg-orange-50 transition-colors text-sm md:text-base whitespace-nowrap",children:"+ Create Payment"})]})]})]})}),e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"flex flex-col sm:flex-row gap-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-2 bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>pe("all"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${$==="all"?"bg-white text-orange-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"All Payments"}),e.jsx("button",{onClick:()=>pe("byStudent"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${$==="byStudent"?"bg-white text-orange-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"By Student"})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Search payments by student name, email, amount, or status...",value:q,onChange:Q=>K(Q.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"}),q&&e.jsx("button",{onClick:()=>K(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400 hover:text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),q&&e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Showing ",Ne.length," of ",Me.length," payments"]})]}),Y?e.jsx("div",{className:"text-center py-12",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md mx-auto",children:[e.jsx("p",{className:"text-red-600 text-lg font-semibold mb-2",children:"Error Loading Payments"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((ge=(se=Y==null?void 0:Y.response)==null?void 0:se.data)==null?void 0:ge.message)||(Y==null?void 0:Y.message)||"Request failed with status code "+(((G=Y==null?void 0:Y.response)==null?void 0:G.status)||"unknown")}),e.jsx("button",{onClick:()=>s.invalidateQueries({queryKey:["payments"]}),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Retry"}),((Ce=Y==null?void 0:Y.response)==null?void 0:Ce.status)===403&&e.jsx("p",{className:"text-xs text-gray-500 mt-4",children:"If you're a student, make sure you're logged in with your student account."})]})}):(Ze=Pe==null?void 0:Pe.data)!=null&&Ze.payments?Ne.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"No payments found"})}):e.jsxs("div",{className:"overflow-x-auto w-full",children:[(()=>{var ue;const Q=Me.reduce((A,L)=>A+(Number(L.amount)||0),0),l=Me.reduce((A,L)=>{const z=L.paidAmount!==void 0&&L.paidAmount!==null?Number(L.paidAmount):0,oe=Number(L.amount)||0;return z>0?A+z:L.status==="paid"&&oe>0?A+oe:(L.status==="partial"&&oe>0&&z===0&&console.warn(`Payment #${L.id} has status 'partial' but paidAmount is 0. Please update the payment with the correct paidAmount.`),A)},0),O=Me.reduce((A,L)=>{const z=Number(L.amount)||0,oe=Number(L.paidAmount)||0;return A+(z-oe)},0),X=Me.find(A=>{var L;return(L=A.enrollment)==null?void 0:L.paymentPlan}),fe=(ue=X==null?void 0:X.enrollment)==null?void 0:ue.paymentPlan,Fe=(fe==null?void 0:fe.totalDeal)!==null&&(fe==null?void 0:fe.totalDeal)!==void 0?Number(fe.totalDeal):null,je=(fe==null?void 0:fe.bookingAmount)!==null&&(fe==null?void 0:fe.bookingAmount)!==void 0?Number(fe.bookingAmount):0,v=(fe==null?void 0:fe.balanceAmount)!==null&&(fe==null?void 0:fe.balanceAmount)!==void 0?Number(fe.balanceAmount):null,_=v!==null?v:Fe!=null?Math.max(0,Fe-je-l):null;return e.jsxs("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-5 gap-4 p-4 bg-gray-50 rounded-lg",children:[Fe!=null&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Total Deal Amount"}),e.jsxs("p",{className:"text-lg font-semibold text-blue-600",children:["",Fe.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Total Payments"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:Me.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Total Amount"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:["",Q.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Total Paid"}),e.jsxs("p",{className:"text-lg font-semibold text-green-600",children:["",l.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Total Pending"}),e.jsxs("p",{className:"text-lg font-semibold text-orange-600",children:["",O.toFixed(2)]}),_!==null&&_!==O&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Balance: ",_.toFixed(2)]})]})]})})(),$==="byStudent"?e.jsx("div",{className:"space-y-6 overflow-x-auto",style:{minWidth:"1200px"},children:Qe.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"No payments found"})}):Qe.map(Q=>{var je,v,_,ue,A,L;const l=Q.paymentPlan,O=(l==null?void 0:l.totalDeal)!==null&&(l==null?void 0:l.totalDeal)!==void 0?Number(l.totalDeal):null,X=(l==null?void 0:l.bookingAmount)!==null&&(l==null?void 0:l.bookingAmount)!==void 0?Number(l.bookingAmount):0,fe=(l==null?void 0:l.balanceAmount)!==null&&(l==null?void 0:l.balanceAmount)!==void 0?Number(l.balanceAmount):null;console.log("Payment Group Calculation:",{studentId:(je=Q.student)==null?void 0:je.id,totalDeal:O,bookingAmount:X,totalPaid:Q.totalPaid,payments:Q.payments.map(z=>({id:z.id,amount:z.amount,paidAmount:z.paidAmount,status:z.status}))});const Fe=O!=null?Math.max(0,O-X-Q.totalPaid):null;return e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 px-4 py-3 border-b border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:((v=Q.student)==null?void 0:v.name)||`Student ${((_=Q.student)==null?void 0:_.id)||"Unknown"}`}),e.jsx("p",{className:"text-sm text-gray-600",children:((ue=Q.student)==null?void 0:ue.email)||"-"}),((A=Q.student)==null?void 0:A.phone)&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Phone: ",Q.student.phone]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[O!==null&&e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs sm:text-sm",children:[e.jsxs("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded font-medium",children:["Total Deal: ",O.toFixed(2)]}),X>0&&e.jsxs("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 rounded font-medium",children:["Booking: ",X.toFixed(2)]}),fe!==null&&e.jsxs("span",{className:"px-2 py-1 bg-indigo-100 text-indigo-800 rounded font-medium",children:["Balance: ",fe.toFixed(2)]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs sm:text-sm",children:[e.jsxs("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 rounded font-medium",children:["Payments: ",Q.payments.length]}),e.jsxs("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 rounded font-medium",children:["Total: ",Q.totalAmount.toFixed(2)]}),e.jsxs("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded font-medium",children:["Paid: ",Q.totalPaid.toFixed(2)]}),e.jsxs("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 rounded font-medium",children:["Pending: ",Q.totalPending.toFixed(2)]}),Fe!==null&&e.jsxs("span",{className:"px-2 py-1 bg-red-100 text-red-800 rounded font-medium",children:["Remaining: ",Fe.toFixed(2)]})]})]})]})}),O!==null&&e.jsxs("div",{className:"px-4 py-3 bg-blue-50 border-b border-blue-200",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Payment Plan Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Total Deal Amount ()"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:["",O.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Booking Amount ()"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:["",X.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Initial Balance Amount ()"}),e.jsxs("p",{className:"text-lg font-semibold text-orange-600",children:["",(fe!==null?fe:O-X).toFixed(2)]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Initial Balance = Total Deal - Booking Amount"})]})]}),Fe!==null&&e.jsx("div",{className:"mt-3 pt-3 border-t border-blue-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Total Paid ()"}),e.jsxs("p",{className:"text-lg font-semibold text-green-600",children:["",Q.totalPaid.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Remaining Balance ()"}),e.jsxs("p",{className:`text-lg font-semibold ${Fe>0?"text-red-600":"text-green-600"}`,children:["",Fe.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Remaining = Total Deal (",O.toFixed(2),") - Booking (",X.toFixed(2),") - Paid (",Q.totalPaid.toFixed(2),")"]})]})]})})]}),(l==null?void 0:l.emiPlan)&&l.emiInstallments&&Array.isArray(l.emiInstallments)&&l.emiInstallments.length>0&&e.jsxs("div",{className:"px-4 py-3 bg-indigo-50 border-b border-indigo-200",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-3",children:"EMI Plan Details"}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"flex flex-wrap gap-4 text-xs sm:text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"EMI Plan:"}),e.jsx("span",{className:"ml-2 font-semibold text-indigo-800",children:"Active"})]}),l.emiPlanDate&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"EMI Plan Date:"}),e.jsx("span",{className:"ml-2 font-semibold text-indigo-800",children:lt(l.emiPlanDate)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total Installments:"}),e.jsx("span",{className:"ml-2 font-semibold text-indigo-800",children:l.emiInstallments.length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total EMI Amount:"}),e.jsxs("span",{className:"ml-2 font-semibold text-indigo-800",children:["",l.emiInstallments.reduce((z,oe)=>z+(Number(oe.amount)||0),0).toFixed(2)]})]})]})}),e.jsx("div",{className:"overflow-x-auto min-w-max",style:{scrollbarWidth:"thin",scrollbarColor:"#cbd5e0 #f7fafc"},children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 border border-gray-300",style:{minWidth:"800px"},children:[e.jsx("thead",{className:"bg-indigo-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase",children:"Month"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase",children:"Amount ()"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase",children:"Due Date"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium text-gray-700 uppercase",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.emiInstallments.map((z,oe)=>{const le=Q.payments.find(B=>{const ye=B.dueDate?new Date(B.dueDate).toISOString().split("T")[0]:null,De=z.dueDate?new Date(z.dueDate).toISOString().split("T")[0]:null;return ye===De&&Math.abs(Number(B.amount)-Number(z.amount))<.01}),xe=le&&(le.status==="paid"||le.status==="partial"),he=z.dueDate&&new Date(z.dueDate)<new Date&&!xe;return e.jsxs("tr",{className:xe?"bg-green-50":he?"bg-red-50":"",children:[e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900 font-medium",children:z.month||oe+1}),e.jsxs("td",{className:"px-4 py-2 text-sm font-semibold text-indigo-900",children:["",Number(z.amount).toFixed(2)]}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:z.dueDate?lt(z.dueDate):"-"}),e.jsx("td",{className:"px-4 py-2 text-center",children:xe?e.jsx("span",{className:"px-2 py-1 rounded text-xs font-semibold bg-green-100 text-green-800",children:le.status==="partial"?"Partial":"Paid"}):he?e.jsx("span",{className:"px-2 py-1 rounded text-xs font-semibold bg-red-100 text-red-800",children:"Overdue"}):e.jsx("span",{className:"px-2 py-1 rounded text-xs font-semibold bg-yellow-100 text-yellow-800",children:"Pending"})})]},oe)})}),e.jsx("tfoot",{className:"bg-indigo-100",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:2,className:"px-4 py-2 text-sm font-semibold text-gray-900",children:"Total EMI Amount"}),e.jsxs("td",{colSpan:2,className:"px-4 py-2 text-sm font-semibold text-indigo-900 text-right",children:["",l.emiInstallments.reduce((z,oe)=>z+(Number(oe.amount)||0),0).toFixed(2)]})]})})]})})]}),e.jsx("div",{className:"overflow-x-auto min-w-max",style:{scrollbarWidth:"thin",scrollbarColor:"#cbd5e0 #f7fafc"},children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",style:{minWidth:"1200px"},children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Payment ID"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden md:table-cell",children:"Batch/Enrollment"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden lg:table-cell",children:"Due Date"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden lg:table-cell",children:"Paid Date"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Q.payments.map(z=>{var oe;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-xs sm:text-sm font-medium text-gray-900",children:["#",z.id]})}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap hidden md:table-cell",children:(oe=z.enrollment)!=null&&oe.batch?e.jsxs("div",{className:"text-xs sm:text-sm",children:[e.jsx("div",{className:"font-medium text-gray-900",children:z.enrollment.batch.title}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Enrollment #",z.enrollmentId]})]}):e.jsx("div",{className:"text-xs sm:text-sm text-gray-400 italic",children:"No enrollment linked"})}),e.jsxs("td",{className:"px-3 sm:px-6 py-4",children:[z.status==="partial"||z.paidAmount&&z.paidAmount>0&&z.paidAmount<z.amount?e.jsxs("div",{className:"text-xs sm:text-sm space-y-1",children:[e.jsxs("div",{className:"text-gray-900 font-semibold",children:["Total: ",z.amount.toFixed(2)]}),e.jsxs("div",{className:"text-green-600 font-medium",children:["Paid: ",(z.paidAmount!==void 0&&z.paidAmount!==null?Number(z.paidAmount):0).toFixed(2)]}),e.jsxs("div",{className:"text-red-600 font-medium",children:["Balance: ",(z.amount-(z.paidAmount!==void 0&&z.paidAmount!==null?Number(z.paidAmount):0)).toFixed(2)]})]}):z.status==="paid"?e.jsxs("div",{className:"text-xs sm:text-sm text-gray-900 font-semibold",children:["",z.amount.toFixed(2)]}):e.jsxs("div",{className:"text-xs sm:text-sm text-gray-900",children:["",z.amount.toFixed(2)]}),e.jsxs("div",{className:"text-xs text-gray-500 lg:hidden mt-1",children:["Due: ",lt(z.dueDate)]})]}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap hidden lg:table-cell",children:e.jsx("div",{className:"text-xs sm:text-sm text-gray-500",children:lt(z.dueDate)})}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap hidden lg:table-cell",children:e.jsx("div",{className:"text-xs sm:text-sm text-gray-500",children:lt(z.paidDate)})}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${z.status==="paid"?"bg-green-100 text-green-800":z.status==="partial"?"bg-blue-100 text-blue-800":z.status==="unpaid"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:z.status})}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap text-xs sm:text-sm font-medium",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 items-start sm:items-center",children:[z.receiptUrl?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:async()=>{var le,xe;try{const he=await qt.downloadReceipt(z.id),B=window.URL.createObjectURL(he),ye=document.createElement("a");ye.href=B,ye.download=`receipt_${z.id}_${new Date().toISOString().split("T")[0]}.pdf`,document.body.appendChild(ye),ye.click(),document.body.removeChild(ye),window.URL.revokeObjectURL(B)}catch(he){alert(((xe=(le=he.response)==null?void 0:le.data)==null?void 0:xe.message)||"Failed to download receipt")}},className:"text-blue-600 hover:text-blue-900 font-medium",title:"Download Receipt",children:" Receipt"}),e.jsx("a",{href:z.receiptUrl.startsWith("http")?z.receiptUrl:`https://api.prashantthakar.com/api${z.receiptUrl.split("/").map((le,xe)=>xe===0||le===""?le:encodeURIComponent(le)).join("/")}`,target:"_blank",rel:"noopener noreferrer",className:"text-green-600 hover:text-green-900 font-medium",title:"View Receipt",children:" View"})]}):(z.status==="paid"||z.status==="partial")&&((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")?e.jsx("button",{onClick:()=>{confirm("Generate receipt for this payment?")&&Ae.mutate(z.id)},disabled:Ae.isPending,className:"text-purple-600 hover:text-purple-900 font-medium disabled:opacity-50",title:"Generate Receipt",children:Ae.isPending?"Generating...":" Generate Receipt"}):null,((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")&&e.jsx("button",{onClick:()=>{C(z),i(!0)},className:"text-orange-600 hover:text-orange-900 text-xs sm:text-sm",children:"Update"})]})})]},z.id)})})]})})]},((L=Q.student)==null?void 0:L.id)||"unknown")})}):e.jsx("div",{className:"overflow-x-auto -mx-4 sm:mx-0",children:e.jsx("div",{className:"inline-block min-w-full align-middle sm:px-0",children:e.jsxs("table",{className:"divide-y divide-gray-200",style:{minWidth:"1200px"},children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Student"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden md:table-cell",children:"Batch/Enrollment"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden lg:table-cell",children:"Due Date"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden lg:table-cell",children:"Paid Date"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Ne.map(Q=>{var l,O,X,fe,Fe;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-3 sm:px-6 py-4",children:[e.jsx("div",{className:"text-xs sm:text-sm font-medium text-gray-900",children:((l=Q.student)==null?void 0:l.name)||`Student ${Q.studentId}`}),e.jsx("div",{className:"text-xs sm:text-sm text-gray-500",children:((O=Q.student)==null?void 0:O.email)||"-"}),e.jsx("div",{className:"text-xs text-gray-500 md:hidden mt-1",children:((fe=(X=Q.enrollment)==null?void 0:X.batch)==null?void 0:fe.title)||"No enrollment"})]}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap hidden md:table-cell",children:(Fe=Q.enrollment)!=null&&Fe.batch?e.jsxs("div",{className:"text-xs sm:text-sm",children:[e.jsx("div",{className:"font-medium text-gray-900",children:Q.enrollment.batch.title}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Enrollment #",Q.enrollmentId]})]}):e.jsx("div",{className:"text-xs sm:text-sm text-gray-400 italic",children:"No enrollment linked"})}),e.jsxs("td",{className:"px-3 sm:px-6 py-4",children:[Q.status==="partial"||Q.paidAmount&&Q.paidAmount>0&&Q.paidAmount<Q.amount?e.jsxs("div",{className:"text-xs sm:text-sm space-y-1",children:[e.jsxs("div",{className:"text-gray-900 font-semibold",children:["Total: ",Q.amount.toFixed(2)]}),e.jsxs("div",{className:"text-green-600 font-medium",children:["Paid: ",(Q.paidAmount!==void 0&&Q.paidAmount!==null?Number(Q.paidAmount):0).toFixed(2)]}),e.jsxs("div",{className:"text-red-600 font-medium",children:["Balance: ",(Q.amount-(Q.paidAmount!==void 0&&Q.paidAmount!==null?Number(Q.paidAmount):0)).toFixed(2)]})]}):Q.status==="paid"?e.jsxs("div",{className:"text-xs sm:text-sm text-gray-900 font-semibold",children:["",Q.amount.toFixed(2)]}):e.jsxs("div",{className:"text-xs sm:text-sm text-gray-900",children:["",Q.amount.toFixed(2)]}),e.jsxs("div",{className:"text-xs text-gray-500 lg:hidden mt-1",children:["Due: ",lt(Q.dueDate)]})]}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap hidden lg:table-cell",children:e.jsx("div",{className:"text-xs sm:text-sm text-gray-500",children:lt(Q.dueDate)})}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap hidden lg:table-cell",children:e.jsx("div",{className:"text-xs sm:text-sm text-gray-500",children:lt(Q.paidDate)})}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${Q.status==="paid"?"bg-green-100 text-green-800":Q.status==="partial"?"bg-blue-100 text-blue-800":Q.status==="unpaid"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:Q.status})}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap text-xs sm:text-sm font-medium",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 items-start sm:items-center",children:[Q.receiptUrl?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:async()=>{var je,v;try{const _=await qt.downloadReceipt(Q.id),ue=window.URL.createObjectURL(_),A=document.createElement("a");A.href=ue,A.download=`receipt_${Q.id}_${new Date().toISOString().split("T")[0]}.pdf`,document.body.appendChild(A),A.click(),document.body.removeChild(A),window.URL.revokeObjectURL(ue)}catch(_){alert(((v=(je=_.response)==null?void 0:je.data)==null?void 0:v.message)||"Failed to download receipt")}},className:"text-blue-600 hover:text-blue-900 font-medium",title:"Download Receipt",children:" Receipt"}),e.jsx("a",{href:Q.receiptUrl.startsWith("http")?Q.receiptUrl:`https://api.prashantthakar.com/api${Q.receiptUrl.split("/").map((je,v)=>v===0||je===""?je:encodeURIComponent(je)).join("/")}`,target:"_blank",rel:"noopener noreferrer",className:"text-green-600 hover:text-green-900 font-medium",title:"View Receipt",children:" View"})]}):(Q.status==="paid"||Q.status==="partial")&&((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")?e.jsx("button",{onClick:()=>{confirm("Generate receipt for this payment?")&&Ae.mutate(Q.id)},disabled:Ae.isPending,className:"text-purple-600 hover:text-purple-900 font-medium disabled:opacity-50",title:"Generate Receipt",children:Ae.isPending?"Generating...":" Generate Receipt"}):null,((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")&&e.jsx("button",{onClick:()=>{C(Q),i(!0)},className:"text-orange-600 hover:text-orange-900 text-xs sm:text-sm",children:"Update"})]})})]},Q.id)})})]})})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-red-500 text-lg",children:"Error: Unable to load payments data"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Please check your connection and try again"})]})]})]})}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Create Payment"}),e.jsxs("form",{onSubmit:H,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Student *"}),e.jsxs("select",{name:"studentId",required:!0,value:de,onChange:U,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select a student"}),W.map(Q=>e.jsxs("option",{value:Q.id,children:[Q.name," (",Q.email,")"]},Q.id))]})]}),de&&e.jsxs(e.Fragment,{children:[(()=>{var l;let Q=null;if(Z!=null&&Z.data&&Array.isArray(Z.data)&&Z.data.length>0){const O=Z.data.find(X=>X.paymentPlan)||Z.data[0];Q=O==null?void 0:O.paymentPlan}if(!Q&&((l=Z==null?void 0:Z.studentProfile)!=null&&l.documents)){let O=Z.studentProfile.documents;if(typeof O=="string")try{O=JSON.parse(O)}catch(X){console.error("Failed to parse documents:",X),O=null}if(O&&typeof O=="object"&&O.enrollmentMetadata){const X=O.enrollmentMetadata;Q={totalDeal:X.totalDeal??null,bookingAmount:X.bookingAmount??null,balanceAmount:X.balanceAmount??null,emiPlan:X.emiPlan??null,emiPlanDate:X.emiPlanDate??null,emiInstallments:X.emiInstallments??null}}}if(Q&&(Q.totalDeal!==null||Q.bookingAmount!==null||Q.balanceAmount!==null)){const O=Q.totalDeal??null,X=Q.bookingAmount??null,fe=Q.balanceAmount??null;return e.jsxs("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-900 mb-3",children:"Payment Plan Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-blue-700 mb-1",children:"Total Deal Amount"}),e.jsx("p",{className:"text-sm font-semibold text-blue-900",children:O!=null?`${Number(O).toFixed(2)}`:"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-blue-700 mb-1",children:"Booking Amount"}),e.jsx("p",{className:"text-sm font-semibold text-blue-900",children:X!=null?`${Number(X).toFixed(2)}`:"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-blue-700 mb-1",children:"Balance Amount"}),e.jsx("p",{className:`text-sm font-semibold ${fe!=null&&fe>0?"text-red-600":"text-green-600"}`,children:fe!=null?`${Number(fe).toFixed(2)}`:"Not set"})]})]}),Q.emiPlan&&Q.emiInstallments&&Array.isArray(Q.emiInstallments)&&Q.emiInstallments.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-2",children:"EMI Installments"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 border border-blue-200",children:[e.jsx("thead",{className:"bg-blue-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-blue-700 uppercase",children:"Month"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-blue-700 uppercase",children:"Amount ()"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-blue-700 uppercase",children:"Due Date"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Q.emiInstallments.map((Fe,je)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 text-sm text-blue-900",children:Fe.month}),e.jsxs("td",{className:"px-4 py-2 text-sm font-semibold text-blue-900",children:["",Number(Fe.amount).toFixed(2)]}),e.jsx("td",{className:"px-4 py-2 text-sm text-blue-900",children:Fe.dueDate?lt(Fe.dueDate):"-"})]},je))})]})})]})]})}return null})(),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Enrollment (Optional - Links payment to enrollment fees)"}),e.jsxs("select",{name:"enrollmentId",value:S,onChange:ce,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"No enrollment (manual payment)"}),Z!=null&&Z.data&&Array.isArray(Z.data)&&Z.data.length>0?Z.data.map(Q=>{var fe;const l=Q.paymentPlan,O=(l==null?void 0:l.totalDeal)||(l==null?void 0:l.balanceAmount)||(l==null?void 0:l.bookingAmount)||0,X=((fe=Q.batch)==null?void 0:fe.title)||"Unknown Batch";return e.jsxs("option",{value:Q.id,children:[X," - ",O>0?`${O.toFixed(2)}`:"No fees set"]},Q.id)}):(Be=(Xe=Z==null?void 0:Z.studentProfile)==null?void 0:Xe.documents)!=null&&Be.enrollmentMetadata?(()=>{const Q=Z.studentProfile.documents.enrollmentMetadata,l=Q.balanceAmount||Q.totalDeal||Q.bookingAmount||0;return e.jsxs("option",{value:"profile_fees",disabled:!0,children:["Fees available in profile: ",l>0?l.toFixed(2):"0.00"," (Create enrollment first or use manual payment)"]})})():e.jsx("option",{value:"",disabled:!0,children:"No enrollments found for this student"})]}),S&&e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Amount will be auto-filled from enrollment fees"}),!S&&(()=>{var l;let Q=(l=Z==null?void 0:Z.studentProfile)==null?void 0:l.documents;if(!Q)return null;if(typeof Q=="string")try{Q=JSON.parse(Q)}catch(O){return console.error("Failed to parse documents:",O),null}if(Q&&typeof Q=="object"&&Q.enrollmentMetadata){const O=Q.enrollmentMetadata,X=O.totalDeal??null,fe=O.bookingAmount??null;let Fe=O.balanceAmount;return Fe==null&&X!=null&&(Fe=fe!=null?X-fe:X),e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 border border-blue-200 rounded text-xs text-blue-800",children:[e.jsx("p",{className:"font-semibold",children:"Fees found in student profile:"}),e.jsxs("p",{children:["Total Deal: ",X!=null?Number(X).toFixed(2):"0.00"]}),e.jsxs("p",{children:["Booking Amount: ",fe!=null?Number(fe).toFixed(2):"0.00"]}),e.jsxs("p",{children:["Balance Amount: ",Fe!=null?Number(Fe).toFixed(2):"0.00"]}),e.jsx("p",{className:"mt-1 italic",children:"You can manually enter the amount above, or create an enrollment first to link it automatically."})]})}return null})()]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount *"}),e.jsx("input",{type:"number",name:"amount",required:!0,step:"0.01",min:"0",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Due Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",name:"dueDate",required:!0,onChange:Q=>{const l=document.getElementById("dueDateDisplay");l&&(l.textContent=Q.target.value?Pt(Q.target.value):"")},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"}),e.jsx("p",{id:"dueDateDisplay",className:"mt-1 text-sm text-gray-600"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{name:"notes",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Method"}),e.jsxs("select",{name:"paymentMethod",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",defaultValue:"",children:[e.jsx("option",{value:"",children:"Select method"}),e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"bank_transfer",children:"Bank Transfer"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"emi",children:"EMI"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Transaction ID"}),e.jsx("input",{type:"text",name:"transactionId",placeholder:"Optional transaction reference",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("button",{type:"submit",disabled:J.isPending,className:"flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50 text-sm sm:text-base",children:J.isPending?"Creating...":"Create"}),e.jsx("button",{type:"button",onClick:()=>r(!1),className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors text-sm sm:text-base",children:"Cancel"})]})]})]})}),n&&j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Update Payment"}),e.jsxs("form",{onSubmit:ae,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{name:"status",defaultValue:j.status,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"unpaid",children:"Unpaid"}),e.jsx("option",{value:"partial",children:"Partial"}),e.jsx("option",{value:"paid",children:"Paid"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Paid Date"}),e.jsx("input",{type:"date",name:"paidDate",defaultValue:j.paidDate?new Date(j.paidDate).toISOString().split("T")[0]:"",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Paid Amount ",j.status==="partial"||j.status==="paid"?e.jsx("span",{className:"text-red-500",children:"*"}):""]}),e.jsx("input",{type:"number",name:"paidAmount",step:"0.01",min:"0",max:j.amount,required:j.status==="partial"||j.status==="paid",defaultValue:j.paidAmount!==void 0&&j.paidAmount!==null&&j.paidAmount>0?Number(j.paidAmount).toFixed(2):"",placeholder:"Enter collected amount",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Payment Amount: ",Number(j.amount).toFixed(2),j.status==="partial"&&e.jsx("span",{className:"text-red-600 ml-2 font-semibold",children:" Required when status is Partial"}),j.status==="paid"&&e.jsx("span",{className:"text-blue-600 ml-2",children:"Will auto-set to full amount if left empty"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Method"}),e.jsxs("select",{name:"paymentMethod",defaultValue:j.paymentMethod||"",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select method"}),e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"bank_transfer",children:"Bank Transfer"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"emi",children:"EMI"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Transaction ID"}),e.jsx("input",{type:"text",name:"transactionId",defaultValue:j.transactionId||"",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{name:"notes",rows:3,defaultValue:j.notes||"",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("button",{type:"submit",disabled:Ie.isPending,className:"flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50 text-sm sm:text-base",children:Ie.isPending?"Updating...":"Update"}),e.jsx("button",{type:"button",onClick:()=>{i(!1),C(null)},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors text-sm sm:text-base",children:"Cancel"})]})]})]})}),h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Upload Payments from Excel"}),e.jsxs("form",{onSubmit:p,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Excel File (Student-wise payments)"}),e.jsx("input",{type:"file",name:"file",accept:".xlsx,.xls,.csv",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Supported formats: .xlsx, .xls, .csv"})]}),e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("p",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Required Columns:"}),e.jsxs("ul",{className:"text-xs text-blue-800 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Email or Phone (to identify student)"}),e.jsx("li",{children:"Amount"}),e.jsx("li",{children:"Due Date (DD/MM/YYYY format, e.g., 31/12/2025)"})]}),e.jsx("p",{className:"text-sm font-semibold text-blue-900 mt-2 mb-1",children:"Optional Columns:"}),e.jsxs("ul",{className:"text-xs text-blue-800 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:'Software List (comma-separated, e.g., "Photoshop, Illustrator, Figma") - Updates student profile'}),e.jsx("li",{children:"Enrollment ID"}),e.jsx("li",{children:"Payment Method"}),e.jsx("li",{children:"Transaction ID"}),e.jsx("li",{children:"Notes"})]}),e.jsx("p",{className:"text-xs text-blue-700 mt-2 italic",children:"Available Software: Photoshop, Illustrator, InDesign, After Effects, Premiere Pro, Figma, Sketch, Blender, Maya, 3ds Max, Cinema 4D, Lightroom, CorelDRAW, AutoCAD, SolidWorks, Revit, SketchUp, Unity, Unreal Engine, DaVinci Resolve, Final Cut Pro, Procreate, Affinity Designer, Affinity Photo, Canva Pro, and custom software names."})]}),e.jsx("div",{className:"mb-4",children:e.jsx("button",{type:"button",onClick:M,className:"text-sm text-orange-600 hover:text-orange-800 underline",children:"Download Template CSV"})}),b&&e.jsxs("div",{className:`mb-4 p-3 rounded-lg ${b.failed>0?"bg-yellow-50 border border-yellow-200":"bg-green-50 border border-green-200"}`,children:[e.jsxs("p",{className:`text-sm font-semibold ${b.failed>0?"text-yellow-900":"text-green-900"}`,children:["Upload Result: ",b.success," succeeded, ",b.failed," failed"]}),b.errors.length>0&&e.jsxs("div",{className:"mt-2 max-h-40 overflow-y-auto",children:[e.jsx("p",{className:"text-xs font-semibold text-red-800",children:"Errors:"}),e.jsxs("ul",{className:"text-xs text-red-700 space-y-1 mt-1",children:[b.errors.slice(0,10).map((Q,l)=>e.jsxs("li",{children:["Row ",Q.row,": ",Q.error]},l)),b.errors.length>10&&e.jsxs("li",{className:"text-gray-600",children:["... and ",b.errors.length-10," more errors"]})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("button",{type:"submit",disabled:re||ve.isPending,className:"flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50 text-sm sm:text-base",children:re||ve.isPending?"Uploading...":"Upload"}),e.jsx("button",{type:"button",onClick:()=>{m(!1),w(null)},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors text-sm sm:text-base",children:"Close"})]})]})]})})]})},Us={getAllPortfolios:async t=>(await Re.get("/portfolios",{params:t})).data,getStudentPortfolio:async t=>(await Re.get(`/students/${t}/portfolio`)).data,createPortfolio:async(t,s)=>(await Re.post(`/students/${t}/portfolio`,s)).data,approvePortfolio:async(t,s)=>(await Re.post(`/portfolio/${t}/approve`,s)).data},Pl=()=>{var ce,ae,u,k;const{user:t}=Nt(),s=vt(),[a,r]=g.useState(!1),[n,i]=g.useState(null),[h,m]=g.useState(!1),[j,C]=g.useState([]),[q,K]=g.useState([""]),[re,T]=g.useState(!1),b=g.useRef(!1),[w,$]=g.useState(""),[pe,Pe]=g.useState("all"),{data:te,isLoading:Y,error:o}=_e({queryKey:["portfolios",t==null?void 0:t.id,t==null?void 0:t.role,pe],queryFn:async()=>{try{const c={};pe!=="all"&&((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin"||(t==null?void 0:t.role)==="faculty")&&(c.status=pe);const D=await Us.getAllPortfolios(c);return console.log("Portfolio API Response:",D),D}catch(c){throw console.error("Portfolio API Error:",c),c}},enabled:!!t,retry:1}),{data:de}=_e({queryKey:["students"],queryFn:()=>kt.getAllStudents(),enabled:(t==null?void 0:t.role)!=="student"}),{data:N}=_e({queryKey:["student-enrollments",t==null?void 0:t.id],queryFn:()=>lr.getAllEnrollments({studentId:t==null?void 0:t.id}),enabled:(t==null?void 0:t.role)==="student"&&!!(t!=null&&t.id)}),{data:S}=_e({queryKey:["batches"],queryFn:()=>St.getAllBatches(),enabled:(t==null?void 0:t.role)!=="student"}),x=st({mutationFn:({studentId:c,data:D})=>Us.createPortfolio(c,D),onSuccess:()=>{s.invalidateQueries({queryKey:["portfolios"]}),s.refetchQueries({queryKey:["portfolios"]}),r(!1),C([]),K([""]),alert("Portfolio created successfully!")},onError:c=>{var D,se;alert(((se=(D=c.response)==null?void 0:D.data)==null?void 0:se.message)||"Failed to create portfolio")}}),Z=st({mutationFn:({id:c,data:D})=>Us.approvePortfolio(c,D),onSuccess:()=>{s.invalidateQueries({queryKey:["portfolios"]}),m(!1),i(null),alert("Portfolio status updated successfully!")},onError:c=>{var D,se;alert(((se=(D=c.response)==null?void 0:D.data)==null?void 0:se.message)||"Failed to update portfolio")}}),J=((ce=te==null?void 0:te.data)==null?void 0:ce.portfolios)||[],Ie=((ae=de==null?void 0:de.data)==null?void 0:ae.students)||[],Ae=(t==null?void 0:t.role)==="student"?((N==null?void 0:N.data)||[]).map(c=>c.batch).filter(c=>c):(S==null?void 0:S.data)||[];console.log("Portfolio Management Debug:",{userRole:t==null?void 0:t.role,userId:t==null?void 0:t.id,userObject:t,isLoading:Y,portfoliosCount:J.length,portfolios:J.map(c=>({id:c.id,studentId:c.studentId,status:c.status,hasFiles:!!c.files,filesType:typeof c.files})),error:o,rawData:te,responseStatus:te==null?void 0:te.status,responseData:te==null?void 0:te.data});const Me=c=>{if(!c)return[];if(Array.isArray(c))return c.filter(D=>typeof D=="string"&&D.length>0);if(typeof c=="object"&&c!==null)return c.length!==void 0?Array.from(c).filter(se=>typeof se=="string"&&se.length>0):Object.values(c).filter(se=>typeof se=="string"&&se.length>0);if(typeof c=="string"){if(c.startsWith("http://")||c.startsWith("https://")||c.startsWith("/"))return[c];try{const D=JSON.parse(c);if(Array.isArray(D))return D.filter(se=>typeof se=="string"&&se.length>0);if(typeof D=="object"&&D!==null)return Object.values(D).filter(ge=>typeof ge=="string"&&ge.length>0);if(typeof D=="string"&&D.length>0)return[D]}catch{return c.length>0&&(c.startsWith("http")||c.startsWith("/"))?[c]:[]}}return[]},W=c=>{if(!c||typeof c!="string")return!1;const D=c.toLowerCase();return!!(/\.(jpg|jpeg|png|gif|webp|bmp|svg)$/i.test(c)||D.includes("/image")||D.includes("/img")||D.includes("image/")||D.includes("image/jpeg")||D.includes("image/png")||D.includes("image/gif"))},Ne=c=>c?c.toLowerCase().endsWith(".pdf")||c.toLowerCase().includes("application/pdf"):!1,V=J.filter(c=>{var se,ge,G,Ce,Ze,Xe,Be;if(!w.trim())return!0;const D=w.toLowerCase();return((ge=(se=c.student)==null?void 0:se.name)==null?void 0:ge.toLowerCase().includes(D))||((Ce=(G=c.student)==null?void 0:G.email)==null?void 0:Ce.toLowerCase().includes(D))||((Xe=(Ze=c.batch)==null?void 0:Ze.title)==null?void 0:Xe.toLowerCase().includes(D))||((Be=c.status)==null?void 0:Be.toLowerCase().includes(D))}),Qe=c=>{c.preventDefault();const D=new FormData(c.currentTarget),se=(t==null?void 0:t.role)==="student"?t.id||t.userId:parseInt(D.get("studentId"));if(!se){alert("Student ID is required");return}const ge=q.map(Xe=>Xe.trim()).filter(Xe=>Xe.length>0);if(j.length===0&&ge.length===0){alert("Please upload at least one image/PDF or provide a video link");return}const G=j.length>0?j.map(Xe=>Xe.url):void 0,Ce=ge.length>0?ge[0]:void 0,Ze={batchId:parseInt(D.get("batchId")),files:G,youtubeUrl:Ce};x.mutate({studentId:se,data:Ze})},ve=c=>{C(D=>D.filter((se,ge)=>ge!==c))},p=c=>{c.preventDefault(),c.stopPropagation(),!b.current&&(b.current=!0,K(D=>[...D,""]),setTimeout(()=>{b.current=!1},100))},M=c=>{K(D=>D.filter((se,ge)=>ge!==c))},P=(c,D)=>{K(se=>{const ge=[...se];return ge[c]=D,ge})},H=async c=>{var Ze,Xe;const D=c.target.files;if(!D||D.length===0)return;const se=10*1024*1024,ge=Array.from(D).filter(Be=>Be.size>se);if(ge.length>0){alert(`Some files exceed 10MB limit: ${ge.map(Be=>Be.name).join(", ")}`);return}const G=["image/jpeg","image/jpg","image/png","image/gif","image/webp","application/pdf"],Ce=Array.from(D).filter(Be=>!G.includes(Be.type));if(Ce.length>0){alert(`Some files are not valid (only images and PDFs allowed): ${Ce.map(Be=>Be.name).join(", ")}`);return}T(!0);try{const Be=Array.from(D),Q=await wt.uploadMultipleFiles(Be),l=Be.map((O,X)=>({url:Q.data.urls[X],type:O.type==="application/pdf"?"pdf":"image",name:O.name}));C(O=>[...O,...l])}catch(Be){alert(((Xe=(Ze=Be.response)==null?void 0:Ze.data)==null?void 0:Xe.message)||"Failed to upload files")}finally{T(!1),c.target.value=""}},U=c=>{if(c.preventDefault(),!n)return;const se={approve:new FormData(c.currentTarget).get("approve")==="true"};Z.mutate({id:n.id,data:se})};return Y?e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})})})}):e.jsxs(et,{children:[e.jsx("div",{className:"max-w-7xl mx-auto p-4 md:p-6",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-orange-500 px-4 md:px-8 py-4 md:py-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-white",children:"Portfolio Management"}),e.jsx("p",{className:"mt-2 text-orange-100",children:"Student portfolios"})]}),((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin"||(t==null?void 0:t.role)==="student")&&e.jsx("button",{onClick:()=>r(!0),className:"px-4 py-2 bg-white text-orange-600 rounded-lg font-semibold hover:bg-orange-50 transition-colors",children:"+ Create Portfolio"})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Search portfolios by student, batch, software, or status...",value:w,onChange:c=>$(c.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"}),w&&e.jsx("button",{onClick:()=>$(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400 hover:text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin"||(t==null?void 0:t.role)==="faculty")&&e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("select",{value:pe,onChange:c=>Pe(c.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 bg-white",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})})]}),((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin"||(t==null?void 0:t.role)==="faculty")&&J.length>0&&e.jsxs("div",{className:"mb-4 flex flex-wrap gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Total:"}),e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 rounded",children:J.length})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Pending:"}),e.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 rounded",children:J.filter(c=>c.status==="pending").length})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Approved:"}),e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded",children:J.filter(c=>c.status==="approved").length})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Rejected:"}),e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 rounded",children:J.filter(c=>c.status==="rejected").length})]}),pe!=="all"&&e.jsx("div",{className:"flex items-center gap-2 text-orange-600",children:e.jsxs("span",{children:["Filtered by: ",pe]})})]}),w&&e.jsxs("p",{className:"mb-4 text-sm text-gray-600",children:["Showing ",V.length," of ",J.length," portfolios matching search"]}),Y?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-500",children:"Loading portfolios..."})]}):o?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-red-600 text-lg mb-2",children:"Error loading portfolios"}),e.jsx("p",{className:"text-gray-500 text-sm",children:o instanceof Error?o.message:"Unknown error"}),e.jsx("button",{onClick:()=>s.refetchQueries({queryKey:["portfolios"]}),className:"mt-4 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Retry"})]}):V.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500 text-lg",children:w?"No portfolios found matching your search":"No portfolios found"}),(t==null?void 0:t.role)==="student"&&e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:J.length===0?`You haven't created any portfolios yet. Click "Create Portfolio" to get started.`:"No portfolios match your search criteria."}),w&&e.jsx("button",{onClick:()=>$(""),className:"mt-2 text-orange-600 hover:text-orange-700 text-sm",children:"Clear search"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:V.map(c=>{var D,se;return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:((D=c.student)==null?void 0:D.name)||`Student ${c.studentId}`}),e.jsx("p",{className:"text-sm text-gray-600",children:((se=c.batch)==null?void 0:se.title)||`Batch ${c.batchId}`})]}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${c.status==="approved"?"bg-green-100 text-green-800":c.status==="rejected"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:c.status})]}),e.jsx("div",{className:"mb-4",children:(()=>{const ge=Me(c.files),G=ge.filter(W),Ce=ge.filter(Ne),Ze=ge.filter(Be=>!W(Be)&&!Ne(Be)),Xe=ge.length>0||c.pdfUrl||c.youtubeUrl;return console.log("Portfolio data:",{portfolioId:c.id,status:c.status,rawFiles:c.files,filesType:typeof c.files,normalizedFiles:ge,imageFiles:G,pdfFiles:Ce,otherFiles:Ze,hasAnyFiles:Xe}),e.jsxs("div",{className:"space-y-2",children:[G.length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-gray-500 mb-2",children:[G.length," image(s)"]}),G.length>0&&e.jsx("div",{className:"mb-3",children:(()=>{const Be=G[0];let Q=Be;Be&&!Be.startsWith("/")&&!Be.startsWith("http")?Q=`/uploads/general/${Be}`:Be&&!Be.startsWith("/uploads/")&&!Be.startsWith("http")&&(Q=Be.startsWith("/")?`/uploads${Be}`:`/uploads/${Be}`);const l=He(Q)||Q,O=Be.split("/").pop()||Be.substring(Be.length-8);console.log(" Image URL Debug:",{original:Be,normalized:Q,fullUrl:l,imageId:O});const fe=(Fe=>{const je=[];if(je.push(l),!Fe.startsWith("http://")&&!Fe.startsWith("https://")&&!Fe.startsWith("data:")){const v="https://api.prashantthakar.com/api",_=v.replace("/api","").replace(/\/$/,"");if((Fe.startsWith("/uploads/")||Fe.includes("uploads"))&&je.push(`${_}${Fe.startsWith("/")?Fe:"/"+Fe}`),je.push(`${window.location.origin}${Fe.startsWith("/")?Fe:"/"+Fe}`),Fe.startsWith("/uploads/")&&(je.push(`${v.replace("/api","")}${Fe}`),je.push(`${window.location.origin}/api${Fe}`)),!Fe.startsWith("/uploads/")){const ue=Fe.startsWith("/")?`/uploads${Fe}`:`/uploads/${Fe}`;je.push(`${_}${ue}`),je.push(`${window.location.origin}${ue}`)}}else Fe.startsWith("http")&&je.push(Fe);return Array.from(new Set(je))})(Q);return console.log(" Alternative URLs to try:",fe),e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:fe[0],alt:"Portfolio preview",className:"w-full h-48 object-cover rounded border-2 border-orange-300 cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>{window.open(fe[0],"_blank")},onLoad:()=>{console.log(" Main image loaded successfully:",fe[0]);const Fe=document.querySelector(`[data-placeholder-for="${Be}"]`);Fe&&(Fe.style.display="none")},onError:Fe=>{console.error(" Main image failed to load:",{original:Be,attemptedUrl:fe[0],imageId:O});const je=Fe.target;je.style.display="none";const v=document.querySelector(`[data-placeholder-for="${Be}"]`);v&&(v.style.display="flex");let _=1;const ue=()=>{if(_<fe.length){const A=fe[_];console.log(` Trying alternative URL ${_+1}/${fe.length}:`,A);const L=new Image;L.onload=()=>{console.log(" Alternative URL worked:",A),je.src=A,je.style.display="block",v&&(v.style.display="none")},L.onerror=()=>{console.error(` Alternative URL ${_+1} failed:`,A),_++,ue()},L.src=A}else console.error(" All alternative URLs failed. Showing placeholder.")};fe.length>1&&ue()}}),e.jsxs("div",{"data-placeholder-for":Be,className:"w-full h-48 bg-orange-100 rounded border-2 border-orange-300 flex flex-col items-center justify-center text-sm text-gray-700 hidden cursor-pointer hover:bg-orange-200 transition-colors",title:`Click to open: ${l}`,onClick:()=>{window.open(l,"_blank")},children:[e.jsx("span",{className:"text-center font-medium mb-2",children:"Click to View"}),e.jsx("span",{className:"text-xs text-gray-500",title:Be,children:O})]})]})})()}),G.length>1&&e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[G.slice(1,5).map((Be,Q)=>{let l=Be;Be&&!Be.startsWith("/")&&!Be.startsWith("http")?l=`/uploads/general/${Be}`:Be&&!Be.startsWith("/uploads/")&&!Be.startsWith("http")&&(l=Be.startsWith("/")?`/uploads${Be}`:`/uploads/${Be}`);const O=He(l)||l,X=Be.split("/").pop()||Be.substring(Be.length-8),Fe=(je=>{const v=[];if(v.push(O),!je.startsWith("http://")&&!je.startsWith("https://")&&!je.startsWith("data:")){const _="https://api.prashantthakar.com/api",ue=_.replace("/api","").replace(/\/$/,"");if((je.startsWith("/uploads/")||je.includes("uploads"))&&v.push(`${ue}${je.startsWith("/")?je:"/"+je}`),v.push(`${window.location.origin}${je.startsWith("/")?je:"/"+je}`),je.startsWith("/uploads/")&&(v.push(`${_.replace("/api","")}${je}`),v.push(`${window.location.origin}/api${je}`)),!je.startsWith("/uploads/")){const A=je.startsWith("/")?`/uploads${je}`:`/uploads/${je}`;v.push(`${ue}${A}`),v.push(`${window.location.origin}${A}`)}}else je.startsWith("http")&&v.push(je);return Array.from(new Set(v))})(l);return e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:Fe[0],alt:`Portfolio image ${Q+2}`,className:"w-20 h-20 object-cover rounded border-2 border-gray-300 cursor-pointer hover:opacity-80 hover:border-orange-500 transition-all",onClick:()=>{window.open(Fe[0],"_blank")},onLoad:()=>{const je=document.querySelector(`[data-thumbnail-placeholder-for="${Be}"]`);je&&(je.style.display="none")},onError:je=>{const v=je.target;v.style.display="none";const _=document.querySelector(`[data-thumbnail-placeholder-for="${Be}"]`);_&&(_.style.display="flex");let ue=1;const A=()=>{if(ue<Fe.length){const L=Fe[ue],z=new Image;z.onload=()=>{v.src=L,v.style.display="block",_&&(_.style.display="none")},z.onerror=()=>{ue++,A()},z.src=L}};Fe.length>1&&A()}}),e.jsxs("div",{"data-thumbnail-placeholder-for":Be,className:"w-20 h-20 bg-orange-100 rounded border-2 border-orange-300 flex flex-col items-center justify-center text-xs text-gray-700 hidden cursor-pointer hover:bg-orange-200 transition-colors",title:`Click to open: ${O}`,onClick:()=>{window.open(O,"_blank")},children:[e.jsxs("span",{className:"text-center px-1 text-[10px] font-medium",children:["Click to",e.jsx("br",{}),"View"]}),e.jsx("span",{className:"text-[8px] text-gray-500 mt-1 truncate w-full px-1",title:Be,children:X.substring(0,8)})]})]},Q)}),G.length>5&&e.jsxs("div",{className:"w-20 h-20 bg-gray-100 rounded border-2 border-gray-300 flex items-center justify-center text-xs text-gray-600 cursor-pointer hover:bg-gray-200",title:`${G.length-5} more images`,children:["+",G.length-5]})]})]}),Ce.length>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("span",{className:"text-lg",children:""}),e.jsxs("span",{children:[Ce.length," PDF file(s)"]})]}),c.pdfUrl&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("span",{className:"text-lg",children:""}),e.jsx("a",{href:He(c.pdfUrl)||c.pdfUrl,target:"_blank",rel:"noopener noreferrer",className:"text-orange-600 hover:underline",children:"Portfolio PDF"})]}),c.youtubeUrl&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("span",{className:"text-lg",children:""}),e.jsx("a",{href:c.youtubeUrl,target:"_blank",rel:"noopener noreferrer",className:"text-orange-600 hover:underline",children:"YouTube Video"})]}),Ze.length>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("span",{className:"text-lg",children:""}),e.jsxs("span",{children:[Ze.length," other file(s)"]})]}),ge.length>0&&G.length===0&&Ce.length===0&&e.jsxs("div",{className:"text-xs text-gray-500",children:[ge.length," file(s) - unable to preview"]}),!Xe&&e.jsx("p",{className:"text-sm text-gray-500",children:"No files"}),c.approvedAt&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Approved: ",lt(c.approvedAt)]})]})})()}),((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin"||(t==null?void 0:t.role)==="faculty")&&c.status==="pending"&&e.jsx("button",{onClick:()=>{i(c),m(!0)},className:"w-full px-3 py-2 bg-orange-600 text-white rounded text-sm hover:bg-orange-700 transition-colors",children:"Review"})]},c.id)})})]})]})}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Create Portfolio"}),e.jsxs("form",{onSubmit:Qe,children:[((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin"||(t==null?void 0:t.role)==="faculty")&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Student *"}),e.jsxs("select",{name:"studentId",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select a student"}),Ie.map(c=>e.jsxs("option",{value:c.id,children:[c.name," (",c.email,")"]},c.id))]})]}),(t==null?void 0:t.role)==="student"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Student"}),e.jsx("input",{type:"text",value:t.name||"You",disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 text-gray-600 cursor-not-allowed"}),e.jsx("input",{type:"hidden",name:"studentId",value:t.id||t.userId})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Batch *"}),e.jsxs("select",{name:"batchId",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select a batch"}),Ae.map(c=>e.jsx("option",{value:c.id,children:c.title},c.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload Images & PDFs (Max 10MB per file)"}),e.jsx("input",{type:"file",accept:"image/jpeg,image/jpg,image/png,image/gif,image/webp,application/pdf",multiple:!0,onChange:H,disabled:re,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 disabled:opacity-50"}),re&&e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"Uploading files..."}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Upload image files (JPG, PNG, GIF, WebP) or PDF files - Max 10MB per file"})]}),j.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Uploaded Files (",j.length,")"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:j.map((c,D)=>e.jsx("div",{className:"relative group",children:c.type==="image"?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:He(c.url)||c.url,alt:c.name||`Image ${D+1}`,className:"w-full h-32 object-cover rounded border border-gray-300",onError:se=>{se.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxMiIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkltYWdlPC90ZXh0Pjwvc3ZnPg=="}}),e.jsx("button",{type:"button",onClick:()=>ve(D),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600 transition-colors opacity-0 group-hover:opacity-100",title:"Remove",children:""})]}):e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"w-full h-32 bg-gray-100 rounded border border-gray-300 flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-4xl mb-1",children:""}),e.jsx("span",{className:"text-xs text-gray-600 text-center px-2 truncate w-full",title:c.name,children:c.name||"PDF"})]}),e.jsx("button",{type:"button",onClick:()=>ve(D),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600 transition-colors opacity-0 group-hover:opacity-100",title:"Remove",children:""})]})},D))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Video Links (YouTube)"}),q.map((c,D)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"url",value:c,onChange:se=>P(D,se.target.value),placeholder:"https://www.youtube.com/watch?v=...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"}),q.length>1&&e.jsx("button",{type:"button",onClick:se=>{se.preventDefault(),se.stopPropagation(),M(D)},className:"px-3 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition-colors",children:"Remove"})]},D)),e.jsx("button",{type:"button",onClick:p,className:"mt-2 px-3 py-1 text-sm bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors",children:"+ Add Video Link"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter YouTube video URLs"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:x.isPending,className:"flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:x.isPending?"Creating...":"Create"}),e.jsx("button",{type:"button",onClick:()=>{r(!1),C([]),K([""])},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})}),h&&n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Review Portfolio"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("span",{className:"font-medium",children:"Student:"})," ",((u=n.student)==null?void 0:u.name)||`Student ${n.studentId}`]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("span",{className:"font-medium",children:"Batch:"})," ",((k=n.batch)==null?void 0:k.title)||`Batch ${n.batchId}`]}),e.jsx("div",{className:"mt-4",children:(()=>{const c=Me(n.files),D=c.filter(W),se=c.filter(Ne),ge=c.filter(G=>!W(G)&&!Ne(G));return e.jsxs("div",{className:"space-y-4",children:[D.length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700 mb-2",children:["Images (",D.length,"):"]}),e.jsx("div",{className:"bg-gray-50 p-3 rounded max-h-60 overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:D.map((G,Ce)=>{let Ze=G;G&&!G.startsWith("/")&&!G.startsWith("http")?Ze=`/uploads/general/${G}`:G&&!G.startsWith("/uploads/")&&!G.startsWith("http")&&(Ze=G.startsWith("/")?`/uploads${G}`:`/uploads/${G}`);const Xe=He(Ze)||Ze;return e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:Xe,alt:`Portfolio image ${Ce+1}`,className:"w-full h-32 object-cover rounded border border-gray-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>window.open(Xe,"_blank"),onError:Be=>{Be.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxMiIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkltYWdlPC90ZXh0Pjwvc3ZnPg=="}}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-10 transition-opacity rounded flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs opacity-0 group-hover:opacity-100",children:"Click to view"})})]},Ce)})})})]}),se.length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700 mb-2",children:["PDF Files (",se.length,"):"]}),e.jsx("div",{className:"bg-gray-50 p-3 rounded space-y-2",children:se.map((G,Ce)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-white rounded border border-gray-200 hover:bg-gray-50",children:[e.jsx("span",{className:"text-2xl",children:""}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("a",{href:He(G)||G,target:"_blank",rel:"noopener noreferrer",className:"text-orange-600 hover:underline text-sm truncate block",children:G.split("/").pop()||`PDF ${Ce+1}`})}),e.jsx("a",{href:He(G)||G,target:"_blank",rel:"noopener noreferrer",className:"px-2 py-1 bg-orange-600 text-white text-xs rounded hover:bg-orange-700",children:"Open"})]},Ce))})]}),n.pdfUrl&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Portfolio PDF:"}),e.jsx("div",{className:"bg-gray-50 p-3 rounded",children:e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-white rounded border border-gray-200 hover:bg-gray-50",children:[e.jsx("span",{className:"text-2xl",children:""}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("a",{href:He(n.pdfUrl)||n.pdfUrl,target:"_blank",rel:"noopener noreferrer",className:"text-orange-600 hover:underline text-sm truncate block",children:n.pdfUrl.split("/").pop()||"Portfolio PDF"})}),e.jsx("a",{href:He(n.pdfUrl)||n.pdfUrl,target:"_blank",rel:"noopener noreferrer",className:"px-2 py-1 bg-orange-600 text-white text-xs rounded hover:bg-orange-700",children:"Open"})]})})]}),n.youtubeUrl&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"YouTube Video:"}),e.jsx("div",{className:"bg-gray-50 p-3 rounded",children:e.jsxs("a",{href:n.youtubeUrl,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-orange-600 hover:underline",children:[e.jsx("span",{className:"text-lg",children:""}),e.jsx("span",{className:"text-sm truncate",children:n.youtubeUrl})]})})]}),ge.length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700 mb-2",children:["Other Files (",ge.length,"):"]}),e.jsx("div",{className:"bg-gray-50 p-3 rounded space-y-1 max-h-40 overflow-y-auto",children:ge.map((G,Ce)=>e.jsx("div",{className:"text-xs text-gray-600",children:e.jsx("a",{href:He(G)||G,target:"_blank",rel:"noopener noreferrer",className:"text-orange-600 hover:underline truncate block",children:G})},Ce))})]}),c.length===0&&!n.pdfUrl&&!n.youtubeUrl&&e.jsx("p",{className:"text-sm text-gray-500",children:"No files in this portfolio"})]})})()})]}),e.jsxs("form",{onSubmit:U,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Action *"}),e.jsxs("select",{name:"approve",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"true",children:"Approve"}),e.jsx("option",{value:"false",children:"Reject"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:Z.isPending,className:"flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:Z.isPending?"Updating...":"Submit"}),e.jsx("button",{type:"button",onClick:()=>{m(!1),i(null)},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})})]})},Al=()=>{const[t,s]=g.useState(null),[a,r]=g.useState(null),[n,i]=g.useState(""),[h,m]=g.useState(""),[j,C]=g.useState(null),[q,K]=g.useState(null),[re,T]=g.useState(""),[b,w]=g.useState(""),[$,pe]=g.useState(null),[Pe,te]=g.useState(null),[Y,o]=g.useState(""),[de,N]=g.useState(""),[S,x]=g.useState(null),[Z,J]=g.useState(""),[Ie,Ae]=g.useState(""),[Me,W]=g.useState(""),{data:Ne}=_e({queryKey:["batches"],queryFn:()=>St.getAllBatches()}),{data:V}=_e({queryKey:["faculty"],queryFn:()=>Kt.getAllFaculty()}),{data:Qe,isLoading:ve}=_e({queryKey:["reports","students-without-batch"],queryFn:()=>_t.getStudentsWithoutBatch(),enabled:t==="students-without-batch"}),{data:p,isLoading:M}=_e({queryKey:["reports","batch-attendance",a,n,h],queryFn:()=>_t.getBatchAttendance(a,{from:n||void 0,to:h||void 0}),enabled:t==="batch-attendance"&&a!==null}),{data:P,isLoading:H}=_e({queryKey:["reports","pending-payments"],queryFn:()=>_t.getPendingPayments(),enabled:t==="pending-payments"}),{data:U,isLoading:ce}=_e({queryKey:["reports","portfolio-status"],queryFn:()=>_t.getPortfolioStatus(),enabled:t==="portfolio-status"}),{data:ae,isLoading:u}=_e({queryKey:["reports","all-analysis"],queryFn:()=>_t.getAllAnalysisReports(),enabled:t==="all-analysis"}),k=g.useMemo(()=>({facultyId:j??void 0,batchId:q??void 0,from:re||void 0,to:b||void 0}),[j,q,re,b]),c=g.useMemo(()=>$?{batchId:$,studentId:Pe??void 0,from:Y||void 0,to:de||void 0}:null,[$,Pe,Y,de]),D=g.useMemo(()=>({userId:S??void 0,role:Z||void 0,from:Ie||void 0,to:Me||void 0}),[S,Z,Ie,Me]),{data:se,isLoading:ge}=_e({queryKey:["attendance-reports","faculty",j,q,re,b],queryFn:()=>Zt.getFacultyAttendance(k),enabled:t==="faculty-attendance"}),{data:G,isLoading:Ce}=_e({queryKey:["attendance-reports","students",$,Pe,Y,de],queryFn:()=>Zt.getStudentAttendance(c),enabled:t==="student-attendance"&&!!c}),{data:Ze,isLoading:Xe}=_e({queryKey:["attendance-reports","punches",S,Z,Ie,Me],queryFn:()=>Zt.getPunchSummary(D),enabled:t==="punch-summary"}),Be=(Ne==null?void 0:Ne.data)||[],Q=(V==null?void 0:V.data.users)||[];return e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto p-4 md:p-6",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-orange-500 px-4 md:px-8 py-4 md:py-6",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-white",children:"Reports"}),e.jsx("p",{className:"mt-2 text-sm md:text-base text-orange-100",children:"View reports"})]})}),e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-8 gap-4",children:[e.jsx("button",{onClick:()=>s("all-analysis"),className:`px-4 py-3 rounded-lg font-semibold transition-colors ${t==="all-analysis"?"bg-orange-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"All Analysis"}),e.jsx("button",{onClick:()=>s("students-without-batch"),className:`px-4 py-3 rounded-lg font-semibold transition-colors ${t==="students-without-batch"?"bg-orange-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Students Without Batch"}),e.jsx("button",{onClick:()=>s("batch-attendance"),className:`px-4 py-3 rounded-lg font-semibold transition-colors ${t==="batch-attendance"?"bg-orange-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Batch Attendance"}),e.jsx("button",{onClick:()=>s("pending-payments"),className:`px-4 py-3 rounded-lg font-semibold transition-colors ${t==="pending-payments"?"bg-orange-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Pending Payments"}),e.jsx("button",{onClick:()=>s("portfolio-status"),className:`px-4 py-3 rounded-lg font-semibold transition-colors ${t==="portfolio-status"?"bg-orange-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Portfolio Status"}),e.jsx("button",{onClick:()=>s("faculty-attendance"),className:`px-4 py-3 rounded-lg font-semibold transition-colors ${t==="faculty-attendance"?"bg-orange-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Faculty Attendance"}),e.jsx("button",{onClick:()=>s("student-attendance"),className:`px-4 py-3 rounded-lg font-semibold transition-colors ${t==="student-attendance"?"bg-orange-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Student Attendance"}),e.jsx("button",{onClick:()=>s("punch-summary"),className:`px-4 py-3 rounded-lg font-semibold transition-colors ${t==="punch-summary"?"bg-orange-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Punch Summary"})]}),t==="students-without-batch"&&e.jsx("div",{children:ve?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Joined Date"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Qe==null?void 0:Qe.data.students.map(l=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:l.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:l.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:l.phone||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:lt(l.createdAt)})]},l.id))})]}),e.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:["Total: ",(Qe==null?void 0:Qe.data.totalCount)||0," students"]})]})}),t==="batch-attendance"&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 flex gap-4",children:[e.jsxs("select",{value:a||"",onChange:l=>r(l.target.value?parseInt(l.target.value):null),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select a batch"}),Be.map(l=>e.jsx("option",{value:l.id,children:l.title},l.id))]}),e.jsx("input",{type:"date",value:n,onChange:l=>i(l.target.value),placeholder:"From Date",className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"}),e.jsx("input",{type:"date",value:h,onChange:l=>m(l.target.value),placeholder:"To Date",className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),M?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):p!=null&&p.data?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:p.data.batch.title}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Total Sessions: ",p.data.totalSessions," | Total Attendances: ",p.data.totalAttendances]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Student"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Present"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Absent"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rate"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:p.data.studentStatistics.map(l=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:["Student ",l.studentId]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:l.present}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:l.absent}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:l.total}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:l.attendanceRate})]},l.studentId))})]})})]}):e.jsx("p",{className:"text-gray-500 text-center py-12",children:"Select a batch to view attendance report"})]}),t==="pending-payments"&&e.jsx("div",{children:H?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):P!=null&&P.data?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Summary"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Total Pending"}),e.jsx("p",{className:"font-semibold",children:P.data.summary.totalPending})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Total Amount"}),e.jsxs("p",{className:"font-semibold",children:["",P.data.summary.totalPendingAmount]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Overdue"}),e.jsx("p",{className:"font-semibold",children:P.data.summary.overdue.count})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Upcoming"}),e.jsx("p",{className:"font-semibold",children:P.data.summary.upcoming.count})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Student"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Due Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:P.data.payments.map(l=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:l.student.name}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:["",l.amount.toFixed(2)]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:lt(l.dueDate)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${l.isOverdue?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:l.isOverdue?"Overdue":"Pending"})})]},l.id))})]})})]}):null}),t==="portfolio-status"&&e.jsx("div",{children:ce?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):U!=null&&U.data?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Summary"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Total"}),e.jsx("p",{className:"font-semibold",children:U.data.summary.total})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Pending"}),e.jsx("p",{className:"font-semibold",children:U.data.summary.pending})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Approved"}),e.jsx("p",{className:"font-semibold",children:U.data.summary.approved})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Rejected"}),e.jsx("p",{className:"font-semibold",children:U.data.summary.rejected})]})]})]}),e.jsx("div",{className:"overflow-x-auto -mx-4 sm:mx-0",children:e.jsx("div",{className:"inline-block min-w-full align-middle sm:px-0",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Student"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden md:table-cell",children:"Batch"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Files"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:U.data.portfolios.map(l=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-3 sm:px-6 py-4",children:[e.jsx("div",{className:"text-xs sm:text-sm font-medium text-gray-900",children:l.student.name}),e.jsx("div",{className:"text-xs text-gray-500 md:hidden mt-1",children:l.batch.title})]}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap hidden md:table-cell",children:e.jsx("div",{className:"text-xs sm:text-sm text-gray-900",children:l.batch.title})}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${l.status==="approved"?"bg-green-100 text-green-800":l.status==="rejected"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:l.status})}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-xs sm:text-sm text-gray-900",children:Object.keys(l.files||{}).length})})]},l.id))})]})})})]}):null}),t==="all-analysis"&&e.jsx("div",{children:u?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):ae!=null&&ae.data?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Generated at: ",new Date(ae.data.generatedAt).toLocaleString()]})}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Students Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Students"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:ae.data.summary.students.total})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"With Batch"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:ae.data.summary.students.withBatch})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Without Batch"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:ae.data.summary.students.withoutBatch})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Batches Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Batches"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:ae.data.summary.batches.total})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Active Batches"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:ae.data.summary.batches.active})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Ended Batches"}),e.jsx("p",{className:"text-2xl font-bold text-gray-600",children:ae.data.summary.batches.ended})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Sessions Summary"}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Sessions"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:ae.data.summary.sessions.total})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Payments Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Payments"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:ae.data.summary.payments.total})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:ae.data.summary.payments.pending})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Amount"}),e.jsxs("p",{className:"text-lg font-bold text-green-600",children:["",ae.data.summary.payments.totalAmount.toFixed(2)]})]}),e.jsxs("div",{className:"bg-teal-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Paid Amount"}),e.jsxs("p",{className:"text-lg font-bold text-teal-600",children:["",ae.data.summary.payments.paidAmount.toFixed(2)]})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pending Amount"}),e.jsxs("p",{className:"text-lg font-bold text-red-600",children:["",ae.data.summary.payments.pendingAmount.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Portfolios Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Portfolios"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:ae.data.summary.portfolios.total})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:ae.data.summary.portfolios.pending})]})]})]})]}):null}),t==="faculty-attendance"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[e.jsxs("select",{value:j||"",onChange:l=>C(l.target.value?Number(l.target.value):null),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"All Faculty"}),Q.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]}),e.jsxs("select",{value:q||"",onChange:l=>K(l.target.value?Number(l.target.value):null),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"All Batches"}),Be.map(l=>e.jsx("option",{value:l.id,children:l.title},l.id))]}),e.jsx("input",{type:"date",value:re,onChange:l=>T(l.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"}),e.jsx("input",{type:"date",value:b,onChange:l=>w(l.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"}),e.jsx("button",{onClick:()=>Zt.downloadFacultyAttendanceCsv(k),className:"px-4 py-2 bg-orange-600 text-white rounded-md font-semibold hover:bg-orange-700 transition-colors",children:"Download CSV"})]}),ge?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):se?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg flex flex-wrap gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Sessions"}),e.jsx("p",{className:"font-semibold text-gray-900",children:se.summary.sessions})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Total Present"}),e.jsx("p",{className:"font-semibold text-green-700",children:se.summary.totalPresent})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Total Absent"}),e.jsx("p",{className:"font-semibold text-red-600",children:se.summary.totalAbsent})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Average Rate"}),e.jsxs("p",{className:"font-semibold text-blue-600",children:[se.summary.averageRate,"%"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Batch"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Faculty"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Present"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Absent"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rate"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:se.rows.map(l=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:lt(l.date)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-700",children:l.batchTitle}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-700",children:l.facultyName}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-green-700",children:l.present}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-red-600",children:l.absent}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[l.attendanceRate,"%"]})]},l.sessionId))})]})})]}):e.jsx("p",{className:"text-gray-500 text-center py-12",children:"Select filters to view faculty attendance."})]}),t==="student-attendance"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[e.jsxs("select",{value:$||"",onChange:l=>pe(l.target.value?Number(l.target.value):null),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select Batch"}),Be.map(l=>e.jsx("option",{value:l.id,children:l.title},l.id))]}),e.jsx("input",{type:"number",placeholder:"Student ID (optional)",value:Pe||"",onChange:l=>te(l.target.value?Number(l.target.value):null),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 w-48"}),e.jsx("input",{type:"date",value:Y,onChange:l=>o(l.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"}),e.jsx("input",{type:"date",value:de,onChange:l=>N(l.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"}),e.jsx("button",{disabled:!c,onClick:()=>c&&Zt.downloadStudentAttendanceCsv(c),className:"px-4 py-2 bg-orange-600 text-white rounded-md font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:"Download CSV"})]}),$===null?e.jsx("p",{className:"text-gray-500 text-center py-12",children:"Select a batch to view student attendance."}):Ce?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):G?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg flex flex-wrap gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Students"}),e.jsx("p",{className:"font-semibold text-gray-900",children:G.summary.students})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Average Rate"}),e.jsxs("p",{className:"font-semibold text-blue-600",children:[G.summary.averageRate,"%"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Student"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Present"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Manual Present"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Absent"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rate"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:G.rows.map(l=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.jsx("div",{className:"font-semibold",children:l.studentName}),e.jsx("div",{className:"text-xs text-gray-500",children:l.studentEmail})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-green-700",children:l.present}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-indigo-600",children:l.manualPresent}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-red-600",children:l.absent}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:l.total}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[l.attendanceRate,"%"]})]},l.studentId))})]})})]}):null]}),t==="punch-summary"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[e.jsx("input",{type:"number",placeholder:"User ID",value:S||"",onChange:l=>x(l.target.value?Number(l.target.value):null),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 w-40"}),e.jsxs("select",{value:Z,onChange:l=>J(l.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"All Roles"}),e.jsx("option",{value:"faculty",children:"Faculty"}),e.jsx("option",{value:"employee",children:"Employee"})]}),e.jsx("input",{type:"date",value:Ie,onChange:l=>Ae(l.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"}),e.jsx("input",{type:"date",value:Me,onChange:l=>W(l.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"}),e.jsx("button",{onClick:()=>Zt.downloadPunchSummaryCsv(D),className:"px-4 py-2 bg-orange-600 text-white rounded-md font-semibold hover:bg-orange-700 transition-colors",children:"Download CSV"})]}),Xe?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):Ze?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg flex flex-wrap gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Punches"}),e.jsx("p",{className:"font-semibold text-gray-900",children:Ze.summary.punches})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Total Hours"}),e.jsx("p",{className:"font-semibold text-blue-600",children:Ze.summary.totalHours})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Punch In"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Punch Out"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Hours"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Ze.rows.map((l,O)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:lt(l.date)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-700",children:l.userName}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:l.role}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-700",children:l.punchInAt?new Date(l.punchInAt).toLocaleTimeString():"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-700",children:l.punchOutAt?new Date(l.punchOutAt).toLocaleTimeString():"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:l.hours})]},`${l.userName}-${l.date}-${O}`))})]})})]}):e.jsx("p",{className:"text-gray-500 text-center py-12",children:"No punch data for the selected filters."})]}),!t&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500 text-lg mb-4",children:"Select a report type to view"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Available reports: All Analysis, Students Without Batch, Batch Attendance, Pending Payments, Portfolio Status, Faculty Attendance, Student Attendance, Punch Summary"})]})]})]})})})},Da={getAllChangeRequests:async t=>(await Re.get("/change-requests",{params:t})).data,getChangeRequest:async t=>(await Re.get(`/change-requests/${t}`)).data,approveChangeRequest:async(t,s)=>(await Re.post(`/change-requests/${t}/approve`,s)).data},Dl=()=>{var K;const{user:t}=Nt(),s=vt(),[a,r]=g.useState(null),[n,i]=g.useState(!1),{data:h,isLoading:m}=_e({queryKey:["change-requests"],queryFn:()=>Da.getAllChangeRequests({status:"pending"})}),j=st({mutationFn:({id:re,data:T})=>Da.approveChangeRequest(re,T),onSuccess:()=>{s.invalidateQueries({queryKey:["change-requests"]}),i(!1),r(null),alert("Request processed successfully!")},onError:re=>{var T,b;alert(((b=(T=re.response)==null?void 0:T.data)==null?void 0:b.message)||"Failed to process request")}}),C=(h==null?void 0:h.data.changeRequests)||[],q=re=>{if(re.preventDefault(),!a)return;const T=new FormData(re.currentTarget),b={approve:T.get("approve")==="true",rejectionReason:T.get("rejectionReason")||void 0};j.mutate({id:a.id,data:b})};return m?e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})})})}):e.jsxs(et,{children:[e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-orange-500 px-8 py-6",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Approvals"}),e.jsx("p",{className:"mt-2 text-orange-100",children:"Manage approvals"})]})}),e.jsx("div",{className:"p-6",children:C.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"No pending approval requests found"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:C.map(re=>{var T;return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 capitalize",children:re.type.replace("_"," ")}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Student: ",((T=re.student)==null?void 0:T.name)||`Student ${re.studentId}`]}),re.batch&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Batch: ",re.batch.title||`Batch ${re.batchId}`]})]}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${re.status==="approved"?"bg-green-100 text-green-800":re.status==="rejected"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:re.status})]}),re.reason&&e.jsx("div",{className:"mb-4",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Reason:"})," ",re.reason]})}),re.requestedData&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Requested Data:"}),e.jsx("div",{className:"bg-gray-50 p-2 rounded text-xs",children:JSON.stringify(re.requestedData,null,2)})]}),e.jsxs("p",{className:"text-xs text-gray-500 mb-4",children:["Created: ",lt(re.createdAt)]}),((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")&&re.status==="pending"&&e.jsx("button",{onClick:()=>{r(re),i(!0)},className:"w-full px-3 py-2 bg-orange-600 text-white rounded text-sm hover:bg-orange-700 transition-colors",children:"Review"})]},re.id)})})})]})}),n&&a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Review Request"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("span",{className:"font-medium",children:"Type:"})," ",a.type.replace("_"," ")]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("span",{className:"font-medium",children:"Student:"})," ",((K=a.student)==null?void 0:K.name)||`Student ${a.studentId}`]}),a.reason&&e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("span",{className:"font-medium",children:"Reason:"})," ",a.reason]})]}),e.jsxs("form",{onSubmit:q,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Action *"}),e.jsxs("select",{name:"approve",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"true",children:"Approve"}),e.jsx("option",{value:"false",children:"Reject"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rejection Reason (if rejecting)"}),e.jsx("textarea",{name:"rejectionReason",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:j.isPending,className:"flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:j.isPending?"Processing...":"Submit"}),e.jsx("button",{type:"button",onClick:()=>{i(!1),r(null)},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})})]})},Cs={getUserPermissions:async t=>(await Re.get(`/users/${t}/permissions`)).data,updateUserPermissions:async(t,s)=>(await Re.put(`/users/${t}/permissions`,s)).data,getModules:async()=>(await Re.get("/users/modules/list")).data},Lt={getAllRoles:async()=>(await Re.get("/roles")).data,getRole:async t=>(await Re.get(`/roles/${t}`)).data,createRole:async t=>(await Re.post("/roles",t)).data,updateRole:async(t,s)=>(await Re.put(`/roles/${t}`,s)).data,deleteRole:async t=>{await Re.delete(`/roles/${t}`)},assignRoleToUser:async(t,s)=>(await Re.post(`/roles/users/${t}/assign`,s)).data,unassignRoleFromUser:async(t,s)=>{await Re.delete(`/roles/users/${t}/roles/${s}`)},getUserRoles:async t=>(await Re.get(`/roles/users/${t}/roles`)).data},Il=["superadmin","admin","faculty","student","employee"];function El(t){if(!t)return;const s=t.toLowerCase().trim();return Il.includes(s)?s:void 0}function Ia(t){return El(t)}const Fl=()=>{var dt,tt;const{user:t}=Nt(),s=vt(),[a,r]=g.useState(null),[n,i]=g.useState(!1),[h,m]=g.useState(!1),[j,C]=g.useState(!1),[q,K]=g.useState(!1),[re,T]=g.useState(!1),[b,w]=g.useState(!1),[$,pe]=g.useState(!1),[Pe,te]=g.useState(!1),[Y,o]=g.useState(!1),[de,N]=g.useState(!1),[S,x]=g.useState(!1),[Z,J]=g.useState(null),[Ie,Ae]=g.useState(""),[Me,W]=g.useState(!1),[Ne,V]=g.useState(null),[Qe,ve]=g.useState([]),[p,M]=g.useState([]),[P,H]=g.useState([]),[U,ce]=g.useState([]),[ae,u]=g.useState([]),[k,c]=g.useState([]),[D,se]=g.useState(""),{data:ge,isLoading:G,error:Ce}=_e({queryKey:["users"],queryFn:()=>yt.getAllUsers(),retry:1}),Ze=st({mutationFn:({id:ne,data:we})=>yt.updateUser(ne,we),onSuccess:()=>{s.invalidateQueries({queryKey:["users"]}),m(!1),r(null),alert("User updated successfully!")},onError:ne=>{var we,Ke;alert(((Ke=(we=ne.response)==null?void 0:we.data)==null?void 0:Ke.message)||"Failed to update user")}}),Xe=st({mutationFn:ne=>yt.deleteUser(ne),onSuccess:()=>{s.invalidateQueries({queryKey:["users"]}),C(!1),r(null),alert("User deleted successfully!")},onError:ne=>{var we,Ke;alert(((Ke=(we=ne.response)==null?void 0:we.data)==null?void 0:Ke.message)||"Failed to delete user")}}),Be=st({mutationFn:ne=>yt.createUser(ne),onSuccess:()=>{s.invalidateQueries({queryKey:["users"]}),K(!1),alert("User created successfully!")},onError:ne=>{var we,Ke;alert(((Ke=(we=ne.response)==null?void 0:we.data)==null?void 0:Ke.message)||"Failed to create user")}}),{data:Q}=_e({queryKey:["user-permissions",a==null?void 0:a.id],queryFn:()=>Cs.getUserPermissions(a.id),enabled:!!a&&re}),{data:l}=_e({queryKey:["modules"],queryFn:()=>Cs.getModules(),enabled:re&&(t==null?void 0:t.role)==="superadmin"}),{data:O}=_e({queryKey:["user-roles",a==null?void 0:a.id],queryFn:()=>Lt.getUserRoles(a.id),enabled:!!a&&b}),{data:X}=_e({queryKey:["roles"],queryFn:()=>Lt.getAllRoles(),enabled:(b||$)&&((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")}),{data:fe}=_e({queryKey:["all-roles"],queryFn:()=>Lt.getAllRoles(),enabled:($||q||h)&&((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")}),{data:Fe}=_e({queryKey:["role",Ne==null?void 0:Ne.id],queryFn:()=>Lt.getRole(Ne.id),enabled:!!Ne&&Y});g.useEffect(()=>{O!=null&&O.data.roles&&H(O.data.roles)},[O]),g.useEffect(()=>{X!=null&&X.data.roles&&ce(X.data.roles.filter(ne=>ne.isActive))},[X]),g.useEffect(()=>{fe!=null&&fe.data.roles&&u(fe.data.roles)},[fe]),g.useEffect(()=>{if(Fe!=null&&Fe.data.role&&Y){const ne=Fe.data.role;if(V(ne),ne.rolePermissions&&p.length>0){const we=p.map(Ke=>{var ct;const rt=(ct=ne.rolePermissions)==null?void 0:ct.find(jt=>jt.module===Ke.value);return{module:Ke.value,canView:(rt==null?void 0:rt.canView)||!1,canAdd:(rt==null?void 0:rt.canAdd)||!1,canEdit:(rt==null?void 0:rt.canEdit)||!1,canDelete:(rt==null?void 0:rt.canDelete)||!1}});c(we)}}},[Fe,Y,p]),g.useEffect(()=>{l!=null&&l.data.modules&&M(l.data.modules)},[l]),g.useEffect(()=>{if(re&&p.length>0&&a){const ne=(Q==null?void 0:Q.data.permissions)||[],we=p.map(Ke=>{const rt=ne.find(ct=>ct.module===Ke.value);return{id:(rt==null?void 0:rt.id)||0,userId:a.id,module:Ke.value,canView:(rt==null?void 0:rt.canView)||!1,canAdd:(rt==null?void 0:rt.canAdd)||!1,canEdit:(rt==null?void 0:rt.canEdit)||!1,canDelete:(rt==null?void 0:rt.canDelete)||!1}});ve(we)}},[re,p,Q,a]);const je=st({mutationFn:({userId:ne,permissions:we})=>Cs.updateUserPermissions(ne,{permissions:we}),onSuccess:()=>{s.invalidateQueries({queryKey:["user-permissions",a==null?void 0:a.id]}),alert("Permissions updated successfully!"),T(!1)},onError:ne=>{var we,Ke;alert(((Ke=(we=ne.response)==null?void 0:we.data)==null?void 0:Ke.message)||"Failed to update permissions")}}),v=st({mutationFn:({userId:ne,roleId:we})=>Lt.assignRoleToUser(ne,{roleId:we}),onSuccess:()=>{s.invalidateQueries({queryKey:["user-roles",a==null?void 0:a.id]}),s.invalidateQueries({queryKey:["users"]}),alert("Role assigned successfully!")},onError:ne=>{var we,Ke;alert(((Ke=(we=ne.response)==null?void 0:we.data)==null?void 0:Ke.message)||"Failed to assign role")}}),_=st({mutationFn:({userId:ne,roleId:we})=>Lt.unassignRoleFromUser(ne,we),onSuccess:()=>{s.invalidateQueries({queryKey:["user-roles",a==null?void 0:a.id]}),s.invalidateQueries({queryKey:["users"]}),alert("Role unassigned successfully!")},onError:ne=>{var we,Ke;alert(((Ke=(we=ne.response)==null?void 0:we.data)==null?void 0:Ke.message)||"Failed to unassign role")}}),ue=st({mutationFn:ne=>Lt.createRole(ne),onSuccess:()=>{s.invalidateQueries({queryKey:["roles"]}),s.invalidateQueries({queryKey:["all-roles"]}),te(!1),c([]),alert("Role created successfully!")},onError:ne=>{var we,Ke;alert(((Ke=(we=ne.response)==null?void 0:we.data)==null?void 0:Ke.message)||"Failed to create role")}}),A=st({mutationFn:({id:ne,data:we})=>Lt.updateRole(ne,we),onSuccess:()=>{s.invalidateQueries({queryKey:["roles"]}),s.invalidateQueries({queryKey:["all-roles"]}),s.invalidateQueries({queryKey:["role",Ne==null?void 0:Ne.id]}),o(!1),V(null),c([]),alert("Role updated successfully!")},onError:ne=>{var we,Ke;alert(((Ke=(we=ne.response)==null?void 0:we.data)==null?void 0:Ke.message)||"Failed to update role")}}),L=st({mutationFn:ne=>Lt.deleteRole(ne),onSuccess:()=>{s.invalidateQueries({queryKey:["roles"]}),s.invalidateQueries({queryKey:["all-roles"]}),N(!1),V(null),alert("Role deleted successfully!")},onError:ne=>{var we,Ke;alert(((Ke=(we=ne.response)==null?void 0:we.data)==null?void 0:Ke.message)||"Failed to delete role")}}),z=st({mutationFn:({userId:ne,newPassword:we})=>yt.resetPassword(ne,we),onSuccess:ne=>{J({newPassword:ne.data.newPassword,email:ne.data.email})},onError:ne=>{var we,Ke;alert(((Ke=(we=ne.response)==null?void 0:we.data)==null?void 0:Ke.message)||"Failed to reset password"),x(!1)}}),oe=(ge==null?void 0:ge.data.users)||[],le=oe.filter(ne=>{var Ke,rt,ct,jt;if(!D.trim())return!0;const we=D.toLowerCase();return((Ke=ne.name)==null?void 0:Ke.toLowerCase().includes(we))||((rt=ne.email)==null?void 0:rt.toLowerCase().includes(we))||((ct=ne.phone)==null?void 0:ct.toLowerCase().includes(we))||((jt=ne.role)==null?void 0:jt.toLowerCase().includes(we))}),xe=ne=>{r(ne),m(!0)},he=ne=>{r(ne),C(!0)},B=ne=>{r(ne),i(!0)},ye=ne=>{if(ne.preventDefault(),!a)return;const we=new FormData(ne.currentTarget),Ke={name:we.get("name")||void 0,email:we.get("email")||void 0,phone:we.get("phone")||void 0,role:Ia(we.get("role")),isActive:we.get("isActive")==="true"};Ze.mutate({id:a.id,data:Ke})},De=()=>{a&&Xe.mutate(a.id)},Se=ne=>{ne.preventDefault();const we=new FormData(ne.currentTarget),Ke=Ia(we.get("role"));if(!Ke){alert("Please select a valid role");return}const rt={name:we.get("name"),email:we.get("email"),phone:we.get("phone")||void 0,role:Ke,password:we.get("password")};Be.mutate(rt)},at=ne=>{r(ne),T(!0)},it=ne=>{r(ne),w(!0)},ot=ne=>{a&&v.mutate({userId:a.id,roleId:ne})},I=ne=>{a&&window.confirm("Are you sure you want to unassign this role?")&&_.mutate({userId:a.id,roleId:ne})},E=(ne,we,Ke)=>{ve(rt=>rt.map(ct=>ct.module===ne?{...ct,[we]:Ke}:ct))},f=()=>{if(!a)return;const ne=Qe.map(we=>({module:we.module,canView:we.canView,canAdd:we.canAdd,canEdit:we.canEdit,canDelete:we.canDelete}));je.mutate({userId:a.id,permissions:ne})},Ee=ne=>{ne.preventDefault();const we=new FormData(ne.currentTarget),Ke={name:we.get("name"),description:we.get("description")||void 0,permissions:k};ue.mutate(Ke)},R=ne=>{if(ne.preventDefault(),!Ne)return;const we=new FormData(ne.currentTarget),Ke={name:we.get("name"),description:we.get("description")||void 0,isActive:we.get("isActive")==="true",permissions:k};A.mutate({id:Ne.id,data:Ke})},me=ne=>{V(ne),o(!0)},Oe=ne=>{V(ne),N(!0)},Ue=()=>{Ne&&L.mutate(Ne.id)},ze=(ne,we,Ke)=>{c(rt=>rt.map(ct=>ct.module===ne?{...ct,[we]:Ke}:ct))},Ve=()=>{a&&(J(null),Ae(""),W(!1),x(!0))},nt=()=>{if(!a)return;const ne=Me&&Ie?Ie:void 0;if(Me&&(!Ie||Ie.length<6)){alert("Password must be at least 6 characters long");return}z.mutate({userId:a.id,newPassword:ne})};return g.useEffect(()=>{if(Pe&&p.length>0&&k.length===0){const ne=p.map(we=>({module:we.value,canView:!1,canAdd:!1,canEdit:!1,canDelete:!1}));c(ne)}},[Pe,p]),G?e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})})})}):e.jsxs(et,{children:[e.jsx("div",{className:"max-w-7xl mx-auto p-4 md:p-6",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-orange-500 px-4 md:px-8 py-4 md:py-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-white",children:"User Management"}),e.jsx("p",{className:"mt-2 text-orange-100",children:"Manage all users in the system"})]}),((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>K(!0),className:"px-4 py-2 bg-white text-orange-600 rounded-lg font-semibold hover:bg-orange-50 transition-colors",children:"+ Create User"}),(t==null?void 0:t.role)==="superadmin"&&e.jsx("button",{onClick:()=>pe(!0),className:"px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 transition-colors",children:" Manage Roles"})]})]})}),e.jsx("div",{className:"p-6",children:G?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):Ce?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-red-600 text-lg mb-4",children:"Error loading users"}),e.jsx("p",{className:"text-gray-500 text-sm mb-4",children:((tt=(dt=Ce==null?void 0:Ce.response)==null?void 0:dt.data)==null?void 0:tt.message)||(Ce==null?void 0:Ce.message)||"Unknown error"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Retry"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"relative max-w-md",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Search users by name, email, phone, or role...",value:D,onChange:ne=>se(ne.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"}),D&&e.jsx("button",{onClick:()=>se(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400 hover:text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),D&&e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Showing ",le.length," of ",oe.length," users"]})]}),le.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500 text-lg",children:D?"No users found matching your search":"No users found"}),D&&e.jsx("button",{onClick:()=>se(""),className:"mt-2 text-orange-600 hover:text-orange-700 text-sm",children:"Clear search"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:le.map(ne=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:ne.name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:ne.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:ne.phone||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${ne.role==="superadmin"?"bg-purple-100 text-purple-800":ne.role==="admin"?"bg-blue-100 text-blue-800":ne.role==="faculty"?"bg-green-100 text-green-800":ne.role==="student"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:ne.role})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${ne.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:ne.isActive?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx("button",{onClick:()=>B(ne),className:"px-2 py-1 text-blue-600 hover:text-blue-900 hover:bg-blue-50 rounded transition-colors",title:"View Profile",children:" View"}),((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>xe(ne),className:"px-2 py-1 text-orange-600 hover:text-orange-900 hover:bg-orange-50 rounded transition-colors",title:"Edit User",children:" Edit"}),(t==null?void 0:t.role)==="superadmin"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>at(ne),className:"px-2 py-1 text-purple-600 hover:text-purple-900 hover:bg-purple-50 rounded transition-colors",title:"Manage Permissions",children:" Permissions"}),e.jsx("button",{onClick:()=>it(ne),className:"px-2 py-1 text-indigo-600 hover:text-indigo-900 hover:bg-indigo-50 rounded transition-colors",title:"Assign Role",children:" Roles"}),ne.id!==t.id&&e.jsx("button",{onClick:()=>he(ne),className:"px-2 py-1 text-red-600 hover:text-red-900 hover:bg-red-50 rounded transition-colors",title:"Delete User",children:" Delete"})]})]})]})})]},ne.id))})]})})]})})]})}),n&&a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"User Profile"}),e.jsx("button",{onClick:()=>{i(!1),r(null)},className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Name"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:a.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:a.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Phone"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:a.phone||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Role"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:a.role})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Status"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:a.isActive?"Active":"Inactive"})]}),a.createdAt&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Created At"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:new Date(a.createdAt).toLocaleString()})]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:()=>{i(!1),r(null)},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Close"})})]})}),h&&a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Edit User"}),e.jsxs("form",{onSubmit:ye,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name *"}),e.jsx("input",{type:"text",name:"name",defaultValue:a.name,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email *"}),e.jsx("input",{type:"email",name:"email",defaultValue:a.email,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{type:"tel",name:"phone",defaultValue:a.phone||"",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role *"}),e.jsxs("select",{name:"role",defaultValue:a.role,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"student",children:"Student"}),e.jsx("option",{value:"faculty",children:"Faculty"}),e.jsx("option",{value:"employee",children:"Employee"}),e.jsx("option",{value:"admin",children:"Admin"}),(t==null?void 0:t.role)==="superadmin"&&e.jsx("option",{value:"superadmin",children:"Superadmin"}),ae.filter(ne=>ne.isActive&&!ne.isSystem).map(ne=>e.jsx("option",{value:ne.name.toLowerCase(),children:ne.name},ne.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status *"}),e.jsxs("select",{name:"isActive",defaultValue:a.isActive?"true":"false",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]})]}),e.jsx("div",{className:"mb-4 pt-4 border-t border-gray-200",children:e.jsxs("button",{type:"button",onClick:Ve,className:"w-full px-4 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})}),"Reset Password"]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:Ze.isPending,className:"flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:Ze.isPending?"Updating...":"Update"}),e.jsx("button",{type:"button",onClick:()=>{m(!1),r(null)},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})}),j&&a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-red-600",children:"Delete User"}),e.jsxs("p",{className:"mb-4 text-gray-700",children:["Are you sure you want to delete ",e.jsx("strong",{children:a.name}),"? This action cannot be undone."]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:De,disabled:Xe.isPending,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition-colors disabled:opacity-50",children:Xe.isPending?"Deleting...":"Delete"}),e.jsx("button",{onClick:()=>{C(!1),r(null)},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})}),q&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Create New User"}),e.jsx("button",{onClick:()=>K(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:Se,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name *"}),e.jsx("input",{type:"text",name:"name",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email *"}),e.jsx("input",{type:"email",name:"email",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{type:"tel",name:"phone",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role *"}),e.jsxs("select",{name:"role",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"student",children:"Student"}),e.jsx("option",{value:"faculty",children:"Faculty"}),e.jsx("option",{value:"employee",children:"Employee"}),e.jsx("option",{value:"admin",children:"Admin"}),(t==null?void 0:t.role)==="superadmin"&&e.jsx("option",{value:"superadmin",children:"Superadmin"}),ae.filter(ne=>ne.isActive&&!ne.isSystem).map(ne=>e.jsx("option",{value:ne.name.toLowerCase(),children:ne.name},ne.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password *"}),e.jsx("input",{type:"password",name:"password",required:!0,minLength:6,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:Be.isPending,className:"flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:Be.isPending?"Creating...":"Create User"}),e.jsx("button",{type:"button",onClick:()=>K(!1),className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})}),re&&a&&(t==null?void 0:t.role)==="superadmin"&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-2xl font-bold",children:["Manage Permissions - ",a.name]}),e.jsx("button",{onClick:()=>{T(!1),r(null),ve([])},className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Customize permissions for ",e.jsx("strong",{children:a.name})," (",a.role,")"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Module"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"View"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Add"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Edit"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Delete"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:p.map(ne=>{const we=Qe.find(Ke=>Ke.module===ne.value);return we?e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:ne.label})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:e.jsx("input",{type:"checkbox",checked:we.canView,onChange:Ke=>E(we.module,"canView",Ke.target.checked),className:"w-4 h-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:e.jsx("input",{type:"checkbox",checked:we.canAdd,onChange:Ke=>E(we.module,"canAdd",Ke.target.checked),className:"w-4 h-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:e.jsx("input",{type:"checkbox",checked:we.canEdit,onChange:Ke=>E(we.module,"canEdit",Ke.target.checked),className:"w-4 h-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:e.jsx("input",{type:"checkbox",checked:we.canDelete,onChange:Ke=>E(we.module,"canDelete",Ke.target.checked),className:"w-4 h-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"})})]},ne.value):null})})]})}),e.jsxs("div",{className:"mt-6 flex gap-3",children:[e.jsx("button",{onClick:f,disabled:je.isPending,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 transition-colors disabled:opacity-50",children:je.isPending?"Saving...":"Save Permissions"}),e.jsx("button",{onClick:()=>{T(!1),r(null),ve([])},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})}),b&&a&&((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin")&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-2xl font-bold",children:["Assign Roles - ",a.name]}),e.jsx("button",{onClick:()=>{w(!1),r(null),H([])},className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Assigned Roles"}),P.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No roles assigned"}):e.jsx("div",{className:"space-y-2",children:P.map(ne=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:ne.name}),ne.description&&e.jsx("p",{className:"text-sm text-gray-500",children:ne.description})]}),e.jsx("button",{onClick:()=>I(ne.id),disabled:_.isPending,className:"text-red-600 hover:text-red-900 disabled:opacity-50",children:"Remove"})]},ne.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Available Roles"}),U.filter(ne=>!P.find(we=>we.id===ne.id)).length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"All available roles are assigned"}):e.jsx("div",{className:"space-y-2",children:U.filter(ne=>!P.find(we=>we.id===ne.id)).map(ne=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:ne.name}),ne.description&&e.jsx("p",{className:"text-sm text-gray-500",children:ne.description})]}),e.jsx("button",{onClick:()=>ot(ne.id),disabled:v.isPending,className:"px-3 py-1 bg-indigo-600 text-white rounded text-sm hover:bg-indigo-700 disabled:opacity-50",children:"Assign"})]},ne.id))})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:()=>{w(!1),r(null),H([])},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Close"})})]})}),$&&(t==null?void 0:t.role)==="superadmin"&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Custom Role Management"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>te(!0),className:"px-4 py-2 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition-colors",children:"+ Create Role"}),e.jsx("button",{onClick:()=>{pe(!1),u([])},className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:ae.map(ne=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:ne.name})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"text-sm text-gray-500",children:ne.description||"-"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${ne.isSystem?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:ne.isSystem?"System":"Custom"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${ne.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:ne.isActive?"Active":"Inactive"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium",children:!ne.isSystem&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>me(ne),className:"text-orange-600 hover:text-orange-900",title:"Edit Role",children:" Edit"}),e.jsx("button",{onClick:()=>Oe(ne),className:"text-red-600 hover:text-red-900",title:"Delete Role",children:" Delete"})]})})]},ne.id))})]})})]})}),Pe&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Create Custom Role"}),e.jsx("button",{onClick:()=>{te(!1),c([])},className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:Ee,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role Name *"}),e.jsx("input",{type:"text",name:"name",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{name:"description",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Permissions"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Module"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"View"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Add"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Edit"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Delete"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:p.map(ne=>{const we=k.find(Ke=>Ke.module===ne.value);return we?e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:ne.label})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:e.jsx("input",{type:"checkbox",checked:we.canView,onChange:Ke=>ze(we.module,"canView",Ke.target.checked),className:"w-4 h-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:e.jsx("input",{type:"checkbox",checked:we.canAdd,onChange:Ke=>ze(we.module,"canAdd",Ke.target.checked),className:"w-4 h-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:e.jsx("input",{type:"checkbox",checked:we.canEdit,onChange:Ke=>ze(we.module,"canEdit",Ke.target.checked),className:"w-4 h-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:e.jsx("input",{type:"checkbox",checked:we.canDelete,onChange:Ke=>ze(we.module,"canDelete",Ke.target.checked),className:"w-4 h-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"})})]},ne.value):null})})]})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:ue.isPending,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition-colors disabled:opacity-50",children:ue.isPending?"Creating...":"Create Role"}),e.jsx("button",{type:"button",onClick:()=>{te(!1),c([])},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})}),Y&&Ne&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Edit Role"}),e.jsx("button",{onClick:()=>{o(!1),V(null),c([])},className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:R,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role Name *"}),e.jsx("input",{type:"text",name:"name",defaultValue:Ne.name,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{name:"description",rows:3,defaultValue:Ne.description||"",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status *"}),e.jsxs("select",{name:"isActive",defaultValue:Ne.isActive?"true":"false",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Permissions"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Module"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"View"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Add"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Edit"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Delete"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:p.map(ne=>{const we=k.find(Ke=>Ke.module===ne.value);return we?e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:ne.label})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:e.jsx("input",{type:"checkbox",checked:we.canView,onChange:Ke=>ze(we.module,"canView",Ke.target.checked),className:"w-4 h-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:e.jsx("input",{type:"checkbox",checked:we.canAdd,onChange:Ke=>ze(we.module,"canAdd",Ke.target.checked),className:"w-4 h-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:e.jsx("input",{type:"checkbox",checked:we.canEdit,onChange:Ke=>ze(we.module,"canEdit",Ke.target.checked),className:"w-4 h-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:e.jsx("input",{type:"checkbox",checked:we.canDelete,onChange:Ke=>ze(we.module,"canDelete",Ke.target.checked),className:"w-4 h-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"})})]},ne.value):null})})]})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:A.isPending,className:"flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:A.isPending?"Updating...":"Update Role"}),e.jsx("button",{type:"button",onClick:()=>{o(!1),V(null),c([])},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})}),de&&Ne&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-red-600",children:"Delete Role"}),e.jsxs("p",{className:"mb-4 text-gray-700",children:["Are you sure you want to delete the role ",e.jsx("strong",{children:Ne.name}),"? This action cannot be undone."]}),e.jsx("p",{className:"mb-4 text-sm text-yellow-600",children:"Note: You cannot delete a role if it is assigned to any users. Please unassign it first."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:Ue,disabled:L.isPending,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition-colors disabled:opacity-50",children:L.isPending?"Deleting...":"Delete"}),e.jsx("button",{onClick:()=>{N(!1),V(null)},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})}),S&&a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:Z?e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-green-600",children:"Password Reset Successful"}),e.jsxs("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:["Password has been reset for ",e.jsx("strong",{children:Z.email})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"New Password:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:Z.newPassword,readOnly:!0,className:"flex-1 px-3 py-2 border border-gray-300 rounded-md bg-gray-50 font-mono text-sm"}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(Z.newPassword),alert("Password copied to clipboard!")},className:"px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-sm",title:"Copy to clipboard",children:"Copy"})]})]}),e.jsx("p",{className:"mt-3 text-xs text-yellow-600",children:" Please share this password with the user securely. They should change it after logging in."})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:()=>{x(!1),J(null),Ae(""),W(!1)},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Close"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-red-600",children:"Reset Password"}),e.jsxs("p",{className:"mb-4 text-gray-700",children:["Reset password for ",e.jsx("strong",{children:a.name})," (",a.email,")"]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"flex items-center gap-2 mb-3",children:[e.jsx("input",{type:"checkbox",checked:Me,onChange:ne=>W(ne.target.checked),className:"w-4 h-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Set custom password"})]}),Me&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"New Password *"}),e.jsx("input",{type:"password",value:Ie,onChange:ne=>Ae(ne.target.value),placeholder:"Enter new password (min 6 characters)",minLength:6,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Password must be at least 6 characters long"})]}),!Me&&e.jsx("p",{className:"text-sm text-gray-600 bg-blue-50 p-3 rounded-lg",children:"A random password will be generated automatically. You'll be able to copy it after reset."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:nt,disabled:z.isPending||Me&&(!Ie||Ie.length<6),className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition-colors disabled:opacity-50",children:z.isPending?"Resetting...":"Reset Password"}),e.jsx("button",{onClick:()=>{x(!1),J(null),Ae(""),W(!1)},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})})})]})},Rl=["superadmin","admin","faculty","student","employee"],Ol=()=>{const{user:t}=Nt(),s=vt(),[a,r]=g.useState(null),[n,i]=g.useState(""),[h,m]=g.useState(!1),[j,C]=g.useState(!1),[q,K]=g.useState(!1),[re,T]=g.useState(!1),[b,w]=g.useState([]),[$,pe]=g.useState([{value:"batches",label:"Batches"},{value:"students",label:"Students"},{value:"faculty",label:"Faculty"},{value:"employees",label:"Employees"},{value:"sessions",label:"Sessions"},{value:"attendance",label:"Attendance"},{value:"payments",label:"Payments"},{value:"portfolios",label:"Portfolios"},{value:"reports",label:"Reports"},{value:"approvals",label:"Approvals"},{value:"users",label:"Users"},{value:"software_completions",label:"Software Completions"},{value:"student_leaves",label:"Student Leaves"},{value:"batch_extensions",label:"Batch Extensions"},{value:"employee_leaves",label:"Employee Leaves"},{value:"faculty_leaves",label:"Faculty Leaves"}]),{data:Pe,isLoading:te}=_e({queryKey:["roles"],queryFn:()=>Lt.getAllRoles(),enabled:(t==null?void 0:t.role)==="superadmin"}),Y=[{value:"batches",label:"Batches"},{value:"students",label:"Students"},{value:"faculty",label:"Faculty"},{value:"employees",label:"Employees"},{value:"sessions",label:"Sessions"},{value:"attendance",label:"Attendance"},{value:"payments",label:"Payments"},{value:"portfolios",label:"Portfolios"},{value:"reports",label:"Reports"},{value:"approvals",label:"Approvals"},{value:"users",label:"Users"},{value:"software_completions",label:"Software Completions"},{value:"student_leaves",label:"Student Leaves"},{value:"batch_extensions",label:"Batch Extensions"},{value:"employee_leaves",label:"Employee Leaves"},{value:"faculty_leaves",label:"Faculty Leaves"}],{data:o,isLoading:de,error:N}=_e({queryKey:["modules"],queryFn:()=>Cs.getModules(),enabled:(t==null?void 0:t.role)==="superadmin",retry:1});g.useEffect(()=>{o!=null&&o.data.modules&&o.data.modules.length>0?pe(o.data.modules):!de&&N&&pe(Y)},[o,de,N]),g.useEffect(()=>{if(h&&$.length>0){const p=$.map(M=>({id:0,roleId:0,module:M.value,canView:!1,canAdd:!1,canEdit:!1,canDelete:!1}));w(p)}},[h,$.length]),g.useEffect(()=>{if((j||re)&&$.length>0&&a){const p=(a==null?void 0:a.rolePermissions)||[],M=$.map(P=>{const H=p.find(U=>U.module===P.value);return{id:(H==null?void 0:H.id)||0,roleId:a.id,module:P.value,canView:(H==null?void 0:H.canView)||!1,canAdd:(H==null?void 0:H.canAdd)||!1,canEdit:(H==null?void 0:H.canEdit)||!1,canDelete:(H==null?void 0:H.canDelete)||!1}});w(M)}},[j,re,$,a]);const S=st({mutationFn:p=>Lt.createRole(p),onSuccess:()=>{s.invalidateQueries({queryKey:["roles"]}),m(!1),w([]),alert("Role created successfully!"),setTimeout(()=>{if($.length>0){const p=$.map(M=>({id:0,roleId:0,module:M.value,canView:!1,canAdd:!1,canEdit:!1,canDelete:!1}));w(p)}},100)},onError:p=>{var M,P;alert(((P=(M=p.response)==null?void 0:M.data)==null?void 0:P.message)||"Failed to create role")}}),x=st({mutationFn:({id:p,data:M})=>Lt.updateRole(p,M),onSuccess:()=>{s.invalidateQueries({queryKey:["roles"]}),C(!1),T(!1),r(null),w([]),alert("Role updated successfully!")},onError:p=>{var M,P;alert(((P=(M=p.response)==null?void 0:M.data)==null?void 0:P.message)||"Failed to update role")}}),Z=st({mutationFn:p=>Lt.deleteRole(p),onSuccess:()=>{s.invalidateQueries({queryKey:["roles"]}),K(!1),r(null),alert("Role deleted successfully!")},onError:p=>{var M,P;alert(((P=(M=p.response)==null?void 0:M.data)==null?void 0:P.message)||"Failed to delete role")}}),J=p=>{p.preventDefault();const M=new FormData(p.currentTarget),P=b.map(U=>({module:U.module,canView:U.canView,canAdd:U.canAdd,canEdit:U.canEdit,canDelete:U.canDelete})),H={name:M.get("name"),description:M.get("description")||void 0,permissions:P};S.mutate(H)},Ie=p=>{if(p.preventDefault(),!a)return;const M=new FormData(p.currentTarget),P=b.map(U=>({module:U.module,canView:U.canView,canAdd:U.canAdd,canEdit:U.canEdit,canDelete:U.canDelete})),H={name:M.get("name")||void 0,description:M.get("description")||void 0,isActive:M.get("isActive")==="true",permissions:P};x.mutate({id:a.id,data:H})},Ae=(p,M,P)=>{w(H=>H.map(U=>U.module===p?{...U,[M]:P}:U))},Me=p=>{r(p),C(!0)},W=p=>{r(p),T(!0)},Ne=p=>{r(p),K(!0)},V=()=>{if(!a)return;const p=b.map(M=>({module:M.module,canView:M.canView,canAdd:M.canAdd,canEdit:M.canEdit,canDelete:M.canDelete}));x.mutate({id:a.id,data:{permissions:p}})};if((t==null?void 0:t.role)!=="superadmin")return e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"bg-white shadow-xl rounded-lg p-6",children:e.jsx("p",{className:"text-red-600",children:"Access denied. Only superadmin can manage roles."})})})});if(te)return e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})})})});const Qe=(Pe==null?void 0:Pe.data.roles)||[],ve=p=>{const M=sr[p]||{};return $.length===0?[]:$.map(P=>{const H=M[P.value];return!H||!H.canView&&!H.canAdd&&!H.canEdit&&!H.canDelete?null:{id:0,roleId:0,module:P.value,canView:H.canView,canAdd:H.canAdd,canEdit:H.canEdit,canDelete:H.canDelete}}).filter(P=>P!==null)};return e.jsxs(et,{children:[e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-purple-500 px-8 py-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Role Management"}),e.jsx("p",{className:"mt-2 text-purple-100",children:"View all roles and their permissions"})]}),e.jsx("button",{onClick:()=>m(!0),className:"px-4 py-2 bg-white text-purple-600 rounded-lg font-semibold hover:bg-purple-50 transition-colors",children:"+ Create Custom Role"})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Predefined Roles & Permissions"}),$.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"Loading modules..."})}):e.jsx("div",{className:"overflow-x-auto border border-gray-300 rounded-md bg-white",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Permissions Count"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Rl.map(p=>{const M=ve(p),P=M.filter(H=>H.canView||H.canAdd||H.canEdit||H.canDelete).length;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:p.charAt(0).toUpperCase()+p.slice(1)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 py-1 rounded text-xs font-semibold bg-blue-100 text-blue-800",children:"System"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 py-1 rounded text-xs font-semibold bg-green-100 text-green-800",children:"Active"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm text-gray-900",children:[P," / ",M.length," modules"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{const H=ve(p);w(H),i(p),T(!0)},className:"text-purple-600 hover:text-purple-900",title:"View Permissions",children:" Permissions"}),e.jsx("button",{onClick:()=>{const H=ve(p);w(H),i(p),C(!0)},className:"text-orange-600 hover:text-orange-900",title:"Edit Permissions",children:" Edit"})]})})]},p)})})]})})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Custom Roles"}),Qe.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"No custom roles found"})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Qe.map(p=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:p.name})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-gray-500",children:p.description||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${p.isSystem?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:p.isSystem?"System":"Custom"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${p.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:p.isActive?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Me(p),disabled:p.isSystem,className:"text-orange-600 hover:text-orange-900 disabled:opacity-50 disabled:cursor-not-allowed",title:"Edit Role",children:" Edit"}),e.jsx("button",{onClick:()=>W(p),className:"text-purple-600 hover:text-purple-900",title:"Manage Permissions",children:" Permissions"}),e.jsx("button",{onClick:()=>Ne(p),disabled:p.isSystem,className:"text-red-600 hover:text-red-900 disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete Role",children:" Delete"})]})})]},p.id))})]})})]})]})]})}),h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Permissions"}),e.jsx("button",{onClick:()=>{m(!1),w([])},className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:J,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role Name *"}),e.jsx("input",{type:"text",name:"name",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{name:"description",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Permissions"}),b.length===0?e.jsx("div",{className:"text-center py-4 text-gray-500 border border-gray-300 rounded-md",children:e.jsx("p",{children:"Loading permissions..."})}):e.jsx("div",{className:"overflow-x-auto border border-gray-300 rounded-md max-h-96 overflow-y-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Module"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"View"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Add"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Edit"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Delete"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.map(p=>{var M;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:((M=$.find(P=>P.value===p.module))==null?void 0:M.label)||p.module}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("input",{type:"checkbox",checked:p.canView,onChange:P=>Ae(p.module,"canView",P.target.checked),className:"w-4 h-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded cursor-pointer"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("input",{type:"checkbox",checked:p.canAdd,onChange:P=>Ae(p.module,"canAdd",P.target.checked),className:"w-4 h-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded cursor-pointer"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("input",{type:"checkbox",checked:p.canEdit,onChange:P=>Ae(p.module,"canEdit",P.target.checked),className:"w-4 h-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded cursor-pointer"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("input",{type:"checkbox",checked:p.canDelete,onChange:P=>Ae(p.module,"canDelete",P.target.checked),className:"w-4 h-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded cursor-pointer"})})]},p.module)})})]})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:S.isPending||b.length===0,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:S.isPending?"Creating...":"Create Role"}),e.jsx("button",{type:"button",onClick:()=>{m(!1),w([])},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})}),j&&a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Edit Role"}),e.jsx("button",{onClick:()=>{C(!1),r(null),w([])},className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:Ie,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role Name *"}),e.jsx("input",{type:"text",name:"name",defaultValue:a.name,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{name:"description",rows:3,defaultValue:a.description||"",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status *"}),e.jsxs("select",{name:"isActive",defaultValue:a.isActive?"true":"false",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",children:[e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Permissions"}),e.jsx("div",{className:"overflow-x-auto border border-gray-300 rounded-md",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Module"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase",children:"View"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase",children:"Add"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase",children:"Edit"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase",children:"Delete"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.map(p=>{var M;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 text-sm",children:((M=$.find(P=>P.value===p.module))==null?void 0:M.label)||p.module}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("input",{type:"checkbox",checked:p.canView,onChange:P=>Ae(p.module,"canView",P.target.checked),className:"w-4 h-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded"})}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("input",{type:"checkbox",checked:p.canAdd,onChange:P=>Ae(p.module,"canAdd",P.target.checked),className:"w-4 h-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded"})}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("input",{type:"checkbox",checked:p.canEdit,onChange:P=>Ae(p.module,"canEdit",P.target.checked),className:"w-4 h-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded"})}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("input",{type:"checkbox",checked:p.canDelete,onChange:P=>Ae(p.module,"canDelete",P.target.checked),className:"w-4 h-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded"})})]},p.module)})})]})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:x.isPending,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 transition-colors disabled:opacity-50",children:x.isPending?"Updating...":"Update Role"}),e.jsx("button",{type:"button",onClick:()=>{C(!1),r(null),w([])},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})}),re&&n&&!a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-2xl font-bold",children:["View Permissions - ",n.charAt(0).toUpperCase()+n.slice(1)]}),e.jsx("button",{onClick:()=>{T(!1),i(""),w([])},className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Note:"}),' This is a predefined system role. Click "Edit" to modify permissions.']})}),e.jsx("div",{className:"overflow-x-auto border border-gray-300 rounded-md mb-4 max-h-96 overflow-y-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Module"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"View"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Add"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Edit"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Delete"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.map(p=>{var M;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:((M=$.find(P=>P.value===p.module))==null?void 0:M.label)||p.module}),e.jsx("td",{className:"px-4 py-3 text-center",children:p.canView?e.jsx("span",{className:"text-green-600 font-semibold",children:""}):e.jsx("span",{className:"text-gray-400",children:""})}),e.jsx("td",{className:"px-4 py-3 text-center",children:p.canAdd?e.jsx("span",{className:"text-green-600 font-semibold",children:""}):e.jsx("span",{className:"text-gray-400",children:""})}),e.jsx("td",{className:"px-4 py-3 text-center",children:p.canEdit?e.jsx("span",{className:"text-green-600 font-semibold",children:""}):e.jsx("span",{className:"text-gray-400",children:""})}),e.jsx("td",{className:"px-4 py-3 text-center",children:p.canDelete?e.jsx("span",{className:"text-green-600 font-semibold",children:""}):e.jsx("span",{className:"text-gray-400",children:""})})]},p.module)})})]})}),e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:()=>{T(!1),i(""),w([])},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Close"})})]})}),j&&n&&!a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-2xl font-bold",children:["Edit Permissions - ",n.charAt(0).toUpperCase()+n.slice(1)]}),e.jsx("button",{onClick:()=>{C(!1),i(""),w([])},className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Warning:"})," Modifying predefined role permissions will affect all users with this role. Changes are saved to the system configuration."]})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Permissions"}),e.jsx("div",{className:"overflow-x-auto border border-gray-300 rounded-md max-h-96 overflow-y-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Module"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"View"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Add"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Edit"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Delete"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.map(p=>{var M;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:((M=$.find(P=>P.value===p.module))==null?void 0:M.label)||p.module}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("input",{type:"checkbox",checked:p.canView,onChange:P=>Ae(p.module,"canView",P.target.checked),className:"w-4 h-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded cursor-pointer"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("input",{type:"checkbox",checked:p.canAdd,onChange:P=>Ae(p.module,"canAdd",P.target.checked),className:"w-4 h-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded cursor-pointer"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("input",{type:"checkbox",checked:p.canEdit,onChange:P=>Ae(p.module,"canEdit",P.target.checked),className:"w-4 h-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded cursor-pointer"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("input",{type:"checkbox",checked:p.canDelete,onChange:P=>Ae(p.module,"canDelete",P.target.checked),className:"w-4 h-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded cursor-pointer"})})]},p.module)})})]})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{alert("Predefined role permissions update functionality needs to be implemented in the backend."),C(!1),i(""),w([])},className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 transition-colors",children:"Save Permissions"}),e.jsx("button",{onClick:()=>{C(!1),i(""),w([])},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})}),re&&a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-2xl font-bold",children:["Manage Permissions - ",a.name]}),e.jsx("button",{onClick:()=>{T(!1),r(null),w([])},className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"overflow-x-auto border border-gray-300 rounded-md mb-4 max-h-96 overflow-y-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Module"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"View"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Add"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Edit"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Delete"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.map(p=>{var M;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:((M=$.find(P=>P.value===p.module))==null?void 0:M.label)||p.module}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("input",{type:"checkbox",checked:p.canView,onChange:P=>Ae(p.module,"canView",P.target.checked),className:"w-4 h-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("input",{type:"checkbox",checked:p.canAdd,onChange:P=>Ae(p.module,"canAdd",P.target.checked),className:"w-4 h-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("input",{type:"checkbox",checked:p.canEdit,onChange:P=>Ae(p.module,"canEdit",P.target.checked),className:"w-4 h-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("input",{type:"checkbox",checked:p.canDelete,onChange:P=>Ae(p.module,"canDelete",P.target.checked),className:"w-4 h-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded"})})]},p.module)})})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:V,disabled:x.isPending,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 transition-colors disabled:opacity-50",children:x.isPending?"Saving...":"Save Permissions"}),e.jsx("button",{onClick:()=>{T(!1),r(null),w([])},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})}),q&&a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-red-600",children:"Delete Role"}),e.jsxs("p",{className:"mb-4 text-gray-700",children:["Are you sure you want to delete ",e.jsx("strong",{children:a.name}),"? This action cannot be undone."]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{a&&Z.mutate(a.id)},disabled:Z.isPending,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition-colors disabled:opacity-50",children:Z.isPending?"Deleting...":"Delete"}),e.jsx("button",{onClick:()=>{K(!1),r(null)},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})})]})},Ws={getAllCertificates:async()=>(await Re.get("/certificates")).data,getCertificateById:async t=>(await Re.get(`/certificates/${t}`)).data,createCertificate:async t=>(await Re.post("/certificates",t)).data,downloadCertificate:async t=>(await Re.get(`/certificates/${t}/download`,{responseType:"blob"})).data},Tl=["Adobe Photoshop","Adobe Illustrator","Corel Draw","Adobe Indesign","Adobe Premiere Pro","Adobe After Effects","Adobe XD","Figma","Sketch","Blender","Maya","Cinema 4D","Autodesk 3ds Max","Unity","Unreal Engine"],Ll=["Graphic Design Prime","Web Design Prime","UI/UX Design Prime","Video Editing Prime","3D Animation Prime","Motion Graphics Prime","Digital Marketing Prime","Full Stack Development Prime"],Ml=["A","B+","B","C"],ql=["Jan - 2025","Feb - 2025","Mar - 2025","Apr - 2025","May - 2025","Jun - 2025","Jul - 2025","Aug - 2025","Sept - 2025","Oct - 2025","Nov - 2025","Dec - 2025"],Bl=()=>{var S,x,Z;const{user:t}=Nt(),s=vt();console.log("CertificateManagement: Component rendering",{user:t==null?void 0:t.role});const[a,r]=g.useState(!1),[n,i]=g.useState({studentId:0,courseName:"",softwareCovered:[],grade:"",monthOfCompletion:"",certificateNumber:"",studentDeclarationAccepted:!1}),[h,m]=g.useState(!1),[j,C]=g.useState(""),{data:q,isLoading:K}=_e({queryKey:["students"],queryFn:()=>kt.getAllStudents()}),{data:re}=_e({queryKey:["batches"],queryFn:()=>St.getAllBatches()}),{data:T,isLoading:b,error:w}=_e({queryKey:["certificates"],queryFn:()=>Ws.getAllCertificates(),retry:1});w&&console.error("Error fetching certificates:",w);const $=st({mutationFn:J=>Ws.createCertificate(J),onSuccess:J=>{s.invalidateQueries({queryKey:["certificates"]}),r(!1),i({studentId:0,courseName:"",softwareCovered:[],grade:"",monthOfCompletion:"",certificateNumber:"",studentDeclarationAccepted:!1}),m(!1),alert("Certificate created successfully! PDF has been generated."),J.data.pdfUrl&&window.open(J.data.pdfUrl,"_blank")},onError:J=>{var Ie,Ae;alert(((Ae=(Ie=J.response)==null?void 0:Ie.data)==null?void 0:Ae.message)||"Failed to create certificate")}}),pe=async J=>{var Ie,Ae;try{const Me=await Ws.downloadCertificate(J),W=window.URL.createObjectURL(Me),Ne=document.createElement("a");Ne.href=W,Ne.download=`certificate_${J}.pdf`,document.body.appendChild(Ne),Ne.click(),document.body.removeChild(Ne),window.URL.revokeObjectURL(W)}catch(Me){alert(((Ae=(Ie=Me.response)==null?void 0:Ie.data)==null?void 0:Ae.message)||"Failed to download certificate")}},Pe=J=>{i(Ie=>({...Ie,softwareCovered:Ie.softwareCovered.includes(J)?Ie.softwareCovered.filter(Ae=>Ae!==J):[...Ie.softwareCovered,J]}))},te=J=>{if(J.preventDefault(),!n.studentId||!n.courseName||!n.grade||!n.monthOfCompletion){alert("Please fill all required fields");return}if(n.softwareCovered.length===0){alert("Please select at least one software");return}$.mutate(n)},Y=((S=q==null?void 0:q.data)==null?void 0:S.students)||[],o=((x=T==null?void 0:T.data)==null?void 0:x.certificates)||[],de=(t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin",N=o.filter(J=>{var Ae,Me,W,Ne,V,Qe,ve,p;if(!j.trim())return!0;const Ie=j.toLowerCase();return((Me=(Ae=J.student)==null?void 0:Ae.name)==null?void 0:Me.toLowerCase().includes(Ie))||((Ne=(W=J.student)==null?void 0:W.email)==null?void 0:Ne.toLowerCase().includes(Ie))||((V=J.courseName)==null?void 0:V.toLowerCase().includes(Ie))||((Qe=J.certificateNumber)==null?void 0:Qe.toLowerCase().includes(Ie))||((ve=J.softwareCovered)==null?void 0:ve.some(M=>M.toLowerCase().includes(Ie)))||((p=J.grade)==null?void 0:p.toLowerCase().includes(Ie))});return t?de?w?e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-8 text-center",children:[e.jsx("p",{className:"text-red-600 text-lg font-semibold",children:"Error Loading Certificates"}),e.jsx("p",{className:"mt-2 text-gray-700",children:w instanceof Error?w.message:"Failed to load certificates. Please check your connection and try again."}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-6 py-3 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors",children:"Retry"})]})})}):b||K?e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-8",children:[e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}),e.jsx("p",{className:"text-center text-gray-600 mt-4",children:"Loading certificates..."})]})})}):e.jsx(et,{children:e.jsxs("div",{className:"max-w-7xl mx-auto p-4 md:p-6",children:[e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-orange-500 px-4 md:px-8 py-4 md:py-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-white",children:"Certificate Management"}),e.jsx("p",{className:"mt-2 text-orange-100",children:"Create and manage student certificates"})]}),e.jsx("button",{onClick:()=>r(!0),className:"px-6 py-3 bg-white text-orange-600 rounded-lg font-semibold hover:bg-orange-50 transition-colors",children:"+ Create Certificate"})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"relative max-w-md",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Search certificates by student, course, certificate number, or software...",value:j,onChange:J=>C(J.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"}),j&&e.jsx("button",{onClick:()=>C(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400 hover:text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),j&&e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Showing ",N.length," of ",o.length," certificates"]})]}),N.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500 text-lg",children:j?"No certificates found matching your search":"No certificates created yet."}),!j&&e.jsx("button",{onClick:()=>r(!0),className:"mt-4 px-6 py-3 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors",children:"Create First Certificate"}),j&&e.jsx("button",{onClick:()=>C(""),className:"mt-2 text-orange-600 hover:text-orange-700 text-sm",children:"Clear search"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Certificate #"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Student"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Course"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Software"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Grade"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Month"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Declaration"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:N.map(J=>{var Ie,Ae;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-900",children:J.certificateNumber}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:((Ie=J.student)==null?void 0:Ie.name)||"N/A"}),e.jsx("div",{className:"text-sm text-gray-500",children:((Ae=J.student)==null?void 0:Ae.email)||""})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:J.courseName}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:(()=>{let Me=[];return Array.isArray(J.softwareCovered)?Me=J.softwareCovered:typeof J.softwareCovered=="string"&&(Me=J.softwareCovered.split(",").map(Ne=>Ne.trim()).filter(Ne=>Ne.length>0)),e.jsxs(e.Fragment,{children:[Me.slice(0,3).map((W,Ne)=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs",children:W},Ne)),Me.length>3&&e.jsxs("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 rounded text-xs",children:["+",Me.length-3]})]})})()})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${J.grade==="A"?"bg-green-100 text-green-800":J.grade==="B+"?"bg-blue-100 text-blue-800":J.grade==="B"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:J.grade})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:J.monthOfCompletion}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:J.studentDeclarationAccepted?e.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs font-semibold",children:"Accepted"}):e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 rounded text-xs",children:"Not Required"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx("button",{onClick:()=>pe(J.id),className:"text-orange-600 hover:text-orange-900 mr-4",children:" Download"}),J.pdfUrl&&e.jsx("a",{href:J.pdfUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-900",children:" View"})]})]},J.id)})})]})})]})]}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-orange-500 px-6 py-4",children:e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Create Certificate"})}),e.jsxs("form",{onSubmit:te,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Student ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:n.studentId,onChange:J=>i({...n,studentId:Number(J.target.value)}),required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:0,children:"Select Student"}),Y.map(J=>e.jsxs("option",{value:J.id,children:[J.name," (",J.email,")"]},J.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Course Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:n.courseName,onChange:J=>i({...n,courseName:J.target.value}),required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select Course"}),Ll.map(J=>e.jsx("option",{value:J,children:J},J))]}),e.jsx("input",{type:"text",placeholder:"Or enter custom course name",value:n.courseName,onChange:J=>i({...n,courseName:J.target.value}),className:"mt-2 w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Software Covered ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"border border-gray-300 rounded-lg p-4 max-h-48 overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Tl.map(J=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.softwareCovered.includes(J),onChange:()=>Pe(J),className:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:J})]},J))})}),n.softwareCovered.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:n.softwareCovered.map(J=>e.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 rounded text-xs",children:J},J))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Grade ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:n.grade,onChange:J=>i({...n,grade:J.target.value}),required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select Grade"}),Ml.map(J=>e.jsx("option",{value:J,children:J},J))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Month of Completion ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:n.monthOfCompletion,onChange:J=>i({...n,monthOfCompletion:J.target.value}),required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select Month"}),ql.map(J=>e.jsx("option",{value:J,children:J},J))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Certificate Number (Optional - Auto-generated if empty)"}),e.jsx("input",{type:"text",value:n.certificateNumber,onChange:J=>i({...n,certificateNumber:J.target.value}),placeholder:"e.g., PA/A/MP/20251120",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Leave empty to auto-generate based on student name and course"})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-blue-800 mb-2",children:[e.jsx("strong",{children:"Note:"})," Please note it is mandatory to submit the completed portfolio for certificate request. Placement and certificate will be strictly subject to portfolio approval and attendance verification."]}),e.jsx("p",{className:"text-sm text-blue-800",children:"In case, you require the certificate without submission/completion of portfolio then please accept the below terms and sign the declaration. Hence forth, you will not be eligible for placement from Prime Academy."})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:J=>{m(J.target.checked),J.target.checked||i({...n,studentDeclarationAccepted:!1})},className:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"I want to request certificate without portfolio submission"})]})}),h&&e.jsxs("div",{className:"p-4 bg-gray-50 border-2 border-green-600 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Student Declaration:"}),e.jsxs("div",{className:"mb-4 text-sm text-gray-700 leading-relaxed",children:[e.jsxs("p",{className:"mb-2",children:["This is a confirmation from ",e.jsx("strong",{children:((Z=Y.find(J=>J.id===n.studentId))==null?void 0:Z.name)||"[Student Name]"}),", I completely understand the policy of the portfolio submission in Professional development and job placement from the Academy."]}),e.jsx("p",{className:"mb-2",children:"But, I am not seeking job placement from the academy or any recommendation. This request is only for the certificate of course completion without submission of my portfolio."}),e.jsx("p",{children:"I understand that I will not be following up ahead anytime for any job related support or recommendation in future from the academy."})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("label",{className:"flex items-start space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.studentDeclarationAccepted||!1,onChange:J=>i({...n,studentDeclarationAccepted:J.target.checked}),className:"mt-1 w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"I accept and agree to the above declaration terms and conditions"})]})}),e.jsxs("div",{className:"mt-4 p-3 bg-white border border-gray-300 rounded",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"Signature / Date:"}),e.jsx("div",{className:"h-16 border-2 border-dashed border-gray-400 rounded flex items-center justify-center text-gray-400 text-sm",children:"[Signature Box]"})]})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"submit",disabled:$.isPending,className:"flex-1 px-6 py-3 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50",children:$.isPending?"Generating...":"Generate Certificate"}),e.jsx("button",{type:"button",onClick:()=>{r(!1),i({studentId:0,courseName:"",softwareCovered:[],grade:"",monthOfCompletion:"",certificateNumber:""})},className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})})]})}):e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-8 text-center",children:[e.jsx("p",{className:"text-red-600 text-lg font-semibold",children:"Access Denied"}),e.jsx("p",{className:"mt-2 text-gray-700",children:"You don't have permission to manage certificates."})]})})}):e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})})})})},ss={getAllDevices:async()=>(await Re.get("/biometric/devices")).data,registerDevice:async t=>(await Re.post("/biometric/register-device",t)).data,updateDevice:async(t,s)=>(await Re.put(`/biometric/device/${t}`,s)).data,deleteDevice:async t=>{await Re.delete(`/biometric/device/${t}`)},testConnection:async t=>(await Re.post(`/biometric/device/${t}/test-connection`)).data,syncNow:async t=>(await Re.post(`/biometric/device/${t}/sync-now`)).data},$l=()=>{const{user:t}=Nt(),s=vt(),[a,r]=g.useState(!1),[n,i]=g.useState(!1),[h,m]=g.useState(!1),[j,C]=g.useState(null),[q,K]=g.useState(null),[re,T]=g.useState(null),[b,w]=g.useState({deviceName:"",deviceType:"pull-api",ipAddress:"",port:void 0,apiUrl:"",authKey:""}),{data:$,isLoading:pe}=_e({queryKey:["biometric-devices"],queryFn:()=>ss.getAllDevices(),enabled:(t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="superadmin"}),Pe=st({mutationFn:W=>ss.registerDevice(W),onSuccess:()=>{s.invalidateQueries({queryKey:["biometric-devices"]}),r(!1),w({deviceName:"",deviceType:"pull-api",ipAddress:"",port:void 0,apiUrl:"",authKey:""}),alert("Device registered successfully!")},onError:W=>{var Ne,V;alert(((V=(Ne=W.response)==null?void 0:Ne.data)==null?void 0:V.message)||"Failed to register device")}}),te=st({mutationFn:({id:W,data:Ne})=>ss.updateDevice(W,Ne),onSuccess:()=>{s.invalidateQueries({queryKey:["biometric-devices"]}),i(!1),C(null),alert("Device updated successfully!")},onError:W=>{var Ne,V;alert(((V=(Ne=W.response)==null?void 0:Ne.data)==null?void 0:V.message)||"Failed to update device")}}),Y=st({mutationFn:W=>ss.deleteDevice(W),onSuccess:()=>{s.invalidateQueries({queryKey:["biometric-devices"]}),m(!1),C(null),alert("Device deleted successfully!")},onError:W=>{var Ne,V;alert(((V=(Ne=W.response)==null?void 0:Ne.data)==null?void 0:V.message)||"Failed to delete device")}}),o=st({mutationFn:W=>ss.testConnection(W),onSuccess:W=>{K(null),W.data.connected?alert("Connection successful!"):alert("Connection failed. Please check device settings.")},onError:W=>{var Ne,V;K(null),alert(((V=(Ne=W.response)==null?void 0:Ne.data)==null?void 0:V.message)||"Connection test failed")}}),de=st({mutationFn:W=>ss.syncNow(W),onSuccess:W=>{T(null),alert(`Sync completed! ${W.data.count} logs processed.`),s.invalidateQueries({queryKey:["biometric-devices"]})},onError:W=>{var Ne,V;T(null),alert(((V=(Ne=W.response)==null?void 0:Ne.data)==null?void 0:V.message)||"Sync failed")}}),N=()=>{Pe.mutate(b)},S=()=>{j&&te.mutate({id:j.id,data:{deviceName:b.deviceName,ipAddress:b.ipAddress,port:b.port,apiUrl:b.apiUrl,authKey:b.authKey}})},x=()=>{j&&Y.mutate(j.id)},Z=W=>{K(W),o.mutate(W)},J=W=>{T(W),de.mutate(W)},Ie=W=>{C(W),w({deviceName:W.deviceName,deviceType:W.deviceType,ipAddress:W.ipAddress||"",port:W.port||void 0,apiUrl:W.apiUrl||"",authKey:W.authKey||""}),i(!0)},Ae=W=>{C(W),m(!0)};if((t==null?void 0:t.role)!=="admin"&&(t==null?void 0:t.role)!=="superadmin")return e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-red-600 to-red-500 px-8 py-6",children:e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Access Denied"})}),e.jsx("div",{className:"p-6",children:e.jsx("p",{className:"text-gray-700",children:"You do not have permission to access this page."})})]})})});const Me=($==null?void 0:$.data)||[];return e.jsx(et,{children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-orange-500 px-8 py-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Biometric Device Settings"}),e.jsx("p",{className:"mt-2 text-orange-100",children:"Manage biometric devices and attendance integration"})]}),e.jsx("button",{onClick:()=>{r(!0),w({deviceName:"",deviceType:"pull-api",ipAddress:"",port:void 0,apiUrl:"",authKey:""})},className:"px-4 py-2 bg-white text-orange-600 rounded-lg font-semibold hover:bg-orange-50 transition-colors",children:"+ Add Device"})]})}),e.jsx("div",{className:"p-6",children:pe?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):Me.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500 text-lg",children:"No biometric devices registered yet."}),e.jsx("button",{onClick:()=>r(!0),className:"mt-4 px-4 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors",children:"Add Your First Device"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Device Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Connection"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Sync"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Logs"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Me.map(W=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:W.deviceName})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800",children:W.deviceType})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:W.apiUrl?e.jsx("div",{className:"truncate max-w-xs",title:W.apiUrl,children:W.apiUrl}):W.ipAddress?e.jsxs("div",{children:[W.ipAddress,":",W.port]}):e.jsx("span",{className:"text-gray-400",children:"Not configured"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${W.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:W.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:W.lastSyncAt?new Date(W.lastSyncAt).toLocaleString():"Never"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:W.logCount||0}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[W.deviceType==="pull-api"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Z(W.id),disabled:q===W.id,className:"text-blue-600 hover:text-blue-900 disabled:opacity-50",title:"Test Connection",children:q===W.id?"Testing...":""}),e.jsx("button",{onClick:()=>J(W.id),disabled:re===W.id,className:"text-green-600 hover:text-green-900 disabled:opacity-50",title:"Sync Now",children:re===W.id?"Syncing...":""})]}),e.jsx("button",{onClick:()=>Ie(W),className:"text-indigo-600 hover:text-indigo-900",title:"Edit",children:""}),(t==null?void 0:t.role)==="superadmin"&&e.jsx("button",{onClick:()=>Ae(W),className:"text-red-600 hover:text-red-900",title:"Delete",children:""})]})})]},W.id))})]})})})]}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Register New Device"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Device Name"}),e.jsx("input",{type:"text",value:b.deviceName,onChange:W=>w({...b,deviceName:W.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"e.g., ZKTeco Main Entrance"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Device Type"}),e.jsxs("select",{value:b.deviceType,onChange:W=>w({...b,deviceType:W.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"pull-api",children:"Pull API (Fetch logs from device)"}),e.jsx("option",{value:"push-api",children:"Push API (Device sends logs to us)"})]})]}),b.deviceType==="pull-api"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"API URL (or leave blank to use IP/Port)"}),e.jsx("input",{type:"text",value:b.apiUrl||"",onChange:W=>w({...b,apiUrl:W.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"https://device.example.com/api"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"IP Address"}),e.jsx("input",{type:"text",value:b.ipAddress||"",onChange:W=>w({...b,ipAddress:W.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"192.168.1.100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Port"}),e.jsx("input",{type:"number",value:b.port||"",onChange:W=>w({...b,port:W.target.value?parseInt(W.target.value):void 0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"4370"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Auth Key (Optional)"}),e.jsx("input",{type:"text",value:b.authKey||"",onChange:W=>w({...b,authKey:W.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"Device authentication key"})]}),b.deviceType==="push-api"&&e.jsxs("div",{className:"bg-blue-50 p-3 rounded-md text-sm text-blue-800",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Push API Setup:"}),e.jsxs("p",{children:["Configure your device to send logs to:"," ",e.jsxs("code",{className:"bg-blue-100 px-1 rounded",children:[window.location.origin,"/api/biometric/push-log"]})]}),e.jsx("p",{className:"mt-2",children:"Include deviceId or deviceAuthKey in the request payload."})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>r(!1),className:"px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:N,disabled:!b.deviceName||Pe.isPending,className:"px-4 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700 disabled:opacity-50",children:Pe.isPending?"Registering...":"Register Device"})]})]})}),n&&j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Edit Device"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Device Name"}),e.jsx("input",{type:"text",value:b.deviceName,onChange:W=>w({...b,deviceName:W.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),j.deviceType==="pull-api"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"API URL"}),e.jsx("input",{type:"text",value:b.apiUrl||"",onChange:W=>w({...b,apiUrl:W.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"IP Address"}),e.jsx("input",{type:"text",value:b.ipAddress||"",onChange:W=>w({...b,ipAddress:W.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Port"}),e.jsx("input",{type:"number",value:b.port||"",onChange:W=>w({...b,port:W.target.value?parseInt(W.target.value):void 0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Auth Key"}),e.jsx("input",{type:"text",value:b.authKey||"",onChange:W=>w({...b,authKey:W.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:j.status,onChange:W=>te.mutate({id:j.id,data:{status:W.target.value}}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>{i(!1),C(null)},className:"px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:S,disabled:te.isPending,className:"px-4 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700 disabled:opacity-50",children:te.isPending?"Updating...":"Update Device"})]})]})}),h&&j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Delete Device"}),e.jsxs("p",{className:"text-gray-700 mb-4",children:["Are you sure you want to delete ",e.jsx("strong",{children:j.deviceName}),"? This action cannot be undone."]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>{m(!1),C(null)},className:"px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:x,disabled:Y.isPending,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50",children:Y.isPending?"Deleting...":"Delete"})]})]})})]})})},Ul=()=>{var M;const t=vt(),[s,a]=g.useState(null),[r,n]=g.useState(!1),[i,h]=g.useState(!1),[m,j]=g.useState(!1),[C,q]=g.useState(null),[K,re]=g.useState(!1),[T,b]=g.useState(""),[w,$]=g.useState("all"),[pe,Pe]=g.useState(!1),[te,Y]=g.useState([]),[o,de]=g.useState(!1),[N,S]=g.useState({}),{data:x,isLoading:Z}=_e({queryKey:["users",w],queryFn:()=>yt.getAllUsers(w!=="all"?{role:w}:{})});At.useEffect(()=>{var P;(P=x==null?void 0:x.data)!=null&&P.users&&console.log(" All users fetched:",x.data.users.map(H=>({id:H.id,name:H.name,email:H.email,avatarUrl:H.avatarUrl,hasAvatar:!!H.avatarUrl})))},[x]);const J=st({mutationFn:({userId:P,avatarUrl:H})=>yt.updateUser(P,{avatarUrl:H}),onSuccess:()=>{t.invalidateQueries({queryKey:["users"]}),n(!1),h(!1),a(null),q(null),alert("Photo updated successfully!")},onError:P=>{var H,U;console.error("Update photo error:",P),alert(((U=(H=P.response)==null?void 0:H.data)==null?void 0:U.message)||"Failed to update photo"),re(!1)}}),Ie=st({mutationFn:P=>yt.updateUser(P,{avatarUrl:void 0}),onSuccess:()=>{t.invalidateQueries({queryKey:["users"]}),j(!1),a(null),alert("Photo deleted successfully!")},onError:P=>{var H,U;console.error("Delete photo error:",P),alert(((U=(H=P.response)==null?void 0:H.data)==null?void 0:U.message)||"Failed to delete photo")}}),Ae=P=>{a(P),q(P.avatarUrl||null),n(!0)},Me=P=>{a(P),q(P.avatarUrl||null),h(!0)},W=P=>{a(P),j(!0)},Ne=async P=>{var ce,ae,u;const H=(ce=P.target.files)==null?void 0:ce[0];if(!H||!s)return;if(!H.type.startsWith("image/")){alert("Please select an image file");return}if(H.size>5*1024*1024){alert("Image size must be less than 5MB");return}const U=new FileReader;U.onloadend=()=>{q(U.result)},U.readAsDataURL(H),re(!0);try{const k=await wt.uploadFile(H);if(console.log("Upload response:",k),k.data&&k.data.files&&k.data.files.length>0){const c=k.data.files[0];console.log("Upload response file:",c);const D=c.url;console.log("Storing relative URL in database:",D);const se=He(D);console.log("Full image URL for preview:",se),q(se||D),J.mutate({userId:s.id,avatarUrl:D})}else throw new Error("No files returned from upload")}catch(k){console.error("Upload error:",k),alert(((u=(ae=k.response)==null?void 0:ae.data)==null?void 0:u.message)||k.message||"Failed to upload image"),re(!1),q(s.avatarUrl||null)}},V=()=>{s&&Ie.mutate(s.id)},Qe=((M=x==null?void 0:x.data)==null?void 0:M.users)||[];At.useEffect(()=>{const P=Qe.filter(H=>H.avatarUrl);console.log(" Users with photos:",P.map(H=>({name:H.name,id:H.id,avatarUrl:H.avatarUrl,fullUrl:He(H.avatarUrl||"")})))},[Qe]);const ve=Qe.filter(P=>P.name.toLowerCase().includes(T.toLowerCase())||P.email.toLowerCase().includes(T.toLowerCase())||P.phone&&P.phone.includes(T)),p=ve.reduce((P,H)=>(P[H.role]||(P[H.role]=[]),P[H.role].push(H),P),{});return Z?e.jsx(et,{children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})})})}):e.jsxs(et,{children:[e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-orange-500 px-8 py-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Photo Management"}),e.jsx("p",{className:"mt-2 text-orange-100",children:"Upload, edit, and manage user photos"})]}),e.jsxs("button",{onClick:()=>Pe(!0),className:"px-4 py-2 bg-white text-orange-600 rounded-lg font-semibold hover:bg-orange-50 transition-colors flex items-center gap-2",title:"Bulk upload photos for multiple users",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Bulk Upload"]})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search by name, email, or phone...",value:T,onChange:P=>b(P.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"})}),e.jsxs("select",{value:w,onChange:P=>$(P.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"student",children:"Students"}),e.jsx("option",{value:"faculty",children:"Faculty"}),e.jsx("option",{value:"employee",children:"Employees"}),e.jsx("option",{value:"admin",children:"Admins"}),e.jsx("option",{value:"superadmin",children:"Super Admins"})]})]}),ve.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"No users found"})}):e.jsx("div",{className:"space-y-6",children:Object.entries(p).map(([P,H])=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 capitalize",children:[P," (",H.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:H.map(U=>e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"relative mb-4",children:U.avatarUrl?e.jsx("img",{src:He(U.avatarUrl)||"",alt:U.name,className:"w-24 h-24 rounded-full object-cover border-4 border-orange-500",crossOrigin:"anonymous",onError:ce=>{const ae=He(U.avatarUrl),u=ce.target;console.error(" Image load error:",{user:U.name,userId:U.id,avatarUrl:U.avatarUrl,fullUrl:ae,imageSrc:u.src,error:"Image failed to load"}),u.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIFBob3RvPC90ZXh0Pjwvc3ZnPg=="},onLoad:()=>{console.log(" Image loaded successfully:",{user:U.name,userId:U.id,avatarUrl:U.avatarUrl,fullUrl:He(U.avatarUrl)})}}):e.jsx("div",{className:"w-24 h-24 rounded-full bg-gray-300 border-4 border-orange-500 flex items-center justify-center",children:e.jsx("span",{className:"text-3xl text-gray-600",children:""})})}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 truncate w-full",children:U.name}),e.jsx("p",{className:"text-sm text-gray-500 truncate w-full",children:U.email}),U.phone&&e.jsx("p",{className:"text-xs text-gray-400",children:U.phone}),e.jsx("span",{className:"inline-block mt-1 px-2 py-1 text-xs bg-orange-100 text-orange-700 rounded-full capitalize",children:U.role})]}),e.jsx("div",{className:"flex gap-2 w-full",children:U.avatarUrl?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Me(U),className:"flex-1 px-3 py-2 bg-orange-500 text-white rounded text-xs hover:bg-orange-600 transition-colors",children:"Edit"}),e.jsx("button",{onClick:()=>W(U),className:"flex-1 px-3 py-2 bg-red-500 text-white rounded text-xs hover:bg-red-600 transition-colors",children:"Delete"})]}):e.jsx("button",{onClick:()=>Ae(U),className:"flex-1 px-3 py-2 bg-blue-500 text-white rounded text-xs hover:bg-blue-600 transition-colors",children:"Upload"})})]})},U.id))})]},P))})]})]})}),r&&s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4",children:["Upload Photo for ",s.name]}),e.jsx("div",{className:"mb-4 flex justify-center",children:C?e.jsx("img",{src:He(C)||C,alt:"Preview",className:"w-32 h-32 rounded-full object-cover border-4 border-orange-500",crossOrigin:"anonymous",onError:P=>{console.error("Image load error in upload modal:",C),P.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIFBob3RvPC90ZXh0Pjwvc3ZnPg=="}}):e.jsx("div",{className:"w-32 h-32 rounded-full bg-gray-300 border-4 border-orange-500 flex items-center justify-center",children:e.jsx("span",{className:"text-4xl text-gray-600",children:""})})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Image (JPG, PNG, WEBP, GIF - Max 5MB)"}),e.jsx("input",{type:"file",accept:"image/*",onChange:Ne,disabled:K,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:()=>{n(!1),a(null),q(null)},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors",disabled:K,children:"Cancel"})})]})}),i&&s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4",children:["Edit Photo for ",s.name]}),e.jsx("div",{className:"mb-4 flex justify-center",children:C?e.jsx("img",{src:He(C)||C,alt:"Current Photo",className:"w-32 h-32 rounded-full object-cover border-4 border-orange-500",onError:P=>{console.error("Image load error in edit modal:",C),P.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIFBob3RvPC90ZXh0Pjwvc3ZnPg=="}}):e.jsx("div",{className:"w-32 h-32 rounded-full bg-gray-300 border-4 border-orange-500 flex items-center justify-center",children:e.jsx("span",{className:"text-4xl text-gray-600",children:""})})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select New Image (JPG, PNG, WEBP, GIF - Max 5MB)"}),e.jsx("input",{type:"file",accept:"image/*",onChange:Ne,disabled:K,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"})]}),K&&e.jsxs("div",{className:"mb-4 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500 mx-auto"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Uploading..."})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:()=>{h(!1),a(null),q(null)},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors",disabled:K,children:"Cancel"})})]})}),m&&s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Delete Photo"}),e.jsxs("p",{className:"mb-4 text-gray-600",children:["Are you sure you want to delete the photo for ",e.jsx("strong",{children:s.name}),"?"]}),s.avatarUrl&&e.jsx("div",{className:"mb-4 flex justify-center",children:e.jsx("img",{src:He(s.avatarUrl)||"",alt:"Current Photo",className:"w-24 h-24 rounded-full object-cover border-4 border-red-500",onError:P=>{console.error("Image load error in delete modal:",s.avatarUrl),P.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIFBob3RvPC90ZXh0Pjwvc3ZnPg=="}})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{j(!1),a(null)},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:V,className:"flex-1 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors",children:"Delete"})]})]})}),pe&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Bulk Photo Upload"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Multiple Images (JPG, PNG, WEBP, GIF - Max 5MB each)"}),e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:P=>{const U=Array.from(P.target.files||[]).map(ce=>({file:ce,user:null,preview:URL.createObjectURL(ce)}));Y(ce=>[...ce,...U])},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"Select multiple images, then assign each to a user below"})]}),te.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:["Assign Photos to Users (",te.length," files)"]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:te.map((P,H)=>{var U,ce,ae,u;return e.jsxs("div",{className:"flex items-center gap-4 p-3 border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:P.preview,alt:`Preview ${H+1}`,className:"w-16 h-16 rounded object-cover border-2 border-gray-300"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:P.file.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(P.file.size/1024/1024).toFixed(2)," MB"]})]}),e.jsx("div",{className:"flex-1",children:e.jsxs("select",{value:((U=P.user)==null?void 0:U.id)||"",onChange:k=>{const c=parseInt(k.target.value),D=Qe.find(se=>se.id===c);Y(se=>se.map((ge,G)=>G===H?{...ge,user:D||null}:ge))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select User..."}),Qe.map(k=>e.jsxs("option",{value:k.id,children:[k.name," (",k.email,") - ",k.role]},k.id))]})}),e.jsxs("div",{className:"flex-shrink-0 w-24 text-center",children:[((ce=N[H])==null?void 0:ce.status)==="uploading"&&e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-orange-500 mx-auto"}),((ae=N[H])==null?void 0:ae.status)==="success"&&e.jsx("span",{className:"text-green-600 text-sm",children:" Done"}),((u=N[H])==null?void 0:u.status)==="error"&&e.jsx("span",{className:"text-red-600 text-sm",children:" Error"})]}),e.jsx("button",{onClick:()=>{URL.revokeObjectURL(P.preview),Y(k=>k.filter((c,D)=>D!==H)),S(k=>{const c={...k};return delete c[H],c})},className:"flex-shrink-0 px-3 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600 transition-colors",children:"Remove"})]},H)})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{te.forEach(P=>URL.revokeObjectURL(P.preview)),Y([]),S({}),Pe(!1)},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors",disabled:o,children:"Cancel"}),e.jsx("button",{onClick:async()=>{const P=te.filter(ce=>!ce.user);if(P.length>0){alert(`Please assign users to all ${P.length} file(s)`);return}de(!0),S({});let H=0,U=0;for(let ce=0;ce<te.length;ce++){const ae=te[ce];if(ae.user){S(u=>({...u,[ce]:{status:"uploading"}}));try{if(!ae.file.type.startsWith("image/"))throw new Error("Invalid file type");if(ae.file.size>5*1024*1024)throw new Error("File size exceeds 5MB");const u=await wt.uploadFile(ae.file);if(u.data&&u.data.files&&u.data.files.length>0){const k=u.data.files[0].url;await yt.updateUser(ae.user.id,{avatarUrl:k}),S(c=>({...c,[ce]:{status:"success"}})),H++}else throw new Error("No files returned from upload")}catch(u){console.error(`Error uploading file ${ce+1}:`,u),S(k=>({...k,[ce]:{status:"error",message:u.message||"Upload failed"}})),U++}}}de(!1),te.forEach(ce=>URL.revokeObjectURL(ce.preview)),t.invalidateQueries({queryKey:["users"]}),alert(`Bulk upload completed!
 Success: ${H}
 Errors: ${U}`),U===0&&(Y([]),S({}),Pe(!1))},className:"flex-1 px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:o||te.length===0,children:o?"Uploading...":`Upload ${te.length} Photo(s)`})]})]})})]})},Wl=zt,Vl=()=>{const{user:t}=Nt(),s=vt(),[a,r]=g.useState(""),[n,i]=g.useState([]),[h,m]=g.useState(!1),[j,C]=g.useState(null),{data:q,isLoading:K,error:re,refetch:T}=_e({queryKey:["courses"],queryFn:async()=>{try{const de=await Jt.getAllCourses();return console.log("Fetched courses:",de),de}catch(de){return console.error("Error fetching courses:",de),{status:"error",data:[]}}}}),b=(q==null?void 0:q.data)||[],w=st({mutationFn:async de=>j?await Jt.updateCourse(j.id,de):await Jt.createCourse(de),onSuccess:()=>{s.invalidateQueries({queryKey:["courses"]}),Pe(),alert(j?"Course updated!":"Course created!")},onError:de=>{var N,S;alert(((S=(N=de.response)==null?void 0:N.data)==null?void 0:S.message)||"Failed to save course")}}),$=st({mutationFn:de=>Jt.deleteCourse(de),onSuccess:()=>{s.invalidateQueries({queryKey:["courses"]}),alert("Course deleted!")},onError:de=>{var N,S;alert(((S=(N=de.response)==null?void 0:N.data)==null?void 0:S.message)||"Failed to delete course")}}),pe=de=>{if(de){C(de),r(de.name);const N=Array.isArray(de.software)?de.software:typeof de.software=="string"?de.software.split(",").map(S=>S.trim()).filter(S=>S):[];i(N)}else C(null),r(""),i([]);m(!0)},Pe=()=>{m(!1),C(null),r(""),i([])},te=()=>{if(!a.trim()){alert("Please enter course name");return}if(n.length===0){alert("Please select at least one software");return}w.mutate({name:a.trim(),software:n})},Y=de=>{window.confirm("Are you sure you want to delete this course?")&&$.mutate(de)},o=de=>{i(N=>N.includes(de)?N.filter(S=>S!==de):[...N,de])};return!t||t.role==="student"||t.role==="employee"?e.jsx(et,{children:e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsx("p",{className:"text-red-600",children:"Access denied. This page is not available for your role."})})})}):t.role!=="admin"&&t.role!=="superadmin"&&t.role!=="faculty"?e.jsx(et,{children:e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsx("p",{className:"text-red-600",children:"Access denied. Admin only."})})})}):e.jsx(et,{children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-orange-600 text-white p-6 rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Course Modules"}),e.jsx("p",{className:"text-orange-100 mt-1",children:"Manage courses and software"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>T(),className:"bg-white text-orange-600 px-4 py-2 rounded-lg font-semibold hover:bg-orange-50",title:"Refresh courses",children:" Refresh"}),e.jsx("button",{onClick:()=>pe(),className:"bg-white text-orange-600 px-4 py-2 rounded-lg font-semibold hover:bg-orange-50",children:"+ Add Course"})]})]})}),e.jsxs("div",{className:"p-6",children:[re&&e.jsxs("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("p",{className:"text-red-800",children:["Error loading courses: ",(re==null?void 0:re.message)||"Unknown error"]}),e.jsx("button",{onClick:()=>s.invalidateQueries({queryKey:["courses"]}),className:"mt-2 text-red-600 underline",children:"Retry"})]}),K?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading courses..."})]}):b.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500 text-lg mb-2",children:"No courses found"}),e.jsx("p",{className:"text-gray-400 text-sm mb-4",children:'Click "Add Course" to create your first course'}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx("button",{onClick:()=>T(),className:"bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300",children:" Refresh"}),e.jsx("button",{onClick:()=>pe(),className:"bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700",children:"+ Create First Course"})]})]}):e.jsx("div",{className:"space-y-4",children:b.map(de=>e.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:de.name}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:Array.isArray(de.software)?de.software.map((N,S)=>e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm",children:N},S)):typeof de.software=="string"&&de.software?de.software.split(",").map((N,S)=>e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm",children:N.trim()},S)):null})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx("button",{onClick:()=>pe(de),className:"px-3 py-1 bg-orange-500 text-white rounded hover:bg-orange-600 text-sm",children:"Edit"}),e.jsx("button",{onClick:()=>Y(de.id),className:"px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 text-sm",children:"Delete"})]})]})},de.id))})]})]}),h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:j?"Edit Course":"Add New Course"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Course Name *"}),e.jsx("input",{type:"text",value:a,onChange:de=>r(de.target.value),placeholder:"e.g., Graphics Beginner",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Software List *"}),e.jsx("div",{className:"border border-gray-300 rounded-lg p-4 max-h-60 overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:Wl.map(de=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:n.includes(de),onChange:()=>o(de),className:"w-4 h-4 text-orange-600 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:de})]},de))})}),n.length>0&&e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Selected: ",n.join(", ")]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:te,disabled:w.isPending,className:"flex-1 bg-orange-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-orange-700 disabled:opacity-50",children:w.isPending?"Saving...":"Save"}),e.jsx("button",{onClick:Pe,className:"flex-1 bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300",children:"Cancel"})]})]})})})]})})};class zl extends g.Component{constructor(){super(...arguments);la(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,r){console.error("ErrorBoundary caught an error:",a,r)}render(){var a;return this.state.hasError?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg max-w-md",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Something went wrong"}),e.jsx("p",{className:"text-gray-700 mb-4",children:((a=this.state.error)==null?void 0:a.message)||"An unexpected error occurred"}),e.jsx("button",{onClick:()=>{this.setState({hasError:!1,error:null}),window.location.reload()},className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Reload Page"})]})}):this.props.children}}const Zl=()=>{const t=s=>{console.log("Settings changed:",s)};return e.jsx(et,{children:e.jsx("div",{className:"max-w-4xl mx-auto p-4 md:p-6",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-orange-500 px-4 md:px-8 py-6",children:e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-white",children:"Settings"})}),e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Student Status Settings"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Configure which student statuses are included in batch suggestions."}),e.jsx(nr,{onSettingsChange:t})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Other Settings"}),e.jsx("p",{className:"text-gray-600",children:"Additional settings will be available here in future updates."})]})]})]})})})},ft=({children:t})=>{const{isAuthenticated:s,loading:a}=Nt();return a?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):s?e.jsx(e.Fragment,{children:t}):e.jsx(pr,{to:"/login",replace:!0})};function Kl(){return e.jsxs(hr,{children:[e.jsx(ht,{path:"/login",element:e.jsx(Jn,{})}),e.jsx(ht,{path:"/",element:e.jsx(ft,{children:e.jsx(Sa,{})})}),e.jsx(ht,{path:"/dashboard",element:e.jsx(ft,{children:e.jsx(Sa,{})})}),e.jsx(ht,{path:"/software-completions",element:e.jsx(ft,{children:e.jsx(Qn,{})})}),e.jsx(ht,{path:"/batch-extensions",element:e.jsx(ft,{children:e.jsx(Xn,{})})}),e.jsx(ht,{path:"/batches",element:e.jsx(ft,{children:e.jsx(sl,{})})}),e.jsx(ht,{path:"/batches/create",element:e.jsx(ft,{children:e.jsx(rl,{})})}),e.jsx(ht,{path:"/batches/:id/edit",element:e.jsx(ft,{children:e.jsx(nl,{})})}),e.jsx(ht,{path:"/batches/:id",element:e.jsx(ft,{children:e.jsx(ll,{})})}),e.jsx(ht,{path:"/course-modules",element:e.jsx(ft,{children:e.jsx(Vl,{})})}),e.jsx(ht,{path:"/students",element:e.jsx(ft,{children:e.jsx(xl,{})})}),e.jsx(ht,{path:"/students/enroll",element:e.jsx(ft,{children:e.jsx(gl,{})})}),e.jsx(ht,{path:"/students/:id/edit",element:e.jsx(ft,{children:e.jsx(hl,{})})}),e.jsx(ht,{path:"/faculty",element:e.jsx(ft,{children:e.jsx(ol,{})})}),e.jsx(ht,{path:"/faculty/:id/edit",element:e.jsx(ft,{children:e.jsx(il,{})})}),e.jsx(ht,{path:"/faculty/register",element:e.jsx(ft,{children:e.jsx(jl,{})})}),e.jsx(ht,{path:"/employees/register",element:e.jsx(ft,{children:e.jsx(yl,{})})}),e.jsx(ht,{path:"/employees/:id/edit",element:e.jsx(ft,{children:e.jsx(bl,{})})}),e.jsx(ht,{path:"/employees",element:e.jsx(ft,{children:e.jsx(pl,{})})}),e.jsx(ht,{path:"/sessions",element:e.jsx(ft,{children:e.jsx(Nl,{})})}),e.jsx(ht,{path:"/attendance",element:e.jsx(ft,{children:e.jsx(vl,{})})}),e.jsx(ht,{path:"/my-attendance",element:e.jsx(ft,{children:e.jsx(Sl,{})})}),e.jsx(ht,{path:"/student-attendance",element:e.jsx(ft,{children:e.jsx(kl,{})})}),e.jsx(ht,{path:"/payments",element:e.jsx(ft,{children:e.jsx(Cl,{})})}),e.jsx(ht,{path:"/portfolios",element:e.jsx(ft,{children:e.jsx(Pl,{})})}),e.jsx(ht,{path:"/reports",element:e.jsx(ft,{children:e.jsx(Al,{})})}),e.jsx(ht,{path:"/approvals",element:e.jsx(ft,{children:e.jsx(Dl,{})})}),e.jsx(ht,{path:"/leaves",element:e.jsx(ft,{children:e.jsx(Ca,{})})}),e.jsx(ht,{path:"/student-leaves",element:e.jsx(ft,{children:e.jsx(Ca,{})})}),e.jsx(ht,{path:"/users",element:e.jsx(ft,{children:e.jsx(Fl,{})})}),e.jsx(ht,{path:"/roles",element:e.jsx(ft,{children:e.jsx(Ol,{})})}),e.jsx(ht,{path:"/certificates",element:e.jsx(ft,{children:e.jsx(Bl,{})})}),e.jsx(ht,{path:"/biometric-settings",element:e.jsx(ft,{children:e.jsx($l,{})})}),e.jsx(ht,{path:"/photos",element:e.jsx(ft,{children:e.jsx(Ul,{})})}),e.jsx(ht,{path:"/settings",element:e.jsx(ft,{children:e.jsx(Zl,{})})})]})}function Gl(){return e.jsx(zl,{children:e.jsx(_n,{children:e.jsx(gr,{children:e.jsx(Kl,{})})})})}const _l=new dr({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:1}}});Vs.createRoot(document.getElementById("root")).render(e.jsx(At.StrictMode,{children:e.jsx(cr,{client:_l,children:e.jsx(Gl,{})})}));
