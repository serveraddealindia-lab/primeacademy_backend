# QUICK FIX COMMANDS - Copy and paste these on your VPS one by one

cd /var/www/primeacademy_backend

# 1. Fix .env - Remove PORT=3000 and duplicates
cp .env .env.backup
grep -v "^PORT=" .env > .env.tmp
grep -v "^NODE_ENV=" .env.tmp > .env.tmp2
echo "NODE_ENV=production" >> .env.tmp2
echo "PORT=3001" >> .env.tmp2
mv .env.tmp2 .env
rm -f .env.tmp
cat .env | grep -E "^PORT=|^NODE_ENV="

# 2. Fix import in index.ts (if it's wrong)
sed -i 's/import runPendingMigrations from/import { runPendingMigrations } from/g' src/index.ts
grep "runPendingMigrations" src/index.ts

# 3. Rebuild
npm run build

# 4. Restart
pm2 delete backend-api
pm2 start dist/index.js --name backend-api
pm2 save

# 5. Wait and check
sleep 5
pm2 list
pm2 logs backend-api --lines 20

# 6. Test
curl http://localhost:3001/api/health
curl https://api.prashantthakar.com/api/health
